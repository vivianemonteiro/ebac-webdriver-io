"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.downloadWAD = downloadWAD;
exports.setupWAD = setupWAD;
exports.isWADChecksumOk = isWADChecksumOk;
exports.installWAD = installWAD;
exports.default = exports.isAdmin = exports.getWADExecutablePath = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _path = _interopRequireDefault(require("path"));

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("./logger"));

var _es6Error = _interopRequireDefault(require("es6-error"));

const WAD_VER = '1.2-RC';
const WAD_DOWNLOAD_LINK = `https://github.com/Microsoft/WinAppDriver/releases/download/v${WAD_VER}/WindowsApplicationDriver.msi`;
const WAD_DOWNLOAD_MD5 = 'dbaa9a3f7416c2b73cc5cd0e7452c8d0';
const WAD_DOWNLOAD_TIMEOUT_MS = 60000;
const POSSIBLE_WAD_INSTALL_ROOTS = [process.env['ProgramFiles(x86)'], process.env.ProgramFiles, `${process.env.SystemDrive || 'C:'}\\\\Program Files`];
const WAD_EXE_NAME = 'WinAppDriver.exe';
const WAD_EXE_MD5 = '50d694ebfaa622ef7e4061c1bf52efe6';

class WADNotFoundError extends _es6Error.default {}

const getWADExecutablePath = _lodash.default.memoize(async function getWADInstallPath() {
  const pathCandidates = POSSIBLE_WAD_INSTALL_ROOTS.filter(Boolean).map(root => _path.default.resolve(root, 'Windows Application Driver', WAD_EXE_NAME));

  for (const result of pathCandidates) {
    if (await _appiumSupport.fs.exists(result)) {
      return result;
    }
  }

  throw new WADNotFoundError(`${WAD_EXE_NAME} has not been found in any of these ` + `locations: ${pathCandidates}. Is it installed?`);
});

exports.getWADExecutablePath = getWADExecutablePath;

async function downloadWAD() {
  const tempFile = _path.default.resolve(await _appiumSupport.tempDir.staticDir(), `${_appiumSupport.util.uuidV4()}.msi`);

  _logger.default.info(`Downloading ${WAD_DOWNLOAD_LINK} to '${tempFile}'`);

  await _appiumSupport.net.downloadFile(WAD_DOWNLOAD_LINK, tempFile, {
    timeout: WAD_DOWNLOAD_TIMEOUT_MS
  });
  const downloadedMd5 = await _appiumSupport.fs.md5(tempFile);

  if (downloadedMd5 !== WAD_DOWNLOAD_MD5) {
    throw new Error(`Checksum validation error: expected ${WAD_DOWNLOAD_MD5} but got ${downloadedMd5}`);
  }

  return tempFile;
}

async function installWAD(msiPath) {
  _logger.default.info(`Running MSI installer`);

  await (0, _teen_process.exec)('msiexec', ['/i', msiPath, '/qn']);
}

async function isWADChecksumOk(executablePath) {
  return (await _appiumSupport.fs.md5(executablePath)) === WAD_EXE_MD5;
}

const isAdmin = _lodash.default.memoize(async function isAdmin() {
  try {
    await (0, _teen_process.exec)('fsutil.exe', ['dirty', 'query', process.env.SystemDrive || 'C:']);
    return true;
  } catch (ign) {
    return false;
  }
});

exports.isAdmin = isAdmin;

async function setupWAD() {
  if (!_appiumSupport.system.isWindows()) {
    throw new Error(`Can only download WinAppDriver on Windows!`);
  }

  try {
    const executablePath = await getWADExecutablePath();

    if (await isWADChecksumOk(executablePath)) {
      _logger.default.info(`WinAppDriver version ${WAD_VER} already exists with correct checksum, not re-downloading`);
    } else {
      _logger.default.warn('WinAppDriver exists, but the checksum did not match. Not re-downloading. ' + 'Was it replaced manually?');
    }

    return;
  } catch (e) {
    if (!(e instanceof WADNotFoundError)) {
      throw e;
    }

    _logger.default.info(`WinAppDriver doesn't exist, setting up`);
  }

  if (!(await isAdmin())) {
    throw new Error(`You are not running as an administrator so WinAppDriver cannot be installed for you; please reinstall as admin`);
  }

  const msiPath = await downloadWAD();

  try {
    await installWAD(msiPath);
  } finally {
    await _appiumSupport.fs.rimraf(msiPath);
  }
}

var _default = setupWAD;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9pbnN0YWxsZXIuanMiXSwibmFtZXMiOlsiV0FEX1ZFUiIsIldBRF9ET1dOTE9BRF9MSU5LIiwiV0FEX0RPV05MT0FEX01ENSIsIldBRF9ET1dOTE9BRF9USU1FT1VUX01TIiwiUE9TU0lCTEVfV0FEX0lOU1RBTExfUk9PVFMiLCJwcm9jZXNzIiwiZW52IiwiUHJvZ3JhbUZpbGVzIiwiU3lzdGVtRHJpdmUiLCJXQURfRVhFX05BTUUiLCJXQURfRVhFX01ENSIsIldBRE5vdEZvdW5kRXJyb3IiLCJFUzZFcnJvciIsImdldFdBREV4ZWN1dGFibGVQYXRoIiwiXyIsIm1lbW9pemUiLCJnZXRXQURJbnN0YWxsUGF0aCIsInBhdGhDYW5kaWRhdGVzIiwiZmlsdGVyIiwiQm9vbGVhbiIsIm1hcCIsInJvb3QiLCJwYXRoIiwicmVzb2x2ZSIsInJlc3VsdCIsImZzIiwiZXhpc3RzIiwiZG93bmxvYWRXQUQiLCJ0ZW1wRmlsZSIsInRlbXBEaXIiLCJzdGF0aWNEaXIiLCJ1dGlsIiwidXVpZFY0IiwibG9nIiwiaW5mbyIsIm5ldCIsImRvd25sb2FkRmlsZSIsInRpbWVvdXQiLCJkb3dubG9hZGVkTWQ1IiwibWQ1IiwiRXJyb3IiLCJpbnN0YWxsV0FEIiwibXNpUGF0aCIsImlzV0FEQ2hlY2tzdW1PayIsImV4ZWN1dGFibGVQYXRoIiwiaXNBZG1pbiIsImlnbiIsInNldHVwV0FEIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwid2FybiIsImUiLCJyaW1yYWYiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLE9BQU8sR0FBRyxRQUFoQjtBQUNBLE1BQU1DLGlCQUFpQixHQUFJLGdFQUErREQsT0FBUSwrQkFBbEc7QUFDQSxNQUFNRSxnQkFBZ0IsR0FBRyxrQ0FBekI7QUFDQSxNQUFNQyx1QkFBdUIsR0FBRyxLQUFoQztBQUNBLE1BQU1DLDBCQUEwQixHQUFHLENBQ2pDQyxPQUFPLENB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QUQsQ0FBekIsRUFBMkM7QUFDekNYLHNCQUFJQyxJQUFKLENBQVUsd0JBQXVCbEMsT0FBUSwyREFBekM7QUFDRCxLQUZELE1BRU87QUFDTGlDLHNCQUFJaUIsSUFBSixDQUFTLDhFQUNQLDJCQURGO0FBRUQ7O0FBQ0Q7QUFDRCxHQVRELENBU0UsT0FBT0MsQ0FBUCxFQUFVO0FBQ1YsUUFBSSxFQUFFQSxDQUFDLFlBQVl4QyxnQkFBZixDQUFKLEVBQXNDO0FBQ3BDLFlBQU13QyxDQUFOO0FBQ0Q7O0FBQ0RsQixvQkFBSUMsSUFBSixDQUFVLHdDQUFWO0FBQ0Q7O0FBRUQsTUFBSSxFQUFDLE1BQU1XLE9BQU8sRUFBZCxDQUFKLEVBQXNCO0FBQ3BCLFVBQU0sSUFBSUwsS0FBSixDQUFXLGdIQUFYLENBQU47QUFDRDs7QUFFRCxRQUFNRSxPQUFPLEdBQUcsTUFBTWYsV0FBVyxFQUFqQzs7QUFDQSxNQUFJO0FBQ0YsVUFBTWMsVUFBVSxDQUFDQyxPQUFELENBQWhCO0FBQ0QsR0FGRCxTQUVVO0FBQ1IsVUFBTWpCLGtCQUFHMkIsTUFBSCxDQUFVVixPQUFWLENBQU47QUFDRDtBQUNGOztlQU1jSyxRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHN5c3RlbSwgZnMsIHV0aWwsIG5ldCwgdGVtcERpciB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBFUzZFcnJvciBmcm9tICdlczYtZXJyb3InO1xuXG5cbmNvbnN0IFdBRF9WRVIgPSAnMS4yLVJDJztcbmNvbnN0IFdBRF9ET1dOTE9BRF9MSU5LID0gYGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvV2luQXBwRHJpdmVyL3JlbGVhc2VzL2Rvd25sb2FkL3Yke1dBRF9WRVJ9L1dpbmRvd3NBcHBsaWNhdGlvbkRyaXZlci5tc2lgO1xuY29uc3QgV0FEX0RPV05MT0FEX01ENSA9ICdkYmFhOWEzZjc0MTZjMmI3M2NjNWNkMGU3NDUyYzhkMCc7XG5jb25zdCBXQURfRE9XTkxPQURfVElNRU9VVF9NUyA9IDYwMDAwO1xuY29uc3QgUE9TU0lCTEVfV0FEX0lOU1RBTExfUk9PVFMgPSBbXG4gIHByb2Nlc3MuZW52WydQcm9ncmFtRmlsZXMoeDg2KSddLFxuICBwcm9jZXNzLmVudi5Qcm9ncmFtRmlsZXMsXG4gIGAke3Byb2Nlc3MuZW52LlN5c3RlbURyaXZlIHx8ICdDOid9XFxcXFxcXFxQcm9ncmFtIEZpbGVzYCxcbl07XG5jb25zdCBXQURfRVhFX05BTUUgPSAnV2luQXBwRHJpdmVyLmV4ZSc7XG5jb25zdCBXQURfRVhFX01ENSA9ICc1MGQ2OTRlYmZhYTYyMmVmN2U0MDYxYzFiZjUyZWZlNic7XG4vLyBjb25zdCBXQURfR1VJRCA9ICdERENENThCRi0zN0NGLTQ3NTgtQTE1RS1BNjBFN0NGMjBFNDEnO1xuXG5jbGFzcyBXQUROb3RGb3VuZEVycm9yIGV4dGVuZHMgRVM2RXJyb3Ige31cblxuY29uc3QgZ2V0V0FERXhlY3V0YWJsZVBhdGggPSBfLm1lbW9pemUoYXN5bmMgZnVuY3Rpb24gZ2V0V0FESW5zdGFsbFBhdGggKCkge1xuICAvLyBUT0RPOiBXQUQgaW5zdGFsbGVyIHNob3VsZCB3cml0ZSB0aGUgZnVsbCBwYXRoIHRvIGl0IGludG8gdGhlIHN5c3RlbSByZWdpc3RyeVxuICBjb25zdCBwYXRoQ2FuZGlkYXRlcyA9IFBPU1NJQkxFX1dBRF9JTlNUQUxMX1JPT1RTXG4gICAgLy8gcmVtb3ZlIHVuc2V0IGVudiB2YXJpYWJsZXNcbiAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgLy8gY29uc3RydWN0IGZ1bGwgcGF0aFxuICAgIC5tYXAoKHJvb3QpID0+IHBhdGgucmVzb2x2ZShyb290LCAnV2luZG93cyBBcHBsaWNhdGlvbiBEcml2ZXInLCBXQURfRVhFX05BTUUpKTtcbiAgZm9yIChjb25zdCByZXN1bHQgb2YgcGF0aENhbmRpZGF0ZXMpIHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHJlc3VsdCkpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICB9XG4gIHRocm93IG5ldyBXQUROb3RGb3VuZEVycm9yKGAke1dBRF9FWEVfTkFNRX0gaGFzIG5vdCBiZWVuIGZvdW5kIGluIGFueSBvZiB0aGVzZSBgICtcbiAgICBgbG9jYXRpb25zOiAke3BhdGhDYW5kaWRhdGVzfS4gSXMgaXQgaW5zdGFsbGVkP2ApO1xufSk7XG5cbmFzeW5jIGZ1bmN0aW9uIGRvd25sb2FkV0FEICgpIHtcbiAgY29uc3QgdGVtcEZpbGUgPSBwYXRoLnJlc29sdmUoYXdhaXQgdGVtcERpci5zdGF0aWNEaXIoKSwgYCR7dXRpbC51dWlkVjQoKX0ubXNpYCk7XG5cbiAgLy8gYWN0dWFsbHkgZG93bmxvYWQgdGhlIG1zaSBmaWxlXG4gIGxvZy5pbmZvKGBEb3dubG9hZGluZyAke1dBRF9ET1dOTE9BRF9MSU5LfSB0byAnJHt0ZW1wRmlsZX0nYCk7XG4gIGF3YWl0IG5ldC5kb3dubG9hZEZpbGUoV0FEX0RPV05MT0FEX0xJTkssIHRlbXBGaWxlLCB7dGltZW91dDogV0FEX0RPV05MT0FEX1RJTUVPVVRfTVN9KTtcblxuICAvLyB2YWxpZGF0ZSBjaGVja3N1bVxuICBjb25zdCBkb3dubG9hZGVkTWQ1ID0gYXdhaXQgZnMubWQ1KHRlbXBGaWxlKTtcbiAgaWYgKGRvd25sb2FkZWRNZDUgIT09IFdBRF9ET1dOTE9BRF9NRDUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENoZWNrc3VtIHZhbGlkYXRpb24gZXJyb3I6IGV4cGVjdGVkICR7V0FEX0RPV05MT0FEX01ENX0gYnV0IGdvdCAke2Rvd25sb2FkZWRNZDV9YCk7XG4gIH1cblxuICByZXR1cm4gdGVtcEZpbGU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGluc3RhbGxXQUQgKG1zaVBhdGgpIHtcbiAgbG9nLmluZm8oYFJ1bm5pbmcgTVNJIGluc3RhbGxlcmApO1xuICBhd2FpdCBleGVjKCdtc2lleGVjJywgWycvaScsIG1zaVBhdGgsICcvcW4nXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGlzV0FEQ2hlY2tzdW1PayAoZXhlY3V0YWJsZVBhdGgpIHtcbiAgcmV0dXJuIGF3YWl0IGZzLm1kNShleGVjdXRhYmxlUGF0aCkgPT09IFdBRF9FWEVfTUQ1O1xufVxuXG5jb25zdCBpc0FkbWluID0gXy5tZW1vaXplKGFzeW5jIGZ1bmN0aW9uIGlzQWRtaW4gKCkge1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWMoJ2ZzdXRpbC5leGUnLCBbJ2RpcnR5JywgJ3F1ZXJ5JywgcHJvY2Vzcy5lbnYuU3lzdGVtRHJpdmUgfHwgJ0M6J10pO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChpZ24pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn0pO1xuXG5hc3luYyBmdW5jdGlvbiBzZXR1cFdBRCAoKSB7XG4gIGlmICghc3lzdGVtLmlzV2luZG93cygpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW4gb25seSBkb3dubG9hZCBXaW5BcHBEcml2ZXIgb24gV2luZG93cyFgKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgZXhlY3V0YWJsZVBhdGggPSBhd2FpdCBnZXRXQURFeGVjdXRhYmxlUGF0aCgpO1xuICAgIGlmIChhd2FpdCBpc1dBRENoZWNrc3VtT2soZXhlY3V0YWJsZVBhdGgpKSB7XG4gICAgICBsb2cuaW5mbyhgV2luQXBwRHJpdmVyIHZlcnNpb24gJHtXQURfVkVSfSBhbHJlYWR5IGV4aXN0cyB3aXRoIGNvcnJlY3QgY2hlY2tzdW0sIG5vdCByZS1kb3dubG9hZGluZ2ApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cud2FybignV2luQXBwRHJpdmVyIGV4aXN0cywgYnV0IHRoZSBjaGVja3N1bSBkaWQgbm90IG1hdGNoLiBOb3QgcmUtZG93bmxvYWRpbmcuICcgK1xuICAgICAgICAnV2FzIGl0IHJlcGxhY2VkIG1hbnVhbGx5PycpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIShlIGluc3RhbmNlb2YgV0FETm90Rm91bmRFcnJvcikpIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICAgIGxvZy5pbmZvKGBXaW5BcHBEcml2ZXIgZG9lc24ndCBleGlzdCwgc2V0dGluZyB1cGApO1xuICB9XG5cbiAgaWYgKCFhd2FpdCBpc0FkbWluKCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFlvdSBhcmUgbm90IHJ1bm5pbmcgYXMgYW4gYWRtaW5pc3RyYXRvciBzbyBXaW5BcHBEcml2ZXIgY2Fubm90IGJlIGluc3RhbGxlZCBmb3IgeW91OyBwbGVhc2UgcmVpbnN0YWxsIGFzIGFkbWluYCk7XG4gIH1cblxuICBjb25zdCBtc2lQYXRoID0gYXdhaXQgZG93bmxvYWRXQUQoKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBpbnN0YWxsV0FEKG1zaVBhdGgpO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGZzLnJpbXJhZihtc2lQYXRoKTtcbiAgfVxufVxuXG5leHBvcnQge1xuICBkb3dubG9hZFdBRCwgc2V0dXBXQUQsIGlzV0FEQ2hlY2tzdW1PaywgaW5zdGFsbFdBRCxcbiAgZ2V0V0FERXhlY3V0YWJsZVBhdGgsIGlzQWRtaW4sXG59O1xuZXhwb3J0IGRlZmF1bHQgc2V0dXBXQUQ7XG4iXSwiZmlsZSI6ImxpYi9pbnN0YWxsZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
