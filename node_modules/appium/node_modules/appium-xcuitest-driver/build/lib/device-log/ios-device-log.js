"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.IOSDeviceLog = void 0;

require("source-map-support/register");

var _appiumSupport = require("appium-support");

var _iosLog = require("./ios-log");

var _appiumIosDevice = require("appium-ios-device");

const log = _appiumSupport.logger.getLogger('IOSDeviceLog');

class IOSDeviceLog extends _iosLog.IOSLog {
  constructor(opts) {
    super();
    this.udid = opts.udid;
    this.showLogs = !!opts.showLogs;
    this.service = null;
  }

  async startCapture() {
    if (this.service) {
      return;
    }

    this.service = await _appiumIosDevice.services.startSyslogService(this.udid);
    this.service.start(this.onLog.bind(this));
  }

  onLog(logLine) {
    this.broadcast(logLine);

    if (this.showLogs) {
      log.info(logLine);
    }
  }

  get isCapturing() {
    return !!this.service;
  }

  stopCapture() {
    if (!this.service) {
      return;
    }

    this.service.close();
    this.service = null;
  }

}

exports.IOSDeviceLog = IOSDeviceLog;
var _default = IOSDeviceLog;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZXZpY2UtbG9nL2lvcy1kZXZpY2UtbG9nLmpzIl0sIm5hbWVzIjpbImxvZyIsImxvZ2dlciIsImdldExvZ2dlciIsIklPU0RldmljZUxvZyIsIklPU0xvZyIsImNvbnN0cnVjdG9yIiwib3B0cyIsInVkaWQiLCJzaG93TG9ncyIsInNlcnZpY2UiLCJzdGFydENhcHR1cmUiLCJzZXJ2aWNlcyIsInN0YXJ0U3lzbG9nU2VydmljZSIsInN0YXJ0Iiwib25Mb2ciLCJiaW5kIiwibG9nTGluZSIsImJyb2FkY2FzdCIsImluZm8iLCJpc0NhcHR1cmluZyIsInN0b3BDYXB0dXJlIiwiY2xvc2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLEdBQUcsR0FBR0Msc0JBQU9DLFNBQVAsQ0FBaUIsY0FBakIsQ0FBWjs7QUFFQSxNQUFNQyxZQUFOLFNBQTJCQyxjQUEzQixDQUFrQztBQUVoQ0MsRUFBQUEsV0FBVyxDQUFFQyxJQUFGLEVBQVE7QUFDakI7QUFDQSxTQUFLQyxJQUFMLEdBQVlELElBQUksQ0FBQ0MsSUFBakI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCLENBQUMsQ0FBQ0YsSUFBSSxDQUFDRSxRQUF2QjtBQUNBLFNBQUtDLE9BQUwsR0FBZSxJQUFmO0FBQ0Q7O0FBRWlCLFFBQVpDLFlBQVksR0FBSTtBQUNwQixRQUFJLEtBQUtELE9BQVQsRUFBa0I7QUFDaEI7QUFDRDs7QUFDRCxTQUFLQSxPQUFMLEdBQWUsTUFBTUUsMEJBQVNDLGtCQUFULENBQTRCLEtBQUtMLElBQWpDLENBQXJCO0FBQ0EsU0FBS0UsT0FBTCxDQUFhSSxLQUFiLENBQW1CLEtBQUtDLEtBQUwsQ0FBV0MsSUFBWCxDQUFnQixJQUFoQixDQUFuQjtBQUNEOztBQUVERCxFQUFBQSxLQUFLLENBQUVFLE9BQUYsRUFBVztBQUNkLFNBQUtDLFNBQUwsQ0FBZUQsT0FBZjs7QUFDQSxRQUFJLEtBQUtSLFFBQVQsRUFBbUI7QUFDakJSLE1BQUFBLEdBQUcsQ0FBQ2tCLElBQUosQ0FBU0YsT0FBVDtBQUNEO0FBQ0Y7O0FBRWMsTUFBWEcsV0FBVyxHQUFJO0FBQ2pCLFdBQU8sQ0FBQyxDQUFDLEtBQUtWLE9BQWQ7QUFDRDs7QUFFRFcsRUFBQUEsV0FBVyxHQUFJO0FBQ2IsUUFBSSxDQUFDLEtBQUtYLE9BQVYsRUFBbUI7QUFDakI7QUFDRDs7QUFDRCxTQUFLQSxPQUFMLENBQWFZLEtBQWI7QUFDQSxTQUFLWixPQUFMLEdBQWUsSUFBZjtBQUNEOztBQWxDK0I7OztlQXNDbkJOLFkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBJT1NMb2cgfSBmcm9tICcuL2lvcy1sb2cnO1xuaW1wb3J0IHsgc2VydmljZXMgfSBmcm9tICdhcHBpdW0taW9zLWRldmljZSc7XG5cbmNvbnN0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0lPU0RldmljZUxvZycpO1xuXG5jbGFzcyBJT1NEZXZpY2VMb2cgZXh0ZW5kcyBJT1NMb2cge1xuXG4gIGNvbnN0cnVjdG9yIChvcHRzKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnVkaWQgPSBvcHRzLnVkaWQ7XG4gICAgdGhpcy5zaG93TG9ncyA9ICEhb3B0cy5zaG93TG9ncztcbiAgICB0aGlzLnNlcnZpY2UgPSBudWxsO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRDYXB0dXJlICgpIHtcbiAgICBpZiAodGhpcy5zZXJ2aWNlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLnN0YXJ0U3lzbG9nU2VydmljZSh0aGlzLnVkaWQpO1xuICAgIHRoaXMuc2VydmljZS5zdGFydCh0aGlzLm9uTG9nLmJpbmQodGhpcykpO1xuICB9XG5cbiAgb25Mb2cgKGxvZ0xpbmUpIHtcbiAgICB0aGlzLmJyb2FkY2FzdChsb2dMaW5lKTtcbiAgICBpZiAodGhpcy5zaG93TG9ncykge1xuICAgICAgbG9nLmluZm8obG9nTGluZSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGlzQ2FwdHVyaW5nICgpIHtcbiAgICByZXR1cm4gISF0aGlzLnNlcnZpY2U7XG4gIH1cblxuICBzdG9wQ2FwdHVyZSAoKSB7XG4gICAgaWYgKCF0aGlzLnNlcnZpY2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXJ2aWNlLmNsb3NlKCk7XG4gICAgdGhpcy5zZXJ2aWNlID0gbnVsbDtcbiAgfVxufVxuXG5leHBvcnQgeyBJT1NEZXZpY2VMb2cgfTtcbmV4cG9ydCBkZWZhdWx0IElPU0RldmljZUxvZztcbiJdLCJmaWxlIjoibGliL2RldmljZS1sb2cvaW9zLWRldmljZS1sb2cuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
