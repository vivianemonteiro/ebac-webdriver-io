"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WebInspectorEncoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _appiumSupport = require("appium-support");

const WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE = 8096;

class WebInspectorEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, callback) {
    let payloadBuffer = _appiumSupport.plist.createPlist(data, true);

    for (let i = 0; i < payloadBuffer.length; i += this._encode(payloadBuffer, i)) {}

    callback();
  }

  _encode(data, pos) {
    const messageLength = Math.min(data.length - pos, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE);

    if (messageLength < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {
      this.push({
        WIRFinalMessageKey: data.slice(pos, messageLength + pos)
      });
    } else {
      this.push({
        WIRPartialMessageKey: data.slice(pos, messageLength + pos)
      });
    }

    return messageLength;
  }

}

exports.WebInspectorEncoder = WebInspectorEncoder;
var _default = WebInspectorEncoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi93ZWJpbnNwZWN0b3IvdHJhbnNmb3JtZXIvd2ViaW5zcGVjdG9yLWVuY29kZXIuanMiXSwibmFtZXMiOlsiV0VCSU5TUEVDVE9SX1BBUlRJQUxfUEFDS0VUX0NIVU5LX1NJWkUiLCJXZWJJbnNwZWN0b3JFbmNvZGVyIiwiU3RyZWFtIiwiVHJhbnNmb3JtIiwiY29uc3RydWN0b3IiLCJvYmplY3RNb2RlIiwiX3RyYW5zZm9ybSIsImRhdGEiLCJlbmNvZGluZyIsImNhbGxiYWNrIiwicGF5bG9hZEJ1ZmZlciIsInBsaXN0IiwiY3JlYXRlUGxpc3QiLCJpIiwibGVuZ3RoIiwiX2VuY29kZSIsInBvcyIsIm1lc3NhZ2VMZW5ndGgiLCJNYXRoIiwibWluIiwicHVzaCIsIldJUkZpbmFsTWVzc2FnZUtleSIsInNsaWNlIiwiV0lSUGFydGlhbE1lc3NhZ2VLZXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsc0NBQXNDLEdBQUcsSUFBL0M7O0FBRUEsTUFBTUMsbUJBQU4sU0FBa0NDLGdCQUFPQyxTQUF6QyxDQUFtRDtBQUVqREMsRUFBQUEsV0FBVyxHQUFJO0FBQ2IsVUFBTTtBQUFFQyxNQUFBQSxVQUFVLEVBQUU7QUFBZCxLQUFOO0FBQ0Q7O0FBRURDLEVBQUFBLFVBQVUsQ0FBRUMsSUFBRixFQUFRQyxRQUFSLEVBQWtCQyxRQUFsQixFQUE0QjtBQUNwQyxRQUFJQyxhQUFhLEdBQUdDLHFCQUFNQyxXQUFOLENBQWtCTCxJQUFsQixFQUF3QixJQUF4QixDQUFwQjs7QUFDQSxTQUFLLElBQUlNLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdILGFBQWEsQ0FBQ0ksTUFBbEMsRUFBMENELENBQUMsSUFBSSxLQUFLRSxPQUFMLENBQWFMLGFBQWIsRUFBNEJHLENBQTVCLENBQS9DLEVBQStFLENBQUU7O0FBQ2pGSixJQUFBQSxRQUFRO0FBQ1Q7O0FBRURNLEVBQUFBLE9BQU8sQ0FBRVIsSUFBRixFQUFRUyxHQUFSLEVBQWE7QUFDbEIsVUFBTUMsYUFBYSxHQUFHQyxJQUFJLENBQUNDLEdBQUwsQ0FBU1osSUFBSSxDQUFDTyxNQUFMLEdBQWNFLEdBQXZCLEVBQTRCaEIsc0NBQTVCLENBQXRCOztBQUNBLFFBQUlpQixhQUFhLEdBQUdqQixzQ0FBcEIsRUFBNEQ7QUFDMUQsV0FBS29CLElBQUwsQ0FBVTtBQUFDQyxRQUFBQSxrQkFBa0IsRUFBRWQsSUFBSSxDQUFDZSxLQUFMLENBQVdOLEdBQVgsRUFBZ0JDLGFBQWEsR0FBR0QsR0FBaEM7QUFBckIsT0FBVjtBQUNELEtBRkQsTUFFTztBQUNMLFdBQUtJLElBQUwsQ0FBVTtBQUFDRyxRQUFBQSxvQkFBb0IsRUFBRWhCLElBQUksQ0FBQ2UsS0FBTCxDQUFXTixHQUFYLEVBQWdCQyxhQUFhLEdBQUdELEdBQWhDO0FBQXZCLE9BQVY7QUFDRDs7QUFDRCxXQUFPQyxhQUFQO0FBQ0Q7O0FBcEJnRDs7O2VBeUJwQ2hCLG1CIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzICovXG5pbXBvcnQgU3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgeyBwbGlzdCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcblxuY29uc3QgV0VCSU5TUEVDVE9SX1BBUlRJQUxfUEFDS0VUX0NIVU5LX1NJWkUgPSA4MDk2O1xuXG5jbGFzcyBXZWJJbnNwZWN0b3JFbmNvZGVyIGV4dGVuZHMgU3RyZWFtLlRyYW5zZm9ybSB7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKHsgb2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIF90cmFuc2Zvcm0gKGRhdGEsIGVuY29kaW5nLCBjYWxsYmFjaykge1xuICAgIGxldCBwYXlsb2FkQnVmZmVyID0gcGxpc3QuY3JlYXRlUGxpc3QoZGF0YSwgdHJ1ZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXlsb2FkQnVmZmVyLmxlbmd0aDsgaSArPSB0aGlzLl9lbmNvZGUocGF5bG9hZEJ1ZmZlciwgaSkpIHt9XG4gICAgY2FsbGJhY2soKTtcbiAgfVxuXG4gIF9lbmNvZGUgKGRhdGEsIHBvcykge1xuICAgIGNvbnN0IG1lc3NhZ2VMZW5ndGggPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIHBvcywgV0VCSU5TUEVDVE9SX1BBUlRJQUxfUEFDS0VUX0NIVU5LX1NJWkUpO1xuICAgIGlmIChtZXNzYWdlTGVuZ3RoIDwgV0VCSU5TUEVDVE9SX1BBUlRJQUxfUEFDS0VUX0NIVU5LX1NJWkUpIHtcbiAgICAgIHRoaXMucHVzaCh7V0lSRmluYWxNZXNzYWdlS2V5OiBkYXRhLnNsaWNlKHBvcywgbWVzc2FnZUxlbmd0aCArIHBvcyl9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wdXNoKHtXSVJQYXJ0aWFsTWVzc2FnZUtleTogZGF0YS5zbGljZShwb3MsIG1lc3NhZ2VMZW5ndGggKyBwb3MpfSk7XG4gICAgfVxuICAgIHJldHVybiBtZXNzYWdlTGVuZ3RoO1xuICB9XG5cbn1cblxuZXhwb3J0IHsgV2ViSW5zcGVjdG9yRW5jb2RlciB9O1xuZXhwb3J0IGRlZmF1bHQgV2ViSW5zcGVjdG9yRW5jb2RlcjsiXSwiZmlsZSI6ImxpYi93ZWJpbnNwZWN0b3IvdHJhbnNmb3JtZXIvd2ViaW5zcGVjdG9yLWVuY29kZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
