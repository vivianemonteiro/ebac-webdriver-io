"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.RemoteMessages = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

class RemoteMessages {
  constructor(isTargetBased = false) {
    this.isTargetBased = isTargetBased;
  }

  setCommunicationProtocol(isTargetBased) {
    this.isTargetBased = isTargetBased;
  }

  setConnectionKey(connId) {
    return {
      __argument: {
        WIRConnectionIdentifierKey: connId
      },
      __selector: '_rpc_reportIdentifier:'
    };
  }

  connectToApp(connId, appIdKey) {
    return {
      __argument: {
        WIRConnectionIdentifierKey: connId,
        WIRApplicationIdentifierKey: appIdKey
      },
      __selector: '_rpc_forwardGetListing:'
    };
  }

  setSenderKey(connId, senderId, appIdKey, pageIdKey) {
    return {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRPageIdentifierKey: pageIdKey,
        WIRAutomaticallyPause: false
      },
      __selector: '_rpc_forwardSocketSetup:'
    };
  }

  indicateWebView(connId, appIdKey, pageIdKey, opts) {
    const {
      enabled
    } = opts;
    return {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRIndicateEnabledKey: _lodash.default.isUndefined(enabled) ? true : enabled,
        WIRConnectionIdentifierKey: connId,
        WIRPageIdentifierKey: pageIdKey
      },
      __selector: '_rpc_forwardIndicateWebView:'
    };
  }

  launchApplication(bundleId) {
    return {
      __argument: {
        WIRApplicationBundleIdentifierKey: bundleId
      },
      __selector: '_rpc_requestApplicationLaunch:'
    };
  }

  getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params) {
    const [realMethod, realParams] = this.isTargetBased ? ['Target.sendMessageToTarget', {
      message: {
        method,
        params
      }
    }] : [method, params];
    return this.command(realMethod, realParams, appIdKey, connId, senderId, pageIdKey);
  }

  sendJSCommand(connId, senderId, appIdKey, pageIdKey, opts = {}) {
    const method = 'Runtime.evaluate';
    const params = {
      expression: opts.command,
      returnByValue: _lodash.default.isBoolean(opts.returnByValue) ? opts.returnByValue : true
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  callJSFunction(connId, senderId, appIdKey, pageIdKey, opts = {}) {
    const method = 'Runtime.callFunctionOn';
    const params = {
      objectId: opts.objId,
      functionDeclaration: opts.fn,
      arguments: opts.args,
      returnByValue: true
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  setUrl(connId, senderId, appIdKey, pageIdKey, opts = {}) {
    const method = 'Page.navigate';
    const params = {
      url: opts.url
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  enablePage(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Page.enable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  startTimeline(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Timeline.start';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  stopTimeline(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Timeline.stop';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  startConsole(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Console.enable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  stopConsole(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Console.disable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  startNetwork(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Network.enable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  stopNetwork(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Network.disable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  getCookies(connId, senderId, appIdKey, pageIdKey, opts = {}) {
    const method = 'Page.getCookies';
    const params = {
      urls: opts.url
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  deleteCookie(connId, senderId, appIdKey, pageIdKey, opts = {}) {
    const method = 'Page.deleteCookie';
    const params = {
      cookieName: opts.cookieName,
      url: opts.url
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  garbageCollect(connId, senderId, appIdKey, pageIdKey) {
    const method = 'Heap.gc';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  awaitPromise(connId, senderId, appIdKey, pageIdKey, opts) {
    const method = 'Runtime.awaitPromise';
    const params = {
      promiseObjectId: opts.promiseObjectId,
      returnByValue: true,
      generatePreview: true,
      saveResult: true
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, method, params);
  }

  command(method, params, appIdKey, connId, senderId, pageIdKey) {
    let plist = {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRSocketDataKey: {
          method,
          params: {
            objectGroup: 'console',
            includeCommandLineAPI: true,
            doNotPauseOnExceptionsAndMuteConsole: true
          }
        },
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRPageIdentifierKey: pageIdKey,
        WIRAutomaticallyPause: true
      },
      __selector: '_rpc_forwardSocketData:'
    };

    if (params) {
      plist.__argument.WIRSocketDataKey.params = _lodash.default.extend(plist.__argument.WIRSocketDataKey.params, params);
    }

    return plist;
  }

  getRemoteCommand(command, opts) {
    const {
      connId,
      appIdKey,
      senderId,
      pageIdKey
    } = opts;

    switch (command) {
      case 'setConnectionKey':
        return this.setConnectionKey(connId);

      case 'launchApplication':
        return this.launchApplication(opts.bundleId);

      case 'connectToApp':
        return this.connectToApp(connId, appIdKey);

      case 'setSenderKey':
        return this.setSenderKey(connId, senderId, appIdKey, pageIdKey);

      case 'indicateWebView':
        return this.indicateWebView(connId, appIdKey, pageIdKey, opts);

      case 'sendJSCommand':
        return this.sendJSCommand(connId, senderId, appIdKey, pageIdKey, opts);

      case 'callJSFunction':
        return this.callJSFunction(connId, senderId, appIdKey, pageIdKey, opts);

      case 'setUrl':
        return this.setUrl(connId, senderId, appIdKey, pageIdKey, opts);

      case 'enablePage':
        return this.enablePage(connId, senderId, appIdKey, pageIdKey);

      case 'startTimeline':
        return this.startTimeline(connId, senderId, appIdKey, pageIdKey);

      case 'stopTimeline':
        return this.stopTimeline(connId, senderId, appIdKey, pageIdKey);

      case 'startConsole':
        return this.startConsole(connId, senderId, appIdKey, pageIdKey);

      case 'stopConsole':
        return this.stopConsole(connId, senderId, appIdKey, pageIdKey);

      case 'startNetwork':
        return this.startNetwork(connId, senderId, appIdKey, pageIdKey);

      case 'stopNetwork':
        return this.stopNetwork(connId, senderId, appIdKey, pageIdKey);

      case 'getCookies':
        return this.getCookies(connId, senderId, appIdKey, pageIdKey, opts);

      case 'deleteCookie':
        return this.deleteCookie(connId, senderId, appIdKey, pageIdKey, opts);

      case 'garbageCollect':
        return this.garbageCollect(connId, senderId, appIdKey, pageIdKey);

      case 'awaitPromise':
        return this.awaitPromise(connId, senderId, appIdKey, pageIdKey, opts);

      default:
        throw new Error(`Unknown command: ${command}`);
    }
  }

}

exports.RemoteMessages = RemoteMessages;
var _default = RemoteMessages;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtbWVzc2FnZXMuanMiXSwibmFtZXMiOlsiUmVtb3RlTWVzc2FnZXMiLCJjb25zdHJ1Y3RvciIsImlzVGFyZ2V0QmFzZWQiLCJzZXRDb21tdW5pY2F0aW9uUHJvdG9jb2wiLCJzZXRDb25uZWN0aW9uS2V5IiwiY29ubklkIiwiX19hcmd1bWVudCIsIldJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5IiwiX19zZWxlY3RvciIsImNvbm5lY3RUb0FwcCIsImFwcElkS2V5IiwiV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5Iiwic2V0U2VuZGVyS2V5Iiwic2VuZGVySWQiLCJwYWdlSWRLZXkiLCJXSVJTZW5kZXJLZXkiLCJXSVJQYWdlSWRlbnRpZmllcktleSIsIldJUkF1dG9tYXRpY2FsbHlQYXVzZSIsImluZGljYXRlV2ViVmlldyIsIm9wdHMiLCJlbmFibGVkIiwiV0lSSW5kaWNhdGVFbmFibGVkS2V5IiwiXyIsImlzVW5kZWZpbmVkIiwibGF1bmNoQXBwbGljYXRpb24iLCJidW5kbGVJZCIsIldJUkFwcGxpY2F0aW9uQnVuZGxlSWRlbnRpZmllcktleSIsImdldEZ1bGxDb21tYW5kIiwibWV0aG9kIiwicGFyYW1zIiwicmVhbE1ldGhvZCIsInJlYWxQYXJhbXMiLCJtZXNzYWdlIiwiY29tbWFuZCIsInNlbmRKU0NvbW1hbmQiLCJleHByZXNzaW9uIiwicmV0dXJuQnlWYWx1ZSIsImlzQm9vbGVhbiIsImNhbGxKU0Z1bmN0aW9uIiwib2JqZWN0SWQiLCJvYmpJZCIsImZ1bmN0aW9uRGVjbGFyYXRpb24iLCJmbiIsImFyZ3VtZW50cyIsImFyZ3MiLCJzZXRVcmwiLCJ1cmwiLCJlbmFibGVQYWdlIiwic3RhcnRUaW1lbGluZSIsInN0b3BUaW1lbGluZSIsInN0YXJ0Q29uc29sZSIsInN0b3BDb25zb2xlIiwic3RhcnROZXR3b3JrIiwic3RvcE5ldHdvcmsiLCJnZXRDb29raWVzIiwidXJscyIsImRlbGV0ZUNvb2tpZSIsImNvb2tpZU5hbWUiLCJnYXJiYWdlQ29sbGVjdCIsImF3YWl0UHJvbWlzZSIsInByb21pc2VPYmplY3RJZCIsImdlbmVyYXRlUHJldmlldyIsInNhdmVSZXN1bHQiLCJwbGlzdCIsIldJUlNvY2tldERhdGFLZXkiLCJvYmplY3RHcm91cCIsImluY2x1ZGVDb21tYW5kTGluZUFQSSIsImRvTm90UGF1c2VPbkV4Y2VwdGlvbnNBbmRNdXRlQ29uc29sZSIsImV4dGVuZCIsImdldFJlbW90ZUNvbW1hbmQiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFHQSxNQUFNQSxjQUFOLENBQXFCO0FBQ25CQyxFQUFBQSxXQUFXLENBQUVDLGFBQWEsR0FBRyxLQUFsQixFQUF5QjtBQUNsQyxTQUFLQSxhQUFMLEdBQXFCQSxhQUFyQjtBQUNEOztBQUVEQyxFQUFBQSx3QkFBd0IsQ0FBRUQsYUFBRixFQUFpQjtBQUN2QyxTQUFLQSxhQUFMLEdBQXFCQSxhQUFyQjtBQUNEOztBQU1ERSxFQUFBQSxnQkFBZ0IsQ0FBRUMsTUFBRixFQUFVO0FBQ3hCLFdBQU87QUFDTEMsTUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLFFBQUFBLDBCQUEwQixFQUFFRjtBQURsQixPQURQO0FBSUxHLE1BQUFBLFVBQVUsRUFBRTtBQUpQLEtBQVA7QUFNRDs7QUFFREMsRUFBQUEsWUFBWSxDQUFFSixNQUFGLEVBQVVLLFFBQVYsRUFBb0I7QUFDOUIsV0FBTztBQUNMSixNQUFBQSxVQUFVLEVBQUU7QUFDVkMsUUFBQUEsMEJBQTBCLEVBQUVGLE1BRGxCO0FBRVZNLFFBQUFBLDJCQUEyQixFQUFFRDtBQUZuQixPQURQO0FBS0xGLE1BQUFBLFVBQVUsRUFBRTtBQUxQLEtBQVA7QUFPRDs7QUFFREksRUFBQUEsWUFBWSxDQUFFUCxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5QztBQUNuRCxXQUFPO0FBQ0xSLE1BQUFBLFVBQVUsRUFBRTtBQUNWSyxRQUFBQSwyQkFBMkIsRUFBRUQsUUFEbkI7QUFFVkgsUUFBQUEsMEJBQTBCLEVBQUVGLE1BRmxCO0FBR1ZVLFFBQUFBLFlBQVksRUFBRUYsUUFISjtBQUlWRyxRQUFBQSxvQkFBb0IsRUFBRUYsU0FKWjtBQUtWRyxRQUFBQSxxQkFBcUIsRUFBRTtBQUxiLE9BRFA7QUFRTFQsTUFBQUEsVUFBVSxFQUFFO0FBUlAsS0FBUDtBQVVEOztBQUVEVSxFQUFBQSxlQUFlLENBQUViLE1BQUYsRUFBVUssUUFBVixFQUFvQkksU0FBcEIsRUFBK0JLLElBQS9CLEVBQXFDO0FBQ2xELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFZRCxJQUFsQjtBQUNBLFdBQU87QUFDTGIsTUFBQUEsVUFBVSxFQUFFO0FBQ1ZLLFFBQUFBLDJCQUEyQixFQUFFRCxRQURuQjtBQUVWVyxRQUFBQSxxQkFBcUIsRUFBRUMsZ0JBQUVDLFdBQUYsQ0FBY0gsT0FBZCxJQUF5QixJQUF6QixHQUFnQ0EsT0FGN0M7QUFHVmIsUUFBQUEsMEJBQTBCLEVBQUVGLE1BSGxCO0FBSVZXLFFBQUFBLG9CQUFvQixFQUFFRjtBQUpaLE9BRFA7QUFPTE4sTUFBQUEsVUFBVSxFQUFFO0FBUFAsS0FBUDtBQVNEOztBQUVEZ0IsRUFBQUEsaUJBQWlCLENBQUVDLFFBQUYsRUFBWTtBQUMzQixXQUFPO0FBQ0xuQixNQUFBQSxVQUFVLEVBQUU7QUFDVm9CLFFBQUFBLGlDQUFpQyxFQUFFRDtBQUR6QixPQURQO0FBSUxqQixNQUFBQSxVQUFVLEVBQUU7QUFKUCxLQUFQO0FBTUQ7O0FBTURtQixFQUFBQSxjQUFjLENBQUV0QixNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5Q2MsTUFBekMsRUFBaURDLE1BQWpELEVBQXlEO0FBQ3JFLFVBQU0sQ0FBQ0MsVUFBRCxFQUFhQyxVQUFiLElBQTJCLEtBQUs3QixhQUFMLEdBQzdCLENBQUMsNEJBQUQsRUFBK0I7QUFBQzhCLE1BQUFBLE9BQU8sRUFBRTtBQUFDSixRQUFBQSxNQUFEO0FBQVNDLFFBQUFBO0FBQVQ7QUFBVixLQUEvQixDQUQ2QixHQUU3QixDQUFDRCxNQUFELEVBQVNDLE1BQVQsQ0FGSjtBQUdBLFdBQU8sS0FBS0ksT0FBTCxDQUFhSCxVQUFiLEVBQXlCQyxVQUF6QixFQUFxQ3JCLFFBQXJDLEVBQStDTCxNQUEvQyxFQUF1RFEsUUFBdkQsRUFBaUVDLFNBQWpFLENBQVA7QUFDRDs7QUFFRG9CLEVBQUFBLGFBQWEsQ0FBRTdCLE1BQUYsRUFBVVEsUUFBVixFQUFvQkgsUUFBcEIsRUFBOEJJLFNBQTlCLEVBQXlDSyxJQUFJLEdBQUcsRUFBaEQsRUFBb0Q7QUFDL0QsVUFBTVMsTUFBTSxHQUFHLGtCQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHO0FBQ2JNLE1BQUFBLFVBQVUsRUFBRWhCLElBQUksQ0FBQ2MsT0FESjtBQUViRyxNQUFBQSxhQUFhLEVBQUVkLGdCQUFFZSxTQUFGLENBQVlsQixJQUFJLENBQUNpQixhQUFqQixJQUFrQ2pCLElBQUksQ0FBQ2lCLGFBQXZDLEdBQXVEO0FBRnpELEtBQWY7QUFJQSxXQUFPLEtBQUtULGNBQUwsQ0FBb0J0QixNQUFwQixFQUE0QlEsUUFBNUIsRUFBc0NILFFBQXRDLEVBQWdESSxTQUFoRCxFQUEyRGMsTUFBM0QsRUFBbUVDLE1BQW5FLENBQVA7QUFDRDs7QUFFRFMsRUFBQUEsY0FBYyxDQUFFakMsTUFBRixFQUFVUSxRQUFWLEVBQW9CSCxRQUFwQixFQUE4QkksU0FBOUIsRUFBeUNLLElBQUksR0FBRyxFQUFoRCxFQUFvRDtBQUNoRSxVQUFNUyxNQUFNLEdBQUcsd0JBQWY7QUFDQSxVQUFNQyxNQUFNLEdBQUc7QUFDYlUsTUFBQUEsUUFBUSxFQUFFcEIsSUFBSSxDQUFDcUIsS0FERjtBQUViQyxNQUFBQSxtQkFBbUIsRUFBRXRCLElBQUksQ0FBQ3VCLEVBRmI7QUFHYkMsTUFBQUEsU0FBUyxFQUFFeEIsSUFBSSxDQUFDeUIsSUFISDtBQUliUixNQUFBQSxhQUFhLEVBQUU7QUFKRixLQUFmO0FBT0EsV0FBTyxLQUFLVCxjQUFMLENBQW9CdEIsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRjLE1BQTNELEVBQW1FQyxNQUFuRSxDQUFQO0FBQ0Q7O0FBRURnQixFQUFBQSxNQUFNLENBQUV4QyxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5Q0ssSUFBSSxHQUFHLEVBQWhELEVBQW9EO0FBQ3hELFVBQU1TLE1BQU0sR0FBRyxlQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHO0FBQ2JpQixNQUFBQSxHQUFHLEVBQUUzQixJQUFJLENBQUMyQjtBQURHLEtBQWY7QUFHQSxXQUFPLEtBQUtuQixjQUFMLENBQW9CdEIsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRjLE1BQTNELEVBQW1FQyxNQUFuRSxDQUFQO0FBQ0Q7O0FBRURrQixFQUFBQSxVQUFVLENBQUUxQyxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5QztBQUNqRCxVQUFNYyxNQUFNLEdBQUcsYUFBZjtBQUNBLFVBQU1DLE1BQU0sR0FBRyxFQUFmO0FBQ0EsV0FBTyxLQUFLRixjQUFMLENBQW9CdEIsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRjLE1BQTNELEVBQW1FQyxNQUFuRSxDQUFQO0FBQ0Q7O0FBRURtQixFQUFBQSxhQUFhLENBQUUzQyxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5QztBQUNwRCxVQUFNYyxNQUFNLEdBQUcsZ0JBQWY7QUFDQSxVQUFNQyxNQUFNLEdBQUcsRUFBZjtBQUNBLFdBQU8sS0FBS0YsY0FBTCxDQUFvQnRCLE1BQXBCLEVBQTRCUSxRQUE1QixFQUFzQ0gsUUFBdEMsRUFBZ0RJLFNBQWhELEVBQTJEYyxNQUEzRCxFQUFtRUMsTUFBbkUsQ0FBUDtBQUNEOztBQUVEb0IsRUFBQUEsWUFBWSxDQUFFNUMsTUFBRixFQUFVUSxRQUFWLEVBQW9CSCxRQUFwQixFQUE4QkksU0FBOUIsRUFBeUM7QUFDbkQsVUFBTWMsTUFBTSxHQUFHLGVBQWY7QUFDQSxVQUFNQyxNQUFNLEdBQUcsRUFBZjtBQUNBLFdBQU8sS0FBS0YsY0FBTCxDQUFvQnRCLE1BQXBCLEVBQTRCUSxRQUE1QixFQUFzQ0gsUUFBdEMsRUFBZ0RJLFNBQWhELEVBQTJEYyxNQUEzRCxFQUFtRUMsTUFBbkUsQ0FBUDtBQUNEOztBQUVEcUIsRUFBQUEsWUFBWSxDQUFFN0MsTUFBRixFQUFVUSxRQUFWLEVBQW9CSCxRQUFwQixFQUE4QkksU0FBOUIsRUFBeUM7QUFDbkQsVUFBTWMsTUFBTSxHQUFHLGdCQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHLEVBQWY7QUFDQSxXQUFPLEtBQUtGLGNBQUwsQ0FBb0J0QixNQUFwQixFQUE0QlEsUUFBNUIsRUFBc0NILFFBQXRDLEVBQWdESSxTQUFoRCxFQUEyRGMsTUFBM0QsRUFBbUVDLE1BQW5FLENBQVA7QUFDRDs7QUFFRHNCLEVBQUFBLFdBQVcsQ0FBRTlDLE1BQUYsRUFBVVEsUUFBVixFQUFvQkgsUUFBcEIsRUFBOEJJLFNBQTlCLEVBQXlDO0FBQ2xELFVBQU1jLE1BQU0sR0FBRyxpQkFBZjtBQUNBLFVBQU1DLE1BQU0sR0FBRyxFQUFmO0FBQ0EsV0FBTyxLQUFLRixjQUFMLENBQW9CdEIsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRjLE1BQTNELEVBQW1FQyxNQUFuRSxDQUFQO0FBQ0Q7O0FBRUR1QixFQUFBQSxZQUFZLENBQUUvQyxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5QztBQUNuRCxVQUFNYyxNQUFNLEdBQUcsZ0JBQWY7QUFDQSxVQUFNQyxNQUFNLEdBQUcsRUFBZjtBQUNBLFdBQU8sS0FBS0YsY0FBTCxDQUFvQnRCLE1BQXBCLEVBQTRCUSxRQUE1QixFQUFzQ0gsUUFBdEMsRUFBZ0RJLFNBQWhELEVBQTJEYyxNQUEzRCxFQUFtRUMsTUFBbkUsQ0FBUDtBQUNEOztBQUVEd0IsRUFBQUEsV0FBVyxDQUFFaEQsTUFBRixFQUFVUSxRQUFWLEVBQW9CSCxRQUFwQixFQUE4QkksU0FBOUIsRUFBeUM7QUFDbEQsVUFBTWMsTUFBTSxHQUFHLGlCQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHLEVBQWY7QUFDQSxXQUFPLEtBQUtGLGNBQUwsQ0FBb0J0QixNQUFwQixFQUE0QlEsUUFBNUIsRUFBc0NILFFBQXRDLEVBQWdESSxTQUFoRCxFQUEyRGMsTUFBM0QsRUFBbUVDLE1BQW5FLENBQVA7QUFDRDs7QUFFRHlCLEVBQUFBLFVBQVUsQ0FBRWpELE1BQUYsRUFBVVEsUUFBVixFQUFvQkgsUUFBcEIsRUFBOEJJLFNBQTlCLEVBQXlDSyxJQUFJLEdBQUcsRUFBaEQsRUFBb0Q7QUFDNUQsVUFBTVMsTUFBTSxHQUFHLGlCQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHO0FBQ2IwQixNQUFBQSxJQUFJLEVBQUVwQyxJQUFJLENBQUMyQjtBQURFLEtBQWY7QUFHQSxXQUFPLEtBQUtuQixjQUFMLENBQW9CdEIsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRjLE1BQTNELEVBQW1FQyxNQUFuRSxDQUFQO0FBQ0Q7O0FBRUQyQixFQUFBQSxZQUFZLENBQUVuRCxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5Q0ssSUFBSSxHQUFHLEVBQWhELEVBQW9EO0FBQzlELFVBQU1TLE1BQU0sR0FBRyxtQkFBZjtBQUNBLFVBQU1DLE1BQU0sR0FBRztBQUNiNEIsTUFBQUEsVUFBVSxFQUFFdEMsSUFBSSxDQUFDc0MsVUFESjtBQUViWCxNQUFBQSxHQUFHLEVBQUUzQixJQUFJLENBQUMyQjtBQUZHLEtBQWY7QUFJQSxXQUFPLEtBQUtuQixjQUFMLENBQW9CdEIsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRjLE1BQTNELEVBQW1FQyxNQUFuRSxDQUFQO0FBQ0Q7O0FBRUQ2QixFQUFBQSxjQUFjLENBQUVyRCxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5QztBQUNyRCxVQUFNYyxNQUFNLEdBQUcsU0FBZjtBQUNBLFVBQU1DLE1BQU0sR0FBRyxFQUFmO0FBQ0EsV0FBTyxLQUFLRixjQUFMLENBQW9CdEIsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRjLE1BQTNELEVBQW1FQyxNQUFuRSxDQUFQO0FBQ0Q7O0FBRUQ4QixFQUFBQSxZQUFZLENBQUV0RCxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5Q0ssSUFBekMsRUFBK0M7QUFDekQsVUFBTVMsTUFBTSxHQUFHLHNCQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHO0FBQ2IrQixNQUFBQSxlQUFlLEVBQUV6QyxJQUFJLENBQUN5QyxlQURUO0FBRWJ4QixNQUFBQSxhQUFhLEVBQUUsSUFGRjtBQUdieUIsTUFBQUEsZUFBZSxFQUFFLElBSEo7QUFJYkMsTUFBQUEsVUFBVSxFQUFFO0FBSkMsS0FBZjtBQU1BLFdBQU8sS0FBS25DLGNBQUwsQ0FBb0J0QixNQUFwQixFQUE0QlEsUUFBNUIsRUFBc0NILFFBQXRDLEVBQWdESSxTQUFoRCxFQUEyRGMsTUFBM0QsRUFBbUVDLE1BQW5FLENBQVA7QUFDRDs7QUFPREksRUFBQUEsT0FBTyxDQUFFTCxNQUFGLEVBQVVDLE1BQVYsRUFBa0JuQixRQUFsQixFQUE0QkwsTUFBNUIsRUFBb0NRLFFBQXBDLEVBQThDQyxTQUE5QyxFQUF5RDtBQUM5RCxRQUFJaUQsS0FBSyxHQUFHO0FBQ1Z6RCxNQUFBQSxVQUFVLEVBQUU7QUFDVkssUUFBQUEsMkJBQTJCLEVBQUVELFFBRG5CO0FBRVZzRCxRQUFBQSxnQkFBZ0IsRUFBRTtBQUNoQnBDLFVBQUFBLE1BRGdCO0FBRWhCQyxVQUFBQSxNQUFNLEVBQUU7QUFDTm9DLFlBQUFBLFdBQVcsRUFBRSxTQURQO0FBRU5DLFlBQUFBLHFCQUFxQixFQUFFLElBRmpCO0FBR05DLFlBQUFBLG9DQUFvQyxFQUFFO0FBSGhDO0FBRlEsU0FGUjtBQVVWNUQsUUFBQUEsMEJBQTBCLEVBQUVGLE1BVmxCO0FBV1ZVLFFBQUFBLFlBQVksRUFBRUYsUUFYSjtBQVlWRyxRQUFBQSxvQkFBb0IsRUFBRUYsU0FaWjtBQWFWRyxRQUFBQSxxQkFBcUIsRUFBRTtBQWJiLE9BREY7QUFnQlZULE1BQUFBLFVBQVUsRUFBRTtBQWhCRixLQUFaOztBQWtCQSxRQUFJcUIsTUFBSixFQUFZO0FBQ1ZrQyxNQUFBQSxLQUFLLENBQUN6RCxVQUFOLENBQWlCMEQsZ0JBQWpCLENBQWtDbkMsTUFBbEMsR0FDRVAsZ0JBQUU4QyxNQUFGLENBQVNMLEtBQUssQ0FBQ3pELFVBQU4sQ0FBaUIwRCxnQkFBakIsQ0FBa0NuQyxNQUEzQyxFQUFtREEsTUFBbkQsQ0FERjtBQUVEOztBQUNELFdBQU9rQyxLQUFQO0FBQ0Q7O0FBRURNLEVBQUFBLGdCQUFnQixDQUFFcEMsT0FBRixFQUFXZCxJQUFYLEVBQWlCO0FBQy9CLFVBQU07QUFDSmQsTUFBQUEsTUFESTtBQUVKSyxNQUFBQSxRQUZJO0FBR0pHLE1BQUFBLFFBSEk7QUFJSkMsTUFBQUE7QUFKSSxRQUtGSyxJQUxKOztBQU9BLFlBQVFjLE9BQVI7QUFDRSxXQUFLLGtCQUFMO0FBQ0UsZUFBTyxLQUFLN0IsZ0JBQUwsQ0FBc0JDLE1BQXRCLENBQVA7O0FBQ0YsV0FBSyxtQkFBTDtBQUNFLGVBQU8sS0FBS21CLGlCQUFMLENBQXVCTCxJQUFJLENBQUNNLFFBQTVCLENBQVA7O0FBQ0YsV0FBSyxjQUFMO0FBQ0UsZUFBTyxLQUFLaEIsWUFBTCxDQUFrQkosTUFBbEIsRUFBMEJLLFFBQTFCLENBQVA7O0FBQ0YsV0FBSyxjQUFMO0FBQ0UsZUFBTyxLQUFLRSxZQUFMLENBQWtCUCxNQUFsQixFQUEwQlEsUUFBMUIsRUFBb0NILFFBQXBDLEVBQThDSSxTQUE5QyxDQUFQOztBQUNGLFdBQUssaUJBQUw7QUFDRSxlQUFPLEtBQUtJLGVBQUwsQ0FBcUJiLE1BQXJCLEVBQTZCSyxRQUE3QixFQUF1Q0ksU0FBdkMsRUFBa0RLLElBQWxELENBQVA7O0FBQ0YsV0FBSyxlQUFMO0FBQ0UsZUFBTyxLQUFLZSxhQUFMLENBQW1CN0IsTUFBbkIsRUFBMkJRLFFBQTNCLEVBQXFDSCxRQUFyQyxFQUErQ0ksU0FBL0MsRUFBMERLLElBQTFELENBQVA7O0FBQ0YsV0FBSyxnQkFBTDtBQUNFLGVBQU8sS0FBS21CLGNBQUwsQ0FBb0JqQyxNQUFwQixFQUE0QlEsUUFBNUIsRUFBc0NILFFBQXRDLEVBQWdESSxTQUFoRCxFQUEyREssSUFBM0QsQ0FBUDs7QUFDRixXQUFLLFFBQUw7QUFDRSxlQUFPLEtBQUswQixNQUFMLENBQVl4QyxNQUFaLEVBQW9CUSxRQUFwQixFQUE4QkgsUUFBOUIsRUFBd0NJLFNBQXhDLEVBQW1ESyxJQUFuRCxDQUFQOztBQUNGLFdBQUssWUFBTDtBQUNFLGVBQU8sS0FBSzRCLFVBQUwsQ0FBZ0IxQyxNQUFoQixFQUF3QlEsUUFBeEIsRUFBa0NILFFBQWxDLEVBQTRDSSxTQUE1QyxDQUFQOztBQUNGLFdBQUssZUFBTDtBQUNFLGVBQU8sS0FBS2tDLGFBQUwsQ0FBbUIzQyxNQUFuQixFQUEyQlEsUUFBM0IsRUFBcUNILFFBQXJDLEVBQStDSSxTQUEvQyxDQUFQOztBQUNGLFdBQUssY0FBTDtBQUNFLGVBQU8sS0FBS21DLFlBQUwsQ0FBa0I1QyxNQUFsQixFQUEwQlEsUUFBMUIsRUFBb0NILFFBQXBDLEVBQThDSSxTQUE5QyxDQUFQOztBQUNGLFdBQUssY0FBTDtBQUNFLGVBQU8sS0FBS29DLFlBQUwsQ0FBa0I3QyxNQUFsQixFQUEwQlEsUUFBMUIsRUFBb0NILFFBQXBDLEVBQThDSSxTQUE5QyxDQUFQOztBQUNGLFdBQUssYUFBTDtBQUNFLGVBQU8sS0FBS3FDLFdBQUwsQ0FBaUI5QyxNQUFqQixFQUF5QlEsUUFBekIsRUFBbUNILFFBQW5DLEVBQTZDSSxTQUE3QyxDQUFQOztBQUNGLFdBQUssY0FBTDtBQUNFLGVBQU8sS0FBS3NDLFlBQUwsQ0FBa0IvQyxNQUFsQixFQUEwQlEsUUFBMUIsRUFBb0NILFFBQXBDLEVBQThDSSxTQUE5QyxDQUFQOztBQUNGLFdBQUssYUFBTDtBQUNFLGVBQU8sS0FBS3VDLFdBQUwsQ0FBaUJoRCxNQUFqQixFQUF5QlEsUUFBekIsRUFBbUNILFFBQW5DLEVBQTZDSSxTQUE3QyxDQUFQOztBQUNGLFdBQUssWUFBTDtBQUNFLGVBQU8sS0FBS3dDLFVBQUwsQ0FBZ0JqRCxNQUFoQixFQUF3QlEsUUFBeEIsRUFBa0NILFFBQWxDLEVBQTRDSSxTQUE1QyxFQUF1REssSUFBdkQsQ0FBUDs7QUFDRixXQUFLLGNBQUw7QUFDRSxlQUFPLEtBQUtxQyxZQUFMLENBQWtCbkQsTUFBbEIsRUFBMEJRLFFBQTFCLEVBQW9DSCxRQUFwQyxFQUE4Q0ksU0FBOUMsRUFBeURLLElBQXpELENBQVA7O0FBQ0YsV0FBSyxnQkFBTDtBQUNFLGVBQU8sS0FBS3VDLGNBQUwsQ0FBb0JyRCxNQUFwQixFQUE0QlEsUUFBNUIsRUFBc0NILFFBQXRDLEVBQWdESSxTQUFoRCxDQUFQOztBQUNGLFdBQUssY0FBTDtBQUNFLGVBQU8sS0FBSzZDLFlBQUwsQ0FBa0J0RCxNQUFsQixFQUEwQlEsUUFBMUIsRUFBb0NILFFBQXBDLEVBQThDSSxTQUE5QyxFQUF5REssSUFBekQsQ0FBUDs7QUFDRjtBQUNFLGNBQU0sSUFBSW1ELEtBQUosQ0FBVyxvQkFBbUJyQyxPQUFRLEVBQXRDLENBQU47QUF4Q0o7QUEwQ0Q7O0FBeFFrQjs7O2VBNFFOakMsYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cblxuY2xhc3MgUmVtb3RlTWVzc2FnZXMge1xuICBjb25zdHJ1Y3RvciAoaXNUYXJnZXRCYXNlZCA9IGZhbHNlKSB7XG4gICAgdGhpcy5pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZDtcbiAgfVxuXG4gIHNldENvbW11bmljYXRpb25Qcm90b2NvbCAoaXNUYXJnZXRCYXNlZCkge1xuICAgIHRoaXMuaXNUYXJnZXRCYXNlZCA9IGlzVGFyZ2V0QmFzZWQ7XG4gIH1cblxuICAvKlxuICAgKiBDb25uZWN0aW9uIGZ1bmN0aW9uc1xuICAgKi9cblxuICBzZXRDb25uZWN0aW9uS2V5IChjb25uSWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgX19hcmd1bWVudDoge1xuICAgICAgICBXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleTogY29ubklkXG4gICAgICB9LFxuICAgICAgX19zZWxlY3RvcjogJ19ycGNfcmVwb3J0SWRlbnRpZmllcjonXG4gICAgfTtcbiAgfVxuXG4gIGNvbm5lY3RUb0FwcCAoY29ubklkLCBhcHBJZEtleSkge1xuICAgIHJldHVybiB7XG4gICAgICBfX2FyZ3VtZW50OiB7XG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXlcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkR2V0TGlzdGluZzonXG4gICAgfTtcbiAgfVxuXG4gIHNldFNlbmRlcktleSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIHJldHVybiB7XG4gICAgICBfX2FyZ3VtZW50OiB7XG4gICAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUlNlbmRlcktleTogc2VuZGVySWQsXG4gICAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXksXG4gICAgICAgIFdJUkF1dG9tYXRpY2FsbHlQYXVzZTogZmFsc2VcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkU29ja2V0U2V0dXA6J1xuICAgIH07XG4gIH1cblxuICBpbmRpY2F0ZVdlYlZpZXcgKGNvbm5JZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgb3B0cykge1xuICAgIGNvbnN0IHtlbmFibGVkfSA9IG9wdHM7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleSxcbiAgICAgICAgV0lSSW5kaWNhdGVFbmFibGVkS2V5OiBfLmlzVW5kZWZpbmVkKGVuYWJsZWQpID8gdHJ1ZSA6IGVuYWJsZWQsXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXlcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkSW5kaWNhdGVXZWJWaWV3OidcbiAgICB9O1xuICB9XG5cbiAgbGF1bmNoQXBwbGljYXRpb24gKGJ1bmRsZUlkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQXBwbGljYXRpb25CdW5kbGVJZGVudGlmaWVyS2V5OiBidW5kbGVJZFxuICAgICAgfSxcbiAgICAgIF9fc2VsZWN0b3I6ICdfcnBjX3JlcXVlc3RBcHBsaWNhdGlvbkxhdW5jaDonXG4gICAgfTtcbiAgfVxuXG4gIC8qXG4gICAqIEFjdGlvbiBmdW5jdGlvbnNcbiAgICovXG5cbiAgZ2V0RnVsbENvbW1hbmQgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG1ldGhvZCwgcGFyYW1zKSB7XG4gICAgY29uc3QgW3JlYWxNZXRob2QsIHJlYWxQYXJhbXNdID0gdGhpcy5pc1RhcmdldEJhc2VkXG4gICAgICA/IFsnVGFyZ2V0LnNlbmRNZXNzYWdlVG9UYXJnZXQnLCB7bWVzc2FnZToge21ldGhvZCwgcGFyYW1zfX1dXG4gICAgICA6IFttZXRob2QsIHBhcmFtc107XG4gICAgcmV0dXJuIHRoaXMuY29tbWFuZChyZWFsTWV0aG9kLCByZWFsUGFyYW1zLCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCwgcGFnZUlkS2V5KTtcbiAgfVxuXG4gIHNlbmRKU0NvbW1hbmQgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdSdW50aW1lLmV2YWx1YXRlJztcbiAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICBleHByZXNzaW9uOiBvcHRzLmNvbW1hbmQsXG4gICAgICByZXR1cm5CeVZhbHVlOiBfLmlzQm9vbGVhbihvcHRzLnJldHVybkJ5VmFsdWUpID8gb3B0cy5yZXR1cm5CeVZhbHVlIDogdHJ1ZSxcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG1ldGhvZCwgcGFyYW1zKTtcbiAgfVxuXG4gIGNhbGxKU0Z1bmN0aW9uIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBvcHRzID0ge30pIHtcbiAgICBjb25zdCBtZXRob2QgPSAnUnVudGltZS5jYWxsRnVuY3Rpb25Pbic7XG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgb2JqZWN0SWQ6IG9wdHMub2JqSWQsXG4gICAgICBmdW5jdGlvbkRlY2xhcmF0aW9uOiBvcHRzLmZuLFxuICAgICAgYXJndW1lbnRzOiBvcHRzLmFyZ3MsXG4gICAgICByZXR1cm5CeVZhbHVlOiB0cnVlLFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGdWxsQ29tbWFuZChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzZXRVcmwgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdQYWdlLm5hdmlnYXRlJztcbiAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICB1cmw6IG9wdHMudXJsLFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cbiAgZW5hYmxlUGFnZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdQYWdlLmVuYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cbiAgc3RhcnRUaW1lbGluZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdUaW1lbGluZS5zdGFydCc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cbiAgc3RvcFRpbWVsaW5lIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ1RpbWVsaW5lLnN0b3AnO1xuICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG1ldGhvZCwgcGFyYW1zKTtcbiAgfVxuXG4gIHN0YXJ0Q29uc29sZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdDb25zb2xlLmVuYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cbiAgc3RvcENvbnNvbGUgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgICBjb25zdCBtZXRob2QgPSAnQ29uc29sZS5kaXNhYmxlJztcbiAgICBjb25zdCBwYXJhbXMgPSB7fTtcbiAgICByZXR1cm4gdGhpcy5nZXRGdWxsQ29tbWFuZChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzdGFydE5ldHdvcmsgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgICBjb25zdCBtZXRob2QgPSAnTmV0d29yay5lbmFibGUnO1xuICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG1ldGhvZCwgcGFyYW1zKTtcbiAgfVxuXG4gIHN0b3BOZXR3b3JrIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ05ldHdvcmsuZGlzYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cbiAgZ2V0Q29va2llcyAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgb3B0cyA9IHt9KSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ1BhZ2UuZ2V0Q29va2llcyc7XG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgdXJsczogb3B0cy51cmwsXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5nZXRGdWxsQ29tbWFuZChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBkZWxldGVDb29raWUgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdQYWdlLmRlbGV0ZUNvb2tpZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgY29va2llTmFtZTogb3B0cy5jb29raWVOYW1lLFxuICAgICAgdXJsOiBvcHRzLnVybCxcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG1ldGhvZCwgcGFyYW1zKTtcbiAgfVxuXG4gIGdhcmJhZ2VDb2xsZWN0IChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ0hlYXAuZ2MnO1xuICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG1ldGhvZCwgcGFyYW1zKTtcbiAgfVxuXG4gIGF3YWl0UHJvbWlzZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgb3B0cykge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdSdW50aW1lLmF3YWl0UHJvbWlzZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgcHJvbWlzZU9iamVjdElkOiBvcHRzLnByb21pc2VPYmplY3RJZCxcbiAgICAgIHJldHVybkJ5VmFsdWU6IHRydWUsXG4gICAgICBnZW5lcmF0ZVByZXZpZXc6IHRydWUsXG4gICAgICBzYXZlUmVzdWx0OiB0cnVlLFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cblxuICAvKlxuICAgKiBJbnRlcm5hbCBmdW5jdGlvbnNcbiAgICovXG5cbiAgY29tbWFuZCAobWV0aG9kLCBwYXJhbXMsIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLCBwYWdlSWRLZXkpIHtcbiAgICBsZXQgcGxpc3QgPSB7XG4gICAgICBfX2FyZ3VtZW50OiB7XG4gICAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICAgIFdJUlNvY2tldERhdGFLZXk6IHtcbiAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBvYmplY3RHcm91cDogJ2NvbnNvbGUnLFxuICAgICAgICAgICAgaW5jbHVkZUNvbW1hbmRMaW5lQVBJOiB0cnVlLFxuICAgICAgICAgICAgZG9Ob3RQYXVzZU9uRXhjZXB0aW9uc0FuZE11dGVDb25zb2xlOiB0cnVlLFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXk6IGNvbm5JZCxcbiAgICAgICAgV0lSU2VuZGVyS2V5OiBzZW5kZXJJZCxcbiAgICAgICAgV0lSUGFnZUlkZW50aWZpZXJLZXk6IHBhZ2VJZEtleSxcbiAgICAgICAgV0lSQXV0b21hdGljYWxseVBhdXNlOiB0cnVlLFxuICAgICAgfSxcbiAgICAgIF9fc2VsZWN0b3I6ICdfcnBjX2ZvcndhcmRTb2NrZXREYXRhOidcbiAgICB9O1xuICAgIGlmIChwYXJhbXMpIHtcbiAgICAgIHBsaXN0Ll9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5wYXJhbXMgPVxuICAgICAgICBfLmV4dGVuZChwbGlzdC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkucGFyYW1zLCBwYXJhbXMpO1xuICAgIH1cbiAgICByZXR1cm4gcGxpc3Q7XG4gIH1cblxuICBnZXRSZW1vdGVDb21tYW5kIChjb21tYW5kLCBvcHRzKSB7XG4gICAgY29uc3Qge1xuICAgICAgY29ubklkLFxuICAgICAgYXBwSWRLZXksXG4gICAgICBzZW5kZXJJZCxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9ID0gb3B0cztcblxuICAgIHN3aXRjaCAoY29tbWFuZCkge1xuICAgICAgY2FzZSAnc2V0Q29ubmVjdGlvbktleSc6XG4gICAgICAgIHJldHVybiB0aGlzLnNldENvbm5lY3Rpb25LZXkoY29ubklkKTtcbiAgICAgIGNhc2UgJ2xhdW5jaEFwcGxpY2F0aW9uJzpcbiAgICAgICAgcmV0dXJuIHRoaXMubGF1bmNoQXBwbGljYXRpb24ob3B0cy5idW5kbGVJZCk7XG4gICAgICBjYXNlICdjb25uZWN0VG9BcHAnOlxuICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0VG9BcHAoY29ubklkLCBhcHBJZEtleSk7XG4gICAgICBjYXNlICdzZXRTZW5kZXJLZXknOlxuICAgICAgICByZXR1cm4gdGhpcy5zZXRTZW5kZXJLZXkoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICBjYXNlICdpbmRpY2F0ZVdlYlZpZXcnOlxuICAgICAgICByZXR1cm4gdGhpcy5pbmRpY2F0ZVdlYlZpZXcoY29ubklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBvcHRzKTtcbiAgICAgIGNhc2UgJ3NlbmRKU0NvbW1hbmQnOlxuICAgICAgICByZXR1cm4gdGhpcy5zZW5kSlNDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMpO1xuICAgICAgY2FzZSAnY2FsbEpTRnVuY3Rpb24nOlxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsSlNGdW5jdGlvbihjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBvcHRzKTtcbiAgICAgIGNhc2UgJ3NldFVybCc6XG4gICAgICAgIHJldHVybiB0aGlzLnNldFVybChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBvcHRzKTtcbiAgICAgIGNhc2UgJ2VuYWJsZVBhZ2UnOlxuICAgICAgICByZXR1cm4gdGhpcy5lbmFibGVQYWdlKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuICAgICAgY2FzZSAnc3RhcnRUaW1lbGluZSc6XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0VGltZWxpbmUoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICBjYXNlICdzdG9wVGltZWxpbmUnOlxuICAgICAgICByZXR1cm4gdGhpcy5zdG9wVGltZWxpbmUoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICBjYXNlICdzdGFydENvbnNvbGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5zdGFydENvbnNvbGUoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICBjYXNlICdzdG9wQ29uc29sZSc6XG4gICAgICAgIHJldHVybiB0aGlzLnN0b3BDb25zb2xlKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuICAgICAgY2FzZSAnc3RhcnROZXR3b3JrJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnROZXR3b3JrKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuICAgICAgY2FzZSAnc3RvcE5ldHdvcmsnOlxuICAgICAgICByZXR1cm4gdGhpcy5zdG9wTmV0d29yayhjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICAgIGNhc2UgJ2dldENvb2tpZXMnOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDb29raWVzKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMpO1xuICAgICAgY2FzZSAnZGVsZXRlQ29va2llJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVsZXRlQ29va2llKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMpO1xuICAgICAgY2FzZSAnZ2FyYmFnZUNvbGxlY3QnOlxuICAgICAgICByZXR1cm4gdGhpcy5nYXJiYWdlQ29sbGVjdChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICAgIGNhc2UgJ2F3YWl0UHJvbWlzZSc6XG4gICAgICAgIHJldHVybiB0aGlzLmF3YWl0UHJvbWlzZShjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBvcHRzKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBjb21tYW5kOiAke2NvbW1hbmR9YCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IFJlbW90ZU1lc3NhZ2VzIH07XG5leHBvcnQgZGVmYXVsdCBSZW1vdGVNZXNzYWdlcztcbiJdLCJmaWxlIjoibGliL3JlbW90ZS1tZXNzYWdlcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
