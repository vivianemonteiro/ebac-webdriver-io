"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RPC_RESPONSE_TIMEOUT_MS = exports.REMOTE_DEBUGGER_PORT = exports.RemoteDebugger = void 0;

require("source-map-support/register");

var _events = _interopRequireDefault(require("events"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumBaseDriver = require("appium-base-driver");

var _rpcClientSimulator = _interopRequireDefault(require("./rpc-client-simulator"));

var _messageHandlers = _interopRequireDefault(require("./message-handlers"));

var _helpers = require("./helpers");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _path = _interopRequireDefault(require("path"));

var _uuidJs = _interopRequireDefault(require("uuid-js"));

let VERSION;

try {
  VERSION = require(_path.default.resolve(__dirname, '..', '..', 'package.json')).version;
} catch (ign) {}

const SELECT_APP_RETRIES = 20;
const SELECT_APP_RETRY_SLEEP_MS = 500;
const REMOTE_DEBUGGER_PORT = 27753;
exports.REMOTE_DEBUGGER_PORT = REMOTE_DEBUGGER_PORT;
const SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
const BLANK_PAGE_URL = 'about:blank';
const RPC_RESPONSE_TIMEOUT_MS = 5000;
exports.RPC_RESPONSE_TIMEOUT_MS = RPC_RESPONSE_TIMEOUT_MS;
const PAGE_READY_TIMEOUT = 5000;
const GARBAGE_COLLECT_TIMEOUT = 5000;

class RemoteDebugger extends _events.default.EventEmitter {
  constructor(opts = {}) {
    super();

    if (VERSION) {
      _logger.default.info(`Remote Debugger version ${VERSION}`);
    }

    const {
      bundleId,
      platformVersion,
      isSafari = true,
      includeSafari = false,
      useNewSafari = false,
      pageLoadMs,
      host,
      port = REMOTE_DEBUGGER_PORT,
      socketPath,
      pageReadyTimeout = PAGE_READY_TIMEOUT,
      remoteDebugProxy,
      garbageCollectOnExecute = false,
      logFullResponse = false
    } = opts;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this.isSafari = isSafari;
    this.includeSafari = includeSafari;
    this.useNewSafari = useNewSafari;
    this.pageLoadMs = pageLoadMs;

    _logger.default.debug(`useNewSafari --> ${this.useNewSafari}`);

    this.garbageCollectOnExecute = garbageCollectOnExecute;
    this.host = host;
    this.port = port;
    this.socketPath = socketPath;
    this.remoteDebugProxy = remoteDebugProxy;
    this.pageReadyTimeout = pageReadyTimeout;
    this.logFullResponse = logFullResponse;
    this.skippedApps = [];
  }

  setup() {
    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this._navigatingToPage = false;
    this.specialCbs = {
      '_rpc_reportIdentifier:': _lodash.default.noop,
      '_rpc_forwardGetListing:': this.onPageChange.bind(this),
      '_rpc_reportConnectedApplicationList:': _lodash.default.noop,
      '_rpc_applicationConnected:': this.onAppConnect.bind(this),
      '_rpc_applicationDisconnected:': this.onAppDisconnect.bind(this),
      '_rpc_applicationUpdated:': this.onAppUpdate.bind(this),
      '_rpc_reportConnectedDriverList:': _lodash.default.noop,
      pageLoad: this.pageLoad.bind(this),
      frameDetached: this.frameDetached.bind(this),
      targetCreated: this.onTargetCreated.bind(this),
      targetDestroyed: this.onTargetDestroyed.bind(this)
    };
    this.rpcClient = null;
  }

  teardown() {
    _logger.default.debug('Cleaning up listeners');

    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this.specialCbs = {};
    this.rpcClient = null;
    this.removeAllListeners(RemoteDebugger.EVENT_PAGE_CHANGE);
    this.removeAllListeners(RemoteDebugger.EVENT_DISCONNECT);
  }

  async connect() {
    this.setup();
    this.rpcClient = new _rpcClientSimulator.default({
      bundleId: this.bundleId,
      platformVersion: this.platformVersion,
      isSafari: this.isSafari,
      host: this.host,
      port: this.port,
      socketPath: this.socketPath,
      specialMessageHandlers: this.specialCbs,
      messageProxy: this.remoteDebugProxy,
      logFullResponse: this.logFullResponse
    });
    await this.rpcClient.connect();

    try {
      const appInfo = await this.setConnectionKey();

      _logger.default.debug('Connected to application');

      return appInfo;
    } catch (err) {
      await this.disconnect();
      return null;
    }
  }

  async disconnect() {
    await this.rpcClient.disconnect();
    this.emit(RemoteDebugger.EVENT_DISCONNECT, true);
    this.teardown();
  }

  isConnected() {
    return !!(this.rpcClient && this.rpcClient.isConnected());
  }

  async setConnectionKey() {
    return await new _bluebird.default((resolve, reject) => {
      let connectCb = apps => {
        if (_lodash.default.isUndefined(apps) || _lodash.default.keys(apps).length === 0) {
          _logger.default.debug('Received no apps from remote debugger. Unable to connect.');

          return resolve(this.appDict);
        }

        let newDict = {};

        for (const dict of _lodash.default.values(apps)) {
          const [id, entry] = (0, _helpers.appInfoFromDict)(dict);

          if (this.skippedApps.includes(entry.name)) {
            continue;
          }

          newDict[id] = entry;
        }

        _lodash.default.defaults(this.appDict, newDict);

        resolve(newDict);
      };

      this.rpcClient.setSpecialMessageHandler('_rpc_reportConnectedApplicationList:', reject, connectCb);

      _logger.default.debug('Sending connection key request');

      return (async () => {
        const [simNameKey, simBuildKey, simPlatformVersion] = await this.rpcClient.send('setConnectionKey');

        _logger.default.debug(`Sim name: ${simNameKey}`);

        _logger.default.debug(`Sim build: ${simBuildKey}`);

        _logger.default.debug(`Sim platform version: ${simPlatformVersion}`);
      })();
    });
  }

  updateAppsWithDict(dict) {
    this.appDict = this.appDict || {};
    let [id, entry] = (0, _helpers.appInfoFromDict)(dict);

    if (this.appDict[id]) {
      entry.pageArray = this.appDict[id].pageArray;
    }

    this.appDict[id] = entry;

    if (_lodash.default.isUndefined(entry.pageArray)) {
      entry.pageArray = (0, _helpers.deferredPromise)();
    }

    if (!this.appIdKey) {
      this.appIdKey = (0, _helpers.getDebuggerAppKey)(this.bundleId, this.platformVersion, this.appDict);
    }
  }

  logApplicationDictionary(apps) {
    function getValueString(key, value) {
      if (_lodash.default.isFunction(value)) {
        return '[Function]';
      }

      if (key === 'pageArray' && !_lodash.default.isArray(value)) {
        return `'Waiting for data'`;
      }

      return JSON.stringify(value);
    }

    _logger.default.debug('Current applications available:');

    for (const [app, info] of _lodash.default.toPairs(apps)) {
      _logger.default.debug(`    Application: '${app}'`);

      for (const [key, value] of _lodash.default.toPairs(info)) {
        if (key === 'pageArray' && Array.isArray(value) && value.length) {
          _logger.default.debug(`        ${key}:`);

          for (const page of value) {
            let prefix = '- ';

            for (const [k, v] of _lodash.default.toPairs(page)) {
              _logger.default.debug(`          ${prefix}${k}: ${JSON.stringify(v)}`);

              prefix = '  ';
            }
          }
        } else {
          const valueString = getValueString(key, value);

          _logger.default.debug(`        ${key}: ${valueString}`);
        }
      }
    }
  }

  async selectApp(currentUrl = null, maxTries = SELECT_APP_RETRIES, ignoreAboutBlankUrl = false) {
    const shouldCheckForTarget = this.rpcClient.shouldCheckForTarget;
    this.rpcClient.shouldCheckForTarget = false;

    try {
      const startTime = process.hrtime();

      _logger.default.debug('Selecting application');

      if (!this.appDict || _lodash.default.isEmpty(this.appDict)) {
        _logger.default.debug('No applications currently connected.');

        return [];
      }

      const {
        appIdKey,
        pageDict
      } = await this.searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl);

      if (!appIdKey || !pageDict) {
        _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
      }

      if (this.appIdKey !== appIdKey) {
        _logger.default.debug(`Received altered app id, updating from '${this.appIdKey}' to '${appIdKey}'`);

        this.appIdKey = appIdKey;
      }

      this.logApplicationDictionary(this.appDict);
      const pageArray = _lodash.default.isEmpty(this.appDict[appIdKey].pageArray) ? (0, _helpers.pageArrayFromDict)(pageDict) : this.appDict[appIdKey].pageArray;

      _logger.default.debug(`Finally selecting app ${this.appIdKey}: ${(0, _helpers.simpleStringify)(pageArray)}`);

      let fullPageArray = [];

      for (const [app, info] of _lodash.default.toPairs(this.appDict)) {
        if (!_lodash.default.isArray(info.pageArray)) {
          continue;
        }

        const id = app.replace('PID:', '');

        for (const page of info.pageArray) {
          if (page.url && (!ignoreAboutBlankUrl || page.url !== BLANK_PAGE_URL)) {
            let pageDict = _lodash.default.clone(page);

            pageDict.id = `${id}.${pageDict.id}`;
            fullPageArray.push(pageDict);
          }
        }
      }

      _logger.default.debug(`Selected app after ${(0, _helpers.getElapsedTime)(startTime)}ms`);

      return fullPageArray;
    } finally {
      this.rpcClient.shouldCheckForTarget = shouldCheckForTarget;
    }
  }

  async searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl) {
    const bundleIds = this.includeSafari && !this.isSafari ? [this.bundleId, SAFARI_BUNDLE_ID] : [this.bundleId];

    try {
      return await (0, _asyncbox.retryInterval)(maxTries, SELECT_APP_RETRY_SLEEP_MS, async retryCount => {
        this.logApplicationDictionary(this.appDict);
        const possibleAppIds = (0, _helpers.getPossibleDebuggerAppKeys)(bundleIds, this.platformVersion, this.appDict);

        _logger.default.debug(`Trying out the possible app ids: ${possibleAppIds.join(', ')}`);

        for (const attemptedAppIdKey of possibleAppIds) {
          try {
            _logger.default.debug(`Selecting app ${attemptedAppIdKey} (try #${retryCount + 1} of ${maxTries})`);

            const [appIdKey, pageDict] = await this.rpcClient.selectApp(attemptedAppIdKey, this.onAppConnect.bind(this));

            if (_lodash.default.isEmpty(pageDict)) {
              _logger.default.debug('Empty page dictionary received. Trying again.');

              continue;
            }

            this.appDict[appIdKey].pageArray = (0, _helpers.pageArrayFromDict)(pageDict);
            const result = this.searchPage(this.appDict, currentUrl, ignoreAboutBlankUrl);

            if (result) {
              return result;
            }

            if (currentUrl) {
              _logger.default.debug(`Received app, but expected url ('${currentUrl}') was not found. Trying again.`);
            } else {
              _logger.default.debug('Received app, but no match was found. Trying again.');
            }
          } catch (err) {
            _logger.default.debug(`Error checking application: '${err.message}'. Retrying connection`);
          }
        }

        retryCount++;
        throw new Error('Failed to find an app to select');
      }, 0);
    } catch (ign) {
      _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
    }
  }

  searchPage(appsDict, currentUrl = null, ignoreAboutBlankUrl = false) {
    for (const appDict of _lodash.default.values(appsDict)) {
      if (!appDict || !appDict.pageArray || appDict.pageArray.promise) {
        continue;
      }

      for (const dict of appDict.pageArray) {
        if ((!ignoreAboutBlankUrl || dict.url !== BLANK_PAGE_URL) && (!currentUrl || dict.url === currentUrl || dict.url === `${currentUrl}/`)) {
          return {
            appIdKey: appDict.id,
            pageDict: dict
          };
        }
      }
    }

    return null;
  }

  async selectPage(appIdKey, pageIdKey, skipReadyCheck = false) {
    this.appIdKey = `PID:${appIdKey}`;
    this.pageIdKey = pageIdKey;

    _logger.default.debug(`Selecting page '${pageIdKey}' on app '${this.appIdKey}' and forwarding socket setup`);

    const startTime = process.hrtime();
    await this.rpcClient.selectPage(this.appIdKey, pageIdKey);

    if (!skipReadyCheck && !(await this.checkPageIsReady())) {
      await this.pageUnload();
    }

    _logger.default.debug(`Selected page after ${(0, _helpers.getElapsedTime)(startTime)}ms`);
  }

  async executeAtom(atom, args, frames) {
    if (!this.rpcClient.isConnected()) {
      throw new Error('Remote debugger is not connected');
    }

    _logger.default.debug(`Executing atom '${atom}'`);

    const script = await (0, _helpers.getScriptForAtom)(atom, args, frames);
    const value = await this.execute(script, true);

    _logger.default.debug(`Received result for atom '${atom}' execution: ${_lodash.default.truncate((0, _helpers.simpleStringify)(value), {
      length: _helpers.RESPONSE_LOG_LENGTH
    })}`);

    return value;
  }

  async executeAtomAsync(atom, args, frames) {
    const promiseName = `appiumAsyncExecutePromise${_uuidJs.default.create().toString().replace(/-/g, '')}`;
    let script = `var res, rej;` + `window.${promiseName} = new Promise(function (resolve, reject) {` + `  res = resolve;` + `  rej = reject;` + `});` + `window.${promiseName}.resolve = res;` + `window.${promiseName}.reject = rej;` + `window.${promiseName};`;
    const obj = await this.rpcClient.send('sendJSCommand', {
      command: script,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      returnByValue: false
    });
    const promiseObjectId = obj.result.objectId;
    const asyncCallBack = `function (res) {` + `  window.${promiseName}.resolve(res);` + `  window.${promiseName}Value = res;` + `}`;
    await this.execute((await (0, _helpers.getScriptForAtom)(atom, args, frames, asyncCallBack)));
    let res;
    const subcommandTimeout = 1000;

    try {
      res = await this.rpcClient.send('awaitPromise', {
        promiseObjectId,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
    } catch (err) {
      if (!err.message.includes(`'Runtime.awaitPromise' was not found`)) {
        throw err;
      }

      const retryWait = 100;
      const timeout = args.length >= 3 ? args[2] : RPC_RESPONSE_TIMEOUT_MS;
      const retries = parseInt(timeout / retryWait, 10);
      const startTime = process.hrtime();
      res = await (0, _asyncbox.retryInterval)(retries, retryWait, async () => {
        if (await this.executeAtom('execute_script', [`return window.hasOwnProperty('${promiseName}Value');`, [null, null], subcommandTimeout], frames)) {
          return await this.executeAtom('execute_script', [`return window.${promiseName}Value;`, [null, null], subcommandTimeout], frames);
        }

        throw new _appiumBaseDriver.errors.TimeoutError(`Timed out waiting for asynchronous script ` + `result after ${(0, _helpers.getElapsedTime)(startTime)} ms'));`);
      });
    } finally {
      try {
        await this.executeAtom('execute_script', [`delete window.${promiseName};`, [null, null], subcommandTimeout], frames);
      } catch (ign) {}
    }

    return (0, _helpers.convertResult)(res);
  }

  frameDetached() {
    this.emit(RemoteDebugger.EVENT_FRAMES_DETACHED);
  }

  async pageLoad(startPageLoadMs, pageLoadVerifyHook) {
    let timeoutMs = 500;
    let start = startPageLoadMs || Date.now();

    _logger.default.debug('Page loaded, verifying whether ready');

    const verify = async () => {
      this.pageLoadDelay = _appiumSupport.util.cancellableDelay(timeoutMs);

      try {
        await this.pageLoadDelay;
      } catch (err) {
        if (err instanceof _bluebird.default.CancellationError) {
          return;
        }
      }

      if (!this.appIdKey) {
        _logger.default.debug('Not connected to an application. Ignoring page load');

        return;
      }

      if (_lodash.default.isFunction(pageLoadVerifyHook)) {
        await pageLoadVerifyHook();
      }

      const ready = await this.checkPageIsReady();

      if (ready || this.pageLoadMs > 0 && start + this.pageLoadMs < Date.now()) {
        _logger.default.debug('Page is ready');

        this.pageLoading = false;
      } else {
        _logger.default.debug('Page was not ready, retrying');

        await verify();
      }
    };

    await verify();
  }

  cancelPageLoad() {
    _logger.default.debug('Unregistering from page readiness notifications');

    this.pageLoading = false;

    if (this.pageLoadDelay) {
      this.pageLoadDelay.cancel();
    }
  }

  async pageUnload() {
    _logger.default.debug('Page unloading');

    this.pageLoading = true;
    await this.waitForDom();
  }

  async waitForDom(startPageLoadMs, pageLoadVerifyHook) {
    _logger.default.debug('Waiting for dom...');

    await this.pageLoad(startPageLoadMs, pageLoadVerifyHook);
  }

  async checkPageIsReady() {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey
    });
    if (errors) throw new Error(errors);

    _logger.default.debug('Checking document readyState');

    const readyCmd = '(function (){ return document.readyState; })()';
    let readyState = 'loading';

    try {
      readyState = await _bluebird.default.resolve(this.execute(readyCmd, true)).timeout(this.pageReadyTimeout);
    } catch (err) {
      if (!(err instanceof _bluebird.default.TimeoutError)) {
        throw err;
      }

      _logger.default.debug(`Page readiness check timed out after ${this.pageReadyTimeout}ms`);

      return false;
    }

    _logger.default.debug(`Document readyState is '${readyState}'`);

    return readyState === 'complete';
  }

  async launchSafari() {
    await this.rpcClient.send('launchApplication', {
      bundleId: SAFARI_BUNDLE_ID
    });
  }

  async navToUrl(url, pageLoadVerifyHook) {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    this._navigatingToPage = true;

    try {
      _logger.default.debug(`Navigating to new URL: '${url}'`);

      await this.rpcClient.send('setUrl', {
        url,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });

      if (!this.useNewSafari) {
        await _bluebird.default.delay(1000);
      }

      await this.waitForFrameNavigated();
      await this.waitForDom(Date.now(), pageLoadVerifyHook);
    } finally {
      this._navigatingToPage = false;
    }
  }

  async waitForFrameNavigated() {
    return await new _bluebird.default(async (resolve, reject) => {
      _logger.default.debug('Waiting for frame navigated message...');

      let startMs = Date.now();

      const navEventListener = value => {
        _logger.default.debug(`Frame navigated in ${(Date.now() - startMs) / 1000} sec from source: ${value}`);

        if (this.navigationDelay) {
          this.navigationDelay.cancel();
        }

        resolve(value);
      };

      this.rpcClient.setSpecialMessageHandler('Page.frameNavigated', reject, navEventListener);

      if (!this.useNewSafari || this.pageLoadMs >= 0) {
        let timeout = this.useNewSafari ? this.pageLoadMs : 500;
        this.navigationDelay = _appiumSupport.util.cancellableDelay(timeout);

        try {
          await this.navigationDelay;
          navEventListener('timeout');
        } catch (err) {}
      }
    });
  }

  async startTimeline(fn) {
    _logger.default.debug('Starting to record the timeline');

    this.rpcClient.setTimelineEventHandler(fn);
    return await this.rpcClient.send('startTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopTimeline() {
    _logger.default.debug('Stopping to record the timeline');

    await this.rpcClient.send('stopTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async startConsole(fn) {
    _logger.default.debug('Starting to listen for JavaScript console');

    this.rpcClient.setConsoleLogEventHandler(fn);
    return await this.rpcClient.send('startConsole', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopConsole() {
    _logger.default.debug('Stopping to listen for JavaScript console');

    await this.rpcClient.send('stopConsole', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async startNetwork(fn) {
    _logger.default.debug('Starting to listen for network events');

    this.rpcClient.setNetworkLogEventHandler(fn);
    return await this.rpcClient.send('startNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopNetwork() {
    _logger.default.debug('Stopping to listen for network events');

    await this.rpcClient.send('stopNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async execute(command, override) {
    if (this.pageLoading && !override) {
      _logger.default.debug('Trying to execute but page is not loaded.');

      await this.waitForDom();
    }

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug(`Sending javascript command: '${_lodash.default.truncate(command, {
      length: 50
    })}'`);

    let res = await this.rpcClient.send('sendJSCommand', {
      command,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  async callFunction(objId, fn, args) {
    let errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    if (errors) throw new Error(errors);

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug('Calling javascript function');

    const res = await this.rpcClient.send('callJSFunction', {
      objId,
      fn,
      args,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  allowNavigationWithoutReload(allow = true) {
    if (_lodash.default.isFunction(this.rpcClient.allowNavigationWithoutReload)) {
      this.rpcClient.allowNavigationWithoutReload(allow);
    }
  }

  async getCookies(urls) {
    _logger.default.debug('Getting network cookies');

    return await this.rpcClient.send('getCookies', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      urls
    });
  }

  async deleteCookie(cookieName, url) {
    _logger.default.debug(`Deleting cookie '${cookieName}' on '${url}'`);

    return await this.rpcClient.send('deleteCookie', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      cookieName,
      url
    });
  }

  async garbageCollect(timeoutMs = GARBAGE_COLLECT_TIMEOUT) {
    _logger.default.debug(`Garbage collecting with ${timeoutMs}ms timeout`);

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      _logger.default.debug(`Unable to collect garbage at this time`);

      return;
    }

    await _bluebird.default.resolve(this.rpcClient.send('garbageCollect', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    })).timeout(timeoutMs).then(function gcSuccess() {
      _logger.default.debug(`Garbage collection successful`);
    }).catch(function gcError(err) {
      if (err instanceof _bluebird.default.TimeoutError) {
        _logger.default.debug(`Garbage collection timed out after ${timeoutMs}ms`);
      } else {
        _logger.default.debug(`Unable to collect garbage: ${err.message}`);
      }
    });
  }

}

exports.RemoteDebugger = RemoteDebugger;
RemoteDebugger.EVENT_PAGE_CHANGE = 'remote_debugger_page_change';
RemoteDebugger.EVENT_FRAMES_DETACHED = 'remote_debugger_frames_detached';
RemoteDebugger.EVENT_DISCONNECT = 'remote_debugger_disconnect';

for (const [name, handler] of _lodash.default.toPairs(_messageHandlers.default)) {
  RemoteDebugger.prototype[name] = handler;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtZGVidWdnZXIuanMiXSwibmFtZXMiOlsiVkVSU0lPTiIsInJlcXVpcmUiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInZlcnNpb24iLCJpZ24iLCJTRUxFQ1RfQVBQX1JFVFJJRVMiLCJTRUxFQ1RfQVBQX1JFVFJZX1NMRUVQX01TIiwiUkVNT1RFX0RFQlVHR0VSX1BPUlQiLCJTQUZBUklfQlVORExFX0lEIiwiQkxBTktfUEFHRV9VUkwiLCJSUENfUkVTUE9OU0VfVElNRU9VVF9NUyIsIlBBR0VfUkVBRFlfVElNRU9VVCIsIkdBUkJBR0VfQ09MTEVDVF9USU1FT1VUIiwiUmVtb3RlRGVidWdnZXIiLCJldmVudHMiLCJFdmVudEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJsb2ciLCJpbmZvIiwiYnVuZGxlSWQiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc1NhZmFyaSIsImluY2x1ZGVTYWZhcmkiLCJ1c2VOZXdTYWZhcmkiLCJwYWdlTG9hZE1zIiwiaG9zdCIsInBvcnQiLCJzb2NrZXRQYXRoIiwicGFnZVJlYWR5VGltZW91dCIsInJlbW90ZURlYnVnUHJveHkiLCJnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSIsImxvZ0Z1bGxSZXNwb25zZSIsImRlYnVnIiwic2tpcHBlZEFwcHMiLCJzZXR1cCIsImFwcERpY3QiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsInBhZ2VMb2FkaW5nIiwiX25hdmlnYXRpbmdUb1BhZ2UiLCJzcGVjaWFsQ2JzIiwiXyIsIm5vb3AiLCJvblBhZ2VDaGFuZ2UiLCJiaW5kIiwib25BcHBDb25uZWN0Iiwib25BcHBEaXNjb25uZWN0Iiwib25BcHBVcGRhdGUiLCJwYWdlTG9hZCIsImZyYW1lRGV0YWNoZWQiLCJ0YXJnZXRDcmVhdGVkIiwib25UYXJnZXRDcmVhdGVkIiwidGFyZ2V0RGVzdHJveWVkIiwib25UYXJnZXREZXN0cm95ZWQiLCJycGNDbGllbnQiLCJ0ZWFyZG93biIsInJlbW92ZUFsbExpc3RlbmVycyIsIkVWRU5UX1BBR0VfQ0hBTkdFIiwiRVZFTlRfRElTQ09OTkVDVCIsImNvbm5lY3QiLCJScGNDbGllbnRTaW11bGF0b3IiLCJzcGVjaWFsTWVzc2FnZUhhbmRsZXJzIiwibWVzc2FnZVByb3h5IiwiYXBwSW5mbyIsInNldENvbm5lY3Rpb25LZXkiLCJlcnIiLCJkaXNjb25uZWN0IiwiZW1pdCIsImlzQ29ubmVjdGVkIiwiQiIsInJlamVjdCIsImNvbm5lY3RDYiIsImFwcHMiLCJpc1VuZGVmaW5lZCIsImtleXMiLCJsZW5ndGgiLCJuZXdEaWN0IiwiZGljdCIsInZhbHVlcyIsImlkIiwiZW50cnkiLCJpbmNsdWRlcyIsIm5hbWUiLCJkZWZhdWx0cyIsInNldFNwZWNpYWxNZXNzYWdlSGFuZGxlciIsInNpbU5hbWVLZXkiLCJzaW1CdWlsZEtleSIsInNpbVBsYXRmb3JtVmVyc2lvbiIsInNlbmQiLCJ1cGRhdGVBcHBzV2l0aERpY3QiLCJwYWdlQXJyYXkiLCJsb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkiLCJnZXRWYWx1ZVN0cmluZyIsImtleSIsInZhbHVlIiwiaXNGdW5jdGlvbiIsImlzQXJyYXkiLCJKU09OIiwic3RyaW5naWZ5IiwiYXBwIiwidG9QYWlycyIsIkFycmF5IiwicGFnZSIsInByZWZpeCIsImsiLCJ2IiwidmFsdWVTdHJpbmciLCJzZWxlY3RBcHAiLCJjdXJyZW50VXJsIiwibWF4VHJpZXMiLCJpZ25vcmVBYm91dEJsYW5rVXJsIiwic2hvdWxkQ2hlY2tGb3JUYXJnZXQiLCJzdGFydFRpbWUiLCJwcm9jZXNzIiwiaHJ0aW1lIiwiaXNFbXB0eSIsInBhZ2VEaWN0Iiwic2VhcmNoRm9yQXBwIiwiZXJyb3JBbmRUaHJvdyIsImZ1bGxQYWdlQXJyYXkiLCJyZXBsYWNlIiwidXJsIiwiY2xvbmUiLCJwdXNoIiwiYnVuZGxlSWRzIiwicmV0cnlDb3VudCIsInBvc3NpYmxlQXBwSWRzIiwiam9pbiIsImF0dGVtcHRlZEFwcElkS2V5IiwicmVzdWx0Iiwic2VhcmNoUGFnZSIsIm1lc3NhZ2UiLCJFcnJvciIsImFwcHNEaWN0IiwicHJvbWlzZSIsInNlbGVjdFBhZ2UiLCJza2lwUmVhZHlDaGVjayIsImNoZWNrUGFnZUlzUmVhZHkiLCJwYWdlVW5sb2FkIiwiZXhlY3V0ZUF0b20iLCJhdG9tIiwiYXJncyIsImZyYW1lcyIsInNjcmlwdCIsImV4ZWN1dGUiLCJ0cnVuY2F0ZSIsIlJFU1BPTlNFX0xPR19MRU5HVEgiLCJleGVjdXRlQXRvbUFzeW5jIiwicHJvbWlzZU5hbWUiLCJVVUlEIiwiY3JlYXRlIiwidG9TdHJpbmciLCJvYmoiLCJjb21tYW5kIiwicmV0dXJuQnlWYWx1ZSIsInByb21pc2VPYmplY3RJZCIsIm9iamVjdElkIiwiYXN5bmNDYWxsQmFjayIsInJlcyIsInN1YmNvbW1hbmRUaW1lb3V0IiwicmV0cnlXYWl0IiwidGltZW91dCIsInJldHJpZXMiLCJwYXJzZUludCIsImVycm9ycyIsIlRpbWVvdXRFcnJvciIsIkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCIsInN0YXJ0UGFnZUxvYWRNcyIsInBhZ2VMb2FkVmVyaWZ5SG9vayIsInRpbWVvdXRNcyIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsInZlcmlmeSIsInBhZ2VMb2FkRGVsYXkiLCJ1dGlsIiwiY2FuY2VsbGFibGVEZWxheSIsIkNhbmNlbGxhdGlvbkVycm9yIiwicmVhZHkiLCJjYW5jZWxQYWdlTG9hZCIsImNhbmNlbCIsIndhaXRGb3JEb20iLCJyZWFkeUNtZCIsInJlYWR5U3RhdGUiLCJsYXVuY2hTYWZhcmkiLCJuYXZUb1VybCIsImRlbGF5Iiwid2FpdEZvckZyYW1lTmF2aWdhdGVkIiwic3RhcnRNcyIsIm5hdkV2ZW50TGlzdGVuZXIiLCJuYXZpZ2F0aW9uRGVsYXkiLCJzdGFydFRpbWVsaW5lIiwiZm4iLCJzZXRUaW1lbGluZUV2ZW50SGFuZGxlciIsInN0b3BUaW1lbGluZSIsInN0YXJ0Q29uc29sZSIsInNldENvbnNvbGVMb2dFdmVudEhhbmRsZXIiLCJzdG9wQ29uc29sZSIsInN0YXJ0TmV0d29yayIsInNldE5ldHdvcmtMb2dFdmVudEhhbmRsZXIiLCJzdG9wTmV0d29yayIsIm92ZXJyaWRlIiwiZ2FyYmFnZUNvbGxlY3QiLCJjYWxsRnVuY3Rpb24iLCJvYmpJZCIsImFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQiLCJhbGxvdyIsImdldENvb2tpZXMiLCJ1cmxzIiwiZGVsZXRlQ29va2llIiwiY29va2llTmFtZSIsInRoZW4iLCJnY1N1Y2Nlc3MiLCJjYXRjaCIsImdjRXJyb3IiLCJoYW5kbGVyIiwibWVzc2FnZUhhbmRsZXJzIiwicHJvdG90eXBlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUlBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLElBQUlBLE9BQUo7O0FBQ0EsSUFBSTtBQUNGQSxFQUFBQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQ0MsY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLElBQXhCLEVBQThCLElBQTlCLEVBQW9DLGNBQXBDLENBQUQsQ0FBUCxDQUE2REMsT0FBdkU7QUFDRCxDQUZELENBRUUsT0FBT0MsR0FBUCxFQUFZLENBQUU7O0FBRWhCLE1BQU1DLGtCQUFrQixHQUFHLEVBQTNCO0FBQ0EsTUFBTUMseUJBQXlCLEdBQUcsR0FBbEM7QUFDQSxNQUFNQyxvQkFBb0IsR0FBRyxLQUE3Qjs7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBRyx3QkFBekI7QUFDQSxNQUFNQyxjQUFjLEdBQUcsYUFBdkI7QUFHQSxNQUFNQyx1QkFBdUIsR0FBRyxJQUFoQzs7QUFFQSxNQUFNQyxrQkFBa0IsR0FBRyxJQUEzQjtBQUVBLE1BQU1DLHVCQUF1QixHQUFHLElBQWhDOztBQUVBLE1BQU1DLGNBQU4sU0FBNkJDLGdCQUFPQyxZQUFwQyxDQUFpRDtBQVUvQ0MsRUFBQUEsV0FBVyxDQUFFQyxJQUFJLEdBQUcsRUFBVCxFQUFhO0FBQ3RCOztBQUVBLFFBQUluQixPQUFKLEVBQWE7QUFDWG9CLHNCQUFJQyxJQUFKLENBQVUsMkJB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RCxLQU5LLEVBTUhxTCxLQU5HLENBTUcsU0FBU0MsT0FBVCxDQUFrQnJKLEdBQWxCLEVBQXVCO0FBQzlCLFVBQUlBLEdBQUcsWUFBWUksa0JBQUVnRyxZQUFyQixFQUFtQztBQUNqQ3BKLHdCQUFJZSxLQUFKLENBQVcsc0NBQXFDeUksU0FBVSxJQUExRDtBQUNELE9BRkQsTUFFTztBQUNMeEosd0JBQUllLEtBQUosQ0FBVyw4QkFBNkJpQyxHQUFHLENBQUNrRSxPQUFRLEVBQXBEO0FBQ0Q7QUFDRixLQVpLLENBQU47QUFhRDs7QUFqdUI4Qzs7O0FBcXVCakR2SCxjQUFjLENBQUM2QyxpQkFBZixHQUFtQyw2QkFBbkM7QUFDQTdDLGNBQWMsQ0FBQzBKLHFCQUFmLEdBQXVDLGlDQUF2QztBQUNBMUosY0FBYyxDQUFDOEMsZ0JBQWYsR0FBa0MsNEJBQWxDOztBQUdBLEtBQUssTUFBTSxDQUFDd0IsSUFBRCxFQUFPcUksT0FBUCxDQUFYLElBQThCOUssZ0JBQUUyRCxPQUFGLENBQVVvSCx3QkFBVixDQUE5QixFQUEwRDtBQUN4RDVNLEVBQUFBLGNBQWMsQ0FBQzZNLFNBQWYsQ0FBeUJ2SSxJQUF6QixJQUFpQ3FJLE9BQWpDO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXZlbnRzIGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgUnBjQ2xpZW50U2ltdWxhdG9yIGZyb20gJy4vcnBjLWNsaWVudC1zaW11bGF0b3InO1xuaW1wb3J0IG1lc3NhZ2VIYW5kbGVycyBmcm9tICcuL21lc3NhZ2UtaGFuZGxlcnMnO1xuaW1wb3J0IHsgYXBwSW5mb0Zyb21EaWN0LCBwYWdlQXJyYXlGcm9tRGljdCwgZ2V0RGVidWdnZXJBcHBLZXksXG4gICAgICAgICBnZXRQb3NzaWJsZURlYnVnZ2VyQXBwS2V5cywgY2hlY2tQYXJhbXMsIGdldFNjcmlwdEZvckF0b20sXG4gICAgICAgICBzaW1wbGVTdHJpbmdpZnksIGRlZmVycmVkUHJvbWlzZSwgZ2V0RWxhcHNlZFRpbWUsIGNvbnZlcnRSZXN1bHQsXG4gICAgICAgICBSRVNQT05TRV9MT0dfTEVOR1RIIH0gZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IFVVSUQgZnJvbSAndXVpZC1qcyc7XG5cblxubGV0IFZFUlNJT047XG50cnkge1xuICBWRVJTSU9OID0gcmVxdWlyZShwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAncGFja2FnZS5qc29uJykpLnZlcnNpb247XG59IGNhdGNoIChpZ24pIHt9XG5cbmNvbnN0IFNFTEVDVF9BUFBfUkVUUklFUyA9IDIwO1xuY29uc3QgU0VMRUNUX0FQUF9SRVRSWV9TTEVFUF9NUyA9IDUwMDtcbmNvbnN0IFJFTU9URV9ERUJVR0dFUl9QT1JUID0gMjc3NTM7XG5jb25zdCBTQUZBUklfQlVORExFX0lEID0gJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknO1xuY29uc3QgQkxBTktfUEFHRV9VUkwgPSAnYWJvdXQ6YmxhbmsnO1xuXG4vKiBIb3cgbWFueSBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3Igd2Via2l0IHRvIHJldHVybiBhIHJlc3BvbnNlIGJlZm9yZSB0aW1pbmcgb3V0ICovXG5jb25zdCBSUENfUkVTUE9OU0VfVElNRU9VVF9NUyA9IDUwMDA7XG5cbmNvbnN0IFBBR0VfUkVBRFlfVElNRU9VVCA9IDUwMDA7XG5cbmNvbnN0IEdBUkJBR0VfQ09MTEVDVF9USU1FT1VUID0gNTAwMDtcblxuY2xhc3MgUmVtb3RlRGVidWdnZXIgZXh0ZW5kcyBldmVudHMuRXZlbnRFbWl0dGVyIHtcbiAgLypcbiAgICogVGhlIGNvbnN0cnVjdG9yIHRha2VzIGFuIG9wdHMgaGFzaCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczpcbiAgICogICAtIGJ1bmRsZUlkIC0gaWQgb2YgdGhlIGFwcCBiZWluZyBjb25uZWN0ZWQgdG9cbiAgICogICAtIHBsYXRmb3JtVmVyc2lvbiAtIHZlcnNpb24gb2YgaU9TXG4gICAqICAgLSB1c2VOZXdTYWZhcmkgLSBmb3Igd2ViIGluc3BlY3Rvciwgd2hldGhlciB0aGlzIGlzIGEgbmV3IFNhZmFyaSBpbnN0YW5jZVxuICAgKiAgIC0gcGFnZUxvYWRNcyAtIHRoZSB0aW1lLCBpbiBtcywgdGhhdCBzaG91bGQgYmUgd2FpdGVkIGZvciBwYWdlIGxvYWRpbmdcbiAgICogICAtIGhvc3QgLSB0aGUgcmVtb3RlIGRlYnVnZ2VyJ3MgaG9zdCBhZGRyZXNzXG4gICAqICAgLSBwb3J0IC0gdGhlIHJlbW90ZSBkZWJ1Z2dlciBwb3J0IHRocm91Z2ggd2hpY2ggdG8gY29tbXVuaWNhdGVcbiAgICovXG4gIGNvbnN0cnVjdG9yIChvcHRzID0ge30pIHtcbiAgICBzdXBlcigpO1xuXG4gICAgaWYgKFZFUlNJT04pIHtcbiAgICAgIGxvZy5pbmZvKGBSZW1vdGUgRGVidWdnZXIgdmVyc2lvbiAke1ZFUlNJT059YCk7XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgYnVuZGxlSWQsXG4gICAgICBwbGF0Zm9ybVZlcnNpb24sXG4gICAgICBpc1NhZmFyaSA9IHRydWUsXG4gICAgICBpbmNsdWRlU2FmYXJpID0gZmFsc2UsXG4gICAgICB1c2VOZXdTYWZhcmkgPSBmYWxzZSxcbiAgICAgIHBhZ2VMb2FkTXMsXG4gICAgICBob3N0LFxuICAgICAgcG9ydCA9IFJFTU9URV9ERUJVR0dFUl9QT1JULFxuICAgICAgc29ja2V0UGF0aCxcbiAgICAgIHBhZ2VSZWFkeVRpbWVvdXQgPSBQQUdFX1JFQURZX1RJTUVPVVQsXG4gICAgICByZW1vdGVEZWJ1Z1Byb3h5LFxuICAgICAgZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUgPSBmYWxzZSxcbiAgICAgIGxvZ0Z1bGxSZXNwb25zZSA9IGZhbHNlLFxuICAgIH0gPSBvcHRzO1xuXG4gICAgdGhpcy5idW5kbGVJZCA9IGJ1bmRsZUlkO1xuICAgIHRoaXMucGxhdGZvcm1WZXJzaW9uID0gcGxhdGZvcm1WZXJzaW9uO1xuICAgIHRoaXMuaXNTYWZhcmkgPSBpc1NhZmFyaTtcbiAgICB0aGlzLmluY2x1ZGVTYWZhcmkgPSBpbmNsdWRlU2FmYXJpO1xuICAgIHRoaXMudXNlTmV3U2FmYXJpID0gdXNlTmV3U2FmYXJpO1xuICAgIHRoaXMucGFnZUxvYWRNcyA9IHBhZ2VMb2FkTXM7XG4gICAgbG9nLmRlYnVnKGB1c2VOZXdTYWZhcmkgLS0+ICR7dGhpcy51c2VOZXdTYWZhcml9YCk7XG5cbiAgICB0aGlzLmdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlID0gZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGU7XG5cbiAgICB0aGlzLmhvc3QgPSBob3N0O1xuICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgdGhpcy5zb2NrZXRQYXRoID0gc29ja2V0UGF0aDtcbiAgICB0aGlzLnJlbW90ZURlYnVnUHJveHkgPSByZW1vdGVEZWJ1Z1Byb3h5O1xuICAgIHRoaXMucGFnZVJlYWR5VGltZW91dCA9IHBhZ2VSZWFkeVRpbWVvdXQ7XG5cbiAgICB0aGlzLmxvZ0Z1bGxSZXNwb25zZSA9IGxvZ0Z1bGxSZXNwb25zZTtcblxuICAgIHRoaXMuc2tpcHBlZEFwcHMgPSBbXTtcbiAgfVxuXG4gIHNldHVwICgpIHtcbiAgICAvLyBhcHAgaGFuZGxpbmcgY29uZmlndXJhdGlvblxuICAgIHRoaXMuYXBwRGljdCA9IHt9O1xuICAgIHRoaXMuYXBwSWRLZXkgPSBudWxsO1xuICAgIHRoaXMucGFnZUlkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VMb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5fbmF2aWdhdGluZ1RvUGFnZSA9IGZhbHNlO1xuXG4gICAgLy8gc2V0IHVwIHRoZSBzcGVjaWFsIGNhbGxiYWNrcyBmb3IgaGFuZGxpbmcgcmQgZXZlbnRzXG4gICAgdGhpcy5zcGVjaWFsQ2JzID0ge1xuICAgICAgJ19ycGNfcmVwb3J0SWRlbnRpZmllcjonOiBfLm5vb3AsXG4gICAgICAnX3JwY19mb3J3YXJkR2V0TGlzdGluZzonOiB0aGlzLm9uUGFnZUNoYW5nZS5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfcmVwb3J0Q29ubmVjdGVkQXBwbGljYXRpb25MaXN0Oic6IF8ubm9vcCxcbiAgICAgICdfcnBjX2FwcGxpY2F0aW9uQ29ubmVjdGVkOic6IHRoaXMub25BcHBDb25uZWN0LmJpbmQodGhpcyksXG4gICAgICAnX3JwY19hcHBsaWNhdGlvbkRpc2Nvbm5lY3RlZDonOiB0aGlzLm9uQXBwRGlzY29ubmVjdC5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfYXBwbGljYXRpb25VcGRhdGVkOic6IHRoaXMub25BcHBVcGRhdGUuYmluZCh0aGlzKSxcbiAgICAgICdfcnBjX3JlcG9ydENvbm5lY3RlZERyaXZlckxpc3Q6JzogXy5ub29wLFxuICAgICAgcGFnZUxvYWQ6IHRoaXMucGFnZUxvYWQuYmluZCh0aGlzKSxcbiAgICAgIGZyYW1lRGV0YWNoZWQ6IHRoaXMuZnJhbWVEZXRhY2hlZC5iaW5kKHRoaXMpLFxuICAgICAgdGFyZ2V0Q3JlYXRlZDogdGhpcy5vblRhcmdldENyZWF0ZWQuYmluZCh0aGlzKSxcbiAgICAgIHRhcmdldERlc3Ryb3llZDogdGhpcy5vblRhcmdldERlc3Ryb3llZC5iaW5kKHRoaXMpLFxuICAgIH07XG5cbiAgICB0aGlzLnJwY0NsaWVudCA9IG51bGw7XG4gIH1cblxuICB0ZWFyZG93biAoKSB7XG4gICAgbG9nLmRlYnVnKCdDbGVhbmluZyB1cCBsaXN0ZW5lcnMnKTtcblxuICAgIHRoaXMuYXBwRGljdCA9IHt9O1xuICAgIHRoaXMuYXBwSWRLZXkgPSBudWxsO1xuICAgIHRoaXMucGFnZUlkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VMb2FkaW5nID0gZmFsc2U7XG5cbiAgICB0aGlzLnNwZWNpYWxDYnMgPSB7fTtcblxuICAgIHRoaXMucnBjQ2xpZW50ID0gbnVsbDtcblxuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFKTtcbiAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhSZW1vdGVEZWJ1Z2dlci5FVkVOVF9ESVNDT05ORUNUKTtcbiAgfVxuXG4gIGFzeW5jIGNvbm5lY3QgKCkge1xuICAgIHRoaXMuc2V0dXAoKTtcblxuICAgIC8vIGluaXRpYWxpemUgdGhlIHJwYyBjbGllbnRcbiAgICB0aGlzLnJwY0NsaWVudCA9IG5ldyBScGNDbGllbnRTaW11bGF0b3Ioe1xuICAgICAgYnVuZGxlSWQ6IHRoaXMuYnVuZGxlSWQsXG4gICAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMucGxhdGZvcm1WZXJzaW9uLFxuICAgICAgaXNTYWZhcmk6IHRoaXMuaXNTYWZhcmksXG4gICAgICBob3N0OiB0aGlzLmhvc3QsXG4gICAgICBwb3J0OiB0aGlzLnBvcnQsXG4gICAgICBzb2NrZXRQYXRoOiB0aGlzLnNvY2tldFBhdGgsXG4gICAgICBzcGVjaWFsTWVzc2FnZUhhbmRsZXJzOiB0aGlzLnNwZWNpYWxDYnMsXG4gICAgICBtZXNzYWdlUHJveHk6IHRoaXMucmVtb3RlRGVidWdQcm94eSxcbiAgICAgIGxvZ0Z1bGxSZXNwb25zZTogdGhpcy5sb2dGdWxsUmVzcG9uc2UsXG4gICAgfSk7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuY29ubmVjdCgpO1xuXG4gICAgLy8gZ2V0IHRoZSBjb25uZWN0aW9uIGluZm9ybWF0aW9uIGFib3V0IHRoZSBhcHBcbiAgICB0cnkge1xuICAgICAgY29uc3QgYXBwSW5mbyA9IGF3YWl0IHRoaXMuc2V0Q29ubmVjdGlvbktleSgpO1xuICAgICAgbG9nLmRlYnVnKCdDb25uZWN0ZWQgdG8gYXBwbGljYXRpb24nKTtcbiAgICAgIHJldHVybiBhcHBJbmZvO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgYXdhaXQgdGhpcy5kaXNjb25uZWN0KCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBkaXNjb25uZWN0ICgpIHtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5kaXNjb25uZWN0KCk7XG4gICAgdGhpcy5lbWl0KFJlbW90ZURlYnVnZ2VyLkVWRU5UX0RJU0NPTk5FQ1QsIHRydWUpO1xuICAgIHRoaXMudGVhcmRvd24oKTtcbiAgfVxuXG4gIGlzQ29ubmVjdGVkICgpIHtcbiAgICByZXR1cm4gISEodGhpcy5ycGNDbGllbnQgJiYgdGhpcy5ycGNDbGllbnQuaXNDb25uZWN0ZWQoKSk7XG4gIH1cblxuICBhc3luYyBzZXRDb25uZWN0aW9uS2V5ICgpIHtcbiAgICAvLyBvbmx5IHJlc29sdmUgd2hlbiB0aGUgY29ubmVjdGlvbiByZXNwb25zZSBpcyByZWNlaXZlZFxuICAgIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAvLyBsb2NhbCBjYWxsYmFjaywgY2FsbGVkIHdoZW4gdGhlIHJlbW90ZSBkZWJ1Z2dlciBoYXMgZXN0YWJsaXNoZWRcbiAgICAgIC8vIGEgY29ubmVjdGlvbiB0byB0aGUgYXBwIHVuZGVyIHRlc3RcbiAgICAgIC8vIGBhcHBgIHdpbGwgYmUgYW4gYXJyYXkgb2YgZGljdGlvbmFyaWVzIG9mIGFwcCBpbmZvcm1hdGlvblxuICAgICAgbGV0IGNvbm5lY3RDYiA9IChhcHBzKSA9PiB7XG4gICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGFwcHMpIHx8IF8ua2V5cyhhcHBzKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBsb2cuZGVidWcoJ1JlY2VpdmVkIG5vIGFwcHMgZnJvbSByZW1vdGUgZGVidWdnZXIuIFVuYWJsZSB0byBjb25uZWN0LicpO1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHRoaXMuYXBwRGljdCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5ld0RpY3QgPSB7fTtcblxuICAgICAgICAvLyB0cmFuc2xhdGUgdGhlIHJlY2VpdmVkIGluZm9ybWF0aW9uIGludG8gYW4gZWFzaWVyLXRvLW1hbmFnZVxuICAgICAgICAvLyBoYXNoIHdpdGggYXBwIGlkIGFzIGtleSwgYW5kIGFwcCBpbmZvIGFzIHZhbHVlXG4gICAgICAgIGZvciAoY29uc3QgZGljdCBvZiBfLnZhbHVlcyhhcHBzKSkge1xuICAgICAgICAgIGNvbnN0IFtpZCwgZW50cnldID0gYXBwSW5mb0Zyb21EaWN0KGRpY3QpO1xuICAgICAgICAgIGlmICh0aGlzLnNraXBwZWRBcHBzLmluY2x1ZGVzKGVudHJ5Lm5hbWUpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbmV3RGljdFtpZF0gPSBlbnRyeTtcbiAgICAgICAgfVxuICAgICAgICAvLyB1cGRhdGUgdGhlIG9iamVjdCdzIGxpc3Qgb2YgYXBwcywgYW5kIHJldHVybiBpdCB0aHJvdWdoIHRoZSBwcm9taXNlXG4gICAgICAgIF8uZGVmYXVsdHModGhpcy5hcHBEaWN0LCBuZXdEaWN0KTtcbiAgICAgICAgcmVzb2x2ZShuZXdEaWN0KTtcbiAgICAgIH07XG4gICAgICB0aGlzLnJwY0NsaWVudC5zZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoJ19ycGNfcmVwb3J0Q29ubmVjdGVkQXBwbGljYXRpb25MaXN0OicsIHJlamVjdCwgY29ubmVjdENiKTtcblxuICAgICAgbG9nLmRlYnVnKCdTZW5kaW5nIGNvbm5lY3Rpb24ga2V5IHJlcXVlc3QnKTtcbiAgICAgIHJldHVybiAoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBbc2ltTmFtZUtleSwgc2ltQnVpbGRLZXksIHNpbVBsYXRmb3JtVmVyc2lvbl0gPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZXRDb25uZWN0aW9uS2V5Jyk7XG4gICAgICAgIGxvZy5kZWJ1ZyhgU2ltIG5hbWU6ICR7c2ltTmFtZUtleX1gKTtcbiAgICAgICAgbG9nLmRlYnVnKGBTaW0gYnVpbGQ6ICR7c2ltQnVpbGRLZXl9YCk7XG4gICAgICAgIGxvZy5kZWJ1ZyhgU2ltIHBsYXRmb3JtIHZlcnNpb246ICR7c2ltUGxhdGZvcm1WZXJzaW9ufWApO1xuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUFwcHNXaXRoRGljdCAoZGljdCkge1xuICAgIC8vIGdldCB0aGUgZGljdGlvbmFyeSBlbnRyeSBpbnRvIGEgbmljZSBmb3JtLCBhbmQgYWRkIGl0IHRvIHRoZVxuICAgIC8vIGFwcGxpY2F0aW9uIGRpY3Rpb25hcnlcbiAgICB0aGlzLmFwcERpY3QgPSB0aGlzLmFwcERpY3QgfHwge307XG4gICAgbGV0IFtpZCwgZW50cnldID0gYXBwSW5mb0Zyb21EaWN0KGRpY3QpO1xuICAgIGlmICh0aGlzLmFwcERpY3RbaWRdKSB7XG4gICAgICAvLyBwcmVzZXJ2ZSB0aGUgcGFnZSBkaWN0aW9uYXJ5IGZvciB0aGlzIGVudHJ5XG4gICAgICBlbnRyeS5wYWdlQXJyYXkgPSB0aGlzLmFwcERpY3RbaWRdLnBhZ2VBcnJheTtcbiAgICB9XG4gICAgdGhpcy5hcHBEaWN0W2lkXSA9IGVudHJ5O1xuXG4gICAgLy8gYWRkIGEgcHJvbWlzZSB0byBnZXQgdGhlIHBhZ2UgZGljdGlvbmFyeVxuICAgIGlmIChfLmlzVW5kZWZpbmVkKGVudHJ5LnBhZ2VBcnJheSkpIHtcbiAgICAgIGVudHJ5LnBhZ2VBcnJheSA9IGRlZmVycmVkUHJvbWlzZSgpO1xuICAgIH1cblxuICAgIC8vIHRyeSB0byBnZXQgdGhlIGFwcCBpZCBmcm9tIG91ciBjb25uZWN0ZWQgYXBwc1xuICAgIGlmICghdGhpcy5hcHBJZEtleSkge1xuICAgICAgdGhpcy5hcHBJZEtleSA9IGdldERlYnVnZ2VyQXBwS2V5KHRoaXMuYnVuZGxlSWQsIHRoaXMucGxhdGZvcm1WZXJzaW9uLCB0aGlzLmFwcERpY3QpO1xuICAgIH1cbiAgfVxuXG4gIGxvZ0FwcGxpY2F0aW9uRGljdGlvbmFyeSAoYXBwcykge1xuICAgIGZ1bmN0aW9uIGdldFZhbHVlU3RyaW5nIChrZXksIHZhbHVlKSB7XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gJ1tGdW5jdGlvbl0nO1xuICAgICAgfVxuICAgICAgaWYgKGtleSA9PT0gJ3BhZ2VBcnJheScgJiYgIV8uaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGAnV2FpdGluZyBmb3IgZGF0YSdgO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKCdDdXJyZW50IGFwcGxpY2F0aW9ucyBhdmFpbGFibGU6Jyk7XG4gICAgZm9yIChjb25zdCBbYXBwLCBpbmZvXSBvZiBfLnRvUGFpcnMoYXBwcykpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgICAgIEFwcGxpY2F0aW9uOiAnJHthcHB9J2ApO1xuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKGluZm8pKSB7XG4gICAgICAgIGlmIChrZXkgPT09ICdwYWdlQXJyYXknICYmIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgICAgICAgICAke2tleX06YCk7XG4gICAgICAgICAgZm9yIChjb25zdCBwYWdlIG9mIHZhbHVlKSB7XG4gICAgICAgICAgICBsZXQgcHJlZml4ID0gJy0gJztcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2ssIHZdIG9mIF8udG9QYWlycyhwYWdlKSkge1xuICAgICAgICAgICAgICBsb2cuZGVidWcoYCAgICAgICAgICAke3ByZWZpeH0ke2t9OiAke0pTT04uc3RyaW5naWZ5KHYpfWApO1xuICAgICAgICAgICAgICBwcmVmaXggPSAnICAnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZVN0cmluZyA9IGdldFZhbHVlU3RyaW5nKGtleSwgdmFsdWUpO1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgICAgICAgICAke2tleX06ICR7dmFsdWVTdHJpbmd9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBzZWxlY3RBcHAgKGN1cnJlbnRVcmwgPSBudWxsLCBtYXhUcmllcyA9IFNFTEVDVF9BUFBfUkVUUklFUywgaWdub3JlQWJvdXRCbGFua1VybCA9IGZhbHNlKSB7XG4gICAgY29uc3Qgc2hvdWxkQ2hlY2tGb3JUYXJnZXQgPSB0aGlzLnJwY0NsaWVudC5zaG91bGRDaGVja0ZvclRhcmdldDtcbiAgICB0aGlzLnJwY0NsaWVudC5zaG91bGRDaGVja0ZvclRhcmdldCA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwcm9jZXNzLmhydGltZSgpO1xuICAgICAgbG9nLmRlYnVnKCdTZWxlY3RpbmcgYXBwbGljYXRpb24nKTtcbiAgICAgIGlmICghdGhpcy5hcHBEaWN0IHx8IF8uaXNFbXB0eSh0aGlzLmFwcERpY3QpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnTm8gYXBwbGljYXRpb25zIGN1cnJlbnRseSBjb25uZWN0ZWQuJyk7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBhcHBJZEtleSwgcGFnZURpY3QgfSA9IGF3YWl0IHRoaXMuc2VhcmNoRm9yQXBwKGN1cnJlbnRVcmwsIG1heFRyaWVzLCBpZ25vcmVBYm91dEJsYW5rVXJsKTtcblxuICAgICAgLy8gaWYsIGFmdGVyIGFsbCB0aGlzLCB3ZSBoYXZlIG5vIGRpY3Rpb25hcnksIHdlIGhhdmUgZmFpbGVkXG4gICAgICBpZiAoIWFwcElkS2V5IHx8ICFwYWdlRGljdCkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNvbm5lY3QgdG8gYSB2YWxpZCBhcHAgYWZ0ZXIgJHttYXhUcmllc30gdHJpZXMuYCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmFwcElkS2V5ICE9PSBhcHBJZEtleSkge1xuICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIGFsdGVyZWQgYXBwIGlkLCB1cGRhdGluZyBmcm9tICcke3RoaXMuYXBwSWRLZXl9JyB0byAnJHthcHBJZEtleX0nYCk7XG4gICAgICAgIHRoaXMuYXBwSWRLZXkgPSBhcHBJZEtleTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkodGhpcy5hcHBEaWN0KTtcblxuICAgICAgLy8gdHJhbnNsYXRlIHRoZSBkaWN0aW9uYXJ5IGludG8gYSB1c2VmdWwgZm9ybSwgYW5kIHJldHVybiB0byBzZW5kZXJcbiAgICAgIGNvbnN0IHBhZ2VBcnJheSA9IF8uaXNFbXB0eSh0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheSlcbiAgICAgICAgPyBwYWdlQXJyYXlGcm9tRGljdChwYWdlRGljdClcbiAgICAgICAgOiB0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheTtcbiAgICAgIGxvZy5kZWJ1ZyhgRmluYWxseSBzZWxlY3RpbmcgYXBwICR7dGhpcy5hcHBJZEtleX06ICR7c2ltcGxlU3RyaW5naWZ5KHBhZ2VBcnJheSl9YCk7XG5cbiAgICAgIGxldCBmdWxsUGFnZUFycmF5ID0gW107XG4gICAgICBmb3IgKGNvbnN0IFthcHAsIGluZm9dIG9mIF8udG9QYWlycyh0aGlzLmFwcERpY3QpKSB7XG4gICAgICAgIGlmICghXy5pc0FycmF5KGluZm8ucGFnZUFycmF5KSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlkID0gYXBwLnJlcGxhY2UoJ1BJRDonLCAnJyk7XG4gICAgICAgIGZvciAoY29uc3QgcGFnZSBvZiBpbmZvLnBhZ2VBcnJheSkge1xuICAgICAgICAgIGlmIChwYWdlLnVybCAmJiAoIWlnbm9yZUFib3V0QmxhbmtVcmwgfHwgcGFnZS51cmwgIT09IEJMQU5LX1BBR0VfVVJMKSkge1xuICAgICAgICAgICAgbGV0IHBhZ2VEaWN0ID0gXy5jbG9uZShwYWdlKTtcbiAgICAgICAgICAgIHBhZ2VEaWN0LmlkID0gYCR7aWR9LiR7cGFnZURpY3QuaWR9YDtcbiAgICAgICAgICAgIGZ1bGxQYWdlQXJyYXkucHVzaChwYWdlRGljdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxvZy5kZWJ1ZyhgU2VsZWN0ZWQgYXBwIGFmdGVyICR7Z2V0RWxhcHNlZFRpbWUoc3RhcnRUaW1lKX1tc2ApO1xuICAgICAgcmV0dXJuIGZ1bGxQYWdlQXJyYXk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMucnBjQ2xpZW50LnNob3VsZENoZWNrRm9yVGFyZ2V0ID0gc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VhcmNoRm9yQXBwIChjdXJyZW50VXJsLCBtYXhUcmllcywgaWdub3JlQWJvdXRCbGFua1VybCkge1xuICAgIGNvbnN0IGJ1bmRsZUlkcyA9IHRoaXMuaW5jbHVkZVNhZmFyaSAmJiAhdGhpcy5pc1NhZmFyaVxuICAgICAgPyBbdGhpcy5idW5kbGVJZCwgU0FGQVJJX0JVTkRMRV9JRF1cbiAgICAgIDogW3RoaXMuYnVuZGxlSWRdO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgcmV0cnlJbnRlcnZhbChtYXhUcmllcywgU0VMRUNUX0FQUF9SRVRSWV9TTEVFUF9NUywgYXN5bmMgKHJldHJ5Q291bnQpID0+IHtcbiAgICAgICAgdGhpcy5sb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkodGhpcy5hcHBEaWN0KTtcbiAgICAgICAgY29uc3QgcG9zc2libGVBcHBJZHMgPSBnZXRQb3NzaWJsZURlYnVnZ2VyQXBwS2V5cyhidW5kbGVJZHMsIHRoaXMucGxhdGZvcm1WZXJzaW9uLCB0aGlzLmFwcERpY3QpO1xuICAgICAgICBsb2cuZGVidWcoYFRyeWluZyBvdXQgdGhlIHBvc3NpYmxlIGFwcCBpZHM6ICR7cG9zc2libGVBcHBJZHMuam9pbignLCAnKX1gKTtcbiAgICAgICAgZm9yIChjb25zdCBhdHRlbXB0ZWRBcHBJZEtleSBvZiBwb3NzaWJsZUFwcElkcykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsb2cuZGVidWcoYFNlbGVjdGluZyBhcHAgJHthdHRlbXB0ZWRBcHBJZEtleX0gKHRyeSAjJHtyZXRyeUNvdW50ICsgMX0gb2YgJHttYXhUcmllc30pYCk7XG4gICAgICAgICAgICBjb25zdCBbYXBwSWRLZXksIHBhZ2VEaWN0XSA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbGVjdEFwcChhdHRlbXB0ZWRBcHBJZEtleSwgdGhpcy5vbkFwcENvbm5lY3QuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAvLyBpbiBpT1MgOC4yIHRoZSBjb25uZWN0IGxvZ2ljIGhhcHBlbnMsIGJ1dCB3aXRoIGFuIGVtcHR5IGRpY3Rpb25hcnlcbiAgICAgICAgICAgIC8vIHdoaWNoIGxlYWRzIHRvIHRoZSByZW1vdGUgZGVidWdnZXIgZ2V0dGluZyBkaXNjb25uZWN0ZWQsIGFuZCBpbnRvIGEgbG9vcFxuICAgICAgICAgICAgaWYgKF8uaXNFbXB0eShwYWdlRGljdCkpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKCdFbXB0eSBwYWdlIGRpY3Rpb25hcnkgcmVjZWl2ZWQuIFRyeWluZyBhZ2Fpbi4nKTtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNhdmUgdGhlIHBhZ2UgYXJyYXkgZm9yIHRoaXMgYXBwXG4gICAgICAgICAgICB0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheSA9IHBhZ2VBcnJheUZyb21EaWN0KHBhZ2VEaWN0KTtcblxuICAgICAgICAgICAgLy8gaWYgd2UgYXJlIGxvb2tpbmcgZm9yIGEgcGFydGljdWxhciB1cmwsIG1ha2Ugc3VyZSB3ZSBoYXZlIHRoZSByaWdodCBwYWdlLiBJZ25vcmUgZW1wdHkgb3IgdW5kZWZpbmVkIHVybHMuIElnbm9yZSBhYm91dDpibGFuayBpZiByZXF1ZXN0ZWQuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnNlYXJjaFBhZ2UodGhpcy5hcHBEaWN0LCBjdXJyZW50VXJsLCBpZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGN1cnJlbnRVcmwpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBhcHAsIGJ1dCBleHBlY3RlZCB1cmwgKCcke2N1cnJlbnRVcmx9Jykgd2FzIG5vdCBmb3VuZC4gVHJ5aW5nIGFnYWluLmApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKCdSZWNlaXZlZCBhcHAsIGJ1dCBubyBtYXRjaCB3YXMgZm91bmQuIFRyeWluZyBhZ2Fpbi4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhgRXJyb3IgY2hlY2tpbmcgYXBwbGljYXRpb246ICcke2Vyci5tZXNzYWdlfScuIFJldHJ5aW5nIGNvbm5lY3Rpb25gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0cnlDb3VudCsrO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmaW5kIGFuIGFwcCB0byBzZWxlY3QnKTtcbiAgICAgIH0sIDApO1xuICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBjb25uZWN0IHRvIGEgdmFsaWQgYXBwIGFmdGVyICR7bWF4VHJpZXN9IHRyaWVzLmApO1xuICAgIH1cbiAgfVxuXG4gIHNlYXJjaFBhZ2UgKGFwcHNEaWN0LCBjdXJyZW50VXJsID0gbnVsbCwgaWdub3JlQWJvdXRCbGFua1VybCA9IGZhbHNlKSB7XG4gICAgZm9yIChjb25zdCBhcHBEaWN0IG9mIF8udmFsdWVzKGFwcHNEaWN0KSkge1xuICAgICAgaWYgKCFhcHBEaWN0IHx8ICFhcHBEaWN0LnBhZ2VBcnJheSB8fCBhcHBEaWN0LnBhZ2VBcnJheS5wcm9taXNlKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgYXBwRGljdC5wYWdlQXJyYXkpIHtcbiAgICAgICAgaWYgKCghaWdub3JlQWJvdXRCbGFua1VybCB8fCBkaWN0LnVybCAhPT0gQkxBTktfUEFHRV9VUkwpICYmXG4gICAgICAgICAgICAoIWN1cnJlbnRVcmwgfHwgZGljdC51cmwgPT09IGN1cnJlbnRVcmwgfHwgZGljdC51cmwgPT09IGAke2N1cnJlbnRVcmx9L2ApKSB7XG4gICAgICAgICAgcmV0dXJuIHsgYXBwSWRLZXk6IGFwcERpY3QuaWQsIHBhZ2VEaWN0OiBkaWN0IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBhc3luYyBzZWxlY3RQYWdlIChhcHBJZEtleSwgcGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayA9IGZhbHNlKSB7XG4gICAgdGhpcy5hcHBJZEtleSA9IGBQSUQ6JHthcHBJZEtleX1gO1xuICAgIHRoaXMucGFnZUlkS2V5ID0gcGFnZUlkS2V5O1xuXG4gICAgbG9nLmRlYnVnKGBTZWxlY3RpbmcgcGFnZSAnJHtwYWdlSWRLZXl9JyBvbiBhcHAgJyR7dGhpcy5hcHBJZEtleX0nIGFuZCBmb3J3YXJkaW5nIHNvY2tldCBzZXR1cGApO1xuXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUoKTtcblxuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbGVjdFBhZ2UodGhpcy5hcHBJZEtleSwgcGFnZUlkS2V5KTtcblxuICAgIC8vIG1ha2Ugc3VyZSBldmVyeXRoaW5nIGlzIHJlYWR5IHRvIGdvXG4gICAgaWYgKCFza2lwUmVhZHlDaGVjayAmJiAhYXdhaXQgdGhpcy5jaGVja1BhZ2VJc1JlYWR5KCkpIHtcbiAgICAgIGF3YWl0IHRoaXMucGFnZVVubG9hZCgpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgU2VsZWN0ZWQgcGFnZSBhZnRlciAke2dldEVsYXBzZWRUaW1lKHN0YXJ0VGltZSl9bXNgKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVBdG9tIChhdG9tLCBhcmdzLCBmcmFtZXMpIHtcbiAgICBpZiAoIXRoaXMucnBjQ2xpZW50LmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVtb3RlIGRlYnVnZ2VyIGlzIG5vdCBjb25uZWN0ZWQnKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyBhdG9tICcke2F0b219J2ApO1xuICAgIGNvbnN0IHNjcmlwdCA9IGF3YWl0IGdldFNjcmlwdEZvckF0b20oYXRvbSwgYXJncywgZnJhbWVzKTtcbiAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZXhlY3V0ZShzY3JpcHQsIHRydWUpO1xuICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgcmVzdWx0IGZvciBhdG9tICcke2F0b219JyBleGVjdXRpb246ICR7Xy50cnVuY2F0ZShzaW1wbGVTdHJpbmdpZnkodmFsdWUpLCB7bGVuZ3RoOiBSRVNQT05TRV9MT0dfTEVOR1RIfSl9YCk7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZUF0b21Bc3luYyAoYXRvbSwgYXJncywgZnJhbWVzKSB7XG4gICAgLy8gZmlyc3QgY3JlYXRlIGEgUHJvbWlzZSBvbiB0aGUgcGFnZSwgc2F2aW5nIHRoZSByZXNvbHZlL3JlamVjdCBmdW5jdGlvbnNcbiAgICAvLyBhcyBwcm9wZXJ0aWVzXG4gICAgY29uc3QgcHJvbWlzZU5hbWUgPSBgYXBwaXVtQXN5bmNFeGVjdXRlUHJvbWlzZSR7VVVJRC5jcmVhdGUoKS50b1N0cmluZygpLnJlcGxhY2UoLy0vZywgJycpfWA7XG4gICAgbGV0IHNjcmlwdCA9IGB2YXIgcmVzLCByZWo7YCArXG4gICAgICAgICAgICAgICAgIGB3aW5kb3cuJHtwcm9taXNlTmFtZX0gPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7YCArXG4gICAgICAgICAgICAgICAgIGAgIHJlcyA9IHJlc29sdmU7YCArXG4gICAgICAgICAgICAgICAgIGAgIHJlaiA9IHJlamVjdDtgICtcbiAgICAgICAgICAgICAgICAgYH0pO2AgK1xuICAgICAgICAgICAgICAgICBgd2luZG93LiR7cHJvbWlzZU5hbWV9LnJlc29sdmUgPSByZXM7YCArXG4gICAgICAgICAgICAgICAgIGB3aW5kb3cuJHtwcm9taXNlTmFtZX0ucmVqZWN0ID0gcmVqO2AgK1xuICAgICAgICAgICAgICAgICBgd2luZG93LiR7cHJvbWlzZU5hbWV9O2A7XG4gICAgY29uc3Qgb2JqID0gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc2VuZEpTQ29tbWFuZCcsIHtcbiAgICAgIGNvbW1hbmQ6IHNjcmlwdCxcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIHJldHVybkJ5VmFsdWU6IGZhbHNlLFxuICAgIH0pO1xuICAgIGNvbnN0IHByb21pc2VPYmplY3RJZCA9IG9iai5yZXN1bHQub2JqZWN0SWQ7XG5cbiAgICAvLyBleGVjdXRlIHRoZSBhdG9tLCBjYWxsaW5nIGJhY2sgdG8gdGhlIHJlc29sdmUgZnVuY3Rpb25cbiAgICBjb25zdCBhc3luY0NhbGxCYWNrID0gYGZ1bmN0aW9uIChyZXMpIHtgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYCAgd2luZG93LiR7cHJvbWlzZU5hbWV9LnJlc29sdmUocmVzKTtgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYCAgd2luZG93LiR7cHJvbWlzZU5hbWV9VmFsdWUgPSByZXM7YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGB9YDtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGUoYXdhaXQgZ2V0U2NyaXB0Rm9yQXRvbShhdG9tLCBhcmdzLCBmcmFtZXMsIGFzeW5jQ2FsbEJhY2spKTtcblxuICAgIC8vIHdhaXQgZm9yIHRoZSBwcm9taXNlIHRvIGJlIHJlc29sdmVkXG4gICAgbGV0IHJlcztcbiAgICBjb25zdCBzdWJjb21tYW5kVGltZW91dCA9IDEwMDA7IC8vIHRpbWVvdXQgb24gaW5kaXZpZHVhbCBjb21tYW5kc1xuICAgIHRyeSB7XG4gICAgICByZXMgPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdhd2FpdFByb21pc2UnLCB7XG4gICAgICAgIHByb21pc2VPYmplY3RJZCxcbiAgICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoYCdSdW50aW1lLmF3YWl0UHJvbWlzZScgd2FzIG5vdCBmb3VuZGApKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cblxuICAgICAgLy8gYXdhaXRQcm9taXNlIGlzIG5vdCBhbHdheXMgYXZhaWxhYmxlLCBzbyBzaW11bGF0ZSBpdCB3aXRoIHBvbGxcbiAgICAgIGNvbnN0IHJldHJ5V2FpdCA9IDEwMDtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSAoYXJncy5sZW5ndGggPj0gMykgPyBhcmdzWzJdIDogUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVM7XG4gICAgICBjb25zdCByZXRyaWVzID0gcGFyc2VJbnQodGltZW91dCAvIHJldHJ5V2FpdCwgMTApO1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICAgIHJlcyA9IGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgcmV0cnlXYWl0LCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIHRoZSBhdG9tIF93aWxsXyByZXR1cm4sIGVpdGhlciBiZWNhdXNlIGl0IGZpbmlzaGVkIG9yIGFuIGVycm9yXG4gICAgICAgIC8vIGluY2x1ZGluZyBhIHRpbWVvdXQgZXJyb3JcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW2ByZXR1cm4gd2luZG93Lmhhc093blByb3BlcnR5KCcke3Byb21pc2VOYW1lfVZhbHVlJyk7YCwgW251bGwsIG51bGxdLCBzdWJjb21tYW5kVGltZW91dF0sIGZyYW1lcykpIHtcbiAgICAgICAgICAvLyB3ZSBvbmx5IHB1dCB0aGUgcHJvcGVydHkgb24gYHdpbmRvd2Agd2hlbiB0aGUgY2FsbGJhY2sgaXMgY2FsbGVkLFxuICAgICAgICAgIC8vIHNvIGlmIGl0IGlzIHRoZXJlLCBldmVyeXRoaW5nIGlzIGRvbmVcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZXhlY3V0ZV9zY3JpcHQnLCBbYHJldHVybiB3aW5kb3cuJHtwcm9taXNlTmFtZX1WYWx1ZTtgLCBbbnVsbCwgbnVsbF0sIHN1YmNvbW1hbmRUaW1lb3V0XSwgZnJhbWVzKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aHJvdyBhIFRpbWVvdXRFcnJvciwgb3IgZWxzZSBpdCBuZWVkcyB0byBiZSBjYXVnaHQgYW5kIHJlLXRocm93blxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlRpbWVvdXRFcnJvcihgVGltZWQgb3V0IHdhaXRpbmcgZm9yIGFzeW5jaHJvbm91cyBzY3JpcHQgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGByZXN1bHQgYWZ0ZXIgJHtnZXRFbGFwc2VkVGltZShzdGFydFRpbWUpfSBtcycpKTtgKTtcbiAgICAgIH0pO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyB0cnkgdG8gZ2V0IHJpZCBvZiB0aGUgcHJvbWlzZVxuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtgZGVsZXRlIHdpbmRvdy4ke3Byb21pc2VOYW1lfTtgLCBbbnVsbCwgbnVsbF0sIHN1YmNvbW1hbmRUaW1lb3V0XSwgZnJhbWVzKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRSZXN1bHQocmVzKTtcbiAgfVxuXG4gIGZyYW1lRGV0YWNoZWQgKCkge1xuICAgIHRoaXMuZW1pdChSZW1vdGVEZWJ1Z2dlci5FVkVOVF9GUkFNRVNfREVUQUNIRUQpO1xuICB9XG5cbiAgYXN5bmMgcGFnZUxvYWQgKHN0YXJ0UGFnZUxvYWRNcywgcGFnZUxvYWRWZXJpZnlIb29rKSB7XG4gICAgbGV0IHRpbWVvdXRNcyA9IDUwMDtcbiAgICBsZXQgc3RhcnQgPSBzdGFydFBhZ2VMb2FkTXMgfHwgRGF0ZS5ub3coKTtcbiAgICBsb2cuZGVidWcoJ1BhZ2UgbG9hZGVkLCB2ZXJpZnlpbmcgd2hldGhlciByZWFkeScpO1xuXG4gICAgY29uc3QgdmVyaWZ5ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5wYWdlTG9hZERlbGF5ID0gdXRpbC5jYW5jZWxsYWJsZURlbGF5KHRpbWVvdXRNcyk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnBhZ2VMb2FkRGVsYXk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEIuQ2FuY2VsbGF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBpZiB0aGUgcHJvbWlzZSBoYXMgYmVlbiBjYW5jZWxsZWRcbiAgICAgICAgICAvLyB3ZSB3YW50IHRvIHNraXAgY2hlY2tpbmcgdGhlIHJlYWRpbmVzc1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyB3ZSBjYW4gZ2V0IHRoaXMgY2FsbGVkIGluIHRoZSBtaWRkbGUgb2YgdHJ5aW5nIHRvIGZpbmQgYSBuZXcgYXBwXG4gICAgICBpZiAoIXRoaXMuYXBwSWRLZXkpIHtcbiAgICAgICAgbG9nLmRlYnVnKCdOb3QgY29ubmVjdGVkIHRvIGFuIGFwcGxpY2F0aW9uLiBJZ25vcmluZyBwYWdlIGxvYWQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHBhZ2VMb2FkVmVyaWZ5SG9vaykpIHtcbiAgICAgICAgYXdhaXQgcGFnZUxvYWRWZXJpZnlIb29rKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWR5ID0gYXdhaXQgdGhpcy5jaGVja1BhZ2VJc1JlYWR5KCk7XG5cbiAgICAgIC8vIGlmIHdlIGFyZSByZWFkeSwgb3Igd2UndmUgc3BlbmQgdG9vIG11Y2ggdGltZSBvbiB0aGlzXG4gICAgICBpZiAocmVhZHkgfHwgKHRoaXMucGFnZUxvYWRNcyA+IDAgJiYgKHN0YXJ0ICsgdGhpcy5wYWdlTG9hZE1zKSA8IERhdGUubm93KCkpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnUGFnZSBpcyByZWFkeScpO1xuICAgICAgICB0aGlzLnBhZ2VMb2FkaW5nID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZGVidWcoJ1BhZ2Ugd2FzIG5vdCByZWFkeSwgcmV0cnlpbmcnKTtcbiAgICAgICAgYXdhaXQgdmVyaWZ5KCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBhd2FpdCB2ZXJpZnkoKTtcbiAgfVxuXG4gIGNhbmNlbFBhZ2VMb2FkICgpIHtcbiAgICBsb2cuZGVidWcoJ1VucmVnaXN0ZXJpbmcgZnJvbSBwYWdlIHJlYWRpbmVzcyBub3RpZmljYXRpb25zJyk7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnBhZ2VMb2FkRGVsYXkpIHtcbiAgICAgIHRoaXMucGFnZUxvYWREZWxheS5jYW5jZWwoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBwYWdlVW5sb2FkICgpIHtcbiAgICBsb2cuZGVidWcoJ1BhZ2UgdW5sb2FkaW5nJyk7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IHRydWU7XG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yRG9tKCk7XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yRG9tIChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vaykge1xuICAgIGxvZy5kZWJ1ZygnV2FpdGluZyBmb3IgZG9tLi4uJyk7XG4gICAgYXdhaXQgdGhpcy5wYWdlTG9hZChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vayk7XG4gIH1cblxuICBhc3luYyBjaGVja1BhZ2VJc1JlYWR5ICgpIHtcbiAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgbG9nLmRlYnVnKCdDaGVja2luZyBkb2N1bWVudCByZWFkeVN0YXRlJyk7XG4gICAgY29uc3QgcmVhZHlDbWQgPSAnKGZ1bmN0aW9uICgpeyByZXR1cm4gZG9jdW1lbnQucmVhZHlTdGF0ZTsgfSkoKSc7XG4gICAgbGV0IHJlYWR5U3RhdGUgPSAnbG9hZGluZyc7XG4gICAgdHJ5IHtcbiAgICAgIHJlYWR5U3RhdGUgPSBhd2FpdCBCLnJlc29sdmUodGhpcy5leGVjdXRlKHJlYWR5Q21kLCB0cnVlKSkudGltZW91dCh0aGlzLnBhZ2VSZWFkeVRpbWVvdXQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgQi5UaW1lb3V0RXJyb3IpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIGxvZy5kZWJ1ZyhgUGFnZSByZWFkaW5lc3MgY2hlY2sgdGltZWQgb3V0IGFmdGVyICR7dGhpcy5wYWdlUmVhZHlUaW1lb3V0fW1zYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgRG9jdW1lbnQgcmVhZHlTdGF0ZSBpcyAnJHtyZWFkeVN0YXRlfSdgKTtcblxuICAgIHJldHVybiByZWFkeVN0YXRlID09PSAnY29tcGxldGUnO1xuICB9XG5cbiAgYXN5bmMgbGF1bmNoU2FmYXJpICgpIHtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdsYXVuY2hBcHBsaWNhdGlvbicsIHtcbiAgICAgIGJ1bmRsZUlkOiBTQUZBUklfQlVORExFX0lEXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBuYXZUb1VybCAodXJsLCBwYWdlTG9hZFZlcmlmeUhvb2spIHtcbiAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTtcbiAgICB9XG5cbiAgICB0aGlzLl9uYXZpZ2F0aW5nVG9QYWdlID0gdHJ1ZTtcblxuICAgIHRyeSB7XG4gICAgICBsb2cuZGVidWcoYE5hdmlnYXRpbmcgdG8gbmV3IFVSTDogJyR7dXJsfSdgKTtcbiAgICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3NldFVybCcsIHtcbiAgICAgICAgdXJsLFxuICAgICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRoaXMudXNlTmV3U2FmYXJpKSB7XG4gICAgICAgIC8vIGEgc21hbGwgcGF1c2UgZm9yIHRoZSBicm93c2VyIHRvIGNhdGNoIHVwXG4gICAgICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IHRoaXMud2FpdEZvckZyYW1lTmF2aWdhdGVkKCk7XG5cbiAgICAgIGF3YWl0IHRoaXMud2FpdEZvckRvbShEYXRlLm5vdygpLCBwYWdlTG9hZFZlcmlmeUhvb2spO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLl9uYXZpZ2F0aW5nVG9QYWdlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgd2FpdEZvckZyYW1lTmF2aWdhdGVkICgpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbG9nLmRlYnVnKCdXYWl0aW5nIGZvciBmcmFtZSBuYXZpZ2F0ZWQgbWVzc2FnZS4uLicpO1xuICAgICAgbGV0IHN0YXJ0TXMgPSBEYXRlLm5vdygpO1xuXG4gICAgICAvLyBhZGQgYSBoYW5kbGVyIGZvciB0aGUgYFBhZ2UuZnJhbWVOYXZpZ2F0ZWRgIG1lc3NhZ2VcbiAgICAgIC8vIGZyb20gdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgY29uc3QgbmF2RXZlbnRMaXN0ZW5lciA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICBsb2cuZGVidWcoYEZyYW1lIG5hdmlnYXRlZCBpbiAkeygoRGF0ZS5ub3coKSAtIHN0YXJ0TXMpIC8gMTAwMCl9IHNlYyBmcm9tIHNvdXJjZTogJHt2YWx1ZX1gKTtcbiAgICAgICAgaWYgKHRoaXMubmF2aWdhdGlvbkRlbGF5KSB7XG4gICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRGVsYXkuY2FuY2VsKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICB9O1xuICAgICAgdGhpcy5ycGNDbGllbnQuc2V0U3BlY2lhbE1lc3NhZ2VIYW5kbGVyKCdQYWdlLmZyYW1lTmF2aWdhdGVkJywgcmVqZWN0LCBuYXZFdmVudExpc3RlbmVyKTtcblxuICAgICAgLy8gdGltZW91dCwgaW4gY2FzZSByZW1vdGUgZGVidWdnZXIgZG9lc24ndCByZXNwb25kLFxuICAgICAgLy8gb3IgdGFrZXMgYSBsb25nIHRpbWVcbiAgICAgIGlmICghdGhpcy51c2VOZXdTYWZhcmkgfHwgdGhpcy5wYWdlTG9hZE1zID49IDApIHtcbiAgICAgICAgLy8gdXNlIHBhZ2VMb2FkTXMsIG9yIGEgc21hbGwgYW1vdW50IG9mIHRpbWVcbiAgICAgICAgbGV0IHRpbWVvdXQgPSB0aGlzLnVzZU5ld1NhZmFyaSA/IHRoaXMucGFnZUxvYWRNcyA6IDUwMDtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRGVsYXkgPSB1dGlsLmNhbmNlbGxhYmxlRGVsYXkodGltZW91dCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5uYXZpZ2F0aW9uRGVsYXk7XG4gICAgICAgICAgbmF2RXZlbnRMaXN0ZW5lcigndGltZW91dCcpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAvLyBub3RoaW5nIHRvIGRvOiB3ZSBvbmx5IGdldCBoZXJlIGlmIHRoZSByZW1vdGUgZGVidWdnZXJcbiAgICAgICAgICAvLyBhbHJlYWR5IG5vdGlmaWVkIG9mIGZyYW1lIG5hdmlnYXRpb24sIGFuZCB0aGUgZGVsYXlcbiAgICAgICAgICAvLyB3YXMgY2FuY2VsbGVkXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0VGltZWxpbmUgKGZuKSB7XG4gICAgbG9nLmRlYnVnKCdTdGFydGluZyB0byByZWNvcmQgdGhlIHRpbWVsaW5lJyk7XG4gICAgdGhpcy5ycGNDbGllbnQuc2V0VGltZWxpbmVFdmVudEhhbmRsZXIoZm4pO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdGFydFRpbWVsaW5lJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RvcFRpbWVsaW5lICgpIHtcbiAgICBsb2cuZGVidWcoJ1N0b3BwaW5nIHRvIHJlY29yZCB0aGUgdGltZWxpbmUnKTtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdG9wVGltZWxpbmUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdGFydENvbnNvbGUgKGZuKSB7XG4gICAgbG9nLmRlYnVnKCdTdGFydGluZyB0byBsaXN0ZW4gZm9yIEphdmFTY3JpcHQgY29uc29sZScpO1xuICAgIHRoaXMucnBjQ2xpZW50LnNldENvbnNvbGVMb2dFdmVudEhhbmRsZXIoZm4pO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdGFydENvbnNvbGUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdG9wQ29uc29sZSAoKSB7XG4gICAgbG9nLmRlYnVnKCdTdG9wcGluZyB0byBsaXN0ZW4gZm9yIEphdmFTY3JpcHQgY29uc29sZScpO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0b3BDb25zb2xlJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RhcnROZXR3b3JrIChmbikge1xuICAgIGxvZy5kZWJ1ZygnU3RhcnRpbmcgdG8gbGlzdGVuIGZvciBuZXR3b3JrIGV2ZW50cycpO1xuICAgIHRoaXMucnBjQ2xpZW50LnNldE5ldHdvcmtMb2dFdmVudEhhbmRsZXIoZm4pO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdGFydE5ldHdvcmsnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdG9wTmV0d29yayAoKSB7XG4gICAgbG9nLmRlYnVnKCdTdG9wcGluZyB0byBsaXN0ZW4gZm9yIG5ldHdvcmsgZXZlbnRzJyk7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc3RvcE5ldHdvcmsnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBleGVjdXRlIChjb21tYW5kLCBvdmVycmlkZSkge1xuICAgIC8vIGlmIHRoZSBwYWdlIGlzIG5vdCBsb2FkZWQgeWV0LCB3YWl0IGZvciBpdFxuICAgIGlmICh0aGlzLnBhZ2VMb2FkaW5nICYmICFvdmVycmlkZSkge1xuICAgICAgbG9nLmRlYnVnKCdUcnlpbmcgdG8gZXhlY3V0ZSBidXQgcGFnZSBpcyBub3QgbG9hZGVkLicpO1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yRG9tKCk7XG4gICAgfVxuXG4gICAgY29uc3QgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5LCBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5fSk7XG4gICAgaWYgKGVycm9ycykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuZ2FyYmFnZUNvbGxlY3QoKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYFNlbmRpbmcgamF2YXNjcmlwdCBjb21tYW5kOiAnJHtfLnRydW5jYXRlKGNvbW1hbmQsIHtsZW5ndGg6IDUwfSl9J2ApO1xuICAgIGxldCByZXMgPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZW5kSlNDb21tYW5kJywge1xuICAgICAgY29tbWFuZCxcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcblxuICAgIHJldHVybiBjb252ZXJ0UmVzdWx0KHJlcyk7XG4gIH1cblxuICBhc3luYyBjYWxsRnVuY3Rpb24gKG9iaklkLCBmbiwgYXJncykge1xuICAgIGxldCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgaWYgKHRoaXMuZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuZ2FyYmFnZUNvbGxlY3QoKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoJ0NhbGxpbmcgamF2YXNjcmlwdCBmdW5jdGlvbicpO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ2NhbGxKU0Z1bmN0aW9uJywge1xuICAgICAgb2JqSWQsXG4gICAgICBmbixcbiAgICAgIGFyZ3MsXG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29udmVydFJlc3VsdChyZXMpO1xuICB9XG5cbiAgYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCAoYWxsb3cgPSB0cnVlKSB7XG4gICAgaWYgKF8uaXNGdW5jdGlvbih0aGlzLnJwY0NsaWVudC5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkKSkge1xuICAgICAgdGhpcy5ycGNDbGllbnQuYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZChhbGxvdyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0Q29va2llcyAodXJscykge1xuICAgIGxvZy5kZWJ1ZygnR2V0dGluZyBuZXR3b3JrIGNvb2tpZXMnKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnZ2V0Q29va2llcycsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIHVybHMsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVDb29raWUgKGNvb2tpZU5hbWUsIHVybCkge1xuICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgY29va2llICcke2Nvb2tpZU5hbWV9JyBvbiAnJHt1cmx9J2ApO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdkZWxldGVDb29raWUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICBjb29raWVOYW1lLFxuICAgICAgdXJsLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2FyYmFnZUNvbGxlY3QgKHRpbWVvdXRNcyA9IEdBUkJBR0VfQ09MTEVDVF9USU1FT1VUKSB7XG4gICAgbG9nLmRlYnVnKGBHYXJiYWdlIGNvbGxlY3Rpbmcgd2l0aCAke3RpbWVvdXRNc31tcyB0aW1lb3V0YCk7XG4gICAgY29uc3QgZXJyb3JzID0gY2hlY2tQYXJhbXMoe1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICAgIGlmIChlcnJvcnMpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGNvbGxlY3QgZ2FyYmFnZSBhdCB0aGlzIHRpbWVgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBhd2FpdCBCLnJlc29sdmUodGhpcy5ycGNDbGllbnQuc2VuZCgnZ2FyYmFnZUNvbGxlY3QnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSkpLnRpbWVvdXQodGltZW91dE1zKVxuICAgIC50aGVuKGZ1bmN0aW9uIGdjU3VjY2VzcyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgbG9nLmRlYnVnKGBHYXJiYWdlIGNvbGxlY3Rpb24gc3VjY2Vzc2Z1bGApO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIGdjRXJyb3IgKGVycikgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEIuVGltZW91dEVycm9yKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgR2FyYmFnZSBjb2xsZWN0aW9uIHRpbWVkIG91dCBhZnRlciAke3RpbWVvdXRNc31tc2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmRlYnVnKGBVbmFibGUgdG8gY29sbGVjdCBnYXJiYWdlOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbi8vIGV2ZW50IGVtaXR0ZWQgcHVibGljYWxseVxuUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UgPSAncmVtb3RlX2RlYnVnZ2VyX3BhZ2VfY2hhbmdlJztcblJlbW90ZURlYnVnZ2VyLkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCA9ICdyZW1vdGVfZGVidWdnZXJfZnJhbWVzX2RldGFjaGVkJztcblJlbW90ZURlYnVnZ2VyLkVWRU5UX0RJU0NPTk5FQ1QgPSAncmVtb3RlX2RlYnVnZ2VyX2Rpc2Nvbm5lY3QnO1xuXG4vLyBhZGQgZ2VuZXJpYyBjYWxsYmFja3NcbmZvciAoY29uc3QgW25hbWUsIGhhbmRsZXJdIG9mIF8udG9QYWlycyhtZXNzYWdlSGFuZGxlcnMpKSB7XG4gIFJlbW90ZURlYnVnZ2VyLnByb3RvdHlwZVtuYW1lXSA9IGhhbmRsZXI7XG59XG5cbmV4cG9ydCB7XG4gIFJlbW90ZURlYnVnZ2VyLCBSRU1PVEVfREVCVUdHRVJfUE9SVCwgUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVMsXG59O1xuIl0sImZpbGUiOiJsaWIvcmVtb3RlLWRlYnVnZ2VyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
