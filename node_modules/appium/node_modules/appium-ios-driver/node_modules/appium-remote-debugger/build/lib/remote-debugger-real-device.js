"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("./logger"));

var _remoteDebugger = require("./remote-debugger");

var _rpcClientRealDevice = _interopRequireDefault(require("./rpc-client-real-device"));

class RemoteDebuggerRealDevice extends _remoteDebugger.RemoteDebugger {
  constructor(opts = {}) {
    super(opts);
    this.udid = opts.udid;
    this.skippedApps = ['lockdownd'];
  }

  async connect() {
    this.setup();
    this.rpcClient = new _rpcClientRealDevice.default({
      bundleId: this.bundleId,
      platformVersion: this.platformVersion,
      isSafari: this.isSafari,
      host: this.host,
      port: this.port,
      socketPath: this.socketPath,
      specialMessageHandlers: this.specialCbs,
      messageProxy: this.remoteDebugProxy,
      logFullResponse: this.logFullResponse,
      udid: this.udid
    });
    await this.rpcClient.connect();

    try {
      const appInfo = await this.setConnectionKey();

      _logger.default.debug('Connected to application');

      return appInfo;
    } catch (err) {
      await this.disconnect();
      return null;
    }
  }

}

exports.default = RemoteDebuggerRealDevice;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtZGVidWdnZXItcmVhbC1kZXZpY2UuanMiXSwibmFtZXMiOlsiUmVtb3RlRGVidWdnZXJSZWFsRGV2aWNlIiwiUmVtb3RlRGVidWdnZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJ1ZGlkIiwic2tpcHBlZEFwcHMiLCJjb25uZWN0Iiwic2V0dXAiLCJycGNDbGllbnQiLCJScGNDbGllbnRSZWFsRGV2aWNlIiwiYnVuZGxlSWQiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc1NhZmFyaSIsImhvc3QiLCJwb3J0Iiwic29ja2V0UGF0aCIsInNwZWNpYWxNZXNzYWdlSGFuZGxlcnMiLCJzcGVjaWFsQ2JzIiwibWVzc2FnZVByb3h5IiwicmVtb3RlRGVidWdQcm94eSIsImxvZ0Z1bGxSZXNwb25zZSIsImFwcEluZm8iLCJzZXRDb25uZWN0aW9uS2V5IiwibG9nIiwiZGVidWciLCJlcnIiLCJkaXNjb25uZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUdlLE1BQU1BLHdCQUFOLFNBQXVDQyw4QkFBdkMsQ0FBc0Q7QUFDbkVDLEVBQUFBLFdBQVcsQ0FBRUMsSUFBSSxHQUFHLEVBQVQsRUFBYTtBQUN0QixVQUFNQSxJQUFOO0FBRUEsU0FBS0MsSUFBTCxHQUFZRCxJQUFJLENBQUNDLElBQWpCO0FBRUEsU0FBS0MsV0FBTCxHQUFtQixDQUFDLFdBQUQsQ0FBbkI7QUFDRDs7QUFFRCxRQUFNQyxPQUFOLEdBQWlCO0FBQ2YsU0FBS0MsS0FBTDtBQUdBLFNBQUtDLFNBQUwsR0FBaUIsSUFBSUMsNEJBQUosQ0FBd0I7QUFDdkNDLE1BQUFBLFFBQVEsRUFBRSxLQUFLQSxRQUR3QjtBQUV2Q0MsTUFBQUEsZUFBZSxFQUFFLEtBQUtBLGVBRmlCO0FBR3ZDQyxNQUFBQSxRQUFRLEVBQUUsS0FBS0EsUUFId0I7QUFJdkNDLE1BQUFBLElBQUksRUFBRSxLQUFLQSxJQUo0QjtBQUt2Q0MsTUFBQUEsSUFBSSxFQUFFLEtBQUtBLElBTDRCO0FBTXZDQyxNQUFBQSxVQUFVLEVBQUUsS0FBS0EsVUFOc0I7QUFPdkNDLE1BQUFBLHNCQUFzQixFQUFFLEtBQUtDLFVBUFU7QUFRdkNDLE1BQUFBLFlBQVksRUFBRSxLQUFLQyxnQkFSb0I7QUFTdkNDLE1BQUFBLGVBQWUsRUFBRSxLQUFLQSxlQVRpQjtBQVV2Q2hCLE1BQUFBLElBQUksRUFBRSxLQUFLQTtBQVY0QixLQUF4QixDQUFqQjtBQVlBLFVBQU0sS0FBS0ksU0FBTCxDQUFlRixPQUFmLEVBQU47O0FBR0EsUUFBSTtBQUNGLFlBQU1lLE9BQU8sR0FBRyxNQUFNLEtBQUtDLGdCQUFMLEVBQXRCOztBQUNBQyxzQkFBSUMsS0FBSixDQUFVLDBCQUFWOztBQUNBLGFBQU9ILE9BQVA7QUFDRCxLQUpELENBSUUsT0FBT0ksR0FBUCxFQUFZO0FBQ1osWUFBTSxLQUFLQyxVQUFMLEVBQU47QUFDQSxhQUFPLElBQVA7QUFDRDtBQUNGOztBQXBDa0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IFJlbW90ZURlYnVnZ2VyIH0gZnJvbSAnLi9yZW1vdGUtZGVidWdnZXInO1xuaW1wb3J0IFJwY0NsaWVudFJlYWxEZXZpY2UgZnJvbSAnLi9ycGMtY2xpZW50LXJlYWwtZGV2aWNlJztcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZW1vdGVEZWJ1Z2dlclJlYWxEZXZpY2UgZXh0ZW5kcyBSZW1vdGVEZWJ1Z2dlciB7XG4gIGNvbnN0cnVjdG9yIChvcHRzID0ge30pIHtcbiAgICBzdXBlcihvcHRzKTtcblxuICAgIHRoaXMudWRpZCA9IG9wdHMudWRpZDtcblxuICAgIHRoaXMuc2tpcHBlZEFwcHMgPSBbJ2xvY2tkb3duZCddO1xuICB9XG5cbiAgYXN5bmMgY29ubmVjdCAoKSB7XG4gICAgdGhpcy5zZXR1cCgpO1xuXG4gICAgLy8gaW5pdGlhbGl6ZSB0aGUgcnBjIGNsaWVudFxuICAgIHRoaXMucnBjQ2xpZW50ID0gbmV3IFJwY0NsaWVudFJlYWxEZXZpY2Uoe1xuICAgICAgYnVuZGxlSWQ6IHRoaXMuYnVuZGxlSWQsXG4gICAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMucGxhdGZvcm1WZXJzaW9uLFxuICAgICAgaXNTYWZhcmk6IHRoaXMuaXNTYWZhcmksXG4gICAgICBob3N0OiB0aGlzLmhvc3QsXG4gICAgICBwb3J0OiB0aGlzLnBvcnQsXG4gICAgICBzb2NrZXRQYXRoOiB0aGlzLnNvY2tldFBhdGgsXG4gICAgICBzcGVjaWFsTWVzc2FnZUhhbmRsZXJzOiB0aGlzLnNwZWNpYWxDYnMsXG4gICAgICBtZXNzYWdlUHJveHk6IHRoaXMucmVtb3RlRGVidWdQcm94eSxcbiAgICAgIGxvZ0Z1bGxSZXNwb25zZTogdGhpcy5sb2dGdWxsUmVzcG9uc2UsXG4gICAgICB1ZGlkOiB0aGlzLnVkaWRcbiAgICB9KTtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5jb25uZWN0KCk7XG5cbiAgICAvLyBnZXQgdGhlIGNvbm5lY3Rpb24gaW5mb3JtYXRpb24gYWJvdXQgdGhlIGFwcFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcHBJbmZvID0gYXdhaXQgdGhpcy5zZXRDb25uZWN0aW9uS2V5KCk7XG4gICAgICBsb2cuZGVidWcoJ0Nvbm5lY3RlZCB0byBhcHBsaWNhdGlvbicpO1xuICAgICAgcmV0dXJuIGFwcEluZm87XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBhd2FpdCB0aGlzLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufVxuIl0sImZpbGUiOiJsaWIvcmVtb3RlLWRlYnVnZ2VyLXJlYWwtZGV2aWNlLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
