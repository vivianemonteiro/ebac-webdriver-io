"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WEBVIEW_BASE = exports.WEBVIEW_WIN = exports.NATIVE_WIN = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncbox = require("asyncbox");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));

var _appiumBaseDriver = require("appium-base-driver");

var _logger = _interopRequireDefault(require("../logger"));

var _appiumSupport = require("appium-support");

const NATIVE_WIN = 'NATIVE_APP';
exports.NATIVE_WIN = NATIVE_WIN;
const WEBVIEW_WIN = 'WEBVIEW';
exports.WEBVIEW_WIN = WEBVIEW_WIN;
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
exports.WEBVIEW_BASE = WEBVIEW_BASE;
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getCurrentContext = async function getCurrentContext() {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  } else {
    return NATIVE_WIN;
  }
};

commands.getContexts = async function getContexts() {
  _logger.default.debug('Getting list of available contexts');

  let contexts = await this.getContextsAndViews(false);

  let mapFn = context => context.id.toString();

  if (this.opts.fullContextList) {
    mapFn = function (context) {
      return {
        id: context.id.toString(),
        title: context.view.title,
        url: context.view.url
      };
    };
  }

  return contexts.map(mapFn);
};

commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
  }

  _logger.default.debug(`Attempting to set context to '${name}'`);

  if (alreadyInContext(name, this.curContext)) {} else if (name === NATIVE_WIN || name === null) {
    this.curContext = null;

    if (this.isRealDevice()) {
      this.remote.disconnect();
    }
  } else {
    if (_lodash.default.isUndefined(this.contexts)) {
      await this.getContexts();
    }

    let contextId = name.replace(WEBVIEW_BASE, '');

    if (contextId === '') {
      contextId = this.contexts[1];
    }

    if (!_lodash.default.includes(this.contexts, contextId)) {
      throw new _appiumBaseDriver.errors.NoSuchContextError();
    }

    if (this.isRealDevice()) {
      if (this.remote) {
        await this.remote.disconnect();
      }

      this.curContext = contextId;
      await this.remote.connect(contextId);
    } else {
      let [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));

      await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
      this.curContext = contextId;
    }
  }

  if (this.opts.enablePerformanceLogging && this.remote) {
    _logger.default.debug(`Starting performance log on '${this.curContext}'`);

    this.logs.performance = new _iosPerformanceLog.default(this.remote);
    await this.logs.performance.startCapture();
  }
};

commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  return this.curContext.toString();
};

commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  this.windowHandleCache = await this.listWebFrames(false);

  const idArray = _lodash.default.map(this.windowHandleCache, 'id');

  if (!this.contexts) {
    this.contexts = idArray;
  }

  return _lodash.default.map(idArray, id => id.toString());
};

commands.setWindow = async function setWindow(name, skipReadyCheck) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
    throw new _appiumBaseDriver.errors.NoSuchWindowError();
  }

  let pageIdKey = parseInt(name, 10);

  if (!this.isRealDevice()) {
    await this.remote.selectPage(pageIdKey, skipReadyCheck);
    this.curContext = this.curWindowHandle = name;
  } else {
    if (name === this.curWindowHandle) {
      _logger.default.debug(`Remote debugger is already connected to window '${name}'`);
    } else if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
      throw new _appiumBaseDriver.errors.NoSuchWindowError();
    } else {
      await this.remote.disconnect();
      this.curContext = this.curWindowHandle = name;
      await this.remote.connect(name);
    }
  }
};

helpers.webContextIndex = function webContextIndex() {
  return this.curContext.replace(WEBVIEW_BASE, '') - 1;
};

extensions.initAutoWebview = async function initAutoWebview() {
  if (this.opts.autoWebview) {
    _logger.default.debug('Setting auto webview');

    await this.navToInitialWebview(this);
  }
};

extensions.getContextsAndViews = async function getContextsAndViews(useUrl = true) {
  _logger.default.debug('Retrieving contexts and views');

  let webviews = await this.listWebFrames(useUrl);
  let ctxs = [{
    id: NATIVE_WIN,
    view: {}
  }];
  this.contexts = [NATIVE_WIN];

  for (let view of webviews) {
    ctxs.push({
      id: `${WEBVIEW_BASE}${view.id}`,
      view
    });
    this.contexts.push(view.id.toString());
  }

  return ctxs;
};

extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  return new _appiumRemoteDebugger.RemoteDebugger({
    bundleId: this.opts.bundleId,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    isSafari: this.isSafari(),
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: false,
    logFullResponse: !!this.opts.safariShowFullResponse
  });
};

extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  if (!this.opts.bundleId) {
    _logger.default.errorAndThrow('Cannot enter web frame without a bundle ID');
  }

  useUrl = useUrl && !!this.getCurrentUrl();

  _logger.default.debug(`Selecting by url: ${useUrl} ${useUrl ? `(expected url: '${this.getCurrentUrl()}')` : ''}`);

  let currentUrl = useUrl ? this.getCurrentUrl() : undefined;
  let pageArray;

  if (this.isRealDevice() && this.remote && this.opts.bundleId) {
    pageArray = await this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
  } else if (this.remote && this.remote.appIdKey) {
    pageArray = await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
  } else if (this.isRealDevice()) {
    try {
      this.remote = new _appiumRemoteDebugger.WebKitRemoteDebugger({
        port: this.opts.webkitDebugProxyPort,
        webkitResponseTimeout: this.opts.webkitResponseTimeout,
        platformVersion: this.opts.platformVersion,
        isSafari: this.isSafari(),
        garbageCollectOnExecute: false,
        logFullResponse: !!this.opts.safariShowFullResponse
      });
      pageArray = await this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      if (!_lodash.default.includes(err.message, 'connect ECONNREFUSED')) throw err;

      _logger.default.warn('Attempted to get a list of webview contexts but could not connect to ' + 'ios-webkit-debug-proxy. If you expect to find webviews, please ensure ' + 'that the proxy is running and accessible');

      this.remote = null;
      pageArray = [];
    }
  } else {
    this.remote = await this.getNewRemoteDebugger();
    let appInfo = await this.remote.connect();

    if (!appInfo) {
      _logger.default.debug('Unable to connect to the remote debugger.');

      return [];
    }

    pageArray = await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
    this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
      if (!_lodash.default.isEmpty(this.curWebFrames)) {
        _logger.default.debug(`Clearing ${this.curWebFrames.length} frames: ${this.curWebFrames.join(', ')}`);
      }

      this.curWebFrames = [];
    });

    let tryClosingAlert = async () => {
      let didDismiss = await this.closeAlertBeforeTest();

      if (!didDismiss) {
        throw new Error('Close alert failed. Retry.');
      }
    };

    try {
      await (0, _asyncbox.retryInterval)(3, 4000, tryClosingAlert);
    } catch (err) {
      if (err.message !== 'Close alert failed. Retry.') {
        _logger.default.errorAndThrow(err);
      }
    }
  }

  if (pageArray.length === 0) {
    _logger.default.debug('No web frames found.');
  }

  return pageArray;
};

extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  _logger.default.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

  if (this.selectingNewPage) {
    _logger.default.debug('We are in the middle of selecting a page, ignoring');

    return;
  }

  if (!this.remote || !this.remote.isConnected()) {
    _logger.default.debug('We have not yet connected, ignoring');

    return;
  }

  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;

  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);

    if (page.isKey) {
      keyId = id;
    }

    const contextId = `${appIdKey}.${id}`;

    if (!_lodash.default.includes(this.contexts, contextId)) {
      newPages.push(id);
      this.contexts.push(contextId);
    }
  }

  if (!keyId) {
    _logger.default.debug('No key id found. Choosing first id from page array');

    keyId = newIds[0] || null;
  }

  if (!_appiumSupport.util.hasValue(this.curContext)) {
    _logger.default.debug('We do not appear to have window set yet, ignoring');

    return;
  }

  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');

  if (curAppIdKey !== appIdKey) {
    _logger.default.debug('Page change not referring to currently selected app, ignoring.');

    return;
  }

  let newPage = null;

  if (newPages.length) {
    newPage = _lodash.default.last(newPages);

    _logger.default.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    _logger.default.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

    if (!_appiumSupport.util.hasValue(keyId)) {
      _logger.default.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');

      this.setCurrentUrl(undefined);
      return;
    }

    _logger.default.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);

    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    _logger.default.debug('Checking if page needs to load');

    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();

    if (needsPageLoad) {
      _logger.default.debug('Page load needed. Loading...');

      await this.remote.pageLoad();
    }

    _logger.default.debug('New page listing is same as old, doing nothing');
  }

  if (_appiumSupport.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

    if (page && page.url !== this.getCurrentUrl()) {
      _logger.default.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);

      this.setCurrentUrl(page.url);
    }
  }

  if (_appiumSupport.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, parseInt(newPage, 10));
    this.selectingNewPage = false;
    this.curContext = `${appIdKey}.${newPage}`;
  }

  this.windowHandleCache = pageArray;
};

extensions.getLatestWebviewContextForTitle = async function getLatestWebviewContextForTitle(regExp) {
  let contexts = await this.getContextsAndViews();
  let matchingCtx;

  for (let ctx of contexts) {
    if (ctx.view && (ctx.view.title && ctx.view.title.match(regExp) || ctx.view.url && ctx.view.url.match(regExp))) {
      if (ctx.view.url !== 'about:blank') {
        matchingCtx = ctx;
      } else {
        if (parseFloat(this.iosSdkVersion) < 7 || parseFloat(this.iosSdkVersion) >= 9 || this.opts.platformVersion === '7.1' && this.opts.app && this.opts.app.toLowerCase() !== 'safari') {
          matchingCtx = ctx;
        }
      }

      break;
    }
  }

  return matchingCtx ? matchingCtx.id : undefined;
};

extensions.useNewSafari = function useNewSafari() {
  return parseFloat(this.iosSdkVersion) >= 8.1 && parseFloat(this.opts.platformVersion) >= 8.1 && !this.isRealDevice() && this.opts.safari;
};

extensions.navToInitialWebview = async function navToInitialWebview() {
  let timeout = 0;

  if (this.isRealDevice()) {
    timeout = 3000;

    _logger.default.debug(`Waiting for ${timeout} ms before navigating to view.`);
  }

  await _bluebird.default.delay(timeout);

  if (this.useNewSafari()) {
    await this.typeAndNavToUrl();
  } else if (parseInt(this.iosSdkVersion, 10) >= 7 && !this.isRealDevice() && this.opts.safari) {
    await this.navToViewThroughFavorites();
  } else {
    await this.navToViewWithTitle(/.*/);
  }
};

async function openNewPage() {
  let newPageButton = await this.findElement('xpath', "//UIAButton[contains(@name,'New page')]");
  await this.nativeTap(newPageButton.ELEMENT);
}

extensions.typeAndNavToUrl = async function typeAndNavToUrl() {
  let address = this.opts.address ? this.opts.address : '127.0.0.1';
  this.setCurrentUrl(this.caps.safariInitialUrl || `http://${address}:${this.opts.port}/welcome`);
  let tries = 0;
  const MAX_TRIES = 2;

  let navigate = async () => {
    let oldImpWait = this.implicitWaitMs;
    this.implicitWaitMs = 7000;
    let el = await (0, _asyncbox.retryInterval)(3, 1000, async () => await this.findElement('accessibility id', 'URL'));
    this.implicitWaitMs = oldImpWait;

    try {
      await this.nativeTap(el.ELEMENT);
    } catch (err) {
      if (_lodash.default.includes(err.message, 'could not be tapped')) {
        if (tries++ >= MAX_TRIES) throw err;
        await openNewPage();
        return await navigate();
      } else {
        throw err;
      }
    }

    try {
      let el = await this.findElement('class name', 'UIATextField');
      await this.setValueImmediate(this.getCurrentUrl(), el);
    } catch (err) {
      if (tries++ >= MAX_TRIES) throw err;
      return await navigate();
    }

    try {
      el = await this.findElement('accessibility id', 'Go');
      await this.nativeTap(el.ELEMENT);
    } catch (err) {
      if (_lodash.default.includes(err.message, 'could not be tapped')) {
        _logger.default.error('Unable to submit URL because \'Go\' button could not be tapped. ' + 'Please make sure your keyboard is toggled on.');
      }

      throw err;
    }

    await this.navToViewWithTitle(undefined, new RegExp(this.getCurrentUrl(), 'i'));
    await this.remote.pageUnload();
  };

  await navigate();
};

extensions.navToViewThroughFavorites = async function navToViewThroughFavorites() {
  _logger.default.debug('We are on iOS7+ simulator: clicking apple button to get into a webview');

  let oldImpWait = this.implicitWaitMs;
  this.implicitWaitMs = 7000;
  let el;

  try {
    el = await this.findElement('xpath', '//UIAScrollView[1]/UIAButton[1]');
  } catch (err) {
    let msg = 'Could not find button to click to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);

    this.implicitWaitMs = oldImpWait;
    return await this.navToViewWithTitle(/.*/i);
  }

  this.implicitWaitMs = oldImpWait;

  try {
    await this.nativeTap(el.ELEMENT);
  } catch (err) {
    let msg = 'Could not click button to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);
  }

  await this.navToViewWithTitle(/apple/i);
};

extensions.navToViewWithTitle = async function navToViewWithTitle(titleRegex, urlRegExp) {
  _logger.default.debug('Navigating to most recently opened webview');

  let start = Date.now();
  let spinTime = 500;

  let spinHandles = async () => {
    let res;

    try {
      res = await this.getLatestWebviewContextForTitle(titleRegex || urlRegExp);
    } catch (err) {
      if (!err.message.includes('Could not connect to a valid app after')) {
        const error = new Error(`Could not navigate to webview! Err: ${err.message}`);
        error.stack += `\nCaused by: ${err.stack}`;
        throw error;
      }

      _logger.default.debug('Could not navigate to webview. Retrying if possible.');
    }

    if (res) {
      let latestWindow = res;

      _logger.default.debug(`Picking webview '${latestWindow}'`);

      await this.setContext(latestWindow);
      await this.remote.cancelPageLoad();
      return;
    }

    if (Date.now() - start >= 90000) {
      throw new Error('Could not navigate to webview; there are none!');
    }

    _logger.default.warn('Could not find any webviews yet, refreshing/retrying');

    if (this.isRealDevice() || !this.opts.safari) {
      await _bluebird.default.delay(spinTime);
      return await spinHandles();
    }

    let element;

    try {
      _logger.default.debug('Finding and tapping reload button');

      element = await this.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
      await this.nativeTap(element.ELEMENT);
    } catch (err) {
      _logger.default.warn(`Error finding and tapping reload button: ${err.message}`);

      _logger.default.warn('Retrying.');

      await _bluebird.default.delay(spinTime);
    }

    return await spinHandles();
  };

  await spinHandles();
};

helpers.closeAlertBeforeTest = async function closeAlertBeforeTest() {
  let present = await this.uiAutoClient.sendCommand('au.alertIsPresent()');

  if (!present) {
    return false;
  }

  _logger.default.debug('Alert present before starting test, let us banish it');

  await this.uiAutoClient.sendCommand('au.dismissAlert()');

  _logger.default.debug('Alert banished!');

  return true;
};

helpers.stopRemote = async function stopRemote(closeWindowBeforeDisconnecting = false) {
  if (!this.remote) {
    _logger.default.errorAndThrow('Tried to leave a web frame but were not in one');
  }

  if (closeWindowBeforeDisconnecting) {
    await this.closeWindow();
  }

  await this.remote.disconnect();
  this.curContext = null;
  this.curWebFrames = [];
  this.curWebCoords = null;
  this.remote = null;
};

helpers.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};

helpers.setCurrentUrl = function setCurrentUrl(url) {
  this._currentUrl = url;
};

helpers.getCurrentUrl = function getCurrentUrl() {
  return this._currentUrl;
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbIk5BVElWRV9XSU4iLCJXRUJWSUVXX1dJTiIsIldFQlZJRVdfQkFTRSIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0cyIsImxvZ2dlciIsImRlYnVnIiwiY29udGV4dHMiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwibWFwRm4iLCJjb250ZXh0IiwiaWQiLCJ0b1N0cmluZyIsIm9wdHMiLCJmdWxsQ29udGV4dExpc3QiLCJ0aXRsZSIsInZpZXciLCJ1cmwiLCJtYXAiLCJzZXRDb250ZXh0IiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc1JlYWxEZXZpY2UiLCJyZW1vdGUiLCJkaXNjb25uZWN0IiwiXyIsImlzVW5kZWZpbmVkIiwiY29udGV4dElkIiwicmVwbGFjZSIsImluY2x1ZGVzIiwiZXJyb3JzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwiY29ubmVjdCIsImFwcElkS2V5IiwicGFnZUlkS2V5Iiwic3BsaXQiLCJwYXJzZUludCIsInNlbGVjdFBhZ2UiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsImdldFdpbmRvd0hhbmRsZSIsImlzV2ViQ29udGV4dCIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJnZXRXaW5kb3dIYW5kbGVzIiwid2luZG93SGFuZGxlQ2FjaGUiLCJsaXN0V2ViRnJhbWVzIiwiaWRBcnJheSIsInNldFdpbmRvdyIsIk5vU3VjaFdpbmRvd0Vycm9yIiwiY3VyV2luZG93SGFuZGxlIiwid2ViQ29udGV4dEluZGV4IiwiaW5pdEF1dG9XZWJ2aWV3IiwiYXV0b1dlYnZpZXciLCJuYXZUb0luaXRpYWxXZWJ2aWV3IiwidXNlVXJsIiwid2Vidmlld3MiLCJjdHhzIiwicHVzaCIsImdldE5ld1JlbW90ZURlYnVnZ2VyIiwiUmVtb3RlRGVidWdnZXIiLCJidW5kbGVJZCIsInVzZU5ld1NhZmFyaSIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc1NhZmFyaSIsInJlbW90ZURlYnVnUHJveHkiLCJnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSIsImxvZ0Z1bGxSZXNwb25zZSIsInNhZmFyaVNob3dGdWxsUmVzcG9uc2UiLCJlcnJvckFuZFRocm93IiwiZ2V0Q3VycmVudFVybCIsImN1cnJlbnRVcmwiLCJ1bmRlZmluZWQiLCJwYWdlQXJyYXkiLCJwYWdlQXJyYXlGcm9tSnNvbiIsImlnbm9yZUFib3V0QmxhbmtVcmwiLCJzZWxlY3RBcHAiLCJ3ZWJ2aWV3Q29ubmVjdFJldHJpZXMiLCJXZWJLaXRSZW1vdGVEZWJ1Z2dlciIsInBvcnQiLCJ3ZWJraXREZWJ1Z1Byb3h5UG9ydCIsIndlYmtpdFJlc3BvbnNlVGltZW91dCIsImVyciIsIm1lc3NhZ2UiLCJ3YXJuIiwiYXBwSW5mbyIsIm9uIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJvblBhZ2VDaGFuZ2UiLCJiaW5kIiwiRVZFTlRfRlJBTUVTX0RFVEFDSEVEIiwiaXNFbXB0eSIsImN1cldlYkZyYW1lcyIsImxlbmd0aCIsImpvaW4iLCJ0cnlDbG9zaW5nQWxlcnQiLCJkaWREaXNtaXNzIiwiY2xvc2VBbGVydEJlZm9yZVRlc3QiLCJFcnJvciIsInBhZ2VDaGFuZ2VOb3RpZmljYXRpb24iLCJKU09OIiwic3RyaW5naWZ5Iiwic2VsZWN0aW5nTmV3UGFnZSIsImlzQ29ubmVjdGVkIiwibmV3SWRzIiwibmV3UGFnZXMiLCJrZXlJZCIsInBhZ2UiLCJpc0tleSIsInV0aWwiLCJoYXNWYWx1ZSIsImN1ckFwcElkS2V5IiwiY3VyUGFnZUlkS2V5IiwibmV3UGFnZSIsImxhc3QiLCJlcnJvciIsInNldEN1cnJlbnRVcmwiLCJuZWVkc1BhZ2VMb2FkIiwiY29udGV4dEFycmF5IiwiaXNFcXVhbCIsImZpbmQiLCJwYWdlTG9hZCIsImN1cnJlbnRQYWdlSWQiLCJwIiwiZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSIsInJlZ0V4cCIsIm1hdGNoaW5nQ3R4IiwiY3R4IiwibWF0Y2giLCJwYXJzZUZsb2F0IiwiaW9zU2RrVmVyc2lvbiIsImFwcCIsInRvTG93ZXJDYXNlIiwic2FmYXJpIiwidGltZW91dCIsIkIiLCJkZWxheSIsInR5cGVBbmROYXZUb1VybCIsIm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMiLCJuYXZUb1ZpZXdXaXRoVGl0bGUiLCJvcGVuTmV3UGFnZSIsIm5ld1BhZ2VCdXR0b24iLCJmaW5kRWxlbWVudCIsIm5hdGl2ZVRhcCIsIkVMRU1FTlQiLCJhZGRyZXNzIiwiY2FwcyIsInNhZmFyaUluaXRpYWxVcmwiLCJ0cmllcyIsIk1BWF9UUklFUyIsIm5hdmlnYXRlIiwib2xkSW1wV2FpdCIsImltcGxpY2l0V2FpdE1zIiwiZWwiLCJzZXRWYWx1ZUltbWVkaWF0ZSIsIlJlZ0V4cCIsInBhZ2VVbmxvYWQiLCJtc2ciLCJ0aXRsZVJlZ2V4IiwidXJsUmVnRXhwIiwic3RhcnQiLCJEYXRlIiwibm93Iiwic3BpblRpbWUiLCJzcGluSGFuZGxlcyIsInJlcyIsInN0YWNrIiwibGF0ZXN0V2luZG93IiwiY2FuY2VsUGFnZUxvYWQiLCJlbGVtZW50IiwiZmluZFVJRWxlbWVudE9yRWxlbWVudHMiLCJwcmVzZW50IiwidWlBdXRvQ2xpZW50Iiwic2VuZENvbW1hbmQiLCJzdG9wUmVtb3RlIiwiY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nIiwiY2xvc2VXaW5kb3ciLCJjdXJXZWJDb29yZHMiLCJfY3VycmVudFVybCIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxVQUFVLEdBQUcsWUFBbkI7O0FBQ0Es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QUs1SixNQUFMLENBQVlDLFVBQVosRUFBTjtBQUNBLE9BQUt6QixVQUFMLEdBQWtCLElBQWxCO0FBQ0EsT0FBS2dHLFlBQUwsR0FBb0IsRUFBcEI7QUFDQSxPQUFLcUYsWUFBTCxHQUFvQixJQUFwQjtBQUNBLE9BQUs3SixNQUFMLEdBQWMsSUFBZDtBQUNELENBYkQ7O0FBZUEzQixPQUFPLENBQUNnRCxZQUFSLEdBQXVCLFNBQVNBLFlBQVQsR0FBeUI7QUFDOUMsU0FBTyxDQUFDLENBQUMsS0FBSzdDLFVBQVAsSUFBcUIsS0FBS0EsVUFBTCxLQUFvQlAsVUFBaEQ7QUFDRCxDQUZEOztBQUlBSSxPQUFPLENBQUMySCxhQUFSLEdBQXdCLFNBQVNBLGFBQVQsQ0FBd0IxRyxHQUF4QixFQUE2QjtBQUNuRCxPQUFLd0ssV0FBTCxHQUFtQnhLLEdBQW5CO0FBQ0QsQ0FGRDs7QUFJQWpCLE9BQU8sQ0FBQzZFLGFBQVIsR0FBd0IsU0FBU0EsYUFBVCxHQUEwQjtBQUNoRCxTQUFPLEtBQUs0RyxXQUFaO0FBQ0QsQ0FGRDs7QUFLQUMsTUFBTSxDQUFDQyxNQUFQLENBQWMxTCxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgUmVtb3RlRGVidWdnZXIsIFdlYktpdFJlbW90ZURlYnVnZ2VyIH0gZnJvbSAnYXBwaXVtLXJlbW90ZS1kZWJ1Z2dlcic7XG5pbXBvcnQgSU9TUGVyZm9ybWFuY2VMb2cgZnJvbSAnLi4vZGV2aWNlLWxvZy9pb3MtcGVyZm9ybWFuY2UtbG9nJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuXG5cbmNvbnN0IE5BVElWRV9XSU4gPSAnTkFUSVZFX0FQUCc7XG5jb25zdCBXRUJWSUVXX1dJTiA9ICdXRUJWSUVXJztcbmNvbnN0IFdFQlZJRVdfQkFTRSA9IGAke1dFQlZJRVdfV0lOfV9gO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmdldEN1cnJlbnRDb250ZXh0ID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudENvbnRleHQgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgaWYgKHRoaXMuY3VyQ29udGV4dCAmJiB0aGlzLmN1ckNvbnRleHQgIT09IE5BVElWRV9XSU4pIHtcbiAgICByZXR1cm4gYCR7V0VCVklFV19CQVNFfSR7dGhpcy5jdXJDb250ZXh0fWA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIE5BVElWRV9XSU47XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldENvbnRleHRzID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGV4dHMgKCkge1xuICBsb2dnZXIuZGVidWcoJ0dldHRpbmcgbGlzdCBvZiBhdmFpbGFibGUgY29udGV4dHMnKTtcbiAgbGV0IGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0c0FuZFZpZXdzKGZhbHNlKTtcblxuICBsZXQgbWFwRm4gPSAoY29udGV4dCkgPT4gY29udGV4dC5pZC50b1N0cmluZygpO1xuICBpZiAodGhpcy5vcHRzLmZ1bGxDb250ZXh0TGlzdCkge1xuICAgIG1hcEZuID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBjb250ZXh0LmlkLnRvU3RyaW5nKCksXG4gICAgICAgIHRpdGxlOiBjb250ZXh0LnZpZXcudGl0bGUsXG4gICAgICAgIHVybDogY29udGV4dC52aWV3LnVybCxcbiAgICAgIH07XG4gICAgfTtcbiAgfVxuICByZXR1cm4gY29udGV4dHMubWFwKG1hcEZuKTtcbn07XG5cbmNvbW1hbmRzLnNldENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiBzZXRDb250ZXh0IChuYW1lLCBjYWxsYmFjaywgc2tpcFJlYWR5Q2hlY2spIHtcbiAgZnVuY3Rpb24gYWxyZWFkeUluQ29udGV4dCAoZGVzaXJlZCwgY3VycmVudCkge1xuICAgIHJldHVybiAoZGVzaXJlZCA9PT0gY3VycmVudCB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gbnVsbCAmJiBjdXJyZW50ID09PSBOQVRJVkVfV0lOKSB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gTkFUSVZFX1dJTiAmJiBjdXJyZW50ID09PSBudWxsKSk7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoYEF0dGVtcHRpbmcgdG8gc2V0IGNvbnRleHQgdG8gJyR7bmFtZX0nYCk7XG4gIGlmIChhbHJlYWR5SW5Db250ZXh0KG5hbWUsIHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICAvLyBhbHJlYWR5IGluIHRoZSBuYW1lZCBjb250ZXh0LCBubyBuZWVkIHRvIGRvIGFueXRoaW5nXG4gIH0gZWxzZSBpZiAobmFtZSA9PT0gTkFUSVZFX1dJTiB8fCBuYW1lID09PSBudWxsKSB7XG4gICAgLy8gc3dpdGNoaW5nIGludG8gdGhlIG5hdGl2ZSBjb250ZXh0XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBzd2l0Y2hpbmcgaW50byBhIHdlYnZpZXcgY29udGV4dFxuXG4gICAgLy8gaWYgY29udGV4dHMgaGF2ZSBub3QgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCwgZ2V0IHRoZW1cbiAgICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLmNvbnRleHRzKSkge1xuICAgICAgYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuICAgIH1cblxuICAgIGxldCBjb250ZXh0SWQgPSBuYW1lLnJlcGxhY2UoV0VCVklFV19CQVNFLCAnJyk7XG4gICAgaWYgKGNvbnRleHRJZCA9PT0gJycpIHtcbiAgICAgIC8vIGFsbG93IHVzZXIgdG8gcGFzcyBpbiBcIldFQlZJRVdcIiB3aXRob3V0IGFuIGluZGV4XG4gICAgICAvLyB0aGUgc2Vjb25kIGNvbnRleHQgd2lsbCBiZSB0aGUgZmlyc3Qgd2VidmlldyBhc1xuICAgICAgLy8gdGhlIGZpcnN0IGlzIGFsd2F5cyBOQVRJVkVfQVBQXG4gICAgICBjb250ZXh0SWQgPSB0aGlzLmNvbnRleHRzWzFdO1xuICAgIH1cbiAgICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgaWYgKHRoaXMucmVtb3RlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IGNvbnRleHRJZDtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QoY29udGV4dElkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYGNvbnRleHRJZGAgd2lsbCBiZSBpbiB0aGUgZm9ybSBvZiBgYXBwSWQucGFnZUlkYCBpbiB0aGlzIGNhc2VcbiAgICAgIGxldCBbYXBwSWRLZXksIHBhZ2VJZEtleV0gPSBfLm1hcChjb250ZXh0SWQuc3BsaXQoJy4nKSwgKGlkKSA9PiBwYXJzZUludChpZCwgMTApKTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2spO1xuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gY29udGV4dElkO1xuICAgIH1cbiAgfVxuXG4gIC8vIGF0dGVtcHQgdG8gc3RhcnQgcGVyZm9ybWFuY2UgbG9nZ2luZywgaWYgcmVxdWVzdGVkXG4gIGlmICh0aGlzLm9wdHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nICYmIHRoaXMucmVtb3RlKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBTdGFydGluZyBwZXJmb3JtYW5jZSBsb2cgb24gJyR7dGhpcy5jdXJDb250ZXh0fSdgKTtcbiAgICB0aGlzLmxvZ3MucGVyZm9ybWFuY2UgPSBuZXcgSU9TUGVyZm9ybWFuY2VMb2codGhpcy5yZW1vdGUpO1xuICAgIGF3YWl0IHRoaXMubG9ncy5wZXJmb3JtYW5jZS5zdGFydENhcHR1cmUoKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93SGFuZGxlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIHJldHVybiB0aGlzLmN1ckNvbnRleHQudG9TdHJpbmcoKTtcbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd0hhbmRsZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRXaW5kb3dIYW5kbGVzICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gYXdhaXQgdGhpcy5saXN0V2ViRnJhbWVzKGZhbHNlKTtcbiAgY29uc3QgaWRBcnJheSA9IF8ubWFwKHRoaXMud2luZG93SGFuZGxlQ2FjaGUsICdpZCcpO1xuICAvLyBzaW5jZSB3ZSB1c2UgdGhpcy5jb250ZXh0cyB0byBtYW5hZ2Ugc2VsZWN0aW5nIGRlYnVnZ2VyIHBhZ2VzLCBtYWtlXG4gIC8vIHN1cmUgaXQgZ2V0cyBwb3B1bGF0ZWQgZXZlbiBpZiBzb21lb25lIGRpZCBub3QgdXNlIHRoZVxuICAvLyBnZXRDb250ZXh0cyBtZXRob2RcbiAgaWYgKCF0aGlzLmNvbnRleHRzKSB7XG4gICAgdGhpcy5jb250ZXh0cyA9IGlkQXJyYXk7XG4gIH1cbiAgcmV0dXJuIF8ubWFwKGlkQXJyYXksIChpZCkgPT4gaWQudG9TdHJpbmcoKSk7XG59O1xuXG5jb21tYW5kcy5zZXRXaW5kb3cgPSBhc3luYyBmdW5jdGlvbiBzZXRXaW5kb3cgKG5hbWUsIHNraXBSZWFkeUNoZWNrKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG5cbiAgaWYgKCFfLmluY2x1ZGVzKF8ubWFwKHRoaXMud2luZG93SGFuZGxlQ2FjaGUsICdpZCcpLCBuYW1lKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoV2luZG93RXJyb3IoKTtcbiAgfVxuICBsZXQgcGFnZUlkS2V5ID0gcGFyc2VJbnQobmFtZSwgMTApO1xuICBpZiAoIXRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RQYWdlKHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2spO1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IHRoaXMuY3VyV2luZG93SGFuZGxlID0gbmFtZTtcbiAgfSBlbHNlIHtcbiAgICBpZiAobmFtZSA9PT0gdGhpcy5jdXJXaW5kb3dIYW5kbGUpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUmVtb3RlIGRlYnVnZ2VyIGlzIGFscmVhZHkgY29ubmVjdGVkIHRvIHdpbmRvdyAnJHtuYW1lfSdgKTtcbiAgICB9IGVsc2UgaWYgKCFfLmluY2x1ZGVzKF8ubWFwKHRoaXMud2luZG93SGFuZGxlQ2FjaGUsICdpZCcpLCBuYW1lKSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5kaXNjb25uZWN0KCk7XG4gICAgICB0aGlzLmN1ckNvbnRleHQgPSB0aGlzLmN1cldpbmRvd0hhbmRsZSA9IG5hbWU7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5jb25uZWN0KG5hbWUpO1xuICAgIH1cbiAgfVxufTtcblxuaGVscGVycy53ZWJDb250ZXh0SW5kZXggPSBmdW5jdGlvbiB3ZWJDb250ZXh0SW5kZXggKCkge1xuICByZXR1cm4gdGhpcy5jdXJDb250ZXh0LnJlcGxhY2UoV0VCVklFV19CQVNFLCAnJykgLSAxO1xufTtcblxuZXh0ZW5zaW9ucy5pbml0QXV0b1dlYnZpZXcgPSBhc3luYyBmdW5jdGlvbiBpbml0QXV0b1dlYnZpZXcgKCkge1xuICBpZiAodGhpcy5vcHRzLmF1dG9XZWJ2aWV3KSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdTZXR0aW5nIGF1dG8gd2VidmlldycpO1xuICAgIGF3YWl0IHRoaXMubmF2VG9Jbml0aWFsV2Vidmlldyh0aGlzKTtcbiAgfVxufTtcblxuZXh0ZW5zaW9ucy5nZXRDb250ZXh0c0FuZFZpZXdzID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGV4dHNBbmRWaWV3cyAodXNlVXJsID0gdHJ1ZSkge1xuICBsb2dnZXIuZGVidWcoJ1JldHJpZXZpbmcgY29udGV4dHMgYW5kIHZpZXdzJyk7XG4gIGxldCB3ZWJ2aWV3cyA9IGF3YWl0IHRoaXMubGlzdFdlYkZyYW1lcyh1c2VVcmwpO1xuXG4gIGxldCBjdHhzID0gW3tpZDogTkFUSVZFX1dJTiwgdmlldzoge319XTtcbiAgdGhpcy5jb250ZXh0cyA9IFtOQVRJVkVfV0lOXTtcbiAgZm9yIChsZXQgdmlldyBvZiB3ZWJ2aWV3cykge1xuICAgIGN0eHMucHVzaCh7aWQ6IGAke1dFQlZJRVdfQkFTRX0ke3ZpZXcuaWR9YCwgdmlld30pO1xuICAgIHRoaXMuY29udGV4dHMucHVzaCh2aWV3LmlkLnRvU3RyaW5nKCkpO1xuICB9XG4gIHJldHVybiBjdHhzO1xufTtcblxuZXh0ZW5zaW9ucy5nZXROZXdSZW1vdGVEZWJ1Z2dlciA9IGFzeW5jIGZ1bmN0aW9uIGdldE5ld1JlbW90ZURlYnVnZ2VyICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIHJldHVybiBuZXcgUmVtb3RlRGVidWdnZXIoe1xuICAgIGJ1bmRsZUlkOiB0aGlzLm9wdHMuYnVuZGxlSWQsXG4gICAgdXNlTmV3U2FmYXJpOiB0aGlzLnVzZU5ld1NhZmFyaSgpLFxuICAgIHBhZ2VMb2FkTXM6IHRoaXMucGFnZUxvYWRNcyxcbiAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgaXNTYWZhcmk6IHRoaXMuaXNTYWZhcmkoKSxcbiAgICByZW1vdGVEZWJ1Z1Byb3h5OiB0aGlzLm9wdHMucmVtb3RlRGVidWdQcm94eSxcbiAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZTogZmFsc2UsXG4gICAgbG9nRnVsbFJlc3BvbnNlOiAhIXRoaXMub3B0cy5zYWZhcmlTaG93RnVsbFJlc3BvbnNlLFxuICB9KTtcbn07XG5cbmV4dGVuc2lvbnMubGlzdFdlYkZyYW1lcyA9IGFzeW5jIGZ1bmN0aW9uIGxpc3RXZWJGcmFtZXMgKHVzZVVybCA9IHRydWUpIHtcbiAgaWYgKCF0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdygnQ2Fubm90IGVudGVyIHdlYiBmcmFtZSB3aXRob3V0IGEgYnVuZGxlIElEJyk7XG4gIH1cblxuICB1c2VVcmwgPSB1c2VVcmwgJiYgISF0aGlzLmdldEN1cnJlbnRVcmwoKTtcbiAgbG9nZ2VyLmRlYnVnKGBTZWxlY3RpbmcgYnkgdXJsOiAke3VzZVVybH0gJHt1c2VVcmwgPyBgKGV4cGVjdGVkIHVybDogJyR7dGhpcy5nZXRDdXJyZW50VXJsKCl9JylgIDogJyd9YCk7XG5cbiAgbGV0IGN1cnJlbnRVcmwgPSB1c2VVcmwgPyB0aGlzLmdldEN1cnJlbnRVcmwoKSA6IHVuZGVmaW5lZDtcbiAgbGV0IHBhZ2VBcnJheTtcbiAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkgJiYgdGhpcy5yZW1vdGUgJiYgdGhpcy5vcHRzLmJ1bmRsZUlkKSB7XG4gICAgLy8gcmVhbCBkZXZpY2UsIGFuZCBhbHJlYWR5IGNvbm5lY3RlZFxuICAgIHBhZ2VBcnJheSA9IGF3YWl0IHRoaXMucmVtb3RlLnBhZ2VBcnJheUZyb21Kc29uKHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgfSBlbHNlIGlmICh0aGlzLnJlbW90ZSAmJiB0aGlzLnJlbW90ZS5hcHBJZEtleSkge1xuICAgIC8vIHNpbXVsYXRvciwgYW5kIGFscmVhZHkgY29ubmVjdGVkXG4gICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0QXBwKGN1cnJlbnRVcmwsIHRoaXMub3B0cy53ZWJ2aWV3Q29ubmVjdFJldHJpZXMsIHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgfSBlbHNlIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgLy8gcmVhbCBkZXZpY2UsIGFuZCBub3QgY29ubmVjdGVkXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMucmVtb3RlID0gbmV3IFdlYktpdFJlbW90ZURlYnVnZ2VyKHtcbiAgICAgICAgcG9ydDogdGhpcy5vcHRzLndlYmtpdERlYnVnUHJveHlQb3J0LFxuICAgICAgICB3ZWJraXRSZXNwb25zZVRpbWVvdXQ6IHRoaXMub3B0cy53ZWJraXRSZXNwb25zZVRpbWVvdXQsXG4gICAgICAgIHBsYXRmb3JtVmVyc2lvbjogdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbixcbiAgICAgICAgaXNTYWZhcmk6IHRoaXMuaXNTYWZhcmkoKSxcbiAgICAgICAgZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGU6IGZhbHNlLFxuICAgICAgICBsb2dGdWxsUmVzcG9uc2U6ICEhdGhpcy5vcHRzLnNhZmFyaVNob3dGdWxsUmVzcG9uc2UsXG4gICAgICB9KTtcbiAgICAgIHBhZ2VBcnJheSA9IGF3YWl0IHRoaXMucmVtb3RlLnBhZ2VBcnJheUZyb21Kc29uKHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGl0IGlzIHJlYXNvbmFibGUgdG8gZXhwZWN0IHRoYXQgdGhpcyBtaWdodCBiZSBjYWxsZWQgd2hlbiB0aGVyZSBpcyBub1xuICAgICAgLy8gd2Via2l0IHJlbW90ZSBkZWJ1Z2dlciB0byBjb25uZWN0IHRvXG4gICAgICBpZiAoIV8uaW5jbHVkZXMoZXJyLm1lc3NhZ2UsICdjb25uZWN0IEVDT05OUkVGVVNFRCcpKSB0aHJvdyBlcnI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgbG9nZ2VyLndhcm4oJ0F0dGVtcHRlZCB0byBnZXQgYSBsaXN0IG9mIHdlYnZpZXcgY29udGV4dHMgYnV0IGNvdWxkIG5vdCBjb25uZWN0IHRvICcgK1xuICAgICAgICAgICAgICAgICAgJ2lvcy13ZWJraXQtZGVidWctcHJveHkuIElmIHlvdSBleHBlY3QgdG8gZmluZCB3ZWJ2aWV3cywgcGxlYXNlIGVuc3VyZSAnICtcbiAgICAgICAgICAgICAgICAgICd0aGF0IHRoZSBwcm94eSBpcyBydW5uaW5nIGFuZCBhY2Nlc3NpYmxlJyk7XG4gICAgICB0aGlzLnJlbW90ZSA9IG51bGw7XG4gICAgICBwYWdlQXJyYXkgPSBbXTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gc2ltdWxhdG9yLCBhbmQgbm90IGNvbm5lY3RlZFxuICAgIHRoaXMucmVtb3RlID0gYXdhaXQgdGhpcy5nZXROZXdSZW1vdGVEZWJ1Z2dlcigpO1xuXG4gICAgbGV0IGFwcEluZm8gPSBhd2FpdCB0aGlzLnJlbW90ZS5jb25uZWN0KCk7XG4gICAgaWYgKCFhcHBJbmZvKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ1VuYWJsZSB0byBjb25uZWN0IHRvIHRoZSByZW1vdGUgZGVidWdnZXIuJyk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHBhZ2VBcnJheSA9IGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdEFwcChjdXJyZW50VXJsLCB0aGlzLm9wdHMud2Vidmlld0Nvbm5lY3RSZXRyaWVzLCB0aGlzLm9wdHMuaWdub3JlQWJvdXRCbGFua1VybCk7XG4gICAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UsIHRoaXMub25QYWdlQ2hhbmdlLmJpbmQodGhpcykpO1xuICAgIHRoaXMucmVtb3RlLm9uKFJlbW90ZURlYnVnZ2VyLkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCwgKCkgPT4ge1xuICAgICAgaWYgKCFfLmlzRW1wdHkodGhpcy5jdXJXZWJGcmFtZXMpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgQ2xlYXJpbmcgJHt0aGlzLmN1cldlYkZyYW1lcy5sZW5ndGh9IGZyYW1lczogJHt0aGlzLmN1cldlYkZyYW1lcy5qb2luKCcsICcpfWApO1xuICAgICAgfVxuICAgICAgdGhpcy5jdXJXZWJGcmFtZXMgPSBbXTtcbiAgICB9KTtcblxuICAgIGxldCB0cnlDbG9zaW5nQWxlcnQgPSBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZGlkRGlzbWlzcyA9IGF3YWl0IHRoaXMuY2xvc2VBbGVydEJlZm9yZVRlc3QoKTtcbiAgICAgIGlmICghZGlkRGlzbWlzcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nsb3NlIGFsZXJ0IGZhaWxlZC4gUmV0cnkuJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCgzLCA0MDAwLCB0cnlDbG9zaW5nQWxlcnQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaWYgdGhlIGxvb3AgdG8gY2xvc2UgYWxlcnRzIGZhaWxlZCB0byBkaXNtaXNzLCBpZ25vcmUsXG4gICAgICAvLyBvdGhlcndpc2UgbG9nIGFuZCB0aHJvdyB0aGUgZXJyb3JcbiAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gJ0Nsb3NlIGFsZXJ0IGZhaWxlZC4gUmV0cnkuJykge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhlcnIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChwYWdlQXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgLy8gd2UgaGF2ZSBubyB3ZWIgZnJhbWVzLCBidXQgY29udGludWUgYW55d2F5XG4gICAgbG9nZ2VyLmRlYnVnKCdObyB3ZWIgZnJhbWVzIGZvdW5kLicpO1xuICB9XG4gIHJldHVybiBwYWdlQXJyYXk7XG59O1xuXG5leHRlbnNpb25zLm9uUGFnZUNoYW5nZSA9IGFzeW5jIGZ1bmN0aW9uIG9uUGFnZUNoYW5nZSAocGFnZUNoYW5nZU5vdGlmaWNhdGlvbikge1xuICBsb2dnZXIuZGVidWcoYFJlbW90ZSBkZWJ1Z2dlciBub3RpZmllZCB1cyBvZiBhIG5ldyBwYWdlIGxpc3Rpbmc6ICR7SlNPTi5zdHJpbmdpZnkocGFnZUNoYW5nZU5vdGlmaWNhdGlvbil9YCk7XG4gIGlmICh0aGlzLnNlbGVjdGluZ05ld1BhZ2UpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1dlIGFyZSBpbiB0aGUgbWlkZGxlIG9mIHNlbGVjdGluZyBhIHBhZ2UsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghdGhpcy5yZW1vdGUgfHwgIXRoaXMucmVtb3RlLmlzQ29ubmVjdGVkKCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1dlIGhhdmUgbm90IHlldCBjb25uZWN0ZWQsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qge2FwcElkS2V5LCBwYWdlQXJyYXl9ID0gcGFnZUNoYW5nZU5vdGlmaWNhdGlvbjtcblxuICBsZXQgbmV3SWRzID0gW107XG4gIGxldCBuZXdQYWdlcyA9IFtdO1xuICBsZXQga2V5SWQgPSBudWxsO1xuICBmb3IgKGNvbnN0IHBhZ2Ugb2YgcGFnZUFycmF5KSB7XG4gICAgY29uc3QgaWQgPSBwYWdlLmlkLnRvU3RyaW5nKCk7XG4gICAgbmV3SWRzLnB1c2goaWQpO1xuICAgIGlmIChwYWdlLmlzS2V5KSB7XG4gICAgICBrZXlJZCA9IGlkO1xuICAgIH1cbiAgICBjb25zdCBjb250ZXh0SWQgPSBgJHthcHBJZEtleX0uJHtpZH1gO1xuXG4gICAgLy8gYWRkIGlmIHRoaXMgaXMgYSBuZXcgcGFnZVxuICAgIGlmICghXy5pbmNsdWRlcyh0aGlzLmNvbnRleHRzLCBjb250ZXh0SWQpKSB7XG4gICAgICBuZXdQYWdlcy5wdXNoKGlkKTtcbiAgICAgIHRoaXMuY29udGV4dHMucHVzaChjb250ZXh0SWQpO1xuICAgIH1cbiAgfVxuXG4gIGlmICgha2V5SWQpIHtcbiAgICAvLyBpZiB0aGVyZSBpcyBubyBrZXkgaWQsIHB1bGwgdGhlIGZpcnN0IGlkIGZyb20gdGhlIHBhZ2UgYXJyYXkgYW5kIHVzZSB0aGF0XG4gICAgLy8gYXMgYSBzdGFuZCBpblxuICAgIGxvZ2dlci5kZWJ1ZygnTm8ga2V5IGlkIGZvdW5kLiBDaG9vc2luZyBmaXJzdCBpZCBmcm9tIHBhZ2UgYXJyYXknKTtcbiAgICBrZXlJZCA9IG5ld0lkc1swXSB8fCBudWxsO1xuICB9XG5cbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1dlIGRvIG5vdCBhcHBlYXIgdG8gaGF2ZSB3aW5kb3cgc2V0IHlldCwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBbY3VyQXBwSWRLZXksIGN1clBhZ2VJZEtleV0gPSB0aGlzLmN1ckNvbnRleHQuc3BsaXQoJy4nKTtcblxuICBpZiAoY3VyQXBwSWRLZXkgIT09IGFwcElkS2V5KSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdQYWdlIGNoYW5nZSBub3QgcmVmZXJyaW5nIHRvIGN1cnJlbnRseSBzZWxlY3RlZCBhcHAsIGlnbm9yaW5nLicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBuZXdQYWdlID0gbnVsbDtcbiAgaWYgKG5ld1BhZ2VzLmxlbmd0aCkge1xuICAgIG5ld1BhZ2UgPSBfLmxhc3QobmV3UGFnZXMpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgV2UgaGF2ZSBuZXcgcGFnZXMsIHNlbGVjdGluZyBwYWdlICcke25ld1BhZ2V9J2ApO1xuICB9IGVsc2UgaWYgKCFfLmluY2x1ZGVzKG5ld0lkcywgY3VyUGFnZUlkS2V5KSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnTmV3IHBhZ2UgbGlzdGluZyBmcm9tIHJlbW90ZSBkZWJ1Z2dlciBkb2VzIG5vdCBjb250YWluICcgK1xuICAgICAgICAgICAgICAgICAnY3VycmVudCB3aW5kb3c7IGFzc3VtaW5nIGl0IGlzIGNsb3NlZCcpO1xuICAgIGlmICghdXRpbC5oYXNWYWx1ZShrZXlJZCkpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRG8gbm90IGhhdmUgb3VyIGN1cnJlbnQgd2luZG93IGFueW1vcmUsIGFuZCB0aGVyZSAnICtcbiAgICAgICAgICAgICAgICAgICAnYXJlIG5vdCBhbnkgbW9yZSB0byBsb2FkISBEb2luZyBub3RoaW5nLi4uJyk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwodW5kZWZpbmVkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2dnZXIuZGVidWcoYERlYnVnZ2VyIGFscmVhZHkgc2VsZWN0ZWQgcGFnZSAnJHtrZXlJZH0nLCBgICtcbiAgICAgICAgICAgICAgICAgYGNvbmZpcm1pbmcgdGhhdCBjaG9pY2UuYCk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gYCR7YXBwSWRLZXl9LiR7a2V5SWR9YDtcbiAgICBuZXdQYWdlID0ga2V5SWQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gYXQgdGhpcyBwb2ludCwgdGhlcmUgYXJlIG5vIG5ldyBwYWdlcywgYW5kIHRoZSBjdXJyZW50IHBhZ2Ugc3RpbGwgZXhpc3RzXG4gICAgbG9nZ2VyLmRlYnVnKCdDaGVja2luZyBpZiBwYWdlIG5lZWRzIHRvIGxvYWQnKTtcbiAgICAvLyBJZiBhIHdpbmRvdyBuYXZpZ2F0ZXMgdG8gYW4gYW5jaG9yIGl0IGRvZXNuJ3QgYWx3YXlzIGZpcmUgYSBwYWdlXG4gICAgLy8gY2FsbGJhY2sgZXZlbnQuIExldCdzIGNoZWNrIGlmIHdlIHdvdW5kIHVwIGluIHN1Y2ggYSBzaXR1YXRpb24uXG4gICAgY29uc3QgbmVlZHNQYWdlTG9hZCA9ICgoKSA9PiB7XG4gICAgICAvLyBuZWVkIHRvIG1hcCB0aGUgcGFnZSBpZHMgdG8gY29udGV4dCBpZHNcbiAgICAgIGNvbnN0IGNvbnRleHRBcnJheSA9IF8ubWFwKHBhZ2VBcnJheSwgKHBhZ2UpID0+IGAke2FwcElkS2V5fS4ke3BhZ2UuaWR9YCk7XG4gICAgICAvLyBjaGVjayBpZiB0aGUgY3VycmVudCBjb250ZXh0IGV4aXN0cyBpbiBib3RoIG91ciByZWNvcmRlZCBjb250ZXh0cyxcbiAgICAgIC8vIGFuZCB0aGUgcGFnZSBhcnJheVxuICAgICAgcmV0dXJuICFfLmlzRXF1YWwoXy5maW5kKHRoaXMuY29udGV4dHMsIHRoaXMuY3VyQ29udGV4dCksIF8uZmluZChjb250ZXh0QXJyYXksIHRoaXMuY3VyQ29udGV4dCkpO1xuICAgIH0pKCk7XG5cbiAgICBpZiAobmVlZHNQYWdlTG9hZCkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdQYWdlIGxvYWQgbmVlZGVkLiBMb2FkaW5nLi4uJyk7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlTG9hZCgpO1xuICAgIH1cblxuICAgIGxvZ2dlci5kZWJ1ZygnTmV3IHBhZ2UgbGlzdGluZyBpcyBzYW1lIGFzIG9sZCwgZG9pbmcgbm90aGluZycpO1xuICB9XG5cbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHBhZ2UgbGlzdGluZyBpc24ndCBpbmRpY2F0aW5nIGEgcmVkaXJlY3RcbiAgaWYgKHV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIGxldCBjdXJyZW50UGFnZUlkID0gcGFyc2VJbnQoXy5sYXN0KHRoaXMuY3VyQ29udGV4dC5zcGxpdCgnLicpKSwgMTApO1xuICAgIGxldCBwYWdlID0gXy5maW5kKHBhZ2VBcnJheSwgKHApID0+IHBhcnNlSW50KHAuaWQsIDEwKSA9PT0gY3VycmVudFBhZ2VJZCk7XG4gICAgaWYgKHBhZ2UgJiYgcGFnZS51cmwgIT09IHRoaXMuZ2V0Q3VycmVudFVybCgpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYFJlZGlyZWN0ZWQgZnJvbSAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nIHRvICcke3BhZ2UudXJsfSdgKTtcbiAgICAgIHRoaXMuc2V0Q3VycmVudFVybChwYWdlLnVybCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHV0aWwuaGFzVmFsdWUobmV3UGFnZSkpIHtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhcnNlSW50KG5ld1BhZ2UsIDEwKSk7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gZmFsc2U7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gYCR7YXBwSWRLZXl9LiR7bmV3UGFnZX1gO1xuICB9XG4gIHRoaXMud2luZG93SGFuZGxlQ2FjaGUgPSBwYWdlQXJyYXk7XG59O1xuXG5leHRlbnNpb25zLmdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUgPSBhc3luYyBmdW5jdGlvbiBnZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlIChyZWdFeHApIHtcbiAgbGV0IGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0c0FuZFZpZXdzKCk7XG4gIGxldCBtYXRjaGluZ0N0eDtcbiAgZm9yIChsZXQgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgaWYgKGN0eC52aWV3ICYmICgoY3R4LnZpZXcudGl0bGUgJiYgY3R4LnZpZXcudGl0bGUubWF0Y2gocmVnRXhwKSkgfHwgKGN0eC52aWV3LnVybCAmJiBjdHgudmlldy51cmwubWF0Y2gocmVnRXhwKSkpKSB7XG4gICAgICBpZiAoY3R4LnZpZXcudXJsICE9PSAnYWJvdXQ6YmxhbmsnKSB7XG4gICAgICAgIG1hdGNoaW5nQ3R4ID0gY3R4O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gaW4gdGhlIGNhc2VzIG9mIFhjb2RlIDwgNSAoaS5lLiwgaU9TIFNESyBWZXJzaW9uIGxlc3MgdGhhbiA3KVxuICAgICAgICAvLyBpT1MgNy4xLCBpT1MgOS4wICYgaU9TIDkuMSBpbiBhIHdlYnZpZXcgKG5vdCBpbiBTYWZhcmkpXG4gICAgICAgIC8vIHdlIGNhbiBoYXZlIHRoZSB1cmwgYmUgYGFib3V0OmJsYW5rYFxuICAgICAgICBpZiAocGFyc2VGbG9hdCh0aGlzLmlvc1Nka1ZlcnNpb24pIDwgNyB8fCBwYXJzZUZsb2F0KHRoaXMuaW9zU2RrVmVyc2lvbikgPj0gOSB8fFxuICAgICAgICAgICAgKHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24gPT09ICc3LjEnICYmIHRoaXMub3B0cy5hcHAgJiYgdGhpcy5vcHRzLmFwcC50b0xvd2VyQ2FzZSgpICE9PSAnc2FmYXJpJykpIHtcbiAgICAgICAgICBtYXRjaGluZ0N0eCA9IGN0eDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiBtYXRjaGluZ0N0eCA/IG1hdGNoaW5nQ3R4LmlkIDogdW5kZWZpbmVkO1xufTtcblxuLy8gUmlnaHQgbm93IHdlIGRvbid0IG5lY2Vzc2FyaWx5IHdhaXQgZm9yIHdlYnZpZXdcbi8vIGFuZCBmcmFtZSB0byBsb2FkLCB3aGljaCBsZWFkcyB0byByYWNlIGNvbmRpdGlvbnMgYW5kIGZsYWtpbmVzcyxcbi8vIGxldCdzIHNlZSBpZiB3ZSBjYW4gdHJhbnNpdGlvbiB0byBzb21ldGhpbmcgYmV0dGVyXG5leHRlbnNpb25zLnVzZU5ld1NhZmFyaSA9IGZ1bmN0aW9uIHVzZU5ld1NhZmFyaSAoKSB7XG4gIHJldHVybiBwYXJzZUZsb2F0KHRoaXMuaW9zU2RrVmVyc2lvbikgPj0gOC4xICYmXG4gICAgICAgICBwYXJzZUZsb2F0KHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24pID49IDguMSAmJlxuICAgICAgICAgIXRoaXMuaXNSZWFsRGV2aWNlKCkgJiZcbiAgICAgICAgIHRoaXMub3B0cy5zYWZhcmk7XG59O1xuXG5leHRlbnNpb25zLm5hdlRvSW5pdGlhbFdlYnZpZXcgPSBhc3luYyBmdW5jdGlvbiBuYXZUb0luaXRpYWxXZWJ2aWV3ICgpIHtcbiAgbGV0IHRpbWVvdXQgPSAwO1xuICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIHRpbWVvdXQgPSAzMDAwO1xuICAgIGxvZ2dlci5kZWJ1ZyhgV2FpdGluZyBmb3IgJHt0aW1lb3V0fSBtcyBiZWZvcmUgbmF2aWdhdGluZyB0byB2aWV3LmApO1xuICB9XG4gIGF3YWl0IEIuZGVsYXkodGltZW91dCk7XG4gIGlmICh0aGlzLnVzZU5ld1NhZmFyaSgpKSB7XG4gICAgYXdhaXQgdGhpcy50eXBlQW5kTmF2VG9VcmwoKTtcbiAgfSBlbHNlIGlmIChwYXJzZUludCh0aGlzLmlvc1Nka1ZlcnNpb24sIDEwKSA+PSA3ICYmICF0aGlzLmlzUmVhbERldmljZSgpICYmIHRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMoKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSgvLiovKTtcbiAgfVxufTtcblxuYXN5bmMgZnVuY3Rpb24gb3Blbk5ld1BhZ2UgKCkge1xuICBsZXQgbmV3UGFnZUJ1dHRvbiA9IGF3YWl0IHRoaXMuZmluZEVsZW1lbnQoJ3hwYXRoJywgXCIvL1VJQUJ1dHRvbltjb250YWlucyhAbmFtZSwnTmV3IHBhZ2UnKV1cIik7XG4gIGF3YWl0IHRoaXMubmF0aXZlVGFwKG5ld1BhZ2VCdXR0b24uRUxFTUVOVCk7XG59XG5cbmV4dGVuc2lvbnMudHlwZUFuZE5hdlRvVXJsID0gYXN5bmMgZnVuY3Rpb24gdHlwZUFuZE5hdlRvVXJsICgpIHtcbiAgbGV0IGFkZHJlc3MgPSB0aGlzLm9wdHMuYWRkcmVzcyA/IHRoaXMub3B0cy5hZGRyZXNzIDogJzEyNy4wLjAuMSc7XG4gIHRoaXMuc2V0Q3VycmVudFVybCh0aGlzLmNhcHMuc2FmYXJpSW5pdGlhbFVybCB8fCBgaHR0cDovLyR7YWRkcmVzc306JHt0aGlzLm9wdHMucG9ydH0vd2VsY29tZWApO1xuXG4gIGxldCB0cmllcyA9IDA7XG4gIGNvbnN0IE1BWF9UUklFUyA9IDI7XG4gIGxldCBuYXZpZ2F0ZSA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgb2xkSW1wV2FpdCA9IHRoaXMuaW1wbGljaXRXYWl0TXM7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IDcwMDA7XG5cbiAgICAvLyBmaW5kIHRoZSB1cmwgYmFyLCBhbmQgdGFwIG9uIGl0LiByZXRyeSB0byBtYWtlIHN1cmUgd2UgZG9uJ3QgdHJ5XG4gICAgLy8gdG9vIHNvb24gd2hpbGUgdGhlIHZpZXcgaXMgc3RpbGwgbG9hZGluZ1xuICAgIGxldCBlbCA9IGF3YWl0IHJldHJ5SW50ZXJ2YWwoMywgMTAwMCwgYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdVUkwnKSk7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IG9sZEltcFdhaXQ7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVUYXAoZWwuRUxFTUVOVCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2NvdWxkIG5vdCBiZSB0YXBwZWQnKSkge1xuICAgICAgICBpZiAodHJpZXMrKyA+PSBNQVhfVFJJRVMpIHRocm93IGVycjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgICAgIC8vIGdlbmVyYWxseSB0aGlzIG1lYW5zIHRoYXQgU2FmYXJpIGlzIGluIHBhZ2Ugdmlld2luZyBtb2RlXG4gICAgICAgIC8vIHNvIHRyeSB0byBvcGVuIGEgbmV3IHBhZ2UgYW5kIHRoZW4gcmVkbyB0aGUgbmF2aWdhdGlvblxuICAgICAgICBhd2FpdCBvcGVuTmV3UGFnZSgpO1xuICAgICAgICByZXR1cm4gYXdhaXQgbmF2aWdhdGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBnZXQgdGhlIGxhc3QgYWRkcmVzcyBlbGVtZW50IGFuZCBzZXQgdGhlIHVybFxuICAgIHRyeSB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCdjbGFzcyBuYW1lJywgJ1VJQVRleHRGaWVsZCcpO1xuICAgICAgYXdhaXQgdGhpcy5zZXRWYWx1ZUltbWVkaWF0ZSh0aGlzLmdldEN1cnJlbnRVcmwoKSwgZWwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gdGhpcyBpcyBmbGFrZXkgb24gY2VydGFpbiBzeXN0ZW1zIHNvIHdlIHJldHJ5IHVudGlsIHdlIGdldCBzb21ldGhpbmdcbiAgICAgIC8vIGlvcyBzaW1zOiBzYWZhcmkgb3BlbnMgYnV0IHRoZSB0ZXh0IGZpZWxkIGNhbid0IGJlIGZvdW5kXG4gICAgICBpZiAodHJpZXMrKyA+PSBNQVhfVFJJRVMpIHRocm93IGVycjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgICAgcmV0dXJuIGF3YWl0IG5hdmlnYXRlKCk7XG4gICAgfVxuXG4gICAgLy8gbWFrZSBpdCBoYXBwZW5cbiAgICB0cnkge1xuICAgICAgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCdhY2Nlc3NpYmlsaXR5IGlkJywgJ0dvJyk7XG4gICAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbC5FTEVNRU5UKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChfLmluY2x1ZGVzKGVyci5tZXNzYWdlLCAnY291bGQgbm90IGJlIHRhcHBlZCcpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignVW5hYmxlIHRvIHN1Ym1pdCBVUkwgYmVjYXVzZSBcXCdHb1xcJyBidXR0b24gY291bGQgbm90IGJlIHRhcHBlZC4gJyArXG4gICAgICAgICAgICAgICAgICAgICAnUGxlYXNlIG1ha2Ugc3VyZSB5b3VyIGtleWJvYXJkIGlzIHRvZ2dsZWQgb24uJyk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKHVuZGVmaW5lZCwgbmV3IFJlZ0V4cCh0aGlzLmdldEN1cnJlbnRVcmwoKSwgJ2knKSk7XG5cbiAgICAvLyB3YWl0IGZvciBwYWdlIHRvIGZpbmlzaCBsb2FkaW5nLlxuICAgIGF3YWl0IHRoaXMucmVtb3RlLnBhZ2VVbmxvYWQoKTtcbiAgfTtcbiAgYXdhaXQgbmF2aWdhdGUoKTtcbn07XG5cbmV4dGVuc2lvbnMubmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcyA9IGFzeW5jIGZ1bmN0aW9uIG5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMgKCkge1xuICBsb2dnZXIuZGVidWcoJ1dlIGFyZSBvbiBpT1M3KyBzaW11bGF0b3I6IGNsaWNraW5nIGFwcGxlIGJ1dHRvbiB0byBnZXQgaW50byBhIHdlYnZpZXcnKTtcbiAgbGV0IG9sZEltcFdhaXQgPSB0aGlzLmltcGxpY2l0V2FpdE1zO1xuICB0aGlzLmltcGxpY2l0V2FpdE1zID0gNzAwMDsgLy8gd2FpdCA3cyBmb3IgYXBwbGUgYnV0dG9uIHRvIGV4aXN0XG5cbiAgbGV0IGVsO1xuICB0cnkge1xuICAgIGVsID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgneHBhdGgnLCAnLy9VSUFTY3JvbGxWaWV3WzFdL1VJQUJ1dHRvblsxXScpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsZXQgbXNnID0gJ0NvdWxkIG5vdCBmaW5kIGJ1dHRvbiB0byBjbGljayB0byBnZXQgaW50byB3ZWJ2aWV3LiAnICtcbiAgICAgICAgICAgICAgJ1Byb2NlZWRpbmcgb24gdGhlIGFzc3VtcHRpb24gd2UgaGF2ZSBhIHdvcmtpbmcgb25lLic7XG4gICAgbG9nZ2VyLmVycm9yKG1zZyk7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IG9sZEltcFdhaXQ7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC8uKi9pKTtcbiAgfVxuICB0aGlzLmltcGxpY2l0V2FpdE1zID0gb2xkSW1wV2FpdDtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbC5FTEVNRU5UKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbGV0IG1zZyA9ICdDb3VsZCBub3QgY2xpY2sgYnV0dG9uIHRvIGdldCBpbnRvIHdlYnZpZXcuICcgK1xuICAgICAgICAgICAgICAnUHJvY2VlZGluZyBvbiB0aGUgYXNzdW1wdGlvbiB3ZSBoYXZlIGEgd29ya2luZyBvbmUuJztcbiAgICBsb2dnZXIuZXJyb3IobXNnKTtcbiAgfVxuICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSgvYXBwbGUvaSk7XG59O1xuXG5leHRlbnNpb25zLm5hdlRvVmlld1dpdGhUaXRsZSA9IGFzeW5jIGZ1bmN0aW9uIG5hdlRvVmlld1dpdGhUaXRsZSAodGl0bGVSZWdleCwgdXJsUmVnRXhwKSB7XG4gIGxvZ2dlci5kZWJ1ZygnTmF2aWdhdGluZyB0byBtb3N0IHJlY2VudGx5IG9wZW5lZCB3ZWJ2aWV3Jyk7XG4gIGxldCBzdGFydCA9IERhdGUubm93KCk7XG4gIGxldCBzcGluVGltZSA9IDUwMDtcbiAgbGV0IHNwaW5IYW5kbGVzID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCByZXM7XG4gICAgdHJ5IHtcbiAgICAgIHJlcyA9IGF3YWl0IHRoaXMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSh0aXRsZVJlZ2V4IHx8IHVybFJlZ0V4cCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIWVyci5tZXNzYWdlLmluY2x1ZGVzKCdDb3VsZCBub3QgY29ubmVjdCB0byBhIHZhbGlkIGFwcCBhZnRlcicpKSB7XG4gICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKGBDb3VsZCBub3QgbmF2aWdhdGUgdG8gd2VidmlldyEgRXJyOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICBlcnJvci5zdGFjayArPSBgXFxuQ2F1c2VkIGJ5OiAke2Vyci5zdGFja31gO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5kZWJ1ZygnQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXcuIFJldHJ5aW5nIGlmIHBvc3NpYmxlLicpO1xuICAgIH1cbiAgICBpZiAocmVzKSB7XG4gICAgICBsZXQgbGF0ZXN0V2luZG93ID0gcmVzO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBQaWNraW5nIHdlYnZpZXcgJyR7bGF0ZXN0V2luZG93fSdgKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0Q29udGV4dChsYXRlc3RXaW5kb3cpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuY2FuY2VsUGFnZUxvYWQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBubyB3ZWJ2aWV3IHdhcyBmb3VuZFxuICAgIGlmICgoRGF0ZS5ub3coKSAtIHN0YXJ0KSA+PSA5MDAwMCkge1xuICAgICAgLy8gdG9vIHNsb3csIGdldCBvdXRcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXc7IHRoZXJlIGFyZSBub25lIScpO1xuICAgIH1cblxuICAgIGxvZ2dlci53YXJuKCdDb3VsZCBub3QgZmluZCBhbnkgd2Vidmlld3MgeWV0LCByZWZyZXNoaW5nL3JldHJ5aW5nJyk7XG4gICAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkgfHwgIXRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICAgIC8vIG9uIGEgcmVhbCBkZXZpY2UsIHdoZW4gbm90IHVzaW5nIFNhZmFyaSwgd2UganVzdCB3YW50IHRvIHRyeSBhZ2FpblxuICAgICAgYXdhaXQgQi5kZWxheShzcGluVGltZSk7XG4gICAgICByZXR1cm4gYXdhaXQgc3BpbkhhbmRsZXMoKTtcbiAgICB9XG5cbiAgICAvLyBmaW5kIHRoZSByZWxvYWQgYnV0dG9uIGFuZCB0YXAgaXQsIGlmIHBvc3NpYmxlXG4gICAgbGV0IGVsZW1lbnQ7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnRmluZGluZyBhbmQgdGFwcGluZyByZWxvYWQgYnV0dG9uJyk7XG4gICAgICBlbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kVUlFbGVtZW50T3JFbGVtZW50cygnYWNjZXNzaWJpbGl0eSBpZCcsICdSZWxvYWRCdXR0b24nLCAnJywgZmFsc2UpO1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVUYXAoZWxlbWVudC5FTEVNRU5UKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBFcnJvciBmaW5kaW5nIGFuZCB0YXBwaW5nIHJlbG9hZCBidXR0b246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2dnZXIud2FybignUmV0cnlpbmcuJyk7XG4gICAgICBhd2FpdCBCLmRlbGF5KHNwaW5UaW1lKTtcbiAgICB9XG5cbiAgICAvLyB0cnkgaXQgYWxsIGFnYWluXG4gICAgcmV0dXJuIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG4gIH07XG4gIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG59O1xuXG5oZWxwZXJzLmNsb3NlQWxlcnRCZWZvcmVUZXN0ID0gYXN5bmMgZnVuY3Rpb24gY2xvc2VBbGVydEJlZm9yZVRlc3QgKCkge1xuICBsZXQgcHJlc2VudCA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKCdhdS5hbGVydElzUHJlc2VudCgpJyk7XG4gIGlmICghcHJlc2VudCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZygnQWxlcnQgcHJlc2VudCBiZWZvcmUgc3RhcnRpbmcgdGVzdCwgbGV0IHVzIGJhbmlzaCBpdCcpO1xuICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZCgnYXUuZGlzbWlzc0FsZXJ0KCknKTtcbiAgbG9nZ2VyLmRlYnVnKCdBbGVydCBiYW5pc2hlZCEnKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5oZWxwZXJzLnN0b3BSZW1vdGUgPSBhc3luYyBmdW5jdGlvbiBzdG9wUmVtb3RlIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcgPSBmYWxzZSkge1xuICBpZiAoIXRoaXMucmVtb3RlKSB7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coJ1RyaWVkIHRvIGxlYXZlIGEgd2ViIGZyYW1lIGJ1dCB3ZXJlIG5vdCBpbiBvbmUnKTtcbiAgfVxuXG4gIGlmIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcpIHtcbiAgICBhd2FpdCB0aGlzLmNsb3NlV2luZG93KCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICB0aGlzLmN1ckNvbnRleHQgPSBudWxsO1xuICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICB0aGlzLmN1cldlYkNvb3JkcyA9IG51bGw7XG4gIHRoaXMucmVtb3RlID0gbnVsbDtcbn07XG5cbmhlbHBlcnMuaXNXZWJDb250ZXh0ID0gZnVuY3Rpb24gaXNXZWJDb250ZXh0ICgpIHtcbiAgcmV0dXJuICEhdGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTjtcbn07XG5cbmhlbHBlcnMuc2V0Q3VycmVudFVybCA9IGZ1bmN0aW9uIHNldEN1cnJlbnRVcmwgKHVybCkge1xuICB0aGlzLl9jdXJyZW50VXJsID0gdXJsO1xufTtcblxuaGVscGVycy5nZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gZ2V0Q3VycmVudFVybCAoKSB7XG4gIHJldHVybiB0aGlzLl9jdXJyZW50VXJsO1xufTtcblxuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzLCBOQVRJVkVfV0lOLCBXRUJWSUVXX1dJTiwgV0VCVklFV19CQVNFIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
