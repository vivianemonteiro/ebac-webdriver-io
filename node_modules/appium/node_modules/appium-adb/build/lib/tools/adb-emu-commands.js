"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger.js"));

var _helpers = require("../helpers");

var _lodash = _interopRequireDefault(require("lodash"));

var _net = _interopRequireDefault(require("net"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _path = _interopRequireDefault(require("path"));

var _ini = _interopRequireDefault(require("ini"));

const PHONE_NUMBER_PATTERN = /^[+]?[(]?[0-9]*[)]?[-\s.]?[0-9]*[-\s.]?[0-9]{2,}$/im;
let emuMethods = {};
emuMethods.POWER_AC_STATES = {
  POWER_AC_ON: 'on',
  POWER_AC_OFF: 'off'
};
emuMethods.GSM_CALL_ACTIONS = {
  GSM_CALL: 'call',
  GSM_ACCEPT: 'accept',
  GSM_CANCEL: 'cancel',
  GSM_HOLD: 'hold'
};
emuMethods.GSM_VOICE_STATES = {
  GSM_VOICE_UNREGISTERED: 'unregistered',
  GSM_VOICE_HOME: 'home',
  GSM_VOICE_ROAMING: 'roaming',
  GSM_VOICE_SEARCHING: 'searching',
  GSM_VOICE_DENIED: 'denied',
  GSM_VOICE_OFF: 'off',
  GSM_VOICE_ON: 'on'
};
emuMethods.GSM_SIGNAL_STRENGTHS = [0, 1, 2, 3, 4];
emuMethods.NETWORK_SPEED = {
  GSM: 'gsm',
  SCSD: 'scsd',
  GPRS: 'gprs',
  EDGE: 'edge',
  UMTS: 'umts',
  HSDPA: 'hsdpa',
  LTE: 'lte',
  EVDO: 'evdo',
  FULL: 'full'
};
emuMethods.SENSORS = {
  ACCELERATION: 'acceleration',
  LIGHT: 'light',
  PROXIMITY: 'proximity',
  TEMPERATURE: 'temperature',
  PRESSURE: 'pressure',
  HUMIDITY: 'humidity'
};

async function listEmulators() {
  let avdsRoot = process.env.ANDROID_AVD_HOME;

  if (await (0, _helpers.dirExists)(avdsRoot)) {
    return await getAvdConfigPaths(avdsRoot);
  }

  if (avdsRoot) {
    _logger.default.warn(`The value of the ANDROID_AVD_HOME environment variable '${avdsRoot}' is not an existing directory`);
  }

  const prefsRoot = await (0, _helpers.getAndroidPrefsRoot)();

  if (!prefsRoot) {
    return [];
  }

  avdsRoot = _path.default.resolve(prefsRoot, 'avd');

  if (!(await (0, _helpers.dirExists)(avdsRoot))) {
    _logger.default.debug(`Virtual devices config root '${avdsRoot}' is not an existing directory`);

    return [];
  }

  return await getAvdConfigPaths(avdsRoot);
}

async function getAvdConfigPaths(avdsRoot) {
  const configs = await _appiumSupport.fs.glob('*.ini', {
    cwd: avdsRoot,
    absolute: true
  });
  return configs.map(confPath => {
    const avdName = _path.default.basename(confPath).split('.').slice(0, -1).join('.');

    return {
      name: avdName,
      config: confPath
    };
  }).filter(({
    name
  }) => _lodash.default.trim(name));
}

emuMethods.isEmulatorConnected = async function isEmulatorConnected() {
  let emulators = await this.getConnectedEmulators();
  return !!_lodash.default.find(emulators, x => x && x.udid === this.curDeviceId);
};

emuMethods.verifyEmulatorConnected = async function verifyEmulatorConnected() {
  if (!(await this.isEmulatorConnected())) {
    throw new Error(`The emulator "${this.curDeviceId}" was unexpectedly disconnected`);
  }
};

emuMethods.fingerprint = async function fingerprint(fingerprintId) {
  if (!fingerprintId) {
    throw new Error('Fingerprint id parameter must be defined');
  }

  let level = await this.getApiLevel();

  if (level < 23) {
    throw new Error(`Device API Level must be >= 23. Current Api level '${level}'`);
  }

  await this.adbExecEmu(['finger', 'touch', fingerprintId]);
};

emuMethods.rotate = async function rotate() {
  await this.adbExecEmu(['rotate']);
};

emuMethods.powerAC = async function powerAC(state = 'on') {
  if (_lodash.default.values(emuMethods.POWER_AC_STATES).indexOf(state) === -1) {
    throw new Error(`Wrong power AC state sent '${state}'. Supported values: ${_lodash.default.values(emuMethods.POWER_AC_STATES)}]`);
  }

  await this.adbExecEmu(['power', 'ac', state]);
};

emuMethods.sensorSet = async function sensorSet(sensor, value) {
  if (!_lodash.default.includes(emuMethods.SENSORS, sensor)) {
    throw new Error(`Unsupported sensor sent '${sensor}'. Supported values: ${_lodash.default.values(emuMethods.SENSORS)}]`);
  }

  value = parseFloat(value);

  if (isNaN(value)) {
    throw new Error(`Missing sensor value argument. You need to provide a valid number to set to the sensor.`);
  }

  await this.adbExecEmu(['sensor', 'set', sensor, value]);
};

emuMethods.powerCapacity = async function powerCapacity(percent = 100) {
  percent = parseInt(percent, 10);

  if (isNaN(percent) || percent < 0 || percent > 100) {
    throw new Error(`The percentage value should be valid integer between 0 and 100`);
  }

  await this.adbExecEmu(['power', 'capacity', percent]);
};

emuMethods.powerOFF = async function powerOFF() {
  await this.powerAC(emuMethods.POWER_AC_STATES.POWER_AC_OFF);
  await this.powerCapacity(0);
};

emuMethods.sendSMS = async function sendSMS(phoneNumber, message = '') {
  message = message.trim();

  if (message === '') {
    throw new Error('Sending an SMS requires a message');
  }

  phoneNumber = `${phoneNumber}`.replace(/\s*/, '');

  if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
    throw new Error(`Invalid sendSMS phoneNumber param ${phoneNumber}`);
  }

  await this.adbExecEmu(['sms', 'send', phoneNumber, message]);
};

emuMethods.gsmCall = async function gsmCall(phoneNumber, action = '') {
  if (_lodash.default.values(emuMethods.GSM_CALL_ACTIONS).indexOf(action) === -1) {
    throw new Error(`Invalid gsm action param ${action}. Supported values: ${_lodash.default.values(emuMethods.GSM_CALL_ACTIONS)}`);
  }

  phoneNumber = `${phoneNumber}`.replace(/\s*/, '');

  if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
    throw new Error(`Invalid gsmCall phoneNumber param ${phoneNumber}`);
  }

  await this.adbExecEmu(['gsm', action, phoneNumber]);
};

emuMethods.gsmSignal = async function gsmSignal(strength = 4) {
  strength = parseInt(strength, 10);

  if (emuMethods.GSM_SIGNAL_STRENGTHS.indexOf(strength) === -1) {
    throw new Error(`Invalid signal strength param ${strength}. Supported values: ${_lodash.default.values(emuMethods.GSM_SIGNAL_STRENGTHS)}`);
  }

  _logger.default.info('gsm signal-profile <strength> changes the reported strength on next (15s) update.');

  await this.adbExecEmu(['gsm', 'signal-profile', strength]);
};

emuMethods.gsmVoice = async function gsmVoice(state = 'on') {
  if (_lodash.default.values(emuMethods.GSM_VOICE_STATES).indexOf(state) === -1) {
    throw new Error(`Invalid gsm voice state param ${state}. Supported values: ${_lodash.default.values(emuMethods.GSM_VOICE_STATES)}`);
  }

  await this.adbExecEmu(['gsm', 'voice', state]);
};

emuMethods.networkSpeed = async function networkSpeed(speed = 'full') {
  if (_lodash.default.values(emuMethods.NETWORK_SPEED).indexOf(speed) === -1) {
    throw new Error(`Invalid network speed param ${speed}. Supported values: ${_lodash.default.values(emuMethods.NETWORK_SPEED)}`);
  }

  await this.adbExecEmu(['network', 'speed', speed]);
};

emuMethods.execEmuConsoleCommand = async function execTelnet(cmd, opts = {}) {
  let port = parseInt(opts.port, 10);

  if (!port) {
    const portMatch = /emulator-(\d+)/i.exec(this.curDeviceId);

    if (!portMatch) {
      throw new Error(`Cannot parse the console port number from the device identifier '${this.curDeviceId}'. ` + `Is it an emulator?`);
    }

    port = parseInt(portMatch[1], 10);
  }

  const host = '127.0.0.1';
  const {
    execTimeout = 60000,
    connTimeout = 5000,
    initTimeout = 5000
  } = opts;
  await this.resetTelnetAuthToken();
  const okFlag = /^OK$/m;
  const nokFlag = /^KO\b/m;
  const eol = '\r\n';

  const client = _net.default.connect({
    host,
    port
  });

  return await new _bluebird.default((resolve, reject) => {
    const connTimeoutObj = setTimeout(() => reject(new Error(`Cannot connect to the Emulator console at ${host}:${port} ` + `after ${connTimeout}ms`)), connTimeout);
    let execTimeoutObj;
    let initTimeoutObj;
    let isCommandSent = false;
    let serverResponse = [];
    client.once('error', e => {
      clearTimeout(connTimeoutObj);
      reject(new Error(`Cannot connect to the Emulator console at ${host}:${port}. ` + `Original error: ${e.message}`));
    });
    client.once('connect', () => {
      clearTimeout(connTimeoutObj);
      initTimeoutObj = setTimeout(() => reject(new Error(`Did not get the initial response from the Emulator console at ${host}:${port} ` + `after ${initTimeout}ms`)), initTimeout);
    });
    client.on('data', chunk => {
      serverResponse.push(chunk);
      const output = Buffer.concat(serverResponse).toString('utf8').trim();

      if (okFlag.test(output)) {
        if (!isCommandSent) {
          clearTimeout(initTimeoutObj);
          serverResponse = [];
          const cmdStr = _lodash.default.isArray(cmd) ? _appiumSupport.util.quote(cmd) : `${cmd}`;

          _logger.default.debug(`Executing Emulator console command: ${cmdStr}`);

          client.write(cmdStr);
          client.write(eol);
          isCommandSent = true;
          execTimeoutObj = setTimeout(() => reject(new Error(`Did not get any response from the Emulator console at ${host}:${port} ` + `to '${cmd}' command after ${execTimeout}ms`)), execTimeout);
          return;
        }

        clearTimeout(execTimeoutObj);
        client.end();
        const outputArr = output.split(eol);
        return resolve(outputArr.slice(0, outputArr.length - 1).join('\n').trim());
      } else if (nokFlag.test(output)) {
        clearTimeout(initTimeoutObj);
        clearTimeout(execTimeoutObj);
        client.end();
        const outputArr = output.split(eol);
        return reject(_lodash.default.trim(_lodash.default.last(outputArr)));
      }
    });
  });
};

emuMethods.getEmuVersionInfo = async function getEmuVersionInfo() {
  const propsPath = _path.default.join(this.sdkRoot, 'emulator', 'source.properties');

  if (!(await _appiumSupport.fs.exists(propsPath))) {
    return {};
  }

  const content = await _appiumSupport.fs.readFile(propsPath, 'utf8');
  const revisionMatch = /^Pkg\.Revision=([\d.]+)$/m.exec(content);
  const result = {};

  if (revisionMatch) {
    result.revision = revisionMatch[1];
  }

  const buildIdMatch = /^Pkg\.BuildId=(\d+)$/m.exec(content);

  if (buildIdMatch) {
    result.buildId = parseInt(buildIdMatch[1], 10);
  }

  return result;
};

emuMethods.getEmuImageProperties = async function getEmuImageProperties(avdName) {
  const avds = await listEmulators();
  const avd = avds.find(({
    name
  }) => name === avdName);

  if (!avd) {
    let msg = `Cannot find '${avdName}' emulator. `;

    if (_lodash.default.isEmpty(avds)) {
      msg += `No emulators have been detected on your system`;
    } else {
      msg += `Available avd names are: ${avds.map(({
        name
      }) => name)}`;
    }

    throw new Error(msg);
  }

  return _ini.default.parse(await _appiumSupport.fs.readFile(avd.config, 'utf8'));
};

emuMethods.checkAvdExist = async function checkAvdExist(avdName) {
  const avds = await listEmulators();

  if (!avds.some(({
    name
  }) => name === avdName)) {
    let msg = `Avd '${avdName}' is not available. `;

    if (_lodash.default.isEmpty(avds)) {
      msg += `No emulators have been detected on your system`;
    } else {
      msg += `Please select your avd name from one of these: '${avds.map(({
        name
      }) => name)}'`;
    }

    throw new Error(msg);
  }

  return true;
};

var _default = emuMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hZGItZW11LWNvbW1hbmRzLmpzIl0sIm5hbWVzIjpbIlBIT05FX05VTUJFUl9QQVRURVJOIiwiZW11TWV0aG9kcyIsIlBPV0VSX0FDX1NUQVRFUyIsIlBPV0VSX0FDX09OIiwiUE9XRVJfQUNfT0ZGIiwiR1NNX0NBTExfQUNUSU9OUyIsIkdTTV9DQUxMIiwiR1NNX0FDQ0VQVCIsIkdTTV9DQU5DRUwiLCJHU01fSE9MRCIsIkdTTV9WT0lDRV9TVEFURVMiLCJHU01fVk9JQ0VfVU5SRUdJU1RFUkVEIiwiR1NNX1ZPSUNFX0hPTUUiLCJHU01fVk9JQ0VfUk9BTUlORyIsIkdTTV9WT0lDRV9TRUFSQ0hJTkciLCJHU01fVk9JQ0VfREVOSUVEIiwiR1NNX1ZPSUNFX09GRiIsIkdTTV9WT0lDRV9PTiIsIkdTTV9TSUdOQUxfU1RSRU5HVEhTIiwiTkVUV09SS19TUEVFRCIsIkdTTSIsIlNDU0QiLCJHUFJTIiwiRURHRSIsIlVNVFMiLCJIU0RQQSIsIkxURSIsIkVWRE8iLCJGVUxMIiwiU0VOU09SUyIsIkFDQ0VMRVJBVElPTiIsIkxJR0hUIiwiUFJPWElNSVRZIiwiVEVNUEVSQVRVUkUiLCJQUkVTU1VSRSIsIkhVTUlESVRZIiwibGlzdEVtdWxhdG9ycyIsImF2ZHNSb290IiwicHJvY2VzcyIsImVudiIsIkFORFJPSURfQVZEX0hPTUUiLCJnZXRBdmRDb25maWdQYXRocyIsImxvZyIsIndhcm4iLCJwcmVmc1Jvb3QiLCJwYXRoIiwicmVzb2x2ZSIsImRlYnVnIiwiY29uZmlncyIsImZzIiwiZ2xvYiIsImN3ZCIsImFic29sdXRlIiwibWFwIiwiY29uZlBhdGgiLCJhdmROYW1lIiwiYmFzZW5hbWUiLCJzcGxpdCIsInNsaWNlIiwiam9pbiIsIm5hbWUiLCJjb25maWciLCJmaWx0ZXIiLCJfIiwidHJpbSIsImlzRW11bGF0b3JDb25uZWN0ZWQiLCJlbXVsYXRvcnMiLCJnZXRDb25uZWN0ZWRFbXVsYXRvcnMiLCJmaW5kIiwieCIsInVkaWQiLCJjdXJEZXZpY2VJZCIsInZlcmlmeUVtdWxhdG9yQ29ubmVjdGVkIiwiRXJyb3IiLCJmaW5nZXJwcmludCIsImZpbmdlcnByaW50SWQiLCJsZXZlbCIsImdldEFwaUxldmVsIiwiYWRiRXhlY0VtdSIsInJvdGF0ZSIsInBvd2VyQUMiLCJzdGF0ZSIsInZhbHVlcyIsImluZGV4T2YiLCJzZW5zb3JTZXQiLCJzZW5zb3IiLCJ2YWx1ZSIsImluY2x1ZGVzIiwicGFyc2VGbG9hdCIsImlzTmFOIiwicG93ZXJDYXBhY2l0eSIsInBlcmNlbnQiLCJwYXJzZUludCIsInBvd2VyT0ZGIiwic2VuZFNNUyIsInBob25lTnVtYmVyIiwibWVzc2FnZSIsInJlcGxhY2UiLCJ0ZXN0IiwiZ3NtQ2FsbCIsImFjdGlvbiIsImdzbVNpZ25hbCIsInN0cmVuZ3RoIiwiaW5mbyIsImdzbVZvaWNlIiwibmV0d29ya1NwZWVkIiwic3BlZWQiLCJleGVjRW11Q29uc29sZUNvbW1hbmQiLCJleGVjVGVsbmV0IiwiY21kIiwib3B0cyIsInBvcnQiLCJwb3J0TWF0Y2giLCJleGVjIiwiaG9zdCIsImV4ZWNUaW1lb3V0IiwiY29ublRpbWVvdXQiLCJpbml0VGltZW91dCIsInJlc2V0VGVsbmV0QXV0aFRva2VuIiwib2tGbGFnIiwibm9rRmxhZyIsImVvbCIsImNsaWVudCIsIm5ldCIsImNvbm5lY3QiLCJCIiwicmVqZWN0IiwiY29ublRpbWVvdXRPYmoiLCJzZXRUaW1lb3V0IiwiZXhlY1RpbWVvdXRPYmoiLCJpbml0VGltZW91dE9iaiIsImlzQ29tbWFuZFNlbnQiLCJzZXJ2ZXJSZXNwb25zZSIsIm9uY2UiLCJlIiwiY2xlYXJUaW1lb3V0Iiwib24iLCJjaHVuayIsInB1c2giLCJvdXRwdXQiLCJCdWZmZXIiLCJjb25jYXQiLCJ0b1N0cmluZyIsImNtZFN0ciIsImlzQXJyYXkiLCJ1dGlsIiwicXVvdGUiLCJ3cml0ZSIsImVuZCIsIm91dHB1dEFyciIsImxlbmd0aCIsImxhc3QiLCJnZXRFbXVWZXJzaW9uSW5mbyIsInByb3BzUGF0aCIsInNka1Jvb3QiLCJleGlzdHMiLCJjb250ZW50IiwicmVhZEZpbGUiLCJyZXZpc2lvbk1hdGNoIiwicmVzdWx0IiwicmV2aXNpb24iLCJidWlsZElkTWF0Y2giLCJidWlsZElkIiwiZ2V0RW11SW1hZ2VQcm9wZXJ0aWVzIiwiYXZkcyIsImF2ZCIsIm1zZyIsImlzRW1wdHkiLCJpbmkiLCJwYXJzZSIsImNoZWNrQXZkRXhpc3QiLCJzb21lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLG9CQUFvQixHQUFHLHFEQUE3QjtBQUVBLElBQUlDLFVBQVUsR0FBRyxFQUFqQjtBQUNBQSxVQUFVLENBQUNDLGVBQVgsR0FBNkI7QUFDM0JDLEVBQUFBLFdBQVcsRUFBRSxJQURjO0FBRTNCQyxFQUFBQSxZQUFZLEVBQUU7QUFGYSxDQUE3QjtBQUlBSCxVQUFVLENBQUNJLGdCQUFYLEdBQThCO0FBQzVCQyxFQUFBQSxRQUFRLEVBQUUsTUFEa0I7QUFFNUJDLEVBQUFBLFVBQVUsRUFBRSxRQUZnQjtBQUc1QkMsRUFBQUEsVUFBVSxFQUFFLFFBSGdCO0FBSTVCQyxFQUFBQSxRQUFRLEVBQUU7QUFKa0IsQ0FBOUI7QUFNQVIsVUFBVSxDQUFDUyxnQkFBWCxHQUE4QjtBQUM1QkMsRUFBQUEsc0JBQXNCLEVBQUUsY0FESTtBQUU1QkMsRUFBQUEsY0FBYyxFQUFFLE1BRlk7QUFHNUJDLEVBQUFBLGlCQUFpQixFQUFFLFNBSFM7QUFJNUJDLEVBQUFBLG1CQUFtQixFQUFFLFdBSk87QUFLNUJDLEVBQUFBLGdCQUFnQixFQUFFLFFBTFU7QUFNNUJDLEVBQUFBLGFBQWEsRUFBRSxLQU5hO0FBTzVCQyxFQUFBQSxZQUFZLEVBQUU7QUFQYyxDQUE5QjtBQVNBaEIsVUFBVSxDQUFDaUIsb0JBQVgsR0FBa0MsQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsRUFBVSxDQUFWLEVBQWEsQ0FBYixDQUFsQztBQUVBakIsVUFBVSxDQUFD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R0FBRyxJQUFLLDRCQUEyQkYsSUFBSSxDQUFDL0csR0FBTCxDQUFTLENBQUM7QUFBQ08sUUFBQUE7QUFBRCxPQUFELEtBQVlBLElBQXJCLENBQTJCLEVBQTlEO0FBQ0Q7O0FBQ0QsVUFBTSxJQUFJYSxLQUFKLENBQVU2RixHQUFWLENBQU47QUFDRDs7QUFDRCxTQUFPRSxhQUFJQyxLQUFKLENBQVUsTUFBTXhILGtCQUFHNEcsUUFBSCxDQUFZUSxHQUFHLENBQUN4RyxNQUFoQixFQUF3QixNQUF4QixDQUFoQixDQUFQO0FBQ0QsQ0FiRDs7QUFzQkE1RCxVQUFVLENBQUN5SyxhQUFYLEdBQTJCLGVBQWVBLGFBQWYsQ0FBOEJuSCxPQUE5QixFQUF1QztBQUNoRSxRQUFNNkcsSUFBSSxHQUFHLE1BQU1oSSxhQUFhLEVBQWhDOztBQUNBLE1BQUksQ0FBQ2dJLElBQUksQ0FBQ08sSUFBTCxDQUFVLENBQUM7QUFBQy9HLElBQUFBO0FBQUQsR0FBRCxLQUFZQSxJQUFJLEtBQUtMLE9BQS9CLENBQUwsRUFBOEM7QUFDNUMsUUFBSStHLEdBQUcsR0FBSSxRQUFPL0csT0FBUSxzQkFBMUI7O0FBQ0EsUUFBSVEsZ0JBQUV3RyxPQUFGLENBQVVILElBQVYsQ0FBSixFQUFxQjtBQUNuQkUsTUFBQUEsR0FBRyxJQUFLLGdEQUFSO0FBQ0QsS0FGRCxNQUVPO0FBQ0xBLE1BQUFBLEdBQUcsSUFBSyxtREFBa0RGLElBQUksQ0FBQy9HLEdBQUwsQ0FBUyxDQUFDO0FBQUNPLFFBQUFBO0FBQUQsT0FBRCxLQUFZQSxJQUFyQixDQUEyQixHQUFyRjtBQUNEOztBQUNELFVBQU0sSUFBSWEsS0FBSixDQUFVNkYsR0FBVixDQUFOO0FBQ0Q7O0FBQ0QsU0FBTyxJQUFQO0FBQ0QsQ0FaRDs7ZUFjZXJLLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQgeyBnZXRBbmRyb2lkUHJlZnNSb290LCBkaXJFeGlzdHMgfSBmcm9tICcuLi9oZWxwZXJzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbmV0IGZyb20gJ25ldCc7XG5pbXBvcnQgeyB1dGlsLCBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGluaSBmcm9tICdpbmknO1xuXG5jb25zdCBQSE9ORV9OVU1CRVJfUEFUVEVSTiA9IC9eWytdP1soXT9bMC05XSpbKV0/Wy1cXHMuXT9bMC05XSpbLVxccy5dP1swLTldezIsfSQvaW07XG5cbmxldCBlbXVNZXRob2RzID0ge307XG5lbXVNZXRob2RzLlBPV0VSX0FDX1NUQVRFUyA9IHtcbiAgUE9XRVJfQUNfT046ICdvbicsXG4gIFBPV0VSX0FDX09GRjogJ29mZidcbn07XG5lbXVNZXRob2RzLkdTTV9DQUxMX0FDVElPTlMgPSB7XG4gIEdTTV9DQUxMOiAnY2FsbCcsXG4gIEdTTV9BQ0NFUFQ6ICdhY2NlcHQnLFxuICBHU01fQ0FOQ0VMOiAnY2FuY2VsJyxcbiAgR1NNX0hPTEQ6ICdob2xkJ1xufTtcbmVtdU1ldGhvZHMuR1NNX1ZPSUNFX1NUQVRFUyA9IHtcbiAgR1NNX1ZPSUNFX1VOUkVHSVNURVJFRDogJ3VucmVnaXN0ZXJlZCcsXG4gIEdTTV9WT0lDRV9IT01FOiAnaG9tZScsXG4gIEdTTV9WT0lDRV9ST0FNSU5HOiAncm9hbWluZycsXG4gIEdTTV9WT0lDRV9TRUFSQ0hJTkc6ICdzZWFyY2hpbmcnLFxuICBHU01fVk9JQ0VfREVOSUVEOiAnZGVuaWVkJyxcbiAgR1NNX1ZPSUNFX09GRjogJ29mZicsXG4gIEdTTV9WT0lDRV9PTjogJ29uJ1xufTtcbmVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMgPSBbMCwgMSwgMiwgMywgNF07XG5cbmVtdU1ldGhvZHMuTkVUV09SS19TUEVFRCA9IHtcbiAgR1NNOiAnZ3NtJywgLy8gR1NNL0NTRCAodXA6IDE0LjQsIGRvd246IDE0LjQpLlxuICBTQ1NEOiAnc2NzZCcsIC8vIEhTQ1NEICh1cDogMTQuNCwgZG93bjogNTcuNikuXG4gIEdQUlM6ICdncHJzJywgLy8gR1BSUyAodXA6IDI4LjgsIGRvd246IDU3LjYpLlxuICBFREdFOiAnZWRnZScsIC8vIEVER0UvRUdQUlMgKHVwOiA0NzMuNiwgZG93bjogNDczLjYpLlxuICBVTVRTOiAndW10cycsIC8vIFVNVFMvM0cgKHVwOiAzODQuMCwgZG93bjogMzg0LjApLlxuICBIU0RQQTogJ2hzZHBhJywgLy8gSFNEUEEgKHVwOiA1NzYwLjAsIGRvd246IDEzLDk4MC4wKS5cbiAgTFRFOiAnbHRlJywgLy8gTFRFICh1cDogNTgsMDAwLCBkb3duOiAxNzMsMDAwKS5cbiAgRVZETzogJ2V2ZG8nLCAvLyBFVkRPICh1cDogNzUsMDAwLCBkb3duOiAyODAsMDAwKS5cbiAgRlVMTDogJ2Z1bGwnIC8vIE5vIGxpbWl0LCB0aGUgZGVmYXVsdCAodXA6IDAuMCwgZG93bjogMC4wKS5cbn07XG5cbmVtdU1ldGhvZHMuU0VOU09SUyA9IHtcbiAgQUNDRUxFUkFUSU9OOiAnYWNjZWxlcmF0aW9uJyxcbiAgTElHSFQ6ICdsaWdodCcsXG4gIFBST1hJTUlUWTogJ3Byb3hpbWl0eScsXG4gIFRFTVBFUkFUVVJFOiAndGVtcGVyYXR1cmUnLFxuICBQUkVTU1VSRTogJ3ByZXNzdXJlJyxcbiAgSFVNSURJVFk6ICdodW1pZGl0eSdcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRW11SW5mb1xuICogQHByb3BlcnR5IHtzdHJpbmd9IG5hbWUgRW11bGF0b3IgbmFtZSwgZm9yIGV4YW1wbGUgYFBpeGVsX1hMX0FQSV8zMGBcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb25maWcgRnVsbCBwYXRoIHRvIHRoZSBlbXVsYXRvciBjb25maWcgLmluaSBmaWxlLFxuICogZm9yIGV4YW1wbGUgYC9Vc2Vycy91c2VyLy5hbmRyb2lkL2F2ZC9QaXhlbF9YTF9BUElfMzAuaW5pYFxuICovXG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBBbmRyb2lkIGVtdWxhdG9yc1xuICpcbiAqIEByZXR1cm5zIHtBcnJheTxFbXVJbmZvPn1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbGlzdEVtdWxhdG9ycyAoKSB7XG4gIGxldCBhdmRzUm9vdCA9IHByb2Nlc3MuZW52LkFORFJPSURfQVZEX0hPTUU7XG4gIGlmIChhd2FpdCBkaXJFeGlzdHMoYXZkc1Jvb3QpKSB7XG4gICAgcmV0dXJuIGF3YWl0IGdldEF2ZENvbmZpZ1BhdGhzKGF2ZHNSb290KTtcbiAgfVxuXG4gIGlmIChhdmRzUm9vdCkge1xuICAgIGxvZy53YXJuKGBUaGUgdmFsdWUgb2YgdGhlIEFORFJPSURfQVZEX0hPTUUgZW52aXJvbm1lbnQgdmFyaWFibGUgJyR7YXZkc1Jvb3R9JyBpcyBub3QgYW4gZXhpc3RpbmcgZGlyZWN0b3J5YCk7XG4gIH1cblxuICBjb25zdCBwcmVmc1Jvb3QgPSBhd2FpdCBnZXRBbmRyb2lkUHJlZnNSb290KCk7XG4gIGlmICghcHJlZnNSb290KSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgYXZkc1Jvb3QgPSBwYXRoLnJlc29sdmUocHJlZnNSb290LCAnYXZkJyk7XG4gIGlmICghYXdhaXQgZGlyRXhpc3RzKGF2ZHNSb290KSkge1xuICAgIGxvZy5kZWJ1ZyhgVmlydHVhbCBkZXZpY2VzIGNvbmZpZyByb290ICcke2F2ZHNSb290fScgaXMgbm90IGFuIGV4aXN0aW5nIGRpcmVjdG9yeWApO1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCBnZXRBdmRDb25maWdQYXRocyhhdmRzUm9vdCk7XG59XG5cbi8qKlxuICogR2V0IGNvbmZpZ3VyYXRpb24gcGF0aHMgb2YgYWxsIHZpcnR1YWwgZGV2aWNlc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdmRzUm9vdCBQYXRoIHRvIHRoZSBkaXJlY3RvcnkgdGhhdCBjb250YWlucyB0aGUgQVZEIC5pbmkgZmlsZXNcbiAqIEByZXR1cm5zIHtBcnJheTxFbXVJbmZvPn1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QXZkQ29uZmlnUGF0aHMgKGF2ZHNSb290KSB7XG4gIGNvbnN0IGNvbmZpZ3MgPSBhd2FpdCBmcy5nbG9iKCcqLmluaScsIHtcbiAgICBjd2Q6IGF2ZHNSb290LFxuICAgIGFic29sdXRlOiB0cnVlLFxuICB9KTtcbiAgcmV0dXJuIGNvbmZpZ3MubWFwKChjb25mUGF0aCkgPT4ge1xuICAgIGNvbnN0IGF2ZE5hbWUgPSBwYXRoLmJhc2VuYW1lKGNvbmZQYXRoKS5zcGxpdCgnLicpLnNsaWNlKDAsIC0xKS5qb2luKCcuJyk7XG4gICAgcmV0dXJuIHtuYW1lOiBhdmROYW1lLCBjb25maWc6IGNvbmZQYXRofTtcbiAgfSkuZmlsdGVyKCh7bmFtZX0pID0+IF8udHJpbShuYW1lKSk7XG59XG5cbi8qKlxuICogQ2hlY2sgdGhlIGVtdWxhdG9yIHN0YXRlLlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgRW11bGF0b3IgaXMgdmlzaWJsZSB0byBhZGIuXG4gKi9cbmVtdU1ldGhvZHMuaXNFbXVsYXRvckNvbm5lY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIGlzRW11bGF0b3JDb25uZWN0ZWQgKCkge1xuICBsZXQgZW11bGF0b3JzID0gYXdhaXQgdGhpcy5nZXRDb25uZWN0ZWRFbXVsYXRvcnMoKTtcbiAgcmV0dXJuICEhXy5maW5kKGVtdWxhdG9ycywgKHgpID0+IHggJiYgeC51ZGlkID09PSB0aGlzLmN1ckRldmljZUlkKTtcbn07XG5cbi8qKlxuICogVmVyaWZ5IHRoZSBlbXVsYXRvciBpcyBjb25uZWN0ZWQuXG4gKlxuICogQHRocm93cyB7ZXJyb3J9IElmIEVtdWxhdG9yIGlzIG5vdCB2aXNpYmxlIHRvIGFkYi5cbiAqL1xuZW11TWV0aG9kcy52ZXJpZnlFbXVsYXRvckNvbm5lY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUVtdWxhdG9yQ29ubmVjdGVkICgpIHtcbiAgaWYgKCEoYXdhaXQgdGhpcy5pc0VtdWxhdG9yQ29ubmVjdGVkKCkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZW11bGF0b3IgXCIke3RoaXMuY3VyRGV2aWNlSWR9XCIgd2FzIHVuZXhwZWN0ZWRseSBkaXNjb25uZWN0ZWRgKTtcbiAgfVxufTtcblxuLyoqXG4gKiBFbXVsYXRlIGZpbmdlcnByaW50IHRvdWNoIGV2ZW50IG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGZpbmdlcnByaW50SWQgLSBUaGUgSUQgb2YgdGhlIGZpbmdlcnByaW50LlxuICovXG5lbXVNZXRob2RzLmZpbmdlcnByaW50ID0gYXN5bmMgZnVuY3Rpb24gZmluZ2VycHJpbnQgKGZpbmdlcnByaW50SWQpIHtcbiAgaWYgKCFmaW5nZXJwcmludElkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGaW5nZXJwcmludCBpZCBwYXJhbWV0ZXIgbXVzdCBiZSBkZWZpbmVkJyk7XG4gIH1cbiAgLy8gdGhlIG1ldGhvZCB1c2VkIG9ubHkgd29ya3MgZm9yIEFQSSBsZXZlbCAyMyBhbmQgYWJvdmVcbiAgbGV0IGxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuICBpZiAobGV2ZWwgPCAyMykge1xuICAgIHRocm93IG5ldyBFcnJvcihgRGV2aWNlIEFQSSBMZXZlbCBtdXN0IGJlID49IDIzLiBDdXJyZW50IEFwaSBsZXZlbCAnJHtsZXZlbH0nYCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsnZmluZ2VyJywgJ3RvdWNoJywgZmluZ2VycHJpbnRJZF0pO1xufTtcblxuLyoqXG4gKiBDaGFuZ2UgdGhlIGRpc3BsYXkgb3JpZW50YXRpb24gb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqIFRoZSBvcmllbnRhdGlvbiBpcyBjaGFuZ2VkIChQSS8yIGlzIGFkZGVkKSBldmVyeSB0aW1lXG4gKiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQuXG4gKi9cbmVtdU1ldGhvZHMucm90YXRlID0gYXN5bmMgZnVuY3Rpb24gcm90YXRlICgpIHtcbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsncm90YXRlJ10pO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIHBvd2VyIHN0YXRlIGNoYW5nZSBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGF0ZSBbJ29uJ10gLSBFaXRoZXIgJ29uJyBvciAnb2ZmJy5cbiAqL1xuZW11TWV0aG9kcy5wb3dlckFDID0gYXN5bmMgZnVuY3Rpb24gcG93ZXJBQyAoc3RhdGUgPSAnb24nKSB7XG4gIGlmIChfLnZhbHVlcyhlbXVNZXRob2RzLlBPV0VSX0FDX1NUQVRFUykuaW5kZXhPZihzdGF0ZSkgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBXcm9uZyBwb3dlciBBQyBzdGF0ZSBzZW50ICcke3N0YXRlfScuIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoZW11TWV0aG9kcy5QT1dFUl9BQ19TVEFURVMpfV1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydwb3dlcicsICdhYycsIHN0YXRlXSk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgc2Vuc29ycyB2YWx1ZXMgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc2Vuc29yIC0gU2Vuc29yIHR5cGUgZGVjbGFyZWQgaW4gU0VOU09SUyBpdGVtcy5cbiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gdmFsdWUgIC0gTnVtYmVyIHRvIHNldCBhcyB0aGUgc2Vuc29yIHZhbHVlLlxuICogQHRocm93cyB7RXJyb3J9IC0gSWYgc2Vuc29yIHR5cGUgb3Igc2Vuc29yIHZhbHVlIGlzIG5vdCBkZWZpbmVkXG4gKi9cbmVtdU1ldGhvZHMuc2Vuc29yU2V0ID0gYXN5bmMgZnVuY3Rpb24gc2Vuc29yU2V0IChzZW5zb3IsIHZhbHVlKSB7XG4gIGlmICghXy5pbmNsdWRlcyhlbXVNZXRob2RzLlNFTlNPUlMsIHNlbnNvcikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHNlbnNvciBzZW50ICcke3NlbnNvcn0nLiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGVtdU1ldGhvZHMuU0VOU09SUyl9XWApO1xuICB9XG4gIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gIGlmIChpc05hTih2YWx1ZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3Npbmcgc2Vuc29yIHZhbHVlIGFyZ3VtZW50LiBZb3UgbmVlZCB0byBwcm92aWRlIGEgdmFsaWQgbnVtYmVyIHRvIHNldCB0byB0aGUgc2Vuc29yLmApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ3NlbnNvcicsICdzZXQnLCBzZW5zb3IsIHZhbHVlXSk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgcG93ZXIgY2FwYWNpdHkgY2hhbmdlIG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBwZXJjZW50IFsxMDBdIC0gUGVyY2VudGFnZSB2YWx1ZSBpbiByYW5nZSBbMCwgMTAwXS5cbiAqL1xuZW11TWV0aG9kcy5wb3dlckNhcGFjaXR5ID0gYXN5bmMgZnVuY3Rpb24gcG93ZXJDYXBhY2l0eSAocGVyY2VudCA9IDEwMCkge1xuICBwZXJjZW50ID0gcGFyc2VJbnQocGVyY2VudCwgMTApO1xuICBpZiAoaXNOYU4ocGVyY2VudCkgfHwgcGVyY2VudCA8IDAgfHwgcGVyY2VudCA+IDEwMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHBlcmNlbnRhZ2UgdmFsdWUgc2hvdWxkIGJlIHZhbGlkIGludGVnZXIgYmV0d2VlbiAwIGFuZCAxMDBgKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydwb3dlcicsICdjYXBhY2l0eScsIHBlcmNlbnRdKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBwb3dlciBvZmYgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqL1xuZW11TWV0aG9kcy5wb3dlck9GRiA9IGFzeW5jIGZ1bmN0aW9uIHBvd2VyT0ZGICgpIHtcbiAgYXdhaXQgdGhpcy5wb3dlckFDKGVtdU1ldGhvZHMuUE9XRVJfQUNfU1RBVEVTLlBPV0VSX0FDX09GRik7XG4gIGF3YWl0IHRoaXMucG93ZXJDYXBhY2l0eSgwKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBzZW5kIFNNUyBldmVudCBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gcGhvbmVOdW1iZXIgLSBUaGUgcGhvbmUgbnVtYmVyIG9mIG1lc3NhZ2Ugc2VuZGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgWycnXSAtIFRoZSBtZXNzYWdlIGNvbnRlbnQuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgcGhvbmUgbnVtYmVyIGhhcyBpbnZhbGlkIGZvcm1hdC5cbiAqL1xuZW11TWV0aG9kcy5zZW5kU01TID0gYXN5bmMgZnVuY3Rpb24gc2VuZFNNUyAocGhvbmVOdW1iZXIsIG1lc3NhZ2UgPSAnJykge1xuICBtZXNzYWdlID0gbWVzc2FnZS50cmltKCk7XG4gIGlmIChtZXNzYWdlID09PSAnJykge1xuICAgIHRocm93IG5ldyBFcnJvcignU2VuZGluZyBhbiBTTVMgcmVxdWlyZXMgYSBtZXNzYWdlJyk7XG4gIH1cbiAgcGhvbmVOdW1iZXIgPSBgJHtwaG9uZU51bWJlcn1gLnJlcGxhY2UoL1xccyovLCAnJyk7XG4gIGlmICghUEhPTkVfTlVNQkVSX1BBVFRFUk4udGVzdChwaG9uZU51bWJlcikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc2VuZFNNUyBwaG9uZU51bWJlciBwYXJhbSAke3Bob25lTnVtYmVyfWApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ3NtcycsICdzZW5kJywgcGhvbmVOdW1iZXIsIG1lc3NhZ2VdKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBHU00gY2FsbCBldmVudCBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gcGhvbmVOdW1iZXIgLSBUaGUgcGhvbmUgbnVtYmVyIG9mIHRoZSBjYWxsZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uIFsnJ10gLSBPbmUgb2YgYXZhaWxhYmxlIEdTTSBjYWxsIGFjdGlvbnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgcGhvbmUgbnVtYmVyIGhhcyBpbnZhbGlkIGZvcm1hdC5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiBfYWN0aW9uXyB2YWx1ZSBpcyBpbnZhbGlkLlxuICovXG5lbXVNZXRob2RzLmdzbUNhbGwgPSBhc3luYyBmdW5jdGlvbiBnc21DYWxsIChwaG9uZU51bWJlciwgYWN0aW9uID0gJycpIHtcbiAgaWYgKF8udmFsdWVzKGVtdU1ldGhvZHMuR1NNX0NBTExfQUNUSU9OUykuaW5kZXhPZihhY3Rpb24pID09PSAtMSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBnc20gYWN0aW9uIHBhcmFtICR7YWN0aW9ufS4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9DQUxMX0FDVElPTlMpfWApO1xuICB9XG4gIHBob25lTnVtYmVyID0gYCR7cGhvbmVOdW1iZXJ9YC5yZXBsYWNlKC9cXHMqLywgJycpO1xuICBpZiAoIVBIT05FX05VTUJFUl9QQVRURVJOLnRlc3QocGhvbmVOdW1iZXIpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGdzbUNhbGwgcGhvbmVOdW1iZXIgcGFyYW0gJHtwaG9uZU51bWJlcn1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydnc20nLCBhY3Rpb24sIHBob25lTnVtYmVyXSk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgR1NNIHNpZ25hbCBzdHJlbmd0aCBjaGFuZ2UgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHN0cmVuZ3RoIFs0XSAtIEEgbnVtYmVyIGluIHJhbmdlIFswLCA0XTtcbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiBfc3RyZW5ndGhfIHZhbHVlIGlzIGludmFsaWQuXG4gKi9cbmVtdU1ldGhvZHMuZ3NtU2lnbmFsID0gYXN5bmMgZnVuY3Rpb24gZ3NtU2lnbmFsIChzdHJlbmd0aCA9IDQpIHtcbiAgc3RyZW5ndGggPSBwYXJzZUludChzdHJlbmd0aCwgMTApO1xuICBpZiAoZW11TWV0aG9kcy5HU01fU0lHTkFMX1NUUkVOR1RIUy5pbmRleE9mKHN0cmVuZ3RoKSA9PT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc2lnbmFsIHN0cmVuZ3RoIHBhcmFtICR7c3RyZW5ndGh9LiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMpfWApO1xuICB9XG4gIGxvZy5pbmZvKCdnc20gc2lnbmFsLXByb2ZpbGUgPHN0cmVuZ3RoPiBjaGFuZ2VzIHRoZSByZXBvcnRlZCBzdHJlbmd0aCBvbiBuZXh0ICgxNXMpIHVwZGF0ZS4nKTtcbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsnZ3NtJywgJ3NpZ25hbC1wcm9maWxlJywgc3RyZW5ndGhdKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBHU00gdm9pY2UgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RhdGUgWydvbiddIC0gRWl0aGVyICdvbicgb3IgJ29mZicuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgX3N0YXRlXyB2YWx1ZSBpcyBpbnZhbGlkLlxuICovXG5lbXVNZXRob2RzLmdzbVZvaWNlID0gYXN5bmMgZnVuY3Rpb24gZ3NtVm9pY2UgKHN0YXRlID0gJ29uJykge1xuICAvLyBnc20gdm9pY2UgPHN0YXRlPiBhbGxvd3MgeW91IHRvIGNoYW5nZSB0aGUgc3RhdGUgb2YgeW91ciBHUFJTIGNvbm5lY3Rpb25cbiAgaWYgKF8udmFsdWVzKGVtdU1ldGhvZHMuR1NNX1ZPSUNFX1NUQVRFUykuaW5kZXhPZihzdGF0ZSkgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGdzbSB2b2ljZSBzdGF0ZSBwYXJhbSAke3N0YXRlfS4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9WT0lDRV9TVEFURVMpfWApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ2dzbScsICd2b2ljZScsIHN0YXRlXSk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgbmV0d29yayBzcGVlZCBjaGFuZ2UgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3BlZWQgWydmdWxsJ10gLSBPbmUgb2YgcG9zc2libGUgTkVUV09SS19TUEVFRCB2YWx1ZXMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgX3NwZWVkXyB2YWx1ZSBpcyBpbnZhbGlkLlxuICovXG5lbXVNZXRob2RzLm5ldHdvcmtTcGVlZCA9IGFzeW5jIGZ1bmN0aW9uIG5ldHdvcmtTcGVlZCAoc3BlZWQgPSAnZnVsbCcpIHtcbiAgLy8gbmV0d29yayBzcGVlZCA8c3BlZWQ+IGFsbG93cyB5b3UgdG8gc2V0IHRoZSBuZXR3b3JrIHNwZWVkIGVtdWxhdGlvbi5cbiAgaWYgKF8udmFsdWVzKGVtdU1ldGhvZHMuTkVUV09SS19TUEVFRCkuaW5kZXhPZihzcGVlZCkgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG5ldHdvcmsgc3BlZWQgcGFyYW0gJHtzcGVlZH0uIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoZW11TWV0aG9kcy5ORVRXT1JLX1NQRUVEKX1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWyduZXR3b3JrJywgJ3NwZWVkJywgc3BlZWRdKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRXhlY1RlbG5ldE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBleGVjVGltZW91dCBbNjAwMDBdIEEgdGltZW91dCB1c2VkIHRvIHdhaXQgZm9yIGEgc2VydmVyXG4gKiByZXBseSB0byB0aGUgZ2l2ZW4gY29tbWFuZFxuICogQHByb3BlcnR5IHtudW1iZXJ9IGNvbm5UaW1lb3V0IFs1MDAwXSBDb25zb2xlIGNvbm5lY3Rpb24gdGltZW91dCBpbiBtaWxsaXNlY29uZHNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBpbml0VGltZW91dCBbNTAwMF0gVGVsbmV0IGNvbnNvbGUgaW5pdGlhbGl6YXRpb24gdGltZW91dFxuICogaW4gbWlsbGlzZWNvbmRzICh0aGUgdGltZSBiZXR3ZWVuIGNvbm5lY3Rpb24gaGFwcGVucyBhbmQgdGhlIGNvbW1hbmQgcHJvbXB0XG4gKiBpcyBhdmFpbGFibGUpXG4gKiBAcHJvcGVydHkgez9udW1iZXJ8c3RyaW5nfSBwb3J0IFRoZSBlbXVsYXRvciBwb3J0IG51bWJlci4gVGhlIG1ldGhvZCB3aWxsIHRyeSB0byBwYXJzZSBpdFxuICogZnJvbSB0aGUgY3VycmVudCBkZXZpY2UgaWRlbnRpZmllciBpZiB1bnNldFxuICovXG5cbi8qKlxuICogRXhlY3V0ZXMgYSBjb21tYW5kIHRocm91Z2ggZW11bGF0b3IgdGVsbmV0IGNvbnNvbGUgaW50ZXJmYWNlIGFuZCByZXR1cm5zIGl0cyBvdXRwdXRcbiAqXG4gKiBAcGFyYW0ge0FycmF5PHN0cmluZz58c3RyaW5nfSBjbWQgLSBUaGUgYWN0dWFsIGNvbW1hbmQgdG8gZXhlY3V0ZS4gU2VlXG4gKiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9zdHVkaW8vcnVuL2VtdWxhdG9yLWNvbnNvbGUgZm9yIG1vcmUgZGV0YWlsc1xuICogb24gYXZhaWxhYmxlIGNvbW1hbmRzXG4gKiBAcGFyYW0ge0V4ZWNUZWxuZXRPcHRpb25zfSBvcHRzXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY29tbWFuZCBvdXRwdXRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgY29ubmVjdGluZyB0byB0aGUgVGVsbmV0IGNvbnNvbGVcbiAqIG9yIGlmIHRoZSBnaXZlbiBjb21tYW5kIHJldHVybmVkIG5vbi1PSyByZXNwb25zZVxuICovXG5lbXVNZXRob2RzLmV4ZWNFbXVDb25zb2xlQ29tbWFuZCA9IGFzeW5jIGZ1bmN0aW9uIGV4ZWNUZWxuZXQgKGNtZCwgb3B0cyA9IHt9KSB7XG4gIGxldCBwb3J0ID0gcGFyc2VJbnQob3B0cy5wb3J0LCAxMCk7XG4gIGlmICghcG9ydCkge1xuICAgIGNvbnN0IHBvcnRNYXRjaCA9IC9lbXVsYXRvci0oXFxkKykvaS5leGVjKHRoaXMuY3VyRGV2aWNlSWQpO1xuICAgIGlmICghcG9ydE1hdGNoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSB0aGUgY29uc29sZSBwb3J0IG51bWJlciBmcm9tIHRoZSBkZXZpY2UgaWRlbnRpZmllciAnJHt0aGlzLmN1ckRldmljZUlkfScuIGAgK1xuICAgICAgICBgSXMgaXQgYW4gZW11bGF0b3I/YCk7XG4gICAgfVxuICAgIHBvcnQgPSBwYXJzZUludChwb3J0TWF0Y2hbMV0sIDEwKTtcbiAgfVxuICBjb25zdCBob3N0ID0gJzEyNy4wLjAuMSc7XG4gIGNvbnN0IHtcbiAgICBleGVjVGltZW91dCA9IDYwMDAwLFxuICAgIGNvbm5UaW1lb3V0ID0gNTAwMCxcbiAgICBpbml0VGltZW91dCA9IDUwMDAsXG4gIH0gPSBvcHRzO1xuICBhd2FpdCB0aGlzLnJlc2V0VGVsbmV0QXV0aFRva2VuKCk7XG5cbiAgY29uc3Qgb2tGbGFnID0gL15PSyQvbTtcbiAgY29uc3Qgbm9rRmxhZyA9IC9eS09cXGIvbTtcbiAgY29uc3QgZW9sID0gJ1xcclxcbic7XG4gIGNvbnN0IGNsaWVudCA9IG5ldC5jb25uZWN0KHtcbiAgICBob3N0LFxuICAgIHBvcnQsXG4gIH0pO1xuXG4gIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgY29ublRpbWVvdXRPYmogPSBzZXRUaW1lb3V0KFxuICAgICAgKCkgPT4gcmVqZWN0KG5ldyBFcnJvcihgQ2Fubm90IGNvbm5lY3QgdG8gdGhlIEVtdWxhdG9yIGNvbnNvbGUgYXQgJHtob3N0fToke3BvcnR9IGAgK1xuICAgICAgICBgYWZ0ZXIgJHtjb25uVGltZW91dH1tc2ApKSwgY29ublRpbWVvdXQpO1xuICAgIGxldCBleGVjVGltZW91dE9iajtcbiAgICBsZXQgaW5pdFRpbWVvdXRPYmo7XG4gICAgbGV0IGlzQ29tbWFuZFNlbnQgPSBmYWxzZTtcbiAgICBsZXQgc2VydmVyUmVzcG9uc2UgPSBbXTtcblxuICAgIGNsaWVudC5vbmNlKCdlcnJvcicsIChlKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQoY29ublRpbWVvdXRPYmopO1xuICAgICAgcmVqZWN0KG5ldyBFcnJvcihgQ2Fubm90IGNvbm5lY3QgdG8gdGhlIEVtdWxhdG9yIGNvbnNvbGUgYXQgJHtob3N0fToke3BvcnR9LiBgICtcbiAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKSk7XG4gICAgfSk7XG5cbiAgICBjbGllbnQub25jZSgnY29ubmVjdCcsICgpID0+IHtcbiAgICAgIGNsZWFyVGltZW91dChjb25uVGltZW91dE9iaik7XG4gICAgICBpbml0VGltZW91dE9iaiA9IHNldFRpbWVvdXQoXG4gICAgICAgICgpID0+IHJlamVjdChuZXcgRXJyb3IoYERpZCBub3QgZ2V0IHRoZSBpbml0aWFsIHJlc3BvbnNlIGZyb20gdGhlIEVtdWxhdG9yIGNvbnNvbGUgYXQgJHtob3N0fToke3BvcnR9IGAgK1xuICAgICAgICAgIGBhZnRlciAke2luaXRUaW1lb3V0fW1zYCkpLCBpbml0VGltZW91dCk7XG4gICAgfSk7XG5cbiAgICBjbGllbnQub24oJ2RhdGEnLCAoY2h1bmspID0+IHtcbiAgICAgIHNlcnZlclJlc3BvbnNlLnB1c2goY2h1bmspO1xuICAgICAgY29uc3Qgb3V0cHV0ID0gQnVmZmVyLmNvbmNhdChzZXJ2ZXJSZXNwb25zZSkudG9TdHJpbmcoJ3V0ZjgnKS50cmltKCk7XG4gICAgICBpZiAob2tGbGFnLnRlc3Qob3V0cHV0KSkge1xuICAgICAgICAvLyBUaGUgaW5pdGlhbCBpbmNvbWluZyBkYXRhIGNodW5rIGNvbmZpcm1zIHRoZSBpbnRlcmZhY2UgaXMgcmVhZHkgZm9yIGlucHV0XG4gICAgICAgIGlmICghaXNDb21tYW5kU2VudCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dChpbml0VGltZW91dE9iaik7XG4gICAgICAgICAgc2VydmVyUmVzcG9uc2UgPSBbXTtcbiAgICAgICAgICBjb25zdCBjbWRTdHIgPSBfLmlzQXJyYXkoY21kKSA/IHV0aWwucXVvdGUoY21kKSA6IGAke2NtZH1gO1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgRXhlY3V0aW5nIEVtdWxhdG9yIGNvbnNvbGUgY29tbWFuZDogJHtjbWRTdHJ9YCk7XG4gICAgICAgICAgY2xpZW50LndyaXRlKGNtZFN0cik7XG4gICAgICAgICAgY2xpZW50LndyaXRlKGVvbCk7XG4gICAgICAgICAgaXNDb21tYW5kU2VudCA9IHRydWU7XG4gICAgICAgICAgZXhlY1RpbWVvdXRPYmogPSBzZXRUaW1lb3V0KFxuICAgICAgICAgICAgKCkgPT4gcmVqZWN0KG5ldyBFcnJvcihgRGlkIG5vdCBnZXQgYW55IHJlc3BvbnNlIGZyb20gdGhlIEVtdWxhdG9yIGNvbnNvbGUgYXQgJHtob3N0fToke3BvcnR9IGAgK1xuICAgICAgICAgICAgICBgdG8gJyR7Y21kfScgY29tbWFuZCBhZnRlciAke2V4ZWNUaW1lb3V0fW1zYCkpLCBleGVjVGltZW91dCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNsZWFyVGltZW91dChleGVjVGltZW91dE9iaik7XG4gICAgICAgIGNsaWVudC5lbmQoKTtcbiAgICAgICAgY29uc3Qgb3V0cHV0QXJyID0gb3V0cHV0LnNwbGl0KGVvbCk7XG4gICAgICAgIC8vIHJlbW92ZSB0aGUgcmVkdW5kYW50IE9LIGZsYWcgZnJvbSB0aGUgcmVzdWx0aW5nIGNvbW1hbmQgb3V0cHV0XG4gICAgICAgIHJldHVybiByZXNvbHZlKG91dHB1dEFyci5zbGljZSgwLCBvdXRwdXRBcnIubGVuZ3RoIC0gMSkuam9pbignXFxuJykudHJpbSgpKTtcbiAgICAgIH0gZWxzZSBpZiAobm9rRmxhZy50ZXN0KG91dHB1dCkpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGluaXRUaW1lb3V0T2JqKTtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGV4ZWNUaW1lb3V0T2JqKTtcbiAgICAgICAgY2xpZW50LmVuZCgpO1xuICAgICAgICBjb25zdCBvdXRwdXRBcnIgPSBvdXRwdXQuc3BsaXQoZW9sKTtcbiAgICAgICAgcmV0dXJuIHJlamVjdChfLnRyaW0oXy5sYXN0KG91dHB1dEFycikpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEVtdVZlcnNpb25JbmZvXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHJldmlzaW9uIFRoZSBhY3R1YWwgcmV2aXNpb24gbnVtYmVyLCBmb3IgZXhhbXBsZSAnMzAuMC41J1xuICogQHByb3BlcnR5IHs/bnVtYmVyfSBidWlsZElkIFRoZSBidWlsZCBpZGVudGlmaWVyLCBmb3IgZXhhbXBsZSA2MzA2MDQ3XG4gKi9cblxuLyoqXG4gKiBSZXRyaWV2ZXMgZW11bGF0b3IgdmVyc2lvbiBmcm9tIHRoZSBmaWxlIHN5c3RlbVxuICpcbiAqIEByZXR1cm5zIHtFbXVWZXJzaW9uSW5mb30gSWYgbm8gdmVyc2lvbiBpbmZvIGNvdWxkIGJlIHBhcnNlZCB0aGVuIGFuIGVtcHR5XG4gKiBvYmplY3QgaXMgcmV0dXJuZWRcbiAqL1xuZW11TWV0aG9kcy5nZXRFbXVWZXJzaW9uSW5mbyA9IGFzeW5jIGZ1bmN0aW9uIGdldEVtdVZlcnNpb25JbmZvICgpIHtcbiAgY29uc3QgcHJvcHNQYXRoID0gcGF0aC5qb2luKHRoaXMuc2RrUm9vdCwgJ2VtdWxhdG9yJywgJ3NvdXJjZS5wcm9wZXJ0aWVzJyk7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKHByb3BzUGF0aCkpIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCBjb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUocHJvcHNQYXRoLCAndXRmOCcpO1xuICBjb25zdCByZXZpc2lvbk1hdGNoID0gL15Qa2dcXC5SZXZpc2lvbj0oW1xcZC5dKykkL20uZXhlYyhjb250ZW50KTtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGlmIChyZXZpc2lvbk1hdGNoKSB7XG4gICAgcmVzdWx0LnJldmlzaW9uID0gcmV2aXNpb25NYXRjaFsxXTtcbiAgfVxuICBjb25zdCBidWlsZElkTWF0Y2ggPSAvXlBrZ1xcLkJ1aWxkSWQ9KFxcZCspJC9tLmV4ZWMoY29udGVudCk7XG4gIGlmIChidWlsZElkTWF0Y2gpIHtcbiAgICByZXN1bHQuYnVpbGRJZCA9IHBhcnNlSW50KGJ1aWxkSWRNYXRjaFsxXSwgMTApO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG4vKipcbiAqIFJldHJpZXZlcyBlbXVsYXRvciBpbWFnZSBwcm9wZXJ0aWVzIGZyb20gdGhlIGxvY2FsIGZpbGUgc3lzdGVtXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGF2ZE5hbWUgRW11bGF0b3IgbmFtZS4gU2hvdWxkIE5PVCBzdGFydCB3aXRoICdAJyBjaGFyYWN0ZXJcbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIGV4dHJhY3RpbmcgdGhlIHByb3BlcnRpZXNcbiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBjb250ZW50IG9mIGVtdWxhdG9yIGltYWdlIHByb3BlcnRpZXMgZmlsZS5cbiAqIFVzdWFsbHkgdGhpcyBjb25maWd1cmF0aW9uIC5pbmkgZmlsZSBoYXMgdGhlIGZvbGxvd2luZyBjb250ZW50OlxuICogICBhdmQuaW5pLmVuY29kaW5nPVVURi04XG4gKiAgIHBhdGg9L1VzZXJzL3VzZXJuYW1lLy5hbmRyb2lkL2F2ZC9QaXhlbF9YTF9BUElfMzAuYXZkXG4gKiAgIHBhdGgucmVsPWF2ZC9QaXhlbF9YTF9BUElfMzAuYXZkXG4gKiAgIHRhcmdldD1hbmRyb2lkLTMwXG4gKi9cbmVtdU1ldGhvZHMuZ2V0RW11SW1hZ2VQcm9wZXJ0aWVzID0gYXN5bmMgZnVuY3Rpb24gZ2V0RW11SW1hZ2VQcm9wZXJ0aWVzIChhdmROYW1lKSB7XG4gIGNvbnN0IGF2ZHMgPSBhd2FpdCBsaXN0RW11bGF0b3JzKCk7XG4gIGNvbnN0IGF2ZCA9IGF2ZHMuZmluZCgoe25hbWV9KSA9PiBuYW1lID09PSBhdmROYW1lKTtcbiAgaWYgKCFhdmQpIHtcbiAgICBsZXQgbXNnID0gYENhbm5vdCBmaW5kICcke2F2ZE5hbWV9JyBlbXVsYXRvci4gYDtcbiAgICBpZiAoXy5pc0VtcHR5KGF2ZHMpKSB7XG4gICAgICBtc2cgKz0gYE5vIGVtdWxhdG9ycyBoYXZlIGJlZW4gZGV0ZWN0ZWQgb24geW91ciBzeXN0ZW1gO1xuICAgIH0gZWxzZSB7XG4gICAgICBtc2cgKz0gYEF2YWlsYWJsZSBhdmQgbmFtZXMgYXJlOiAke2F2ZHMubWFwKCh7bmFtZX0pID0+IG5hbWUpfWA7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICB9XG4gIHJldHVybiBpbmkucGFyc2UoYXdhaXQgZnMucmVhZEZpbGUoYXZkLmNvbmZpZywgJ3V0ZjgnKSk7XG59O1xuXG4vKipcbiAqIENoZWNrIGlmIGdpdmVuIGVtdWxhdG9yIGV4aXN0cyBpbiB0aGUgbGlzdCBvZiBhdmFpbGFibGUgYXZkcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXZkTmFtZSAtIFRoZSBuYW1lIG9mIGVtdWxhdG9yIHRvIHZlcmlmeSBmb3IgZXhpc3RlbmNlLlxuICogU2hvdWxkIE5PVCBzdGFydCB3aXRoICdAJyBjaGFyYWN0ZXJcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgZW11bGF0b3Igd2l0aCBnaXZlbiBuYW1lIGRvZXMgbm90IGV4aXN0LlxuICovXG5lbXVNZXRob2RzLmNoZWNrQXZkRXhpc3QgPSBhc3luYyBmdW5jdGlvbiBjaGVja0F2ZEV4aXN0IChhdmROYW1lKSB7XG4gIGNvbnN0IGF2ZHMgPSBhd2FpdCBsaXN0RW11bGF0b3JzKCk7XG4gIGlmICghYXZkcy5zb21lKCh7bmFtZX0pID0+IG5hbWUgPT09IGF2ZE5hbWUpKSB7XG4gICAgbGV0IG1zZyA9IGBBdmQgJyR7YXZkTmFtZX0nIGlzIG5vdCBhdmFpbGFibGUuIGA7XG4gICAgaWYgKF8uaXNFbXB0eShhdmRzKSkge1xuICAgICAgbXNnICs9IGBObyBlbXVsYXRvcnMgaGF2ZSBiZWVuIGRldGVjdGVkIG9uIHlvdXIgc3lzdGVtYDtcbiAgICB9IGVsc2Uge1xuICAgICAgbXNnICs9IGBQbGVhc2Ugc2VsZWN0IHlvdXIgYXZkIG5hbWUgZnJvbSBvbmUgb2YgdGhlc2U6ICcke2F2ZHMubWFwKCh7bmFtZX0pID0+IG5hbWUpfSdgO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGVtdU1ldGhvZHM7XG4iXSwiZmlsZSI6ImxpYi90b29scy9hZGItZW11LWNvbW1hbmRzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
