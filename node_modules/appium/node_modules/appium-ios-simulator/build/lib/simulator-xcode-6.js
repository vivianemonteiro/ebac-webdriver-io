"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SimulatorXcode6 = exports.SPRINGBOARD_BUNDLE_ID = exports.BOOT_COMPLETED_EVENT = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _appiumXcode = _interopRequireWildcard(require("appium-xcode"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils.js");

var _asyncbox = require("asyncbox");

var settings = _interopRequireWildcard(require("./settings"));

var _teen_process = require("teen_process");

var _tailUntil = require("./tail-until.js");

var _index = _interopRequireDefault(require("./extensions/index"));

var _events = require("events");

var _calendar = _interopRequireDefault(require("./calendar"));

var _permissions = _interopRequireDefault(require("./permissions"));

var _nodeSimctl = _interopRequireDefault(require("node-simctl"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const STARTUP_TIMEOUT = 60 * 1000;
const EXTRA_STARTUP_TIME = 2000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
const SPRINGBOARD_BUNDLE_ID = 'com.apple.SpringBoard';
exports.SPRINGBOARD_BUNDLE_ID = SPRINGBOARD_BUNDLE_ID;
const BOOT_COMPLETED_EVENT = 'bootCompleted';
exports.BOOT_COMPLETED_EVENT = BOOT_COMPLETED_EVENT;

class SimulatorXcode6 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super();
    this.udid = String(udid);
    this.simctl = new _nodeSimctl.default({
      udid: this.udid
    });
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this.simulatorApp = 'iOS Simulator.app';
    this.appDataBundlePaths = {};
    this.isFreshFiles = ['Library/ConfigurationProfiles', 'Library/Cookies', 'Library/Preferences/.GlobalPreferences.plist', 'Library/Preferences/com.apple.springboard.plist', 'var/run/syslog.pid'];
    this.extraStartupTime = EXTRA_STARTUP_TIME;
    this.calendar = new _calendar.default(xcodeVersion, this.getDir());
    this.permissions = new _permissions.default(xcodeVersion, this.getDir(), this.udid);
  }

  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }

  get devicesSetPath() {
    return this.simctl.devicesSetPath;
  }

  set devicesSetPath(value) {
    this.simctl.devicesSetPath = value;
  }

  async getUIClientPid() {
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${this.simulatorApp}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }

    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }

    stdout = stdout.trim();

    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);

    return stdout;
  }

  async isUIClientRunning() {
    return !_lodash.default.isNull(await this.getUIClientPid());
  }

  get startupTimeout() {
    return STARTUP_TIMEOUT;
  }

  async getPlatformVersion() {
    if (!this._platformVersion) {
      let {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }

    return this._platformVersion;
  }

  getRootDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }

  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }

  getLogDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }

  async installApp(app) {
    return await this.simctl.installApp(app);
  }

  async isAppInstalled(bundleId, appFile = null) {
    let appDirs = await this.getAppDirs(appFile, bundleId);
    return appDirs.length !== 0;
  }

  async getUserInstalledBundleIdsByBundleName(bundleName) {
    const rootUserAppDir = await this.buildBundlePathMap('Bundle');
    const bundleIds = [];

    if (_lodash.default.isEmpty(rootUserAppDir)) {
      return bundleIds;
    }

    for (const [bundleId, userAppDirPath] of Object.entries(rootUserAppDir)) {
      const appFile = (await _appiumSupport.fs.readdir(userAppDirPath)).find(file => _path.default.extname(file).toLowerCase() === '.app');

      const infoPlistPath = _path.default.resolve(userAppDirPath, appFile, 'Info.plist');

      if (!(await _appiumSupport.fs.exists(infoPlistPath))) {
        continue;
      }

      try {
        const infoPlist = await _appiumSupport.plist.parsePlistFile(infoPlistPath, false);

        if (infoPlist.CFBundleName === bundleName) {
          bundleIds.push(bundleId);
        }
      } catch (err) {
        _logger.default.warn(`Failed to read plist ${infoPlistPath}. Original error '${err.message}'`);

        continue;
      }
    }

    _logger.default.debug(`The simulator has '${bundleIds.length}' bundles which have '${bundleName}' as their 'CFBundleName':`);

    for (const bundleId of bundleIds) {
      _logger.default.debug(`    '${bundleId}'`);
    }

    return bundleIds;
  }

  async getAppDir(id, subDir = 'Data') {
    this.appDataBundlePaths[subDir] = this.appDataBundlePaths[subDir] || {};

    if (_lodash.default.isEmpty(this.appDataBundlePaths[subDir]) && !(await this.isFresh())) {
      this.appDataBundlePaths[subDir] = await this.buildBundlePathMap(subDir);
    }

    return this.appDataBundlePaths[subDir][id];
  }

  async buildBundlePathMap(subDir = 'Data') {
    _logger.default.debug('Building bundle path map');

    let applicationList;
    let pathBundlePair;

    if ((await this.getPlatformVersion()) === '7.1') {
      applicationList = _path.default.resolve(this.getDir(), 'Applications');

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let appFiles = await _appiumSupport.fs.glob(`${dir}/*.app`);
        let bundleId = appFiles[0].match(/.*\/(.*)\.app/)[1];
        return {
          path: dir,
          bundleId
        };
      };
    } else {
      applicationList = _path.default.resolve(this.getDir(), 'Containers', subDir, 'Application');

      let readBundleId = async dir => {
        let plist = _path.default.resolve(dir, '.com.apple.mobile_container_manager.metadata.plist');

        let metadata = await settings.read(plist);
        return metadata.MCMMetadataIdentifier;
      };

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let bundleId = await readBundleId(dir);
        return {
          path: dir,
          bundleId
        };
      };
    }

    if (!(await _appiumSupport.fs.exists(applicationList))) {
      _logger.default.warn(`No directory path '${applicationList}'`);

      return {};
    }

    let bundlePathDirs = await _appiumSupport.fs.readdir(applicationList);
    let bundlePathPairs = await (0, _asyncbox.asyncmap)(bundlePathDirs, async function (dir) {
      return await pathBundlePair(dir);
    }, false);
    return bundlePathPairs.reduce((bundleMap, bundlePath) => {
      bundleMap[bundlePath.bundleId] = bundlePath.path;
      return bundleMap;
    }, {});
  }

  async stat() {
    for (let [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }

    return {};
  }

  async isFresh() {
    let files = this.isFreshFiles;
    let pv = await this.getPlatformVersion();

    if (pv !== '7.1') {
      files.push('Library/Preferences/com.apple.Preferences.plist');
    } else {
      files.push('Applications');
    }

    const dir = this.getDir();
    files = files.map(s => _path.default.resolve(dir, s));
    const existences = await (0, _asyncbox.asyncmap)(files, async f => await _appiumSupport.fs.hasAccess(f));
    const fresh = _lodash.default.compact(existences).length !== files.length;

    _logger.default.debug(`Checking whether simulator has been run before: ${fresh ? 'no' : 'yes'}`);

    return fresh;
  }

  async isRunning() {
    try {
      await this.simctl.getEnv('dummy');
      return true;
    } catch (e) {
      return false;
    }
  }

  async isShutdown() {
    try {
      await this.simctl.getEnv('dummy');
      return false;
    } catch (e) {
      return _lodash.default.includes(e.stderr, 'Current state: Shutdown');
    }
  }

  async waitForBoot(startupTimeout) {
    let bootedIndicator = await this.getBootedIndicatorString();
    await this.tailLogsUntil(bootedIndicator, startupTimeout);

    _logger.default.debug(`Waiting an extra ${this.extraStartupTime}ms for the simulator to really finish booting`);

    await _bluebird.default.delay(this.extraStartupTime);

    _logger.default.debug('Done waiting extra time for simulator');

    this.emit(BOOT_COMPLETED_EVENT);
  }

  async getBootedIndicatorString() {
    let indicator;
    let platformVersion = await this.getPlatformVersion();

    switch (platformVersion) {
      case '7.1':
      case '8.1':
      case '8.2':
      case '8.3':
      case '8.4':
        indicator = 'profiled: Service starting...';
        break;

      case '9.0':
      case '9.1':
      case '9.2':
      case '9.3':
        indicator = 'System app "com.apple.springboard" finished startup';
        break;

      case '10.0':
        indicator = 'Switching to keyboard';
        break;

      default:
        _logger.default.warn(`No boot indicator case for platform version '${platformVersion}'`);

        indicator = 'no boot indicator string available';
    }

    return indicator;
  }

  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);

    _lodash.default.defaultsDeep(opts, {
      scaleFactor: null,
      startupTimeout: this.startupTimeout
    });

    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', this.simulatorApp);

    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];

    if (opts.scaleFactor) {
      const {
        name
      } = await this.stat();
      const formattedDeviceName = name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }

    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);

    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }

      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }

  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const isServerRunning = await this.isRunning();
    const isUIClientRunning = await this.isUIClientRunning();

    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);

      return;
    }

    const timer = new _appiumSupport.timing.Timer().start();

    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }

    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);

    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
  }

  async clean() {
    await this.endSimulatorDaemon();

    _logger.default.info(`Cleaning simulator ${this.udid}`);

    await this.simctl.eraseDevice(10000);
  }

  async scrubCustomApp(appFile, appBundleId) {
    return await this.cleanCustomApp(appFile, appBundleId, true);
  }

  async cleanCustomApp(appFile, appBundleId, scrub = false) {
    _logger.default.debug(`Cleaning app data files for '${appFile}', '${appBundleId}'`);

    if (!scrub) {
      _logger.default.debug(`Deleting app altogether`);
    }

    let appDirs = await this.getAppDirs(appFile, appBundleId, scrub);

    if (appDirs.length === 0) {
      _logger.default.debug('Could not find app directories to delete. It is probably not installed');

      return;
    }

    let deletePromises = [];

    for (let dir of appDirs) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(dir));
    }

    if ((await this.getPlatformVersion()) >= 8) {
      let relRmPath = `Library/Preferences/${appBundleId}.plist`;

      let rmPath = _path.default.resolve(this.getRootDir(), relRmPath);

      _logger.default.debug(`Deleting file: '${rmPath}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(rmPath));
    }

    await _bluebird.default.all(deletePromises);
  }

  async getAppDirs(appFile, appBundleId, scrub = false) {
    let dirs = [];

    if ((await this.getPlatformVersion()) >= 8) {
      let data = await this.getAppDir(appBundleId);
      if (!data) return dirs;
      let bundle = !scrub ? await this.getAppDir(appBundleId, 'Bundle') : undefined;

      for (let src of [data, bundle]) {
        if (src) {
          dirs.push(src);
        }
      }
    } else {
      let data = await this.getAppDir(appFile);

      if (data) {
        dirs.push(data);
      }
    }

    return dirs;
  }

  async launchAndQuit(safari = false, startupTimeout = this.startupTimeout) {
    _logger.default.debug('Attempting to launch and quit the simulator, to create directory structure');

    _logger.default.debug(`Will launch with Safari? ${safari}`);

    await this.run({
      startupTimeout
    });

    if (safari) {
      await this.openUrl('http://www.appium.io');
    }

    try {
      await (0, _asyncbox.retryInterval)(60, 250, async () => {
        if (await this.isFresh()) {
          throw new Error('Simulator files not fully created. Waiting a bit');
        }
      });
    } catch (err) {
      _logger.default.warn(`Timeout waiting for simulator files to be created. Continuing`);
    }

    await this.shutdown();
  }

  async endSimulatorDaemon() {
    _logger.default.debug(`Killing any simulator daemons for ${this.udid}`);

    let launchctlCmd = `launchctl list | grep ${this.udid} | cut -f 3 | xargs -n 1 launchctl`;

    try {
      let stopCmd = `${launchctlCmd} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      let removeCmd = `${launchctlCmd} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        let {
          stdout
        } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep ${this.udid} | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
        return stdout.trim().length === 0;
      }, {
        waitMs: 10000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end simulator daemon for ${this.udid}: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }
  }

  async shutdown(opts = {}) {
    if (await this.isShutdown()) {
      return;
    }

    await (0, _asyncbox.retryInterval)(5, 500, this.simctl.shutdownDevice.bind(this.simctl));
    const waitMs = parseInt(opts.timeout, 10);

    if (waitMs > 0) {
      try {
        await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
          waitMs,
          intervalMs: 100
        });
      } catch (err) {
        throw new Error(`Simulator is not in 'Shutdown' state after ${waitMs}ms`);
      }
    }
  }

  async delete() {
    await this.simctl.deleteDevice();
  }

  async updateSettings(plist, updates) {
    return await settings.updateSettings(this, plist, updates);
  }

  async updateLocationSettings(bundleId, authorized) {
    return await settings.updateLocationSettings(this, bundleId, authorized);
  }

  async setReduceMotion(reduceMotion = true) {
    if (await this.isFresh()) {
      await this.launchAndQuit(false, STARTUP_TIMEOUT);
    }

    await settings.setReduceMotion(this, reduceMotion);
  }

  async setAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to set UI appearance`);
  }

  async getAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to get UI appearance`);
  }

  async updateSafariSettings(updates) {
    let updated = await settings.updateSafariUserSettings(this, updates);
    return (await settings.updateSettings(this, 'mobileSafari', updates)) || updated;
  }

  async updateSafariGlobalSettings(updates) {
    return await settings.updateSafariGlobalSettings(this, updates);
  }

  async updateLocale(language, locale, calendarFormat) {
    return await settings.updateLocale(this, language, locale, calendarFormat);
  }

  async deleteSafari() {
    _logger.default.debug('Deleting Safari apps from simulator');

    let dirs = [];
    dirs.push(await this.getAppDir('com.apple.mobilesafari'));
    let pv = await this.getPlatformVersion();

    if (pv >= 8) {
      dirs.push(await this.getAppDir('com.apple.mobilesafari', 'Bundle'));
    }

    let deletePromises = [];

    for (let dir of _lodash.default.compact(dirs)) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(dir));
    }

    await _bluebird.default.all(deletePromises);
  }

  async cleanSafari(keepPrefs = true) {
    _logger.default.debug('Cleaning mobile safari data files');

    if (await this.isFresh()) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let libraryDir = _path.default.resolve(this.getDir(), 'Library');

    let safariRoot = await this.getAppDir('com.apple.mobilesafari');

    if (!safariRoot) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let safariLibraryDir = _path.default.resolve(safariRoot, 'Library');

    let filesToDelete = ['Caches/Snapshots/com.apple.mobilesafari', 'Caches/com.apple.mobilesafari/*', 'Caches/com.apple.WebAppCache/*', 'Caches/com.apple.WebKit.Networking/*', 'Caches/com.apple.WebKit.WebContent/*', 'Image Cache/*', 'WebKit/com.apple.mobilesafari/*', 'WebKit/GeolocationSites.plist', 'WebKit/LocalStorage/*.*', 'Safari/*', 'Cookies/*.binarycookies', 'Caches/com.apple.UIStatusBar/*', 'Caches/com.apple.keyboards/images/*', 'Caches/com.apple.Safari.SafeBrowsing/*', '../tmp/com.apple.mobilesafari/*'];
    let deletePromises = [];

    for (let file of filesToDelete) {
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(libraryDir, file)));
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(safariLibraryDir, file)));
    }

    if (!keepPrefs) {
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(safariLibraryDir, 'Preferences/*.plist')));
    }

    await _bluebird.default.all(deletePromises);
  }

  async removeApp(bundleId) {
    await this.simctl.removeApp(bundleId);
  }

  async moveBuiltInApp(appName, appPath, newAppPath) {
    await (0, _utils.safeRimRaf)(newAppPath);
    await _appiumSupport.fs.copyFile(appPath, newAppPath);

    _logger.default.debug(`Copied '${appName}' to '${newAppPath}'`);

    await _appiumSupport.fs.rimraf(appPath);

    _logger.default.debug(`Temporarily deleted original app at '${appPath}'`);

    return [newAppPath, appPath];
  }

  async openUrl(url) {
    const SAFARI_BOOTED_INDICATOR = 'MobileSafari[';
    const SAFARI_STARTUP_TIMEOUT = 15 * 1000;
    const EXTRA_STARTUP_TIME = 3 * 1000;

    if (await this.isRunning()) {
      await (0, _asyncbox.retry)(5000, this.simctl.openUrl.bind(this.simctl), url);
      await this.tailLogsUntil(SAFARI_BOOTED_INDICATOR, SAFARI_STARTUP_TIMEOUT);

      _logger.default.debug(`Safari started, waiting ${EXTRA_STARTUP_TIME}ms for it to fully start`);

      await _bluebird.default.delay(EXTRA_STARTUP_TIME);

      _logger.default.debug('Done waiting for Safari');

      return;
    } else {
      throw new Error('Tried to open a url, but the Simulator is not Booted');
    }
  }

  async clearCaches(...folderNames) {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');

    if (!(await _appiumSupport.fs.hasAccess(cachesRoot))) {
      _logger.default.debug(`Caches root at '${cachesRoot}' does not exist or is not accessible. Nothing to do there`);

      return 0;
    }

    let itemsToRemove = folderNames.length ? folderNames : await _appiumSupport.fs.readdir(cachesRoot);
    itemsToRemove = itemsToRemove.map(x => _path.default.resolve(cachesRoot, x));

    if (folderNames.length) {
      itemsToRemove = await _bluebird.default.filter(itemsToRemove, x => _appiumSupport.fs.hasAccess(x));
    }

    itemsToRemove = await _bluebird.default.filter(itemsToRemove, async x => (await _appiumSupport.fs.stat(x)).isDirectory());

    if (!itemsToRemove.length) {
      _logger.default.debug(`No Simulator cache items for cleanup were matched in '${cachesRoot}'`);

      return 0;
    }

    _logger.default.debug(`Matched ${_appiumSupport.util.pluralize('simulator cache item', itemsToRemove.length, true)} ` + `for cleanup: ${itemsToRemove}`);

    try {
      await _bluebird.default.all(itemsToRemove, x => _appiumSupport.fs.rimraf(x));
    } catch (e) {
      _logger.default.warn(`Got an exception while cleaning Simulator caches: ${e.message}`);
    }

    return itemsToRemove.length;
  }

  async tailLogsUntil(bootedIndicator, timeoutMs) {
    let simLog = _path.default.resolve(this.getLogDir(), 'system.log');

    await (0, _asyncbox.retryInterval)(200, 200, async () => {
      let exists = await _appiumSupport.fs.exists(simLog);

      if (!exists) {
        throw new Error(`Could not find Simulator log: '${simLog}'`);
      }
    });

    _logger.default.info(`Simulator log at '${simLog}'`);

    _logger.default.info(`Tailing simulator logs until we encounter the string "${bootedIndicator}"`);

    _logger.default.info(`We will time out after ${timeoutMs}ms`);

    try {
      await (0, _tailUntil.tailUntil)(simLog, bootedIndicator, timeoutMs);
    } catch (err) {
      _logger.default.debug('Simulator startup timed out. Continuing anyway.');
    }
  }

  async enableCalendarAccess(bundleID) {
    await this.calendar.enableCalendarAccess(bundleID);
  }

  async disableCalendarAccess(bundleID) {
    await this.calendar.disableCalendarAccess(bundleID);
  }

  async hasCalendarAccess(bundleID) {
    return await this.calendar.hasCalendarAccess(bundleID);
  }

  async _activateWindow() {
    const pid = await this.getUIClientPid();

    if (pid) {
      try {
        return await (0, _utils.activateApp)(pid);
      } catch (e) {
        _logger.default.debug(e.stderr || e.message);
      }
    }

    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }

  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;

    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);

    return await UI_CLIENT_ACCESS_GUARD.acquire(this.simulatorApp, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. ` + `Original error: ${err.message}`);
      }
    });
  }

  async isBiometricEnrolled() {
    const output = await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
        end tell
      end tell
    `);

    _logger.default.debug(`Touch ID enrolled state: ${output}`);

    return _lodash.default.isString(output) && output.trim() === 'true';
  }

  async enrollBiometric(isEnabled = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
          if ${isEnabled ? 'not ' : ''}isChecked then
            click dstMenuItem
          end if
        end tell
      end tell
    `);
  }

  async sendBiometricMatch(shouldMatch = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "${shouldMatch ? 'Matching' : 'Non-matching'}" of menu 1 of menu item "Simulate Finger Touch" of menu 1 of menu bar item "Hardware" of menu bar 1
          click dstMenuItem
        end tell
      end tell
    `);
  }

  async dismissDatabaseAlert(increase = true) {
    let button = increase ? 'Increase' : 'Cancel';

    _logger.default.debug(`Attempting to dismiss database alert with '${button}' button`);

    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          click button "${button}" of window 1
        end tell
      end tell
    `);
  }

  async backupKeychains() {
    if (!(await _appiumSupport.fs.exists(this.keychainPath))) {
      return false;
    }

    const backupPath = await _appiumSupport.tempDir.path({
      prefix: `keychains_backup_${Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1)}`,
      suffix: '.zip'
    });
    const zipArgs = ['-r', backupPath, `${this.keychainPath}${_path.default.sep}`];

    _logger.default.debug(`Creating keychains backup with 'zip ${zipArgs.join(' ')}' command`);

    await (0, _teen_process.exec)('zip', zipArgs);

    if (_lodash.default.isString(this._keychainsBackupPath) && (await _appiumSupport.fs.exists(this._keychainsBackupPath))) {
      await _appiumSupport.fs.unlink(this._keychainsBackupPath);
    }

    this._keychainsBackupPath = backupPath;
    return true;
  }

  async restoreKeychains(excludePatterns = []) {
    if (!_lodash.default.isString(this._keychainsBackupPath) || !(await _appiumSupport.fs.exists(this._keychainsBackupPath))) {
      throw new Error(`The keychains backup archive does not exist. ` + `Are you sure it was created before?`);
    }

    if (_lodash.default.isString(excludePatterns)) {
      excludePatterns = excludePatterns.split(',').map(x => x.trim());
    }

    const isServerRunning = await this.isRunning();
    let plistPath;

    if (isServerRunning) {
      plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

      if (!(await _appiumSupport.fs.exists(plistPath))) {
        throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
      }

      await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);
    }

    try {
      await _appiumSupport.fs.rimraf(this.keychainPath);
      await (0, _appiumSupport.mkdirp)(this.keychainPath);
      const unzipArgs = ['-o', this._keychainsBackupPath, ..._lodash.default.flatMap(excludePatterns.map(x => ['-x', x])), '-d', '/'];

      _logger.default.debug(`Restoring keychains with 'unzip ${unzipArgs.join(' ')}' command`);

      await (0, _teen_process.exec)('unzip', unzipArgs);
      await _appiumSupport.fs.unlink(this._keychainsBackupPath);
      this._keychainsBackupPath = null;
    } finally {
      if (isServerRunning && plistPath) {
        await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
      }
    }

    return true;
  }

  async clearKeychains() {
    const plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

    if (!(await _appiumSupport.fs.exists(plistPath))) {
      throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
    }

    await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);

    try {
      if (await _appiumSupport.fs.exists(this.keychainPath)) {
        await _appiumSupport.fs.rimraf(this.keychainPath);
        await (0, _appiumSupport.mkdirp)(this.keychainPath);
      }
    } finally {
      await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
    }
  }

  async ps() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['launchctl', 'print', 'system']);
    const servicesMatch = /^\s*services\s*=\s*{([^}]+)/m.exec(stdout);

    if (!servicesMatch) {
      _logger.default.debug(stdout);

      throw new Error(`The list of active processes cannot be retrieved`);
    }

    const result = [];
    const pattern = /^\s*(\d+)\s+[\d-]+\s+([\w\-.]+:)?([\w\-.]+)/gm;
    let match;

    while (match = pattern.exec(servicesMatch[1])) {
      result.push({
        pid: parseInt(match[1], 10),
        group: _lodash.default.trimEnd(match[2], ':') || null,
        name: match[3]
      });
    }

    return result;
  }

  async setPermission(bundleId, permission, value) {
    await this.setPermissions(bundleId, {
      [permission]: value
    });
  }

  async setPermissions(bundleId, permissionsMapping) {
    _logger.default.debug(`Setting access for '${bundleId}': ` + JSON.stringify(permissionsMapping, null, 2));

    await this.permissions.setAccess(bundleId, permissionsMapping);
  }

  async getPermission(bundleId, serviceName) {
    const result = await this.permissions.getAccess(bundleId, serviceName);

    _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);

    return result;
  }

  async addCertificate(payload) {
    if (await (0, _utils.hasSSLCert)(payload, this.udid)) {
      _logger.default.info(`SSL certificate '${_lodash.default.truncate(payload, {
        length: 20
      })}' already installed`);

      return false;
    }

    _logger.default.info(`Installing SSL root certificate '${_lodash.default.truncate(payload, {
      length: 20
    })}'`);

    await (0, _utils.installSSLCert)(payload, this.udid);
    return true;
  }

  async pushNotification() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to push notifications`);
  }

  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/LaunchDaemons');
  }

  static async _getDeviceStringPlatformVersion(platformVersion) {
    let reqVersion = platformVersion;

    if (!reqVersion) {
      reqVersion = await _appiumXcode.default.getMaxIOSSDK();

      _logger.default.warn(`No platform version set. Using max SDK version: ${reqVersion}`);

      if (!_lodash.default.isString(reqVersion)) {
        reqVersion = reqVersion % 1 ? String(reqVersion) : `${reqVersion}.0`;
      }
    }

    return reqVersion;
  }

  static async _getDeviceStringVersionString(platformVersion) {
    let reqVersion = await this._getDeviceStringPlatformVersion(platformVersion);
    return `(${reqVersion} Simulator)`;
  }

  static _getDeviceStringConfigFix() {
    return {
      'iPad Simulator (7.1 Simulator)': 'iPad 2 (7.1 Simulator)',
      'iPad Simulator (8.0 Simulator)': 'iPad 2 (8.0 Simulator)',
      'iPad Simulator (8.1 Simulator)': 'iPad 2 (8.1 Simulator)',
      'iPad Simulator (8.2 Simulator)': 'iPad 2 (8.2 Simulator)',
      'iPad Simulator (8.3 Simulator)': 'iPad 2 (8.3 Simulator)',
      'iPad Simulator (8.4 Simulator)': 'iPad 2 (8.4 Simulator)',
      'iPhone Simulator (7.1 Simulator)': 'iPhone 5s (7.1 Simulator)',
      'iPhone Simulator (8.4 Simulator)': 'iPhone 6 (8.4 Simulator)',
      'iPhone Simulator (8.3 Simulator)': 'iPhone 6 (8.3 Simulator)',
      'iPhone Simulator (8.2 Simulator)': 'iPhone 6 (8.2 Simulator)',
      'iPhone Simulator (8.1 Simulator)': 'iPhone 6 (8.1 Simulator)',
      'iPhone Simulator (8.0 Simulator)': 'iPhone 6 (8.0 Simulator)'
    };
  }

  static async getDeviceString(opts) {
    opts = Object.assign({}, {
      deviceName: null,
      platformVersion: null,
      forceIphone: false,
      forceIpad: false
    }, opts);
    let logOpts = {
      deviceName: opts.deviceName,
      platformVersion: opts.platformVersion,
      forceIphone: opts.forceIphone,
      forceIpad: opts.forceIpad
    };

    _logger.default.debug(`Getting device string from options: ${JSON.stringify(logOpts)}`);

    if ((opts.deviceName || '')[0] === '=') {
      return opts.deviceName.substring(1);
    }

    let isiPhone = !!opts.forceIphone || !opts.forceIpad;

    if (opts.deviceName) {
      let device = opts.deviceName.toLowerCase();

      if (device.indexOf('iphone') !== -1) {
        isiPhone = true;
      } else if (device.indexOf('ipad') !== -1) {
        isiPhone = false;
      }
    }

    let iosDeviceString = opts.deviceName || (isiPhone ? 'iPhone Simulator' : 'iPad Simulator');

    if (/^(iPhone|iPad)$/.test(iosDeviceString)) {
      iosDeviceString += ' Simulator';
    }

    if (/[^(iPhone|iPad)] Simulator/.test(iosDeviceString)) {
      iosDeviceString = iosDeviceString.replace(' Simulator', '');
    }

    iosDeviceString += ` ${await this._getDeviceStringVersionString(opts.platformVersion)}`;

    let CONFIG_FIX = this._getDeviceStringConfigFix();

    let configFix = CONFIG_FIX;

    if (configFix[iosDeviceString]) {
      iosDeviceString = configFix[iosDeviceString];

      _logger.default.debug(`Fixing device. Changed from '${opts.deviceName}' ` + `to '${iosDeviceString}'`);
    }

    _logger.default.debug(`Final device string is '${iosDeviceString}'`);

    return iosDeviceString;
  }

  async getWebInspectorSocket() {
    return null;
  }

}

exports.SimulatorXcode6 = SimulatorXcode6;

for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode6.prototype[cmd] = fn;
}

var _default = SimulatorXcode6;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IteGNvZGUtNi5qcyJdLCJuYW1lcyI6WyJTVEFSVFVQX1RJTUVPVVQiLCJFWFRSQV9TVEFSVFVQX1RJTUUiLCJVSV9DTElFTlRfQUNDRVNTX0dVQVJEIiwiQXN5bmNMb2NrIiwiVUlfQ0xJRU5UX0JVTkRMRV9JRCIsIlNQUklOR0JPQVJEX0JVTkRMRV9JRCIsIkJPT1RfQ09NUExFVEVEX0VWRU5UIiwiU2ltdWxhdG9yWGNvZGU2IiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwiU3RyaW5nIiwic2ltY3RsIiwiU2ltY3RsIiwiX3BsYXRmb3JtVmVyc2lvbiIsImtleWNoYWluUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0RGlyIiwic2ltdWxhdG9yQXBwIiwiYXBwRGF0YUJ1bmRsZVBhdGhzIiwiaXNGcmVzaEZpbGVzIiwiZXh0cmFTdGFydHVwVGltZSIsImNhbGVuZGFyIiwiQ2FsZW5kYXIiLCJwZXJtaXNzaW9ucyIsIlBlcm1pc3Npb25zIiwidWlDbGllbnRCdW5kbGVJZCIsImRldmljZXNTZXRQYXRoIiwidmFsdWUiLCJnZXRVSUNsaWVudFBpZCIsInN0ZG91dCIsImUiLCJpc05hTiIsInBhcnNlSW50IiwidHJpbSIsImxvZyIsImRlYnVnIiwiaXNVSUNsaWVudFJ1bm5pbmciLCJfIiwiaXNOdWxsIiwic3RhcnR1cFRpbWVvdXQiLCJnZXRQbGF0Zm9ybVZlcnNpb24iLCJzZGsiLCJzdGF0IiwiZ2V0Um9vdERpciIsImhvbWUiLCJwcm9jZXNzIiwiZW52IiwiSE9NRSIsImdldExvZ0RpciIsImluc3RhbGxBcHAiLCJhcHAiLCJpc0FwcEluc3RhbGxlZCIsImJ1bmRsZUlkIiwiYXBwRmlsZSIsImFwcERpcnMiLCJnZXRBcHBEaXJzIiwibGVuZ3RoIiwiZ2V0VXNlckluc3RhbGxlZEJ1bmRsZUlkc0J5QnVuZGxlTmFtZSIsImJ1bmRsZU5hbWUiLCJyb290VXNlckFwcERpciIsImJ1aWxkQnVuZGxlUGF0aE1hcCIsImJ1bmRsZUlkcyIsImlzRW1wdHkiLCJ1c2VyQXBwRGlyUGF0aCIsIk9iamVjdCIsImVudHJpZXMiLCJmcyIsInJlYWRkaXIiLCJmaW5kIiwiZmlsZSIsImV4dG5hbWUiLCJ0b0xvd2VyQ2FzZSIsImluZm9QbGlzdFBhdGgiLCJleGlzdHMiLCJpbmZvUGxpc3QiLCJwbGlzdCIsInBhcnNlUGxpc3RGaWxlIiwiQ0ZCdW5kbGVOYW1lIiwicHVzaCIsImVyciIsIndhcm4iLCJtZXNzYWdlIiwiZ2V0QXBwRGlyIiwiaWQiLCJzdWJEaXIiLCJpc0ZyZXNoIiwiYXBwbGljYXRpb25MaXN0IiwicGF0aEJ1bmRsZVBhaXIiLCJkaXIiLCJhcHBGaWxlcyIsImdsb2IiLCJtYXRjaCIsInJlYWRCdW5kbGVJZCIsIm1ldGFkYXRhIiwic2V0dGluZ3MiLCJyZWFkIiwiTUNNTWV0YWRhdGFJZGVudGlmaWVyIiwiYnVuZGxlUGF0aERpcnMiLCJidW5kbGVQYXRoUGFpcnMiLCJyZWR1Y2UiLCJidW5kbGVNYXAiLCJidW5kbGVQYXRoIiwiZGV2aWNlQXJyIiwidG9QYWlycyIsImdldERldmljZXMiLCJkZXZpY2UiLCJmaWxlcyIsInB2IiwibWFwIiwicyIsImV4aXN0ZW5jZXMiLCJmIiwiaGFzQWNjZXNzIiwiZnJlc2giLCJjb21wYWN0IiwiaXNSdW5uaW5nIiwiZ2V0RW52IiwiaXNTaHV0ZG93biIsImluY2x1ZGVzIiwic3RkZXJyIiwid2FpdEZvckJvb3QiLCJib290ZWRJbmRpY2F0b3IiLCJnZXRCb290ZWRJbmRpY2F0b3JTdHJpbmciLCJ0YWlsTG9nc1VudGlsIiwiQiIsImRlbGF5IiwiZW1pdCIsImluZGljYXRvciIsInBsYXRmb3JtVmVyc2lvbiIsInN0YXJ0VUlDbGllbnQiLCJvcHRzIiwiY2xvbmVEZWVwIiwiZGVmYXVsdHNEZWVwIiwic2NhbGVGYWN0b3IiLCJhcmdzIiwibmFtZSIsImZvcm1hdHRlZERldmljZU5hbWUiLCJyZXBsYWNlIiwiYXJndW1lbnROYW1lIiwiaW5mbyIsImpvaW4iLCJ0aW1lb3V0IiwicnVuIiwiYXNzaWduIiwiaXNTZXJ2ZXJSdW5uaW5nIiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic2h1dGRvd24iLCJnZXREdXJhdGlvbiIsImFzU2Vjb25kcyIsInRvRml4ZWQiLCJjbGVhbiIsImVuZFNpbXVsYXRvckRhZW1vbiIsImVyYXNlRGV2aWNlIiwic2NydWJDdXN0b21BcHAiLCJhcHBCdW5kbGVJZCIsImNsZWFuQ3VzdG9tQXBwIiwic2NydWIiLCJkZWxldGVQcm9taXNlcyIsInJpbXJhZiIsInJlbFJtUGF0aCIsInJtUGF0aCIsImFsbCIsImRpcnMiLCJkYXRhIiwiYnVuZGxlIiwidW5kZWZpbmVkIiwic3JjIiwibGF1bmNoQW5kUXVpdCIsInNhZmFyaSIsIm9wZW5VcmwiLCJFcnJvciIsImxhdW5jaGN0bENtZCIsInN0b3BDbWQiLCJyZW1vdmVDbWQiLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwic2h1dGRvd25EZXZpY2UiLCJiaW5kIiwiZGVsZXRlIiwiZGVsZXRlRGV2aWNlIiwidXBkYXRlU2V0dGluZ3MiLCJ1cGRhdGVzIiwidXBkYXRlTG9jYXRpb25TZXR0aW5ncyIsImF1dGhvcml6ZWQiLCJzZXRSZWR1Y2VNb3Rpb24iLCJyZWR1Y2VNb3Rpb24iLCJzZXRBcHBlYXJhbmNlIiwiZ2V0QXBwZWFyYW5jZSIsInVwZGF0ZVNhZmFyaVNldHRpbmdzIiwidXBkYXRlZCIsInVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyIsInVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzIiwidXBkYXRlTG9jYWxlIiwibGFuZ3VhZ2UiLCJsb2NhbGUiLCJjYWxlbmRhckZvcm1hdCIsImRlbGV0ZVNhZmFyaSIsImNsZWFuU2FmYXJpIiwia2VlcFByZWZzIiwibGlicmFyeURpciIsInNhZmFyaVJvb3QiLCJzYWZhcmlMaWJyYXJ5RGlyIiwiZmlsZXNUb0RlbGV0ZSIsInJlbW92ZUFwcCIsIm1vdmVCdWlsdEluQXBwIiwiYXBwTmFtZSIsImFwcFBhdGgiLCJuZXdBcHBQYXRoIiwiY29weUZpbGUiLCJ1cmwiLCJTQUZBUklfQk9PVEVEX0lORElDQVRPUiIsIlNBRkFSSV9TVEFSVFVQX1RJTUVPVVQiLCJjbGVhckNhY2hlcyIsImZvbGRlck5hbWVzIiwiY2FjaGVzUm9vdCIsIml0ZW1zVG9SZW1vdmUiLCJ4IiwiZmlsdGVyIiwiaXNEaXJlY3RvcnkiLCJ1dGlsIiwicGx1cmFsaXplIiwidGltZW91dE1zIiwic2ltTG9nIiwiZW5hYmxlQ2FsZW5kYXJBY2Nlc3MiLCJidW5kbGVJRCIsImRpc2FibGVDYWxlbmRhckFjY2VzcyIsImhhc0NhbGVuZGFyQWNjZXNzIiwiX2FjdGl2YXRlV2luZG93IiwicGlkIiwiZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IiwiYXBwbGVTY3JpcHQiLCJ3aW5kb3dBY3RpdmF0aW9uU2NyaXB0IiwicmVzdWx0U2NyaXB0IiwiYWNxdWlyZSIsImVycm9yQW5kVGhyb3ciLCJpc0Jpb21ldHJpY0Vucm9sbGVkIiwib3V0cHV0IiwiaXNTdHJpbmciLCJlbnJvbGxCaW9tZXRyaWMiLCJpc0VuYWJsZWQiLCJzZW5kQmlvbWV0cmljTWF0Y2giLCJzaG91bGRNYXRjaCIsImRpc21pc3NEYXRhYmFzZUFsZXJ0IiwiaW5jcmVhc2UiLCJidXR0b24iLCJiYWNrdXBLZXljaGFpbnMiLCJiYWNrdXBQYXRoIiwidGVtcERpciIsInByZWZpeCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic3VmZml4IiwiemlwQXJncyIsInNlcCIsIl9rZXljaGFpbnNCYWNrdXBQYXRoIiwidW5saW5rIiwicmVzdG9yZUtleWNoYWlucyIsImV4Y2x1ZGVQYXR0ZXJucyIsInNwbGl0IiwicGxpc3RQYXRoIiwiZ2V0TGF1bmNoRGFlbW9uc1Jvb3QiLCJzcGF3blByb2Nlc3MiLCJ1bnppcEFyZ3MiLCJmbGF0TWFwIiwiY2xlYXJLZXljaGFpbnMiLCJwcyIsInNlcnZpY2VzTWF0Y2giLCJleGVjIiwicmVzdWx0IiwicGF0dGVybiIsImdyb3VwIiwidHJpbUVuZCIsInNldFBlcm1pc3Npb24iLCJwZXJtaXNzaW9uIiwic2V0UGVybWlzc2lvbnMiLCJwZXJtaXNzaW9uc01hcHBpbmciLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0QWNjZXNzIiwiZ2V0UGVybWlzc2lvbiIsInNlcnZpY2VOYW1lIiwiZ2V0QWNjZXNzIiwiYWRkQ2VydGlmaWNhdGUiLCJwYXlsb2FkIiwidHJ1bmNhdGUiLCJwdXNoTm90aWZpY2F0aW9uIiwiZGV2Um9vdCIsIl9nZXREZXZpY2VTdHJpbmdQbGF0Zm9ybVZlcnNpb24iLCJyZXFWZXJzaW9uIiwieGNvZGUiLCJnZXRNYXhJT1NTREsiLCJfZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyIsIl9nZXREZXZpY2VTdHJpbmdDb25maWdGaXgiLCJnZXREZXZpY2VTdHJpbmciLCJkZXZpY2VOYW1lIiwiZm9yY2VJcGhvbmUiLCJmb3JjZUlwYWQiLCJsb2dPcHRzIiwiaXNpUGhvbmUiLCJpbmRleE9mIiwiaW9zRGV2aWNlU3RyaW5nIiwidGVzdCIsIkNPTkZJR19GSVgiLCJjb25maWdGaXgiLCJnZXRXZWJJbnNwZWN0b3JTb2NrZXQiLCJjbWQiLCJmbiIsImV4dGVuc2lvbnMiLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUdBLE1BQU1BLGVBQWUsR0FBRyxLQUFLLElBQTdCO0FBQ0EsTUFBTUMsa0JBQWtCLEdBQUcsSUFBM0I7QUFDQSxNQUFNQyxzQkFBc0IsR0FBRyxJQUFJQyxrQkFBSixFQUEvQjtBQUNBLE1BQU1DLG1CQUFtQixHQUFHLDJCQUE1QjtBQUNBLE1BQU1DLHFCQUFxQixHQUFHLHVCQUE5Qjs7QUFVQSxNQUFNQyxvQkFBb0IsR0FBRyxlQUE3Qjs7O0FBR0EsTUFBTUMsZUFBTixTQUE4QkMsb0JBQTlCLENBQTJD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QUQsQ0FBM0I7O0FBQ0FoUixzQkFBSUMsS0FBSixDQUFXLGdDQUErQitGLElBQUksQ0FBQzBLLFVBQVcsSUFBaEQsR0FDQyxPQUFNTSxlQUFnQixHQURqQztBQUVEOztBQUVEaFIsb0JBQUlDLEtBQUosQ0FBVywyQkFBMEIrUSxlQUFnQixHQUFyRDs7QUFDQSxXQUFPQSxlQUFQO0FBQ0Q7O0FBTTBCLFFBQXJCSSxxQkFBcUIsR0FBSTtBQUU3QixXQUFPLElBQVA7QUFDRDs7QUFqOUN3Qzs7OztBQW85QzNDLEtBQUssSUFBSSxDQUFDQyxHQUFELEVBQU1DLEVBQU4sQ0FBVCxJQUFzQm5SLGdCQUFFa0UsT0FBRixDQUFVa04sY0FBVixDQUF0QixFQUE2QztBQUMzQ3JULEVBQUFBLGVBQWUsQ0FBQ3NULFNBQWhCLENBQTBCSCxHQUExQixJQUFpQ0MsRUFBakM7QUFDRDs7ZUFFY3BULGUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGRlZmF1bHQgYXMgeGNvZGUsIGdldFBhdGggYXMgZ2V0WGNvZGVQYXRoIH0gZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgZnMsIHRlbXBEaXIsIG1rZGlycCwgcGxpc3QsIHRpbWluZywgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQXN5bmNMb2NrIGZyb20gJ2FzeW5jLWxvY2snO1xuaW1wb3J0IHtcbiAgc2FmZVJpbVJhZiwgZ2V0RGV2ZWxvcGVyUm9vdCwgaW5zdGFsbFNTTENlcnQsIGhhc1NTTENlcnQsIGFjdGl2YXRlQXBwLFxufSBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB7IGFzeW5jbWFwLCByZXRyeUludGVydmFsLCB3YWl0Rm9yQ29uZGl0aW9uLCByZXRyeSB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCAqIGFzIHNldHRpbmdzIGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyB0YWlsVW50aWwgfSBmcm9tICcuL3RhaWwtdW50aWwuanMnO1xuaW1wb3J0IGV4dGVuc2lvbnMgZnJvbSAnLi9leHRlbnNpb25zL2luZGV4JztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgQ2FsZW5kYXIgZnJvbSAnLi9jYWxlbmRhcic7XG5pbXBvcnQgUGVybWlzc2lvbnMgZnJvbSAnLi9wZXJtaXNzaW9ucyc7XG5pbXBvcnQgU2ltY3RsIGZyb20gJ25vZGUtc2ltY3RsJztcblxuXG5jb25zdCBTVEFSVFVQX1RJTUVPVVQgPSA2MCAqIDEwMDA7XG5jb25zdCBFWFRSQV9TVEFSVFVQX1RJTUUgPSAyMDAwO1xuY29uc3QgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRCA9IG5ldyBBc3luY0xvY2soKTtcbmNvbnN0IFVJX0NMSUVOVF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLmlwaG9uZXNpbXVsYXRvcic7XG5jb25zdCBTUFJJTkdCT0FSRF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLlNwcmluZ0JvYXJkJztcblxuLypcbiAqIFRoaXMgZXZlbnQgaXMgZW1pdHRlZCBhcyBzb29uIGFzIGlPUyBTaW11bGF0b3JcbiAqIGhhcyBmaW5pc2hlZCBib290aW5nIGFuZCBpdCBpcyByZWFkeSB0byBhY2NlcHQgeGNydW4gY29tbWFuZHMuXG4gKiBUaGUgZXZlbnQgaGFuZGxlciBpcyBjYWxsZWQgYWZ0ZXIgJ3J1bicgbWV0aG9kIGlzIGNvbXBsZXRlZFxuICogZm9yIFhjb2RlIDcgYW5kIG9sZGVyIGFuZCBpcyBvbmx5IHVzZWZ1bCBpbiBYY29kZSA4KyxcbiAqIHNpbmNlIG9uZSBjYW4gc3RhcnQgZG9pbmcgc3R1ZmYgKGZvciBleGFtcGxlIGluc3RhbGwvdW5pbnN0YWxsIGFuIGFwcCkgaW4gcGFyYWxsZWxcbiAqIHdpdGggU2ltdWxhdG9yIFVJIHN0YXJ0dXAsIHdoaWNoIHNob3J0ZW5zIHNlc3Npb24gc3RhcnR1cCB0aW1lLlxuICovXG5jb25zdCBCT09UX0NPTVBMRVRFRF9FVkVOVCA9ICdib290Q29tcGxldGVkJztcblxuXG5jbGFzcyBTaW11bGF0b3JYY29kZTYgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIHRoZSBvYmplY3Qgd2l0aCB0aGUgYHVkaWRgIGFuZCB2ZXJzaW9uIG9mIFhjb2RlLiBVc2UgdGhlIGV4cG9ydGVkIGBnZXRTaW11bGF0b3IodWRpZClgIG1ldGhvZCBpbnN0ZWFkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBTaW11bGF0b3IgSUQuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB4Y29kZVZlcnNpb24gLSBUaGUgdGFyZ2V0IFhjb2RlIHZlcnNpb24gaW4gZm9ybWF0IHttYWpvciwgbWlub3IsIGJ1aWxkfS5cbiAgICovXG4gIGNvbnN0cnVjdG9yICh1ZGlkLCB4Y29kZVZlcnNpb24pIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy51ZGlkID0gU3RyaW5nKHVkaWQpO1xuICAgIHRoaXMuc2ltY3RsID0gbmV3IFNpbWN0bCh7XG4gICAgICB1ZGlkOiB0aGlzLnVkaWQsXG4gICAgfSk7XG4gICAgdGhpcy54Y29kZVZlcnNpb24gPSB4Y29kZVZlcnNpb247XG5cbiAgICAvLyBwbGF0Zm9ybVZlcnNpb24gY2Fubm90IGJlIGZvdW5kIGluaXRpYWxseSwgc2luY2UgZ2V0dGluZyBpdCBoYXMgc2lkZSBlZmZlY3RzIGZvclxuICAgIC8vIG91ciBsb2dpYyBmb3IgZmlndXJpbmcgb3V0IGlmIGEgc2ltIGhhcyBiZWVuIHJ1blxuICAgIC8vIGl0IHdpbGwgYmUgc2V0IHdoZW4gaXQgaXMgbmVlZGVkXG4gICAgdGhpcy5fcGxhdGZvcm1WZXJzaW9uID0gbnVsbDtcblxuICAgIHRoaXMua2V5Y2hhaW5QYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdMaWJyYXJ5JywgJ0tleWNoYWlucycpO1xuICAgIHRoaXMuc2ltdWxhdG9yQXBwID0gJ2lPUyBTaW11bGF0b3IuYXBwJztcblxuICAgIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzID0ge307XG5cbiAgICAvLyBsaXN0IG9mIGZpbGVzIHRvIGNoZWNrIGZvciB3aGVuIHNlZWluZyBpZiBhIHNpbXVsYXRvciBpcyBcImZyZXNoXCJcbiAgICAvLyAobWVhbmluZyBpdCBoYXMgbmV2ZXIgYmVlbiBib290ZWQpLlxuICAgIC8vIElmIHRoZXNlIGZpbGVzIGFyZSBwcmVzZW50LCB3ZSBhc3N1bWUgaXQncyBiZWVuIHN1Y2Nlc3NmdWxseSBib290ZWRcbiAgICB0aGlzLmlzRnJlc2hGaWxlcyA9IFtcbiAgICAgICdMaWJyYXJ5L0NvbmZpZ3VyYXRpb25Qcm9maWxlcycsXG4gICAgICAnTGlicmFyeS9Db29raWVzJyxcbiAgICAgICdMaWJyYXJ5L1ByZWZlcmVuY2VzLy5HbG9iYWxQcmVmZXJlbmNlcy5wbGlzdCcsXG4gICAgICAnTGlicmFyeS9QcmVmZXJlbmNlcy9jb20uYXBwbGUuc3ByaW5nYm9hcmQucGxpc3QnLFxuICAgICAgJ3Zhci9ydW4vc3lzbG9nLnBpZCdcbiAgICBdO1xuXG4gICAgLy8gZXh0cmEgdGltZSB0byB3YWl0IGZvciBzaW11bGF0b3IgdG8gYmUgZGVlbWVkIGJvb3RlZFxuICAgIHRoaXMuZXh0cmFTdGFydHVwVGltZSA9IEVYVFJBX1NUQVJUVVBfVElNRTtcblxuICAgIHRoaXMuY2FsZW5kYXIgPSBuZXcgQ2FsZW5kYXIoeGNvZGVWZXJzaW9uLCB0aGlzLmdldERpcigpKTtcbiAgICB0aGlzLnBlcm1pc3Npb25zID0gbmV3IFBlcm1pc3Npb25zKHhjb2RlVmVyc2lvbiwgdGhpcy5nZXREaXIoKSwgdGhpcy51ZGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IEJ1bmRsZSBpZGVudGlmaWVyIG9mIFNpbXVsYXRvciBVSSBjbGllbnQuXG4gICAqL1xuICBnZXQgdWlDbGllbnRCdW5kbGVJZCAoKSB7XG4gICAgcmV0dXJuIFVJX0NMSUVOVF9CVU5ETEVfSUQ7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byB0aGUgZGV2aWNlcyBzZXQgd2hlcmUgdGhlIGN1cnJlbnQgc2ltdWxhdG9yIGlzIGxvY2F0ZWQuXG4gICAqIGBudWxsYCB2YWx1ZSBtZWFucyB0aGF0IHRoZSBkZWZhdWx0IHBhdGggaXMgdXNlZCwgd2hpY2ggaXMgdXN1YWxseSBgfi9MaWJyYXJ5L0RldmVsb3Blci9Db3JlU2ltdWxhdG9yL0RldmljZXNgXG4gICAqL1xuICBnZXQgZGV2aWNlc1NldFBhdGggKCkge1xuICAgIHJldHVybiB0aGlzLnNpbWN0bC5kZXZpY2VzU2V0UGF0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGV2aWNlcyBzZXQuIEl0IGlzIHJlY29tbWVuZGVkIHRvIHNldCB0aGlzIHZhbHVlXG4gICAqIG9uY2UgcmlnaHQgYWZ0ZXIgU2ltdWxhdG9yIGluc3RhbmNlIGlzIGNyZWF0ZWQgYW5kIHRvIG5vdCBjaGFuZ2UgaXQgZHVyaW5nXG4gICAqIHRoZSBpbnN0YW5jZSBsaWZlY3ljbGVcbiAgICpcbiAgICogQHBhcmFtIHs/c3RyaW5nfSB2YWx1ZSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldCByb290IG9uIHRoZVxuICAgKiBsb2NhbCBmaWxlIHN5c3RlbVxuICAgKi9cbiAgc2V0IGRldmljZXNTZXRQYXRoICh2YWx1ZSkge1xuICAgIHRoaXMuc2ltY3RsLmRldmljZXNTZXRQYXRoID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHByb2Nlc3MgaWQgb2YgdGhlIFVJIGNsaWVudFxuICAgKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgcHJvY2VzcyBJRCBvciBudWxsIGlmIHRoZSBVSSBjbGllbnQgaXMgbm90IHJ1bm5pbmdcbiAgICovXG4gIGFzeW5jIGdldFVJQ2xpZW50UGlkICgpIHtcbiAgICBsZXQgc3Rkb3V0O1xuICAgIHRyeSB7XG4gICAgICAoe3N0ZG91dH0gPSBhd2FpdCBleGVjKCdwZ3JlcCcsIFsnLWZuJywgYCR7dGhpcy5zaW11bGF0b3JBcHB9L0NvbnRlbnRzL01hY09TL2BdKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmIChpc05hTihwYXJzZUludChzdGRvdXQsIDEwKSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzdGRvdXQgPSBzdGRvdXQudHJpbSgpO1xuICAgIGxvZy5kZWJ1ZyhgR290IFNpbXVsYXRvciBVSSBjbGllbnQgUElEOiAke3N0ZG91dH1gKTtcbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHRoZSBzdGF0ZSBvZiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIG9mIGlmIFVJIGNsaWVudCBpcyBydW5uaW5nIG9yIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIGFzeW5jIGlzVUlDbGllbnRSdW5uaW5nICgpIHtcbiAgICByZXR1cm4gIV8uaXNOdWxsKGF3YWl0IHRoaXMuZ2V0VUlDbGllbnRQaWQoKSk7XG4gIH1cblxuICAvKipcbiAgICogSG93IGxvbmcgdG8gd2FpdCBiZWZvcmUgdGhyb3dpbmcgYW4gZXJyb3IgYWJvdXQgU2ltdWxhdG9yIHN0YXJ0dXAgdGltZW91dCBoYXBwZW5lZC5cbiAgICpcbiAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcy5cbiAgICovXG4gIGdldCBzdGFydHVwVGltZW91dCAoKSB7XG4gICAgcmV0dXJuIFNUQVJUVVBfVElNRU9VVDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHBsYXRmb3JtIHZlcnNpb24gb2YgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFNESyB2ZXJzaW9uLCBmb3IgZXhhbXBsZSAnOC4zJy5cbiAgICovXG4gIGFzeW5jIGdldFBsYXRmb3JtVmVyc2lvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl9wbGF0Zm9ybVZlcnNpb24pIHtcbiAgICAgIGxldCB7c2RrfSA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgICAgdGhpcy5fcGxhdGZvcm1WZXJzaW9uID0gc2RrO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcGxhdGZvcm1WZXJzaW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSB3aGVyZSBTaW11bGF0b3Igc3R1ZmYgaXMgbG9jYXRlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aCBzdHJpbmcuXG4gICAqL1xuICBnZXRSb290RGlyICgpIHtcbiAgICBsZXQgaG9tZSA9IHByb2Nlc3MuZW52LkhPTUU7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShob21lLCAnTGlicmFyeScsICdEZXZlbG9wZXInLCAnQ29yZVNpbXVsYXRvcicsICdEZXZpY2VzJyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBhcHBsaWNhdGlvbnMgZGF0YSBpcyBsb2NhdGVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXRoIHN0cmluZy5cbiAgICovXG4gIGdldERpciAoKSB7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZSh0aGlzLmdldFJvb3REaXIoKSwgdGhpcy51ZGlkLCAnZGF0YScpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSB3aGVyZSBTaW11bGF0b3IgbG9ncyBhcmUgc3RvcmVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXRoIHN0cmluZy5cbiAgICovXG4gIGdldExvZ0RpciAoKSB7XG4gICAgbGV0IGhvbWUgPSBwcm9jZXNzLmVudi5IT01FO1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUoaG9tZSwgJ0xpYnJhcnknLCAnTG9ncycsICdDb3JlU2ltdWxhdG9yJywgdGhpcy51ZGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnN0YWxsIHZhbGlkIC5hcHAgcGFja2FnZSBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHAgLSBUaGUgcGF0aCB0byB0aGUgLmFwcCBwYWNrYWdlLlxuICAgKi9cbiAgYXN5bmMgaW5zdGFsbEFwcCAoYXBwKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2ltY3RsLmluc3RhbGxBcHAoYXBwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZnkgd2hldGhlciB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBpcyBpbnN0YWxsZWQgb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgYnVuZGxlIGlkIG9mIHRoZSBhcHBsaWNhdGlvbiB0byBiZSBjaGVja2VkLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRnVsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIgKGZvciBpT1MgNy4xKVxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBpcyBpbnN0YWxsZWRcbiAgICovXG4gIGFzeW5jIGlzQXBwSW5zdGFsbGVkIChidW5kbGVJZCwgYXBwRmlsZSA9IG51bGwpIHtcbiAgICAvLyBgYXBwRmlsZWAgYXJndW1lbnQgb25seSBuZWNlc3NhcnkgZm9yIGlPUyBiZWxvdyB2ZXJzaW9uIDhcbiAgICBsZXQgYXBwRGlycyA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlycyhhcHBGaWxlLCBidW5kbGVJZCk7XG4gICAgcmV0dXJuIGFwcERpcnMubGVuZ3RoICE9PSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdXNlciBpbnN0YWxsZWQgYnVuZGxlIGlkcyB3aGljaCBoYXMgJ2J1bmRsZU5hbWUnIGluIHRoZWlyIEluZm8uUGxpc3QgYXMgJ0NGQnVuZGxlTmFtZSdcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1bmRsZSBpZCBvZiB0aGUgYXBwbGljYXRpb24gdG8gYmUgY2hlY2tlZC5cbiAgICogQHJldHVybiB7YXJyYXk8c3RyaW5nPn0gLSBUaGUgbGlzdCBvZiBidW5kbGUgaWRzIHdoaWNoIGhhdmUgJ2J1bmRsZU5hbWUnXG4gICAqL1xuICBhc3luYyBnZXRVc2VySW5zdGFsbGVkQnVuZGxlSWRzQnlCdW5kbGVOYW1lIChidW5kbGVOYW1lKSB7XG4gICAgY29uc3Qgcm9vdFVzZXJBcHBEaXIgPSBhd2FpdCB0aGlzLmJ1aWxkQnVuZGxlUGF0aE1hcCgnQnVuZGxlJyk7XG4gICAgY29uc3QgYnVuZGxlSWRzID0gW107XG4gICAgaWYgKF8uaXNFbXB0eShyb290VXNlckFwcERpcikpIHtcbiAgICAgIHJldHVybiBidW5kbGVJZHM7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBbYnVuZGxlSWQsIHVzZXJBcHBEaXJQYXRoXSBvZiBPYmplY3QuZW50cmllcyhyb290VXNlckFwcERpcikpIHtcbiAgICAgIGNvbnN0IGFwcEZpbGUgPSAoYXdhaXQgZnMucmVhZGRpcih1c2VyQXBwRGlyUGF0aCkpLmZpbmQoXG4gICAgICAgIChmaWxlKSA9PiBwYXRoLmV4dG5hbWUoZmlsZSkudG9Mb3dlckNhc2UoKSA9PT0gJy5hcHAnKTtcbiAgICAgIGNvbnN0IGluZm9QbGlzdFBhdGggPSBwYXRoLnJlc29sdmUodXNlckFwcERpclBhdGgsIGFwcEZpbGUsICdJbmZvLnBsaXN0Jyk7XG4gICAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhpbmZvUGxpc3RQYXRoKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluZm9QbGlzdCA9IGF3YWl0IHBsaXN0LnBhcnNlUGxpc3RGaWxlKGluZm9QbGlzdFBhdGgsIGZhbHNlKTtcbiAgICAgICAgaWYgKGluZm9QbGlzdC5DRkJ1bmRsZU5hbWUgPT09IGJ1bmRsZU5hbWUpIHtcbiAgICAgICAgICBidW5kbGVJZHMucHVzaChidW5kbGVJZCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cud2FybihgRmFpbGVkIHRvIHJlYWQgcGxpc3QgJHtpbmZvUGxpc3RQYXRofS4gT3JpZ2luYWwgZXJyb3IgJyR7ZXJyLm1lc3NhZ2V9J2ApO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nLmRlYnVnKGBUaGUgc2ltdWxhdG9yIGhhcyAnJHtidW5kbGVJZHMubGVuZ3RofScgYnVuZGxlcyB3aGljaCBoYXZlICcke2J1bmRsZU5hbWV9JyBhcyB0aGVpciAnQ0ZCdW5kbGVOYW1lJzpgKTtcbiAgICBmb3IgKGNvbnN0IGJ1bmRsZUlkIG9mIGJ1bmRsZUlkcykge1xuICAgICAgbG9nLmRlYnVnKGAgICAgJyR7YnVuZGxlSWR9J2ApO1xuICAgIH1cbiAgICByZXR1cm4gYnVuZGxlSWRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBkaXJlY3RvcnkgZm9yIGEgcGFydGljdWxhciBhcHBsaWNhdGlvbidzIGRhdGEuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIEVpdGhlciBhIGJ1bmRsZUlkIChlLmcuLCBjb20uYXBwbGUubW9iaWxlc2FmYXJpKSBvciwgZm9yIGlPUyA3LjEsIHRoZSBhcHAgbmFtZSB3aXRob3V0IGAuYXBwYCAoZS5nLiwgTW9iaWxlU2FmYXJpKVxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3ViZGlyIC0gVGhlIHN1Yi1kaXJlY3Rvcnkgd2UgZXhwZWN0IHRvIGJlIHdpdGhpbiB0aGUgYXBwbGljYXRpb24gZGlyZWN0b3J5LiBEZWZhdWx0cyB0byBcIkRhdGFcIi5cbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcm9vdCBhcHBsaWNhdGlvbiBmb2xkZXIuXG4gICAqL1xuICBhc3luYyBnZXRBcHBEaXIgKGlkLCBzdWJEaXIgPSAnRGF0YScpIHtcbiAgICB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdID0gdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSB8fCB7fTtcbiAgICBpZiAoXy5pc0VtcHR5KHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0pICYmICFhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSA9IGF3YWl0IHRoaXMuYnVpbGRCdW5kbGVQYXRoTWFwKHN1YkRpcik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdW2lkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgeGNvZGUgNiBzaW11bGF0b3JzIGFyZSByZWFsbHkgYW5ub3lpbmcsIGFuZCBidXJ5IHRoZSBtYWluIGFwcFxuICAgKiBkaXJlY3RvcmllcyBpbnNpZGUgZGlyZWN0b3JpZXMganVzdCBuYW1lZCB3aXRoIEhhc2hlcy5cbiAgICogVGhpcyBmdW5jdGlvbiBmaW5kcyB0aGUgcHJvcGVyIGRpcmVjdG9yeSBieSB0cmF2ZXJzaW5nIGFsbCBvZiB0aGVtXG4gICAqIGFuZCByZWFkaW5nIGEgbWV0YWRhdGEgcGxpc3QgKE1vYmlsZSBDb250YWluZXIgTWFuYWdlcikgdG8gZ2V0IHRoZVxuICAgKiBidW5kbGUgaWQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdWJkaXIgLSBUaGUgc3ViLWRpcmVjdG9yeSB3ZSBleHBlY3QgdG8gYmUgd2l0aGluIHRoZSBhcHBsaWNhdGlvbiBkaXJlY3RvcnkuIERlZmF1bHRzIHRvIFwiRGF0YVwiLlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFRoZSBsaXN0IG9mIHBhdGgtYnVuZGxlIHBhaXJzIHRvIGFuIG9iamVjdCB3aGVyZSBidW5kbGVJZHMgYXJlIG1hcHBlZCB0byBwYXRocy5cbiAgICovXG4gIGFzeW5jIGJ1aWxkQnVuZGxlUGF0aE1hcCAoc3ViRGlyID0gJ0RhdGEnKSB7XG4gICAgbG9nLmRlYnVnKCdCdWlsZGluZyBidW5kbGUgcGF0aCBtYXAnKTtcbiAgICBsZXQgYXBwbGljYXRpb25MaXN0O1xuICAgIGxldCBwYXRoQnVuZGxlUGFpcjtcbiAgICBpZiAoYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKSA9PT0gJzcuMScpIHtcbiAgICAgIC8vIGFwcHMgYXZhaWxhYmxlXG4gICAgICAvLyAgIFdlYi5hcHAsXG4gICAgICAvLyAgIFdlYlZpZXdTZXJ2aWNlLmFwcCxcbiAgICAgIC8vICAgTW9iaWxlU2FmYXJpLmFwcCxcbiAgICAgIC8vICAgV2ViQ29udGVudEFuYWx5c2lzVUkuYXBwLFxuICAgICAgLy8gICBEREFjdGlvbnNTZXJ2aWNlLmFwcCxcbiAgICAgIC8vICAgU3RvcmVLaXRVSVNlcnZpY2UuYXBwXG4gICAgICBhcHBsaWNhdGlvbkxpc3QgPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0FwcGxpY2F0aW9ucycpO1xuICAgICAgcGF0aEJ1bmRsZVBhaXIgPSBhc3luYyAoZGlyKSA9PiB7XG4gICAgICAgIGRpciA9IHBhdGgucmVzb2x2ZShhcHBsaWNhdGlvbkxpc3QsIGRpcik7XG4gICAgICAgIGxldCBhcHBGaWxlcyA9IGF3YWl0IGZzLmdsb2IoYCR7ZGlyfS8qLmFwcGApO1xuICAgICAgICBsZXQgYnVuZGxlSWQgPSBhcHBGaWxlc1swXS5tYXRjaCgvLipcXC8oLiopXFwuYXBwLylbMV07XG4gICAgICAgIHJldHVybiB7cGF0aDogZGlyLCBidW5kbGVJZH07XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBhcHBsaWNhdGlvbkxpc3QgPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0NvbnRhaW5lcnMnLCBzdWJEaXIsICdBcHBsaWNhdGlvbicpO1xuICAgICAgLy8gZ2l2ZW4gYSBkaXJlY3RvcnksIGZpbmQgdGhlIHBsaXN0IGZpbGUgYW5kIHB1bGwgdGhlIGJ1bmRsZSBpZCBmcm9tIGl0XG4gICAgICBsZXQgcmVhZEJ1bmRsZUlkID0gYXN5bmMgKGRpcikgPT4ge1xuICAgICAgICBsZXQgcGxpc3QgPSBwYXRoLnJlc29sdmUoZGlyLCAnLmNvbS5hcHBsZS5tb2JpbGVfY29udGFpbmVyX21hbmFnZXIubWV0YWRhdGEucGxpc3QnKTtcbiAgICAgICAgbGV0IG1ldGFkYXRhID0gYXdhaXQgc2V0dGluZ3MucmVhZChwbGlzdCk7XG4gICAgICAgIHJldHVybiBtZXRhZGF0YS5NQ01NZXRhZGF0YUlkZW50aWZpZXI7XG4gICAgICB9O1xuICAgICAgLy8gZ2l2ZW4gYSBkaXJlY3RvcnksIHJldHVybiB0aGUgcGF0aCBhbmQgYnVuZGxlIGlkIGFzc29jaWF0ZWQgd2l0aCBpdFxuICAgICAgcGF0aEJ1bmRsZVBhaXIgPSBhc3luYyAoZGlyKSA9PiB7XG4gICAgICAgIGRpciA9IHBhdGgucmVzb2x2ZShhcHBsaWNhdGlvbkxpc3QsIGRpcik7XG4gICAgICAgIGxldCBidW5kbGVJZCA9IGF3YWl0IHJlYWRCdW5kbGVJZChkaXIpO1xuICAgICAgICByZXR1cm4ge3BhdGg6IGRpciwgYnVuZGxlSWR9O1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBsaWNhdGlvbkxpc3QpKSB7XG4gICAgICBsb2cud2FybihgTm8gZGlyZWN0b3J5IHBhdGggJyR7YXBwbGljYXRpb25MaXN0fSdgKTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICBsZXQgYnVuZGxlUGF0aERpcnMgPSBhd2FpdCBmcy5yZWFkZGlyKGFwcGxpY2F0aW9uTGlzdCk7XG4gICAgbGV0IGJ1bmRsZVBhdGhQYWlycyA9IGF3YWl0IGFzeW5jbWFwKGJ1bmRsZVBhdGhEaXJzLCBhc3luYyBmdW5jdGlvbiAoZGlyKSB7XG4gICAgICByZXR1cm4gYXdhaXQgcGF0aEJ1bmRsZVBhaXIoZGlyKTtcbiAgICB9LCBmYWxzZSk7XG5cbiAgICAvLyByZWR1Y2UgdGhlIGxpc3Qgb2YgcGF0aC1idW5kbGUgcGFpcnMgdG8gYW4gb2JqZWN0IHdoZXJlIGJ1bmRsZUlkcyBhcmUgbWFwcGVkIHRvIHBhdGhzXG4gICAgcmV0dXJuIGJ1bmRsZVBhdGhQYWlycy5yZWR1Y2UoKGJ1bmRsZU1hcCwgYnVuZGxlUGF0aCkgPT4ge1xuICAgICAgYnVuZGxlTWFwW2J1bmRsZVBhdGguYnVuZGxlSWRdID0gYnVuZGxlUGF0aC5wYXRoO1xuICAgICAgcmV0dXJuIGJ1bmRsZU1hcDtcbiAgICB9LCB7fSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzdGF0ZSBhbmQgc3BlY2lmaWNzIG9mIHRoaXMgc2ltLlxuICAgKlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFNpbXVsYXRvciBzdGF0cyBtYXBwaW5nLCBmb3IgZXhhbXBsZTpcbiAgICogeyBuYW1lOiAnaVBob25lIDRzJyxcbiAgICogICB1ZGlkOiAnQzA5QjM0RTUtN0RDQi00NDJFLUI3OUMtQUI2QkMwMzU3NDE3JyxcbiAgICogICBzdGF0ZTogJ1NodXRkb3duJyxcbiAgICogICBzZGs6ICc4LjMnXG4gICAqIH1cbiAgICovXG4gIGFzeW5jIHN0YXQgKCkge1xuICAgIGZvciAobGV0IFtzZGssIGRldmljZUFycl0gb2YgXy50b1BhaXJzKGF3YWl0IHRoaXMuc2ltY3RsLmdldERldmljZXMoKSkpIHtcbiAgICAgIGZvciAobGV0IGRldmljZSBvZiBkZXZpY2VBcnIpIHtcbiAgICAgICAgaWYgKGRldmljZS51ZGlkID09PSB0aGlzLnVkaWQpIHtcbiAgICAgICAgICBkZXZpY2Uuc2RrID0gc2RrO1xuICAgICAgICAgIHJldHVybiBkZXZpY2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBpcyBhIGJlc3QtYmV0IGhldXJpc3RpYyBmb3Igd2hldGhlciBvciBub3QgYSBzaW0gaGFzIGJlZW4gYm9vdGVkXG4gICAqIGJlZm9yZS4gV2UgdXN1YWxseSB3YW50IHRvIHN0YXJ0IGEgc2ltdWxhdG9yIHRvIFwid2FybVwiIGl0IHVwLCBoYXZlXG4gICAqIFhjb2RlIHBvcHVsYXRlIGl0IHdpdGggcGxpc3RzIGZvciB1cyB0byBtYW5pcHVsYXRlIGJlZm9yZSBhIHJlYWxcbiAgICogdGVzdCBydW4uXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGhhcyBuZXZlciBiZWVuIHN0YXJ0ZWQgYmVmb3JlXG4gICAqL1xuICBhc3luYyBpc0ZyZXNoICgpIHtcbiAgICAvLyBpZiB0aGUgZm9sbG93aW5nIGZpbGVzIGRvbid0IGV4aXN0LCBpdCBoYXNuJ3QgYmVlbiBib290ZWQuXG4gICAgLy8gVEhJUyBJUyBOT1QgQU4gRVhIQVVTVElWRSBMSVNUXG4gICAgbGV0IGZpbGVzID0gdGhpcy5pc0ZyZXNoRmlsZXM7XG5cbiAgICBsZXQgcHYgPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIGlmIChwdiAhPT0gJzcuMScpIHtcbiAgICAgIGZpbGVzLnB1c2goJ0xpYnJhcnkvUHJlZmVyZW5jZXMvY29tLmFwcGxlLlByZWZlcmVuY2VzLnBsaXN0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpbGVzLnB1c2goJ0FwcGxpY2F0aW9ucycpO1xuICAgIH1cblxuICAgIGNvbnN0IGRpciA9IHRoaXMuZ2V0RGlyKCk7XG4gICAgZmlsZXMgPSBmaWxlcy5tYXAoKHMpID0+IHBhdGgucmVzb2x2ZShkaXIsIHMpKTtcblxuICAgIGNvbnN0IGV4aXN0ZW5jZXMgPSBhd2FpdCBhc3luY21hcChmaWxlcywgYXN5bmMgKGYpID0+IGF3YWl0IGZzLmhhc0FjY2VzcyhmKSk7XG4gICAgY29uc3QgZnJlc2ggPSBfLmNvbXBhY3QoZXhpc3RlbmNlcykubGVuZ3RoICE9PSBmaWxlcy5sZW5ndGg7XG4gICAgbG9nLmRlYnVnKGBDaGVja2luZyB3aGV0aGVyIHNpbXVsYXRvciBoYXMgYmVlbiBydW4gYmVmb3JlOiAke2ZyZXNoID8gJ25vJyA6ICd5ZXMnfWApO1xuXG4gICAgcmV0dXJuIGZyZXNoO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgc3RhdGUgb2YgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLiBPbmUgc2hvdWxkIGRpc3Rpbmd1aXNoIHRoZVxuICAgKiBzdGF0ZXMgb2YgU2ltdWxhdG9yIFVJIGFuZCB0aGUgU2ltdWxhdG9yIGl0c2VsZi5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgcnVubmluZy5cbiAgICovXG4gIGFzeW5jIGlzUnVubmluZyAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLmdldEVudignZHVtbXknKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBzaW11bGF0b3IgaXMgaW4gc2h1dGRvd24gc3RhdGUuXG4gICAqIFRoaXMgbWV0aG9kIGlzIG5lY2Vzc2FyeSwgYmVjYXVzZSBTaW11bGF0b3IgbWlnaHQgYWxzbyBiZVxuICAgKiBpbiB0aGUgdHJhbnNpdGlvbmFsIFNodXR0aW5nIERvd24gc3RhdGUgcmlnaHQgYWZ0ZXIgdGhlIGBzaHV0ZG93bmBcbiAgICogY29tbWFuZCBoYXMgYmVlbiBpc3N1ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGlzIHNodXQgZG93bi5cbiAgICovXG4gIGFzeW5jIGlzU2h1dGRvd24gKCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnNpbWN0bC5nZXRFbnYoJ2R1bW15Jyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIF8uaW5jbHVkZXMoZS5zdGRlcnIsICdDdXJyZW50IHN0YXRlOiBTaHV0ZG93bicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZnkgd2hldGhlciB0aGUgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkIGFuZC9vciB3YWl0IGZvciBpdFxuICAgKiB1bnRpbCB0aGUgdGltZW91dCBleHBpcmVzLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnR1cFRpbWVvdXQgLSB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIGJvb3RpbmcgaXMgY29tcGxldGVkLlxuICAgKiBAZW1pdHMgQk9PVF9DT01QTEVURURfRVZFTlQgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGlzIHJlYWR5IHRvIGFjY2VwdCBzaW1jdGwgY29tbWFuZHMsIGxpa2UgJ2luc3RhbGwnLlxuICAgKi9cbiAgYXN5bmMgd2FpdEZvckJvb3QgKHN0YXJ0dXBUaW1lb3V0KSB7XG4gICAgLy8gd2FpdCBmb3IgdGhlIHNpbXVsYXRvciB0byBib290XG4gICAgLy8gd2FpdGluZyBmb3IgdGhlIHNpbXVsYXRvciBzdGF0dXMgdG8gYmUgJ2Jvb3RlZCcgaXNuJ3QgZ29vZCBlbm91Z2hcbiAgICAvLyBpdCBjbGFpbXMgdG8gYmUgYm9vdGVkIHdheSBiZWZvcmUgZmluaXNoaW5nIGxvYWRpbmdcbiAgICAvLyBsZXQncyB0YWlsIHRoZSBzaW11bGF0b3Igc3lzdGVtIGxvZyB1bnRpbCB3ZSBzZWUgYSBtYWdpYyBsaW5lICh0aGlzLmJvb3RlZEluZGljYXRvcilcbiAgICBsZXQgYm9vdGVkSW5kaWNhdG9yID0gYXdhaXQgdGhpcy5nZXRCb290ZWRJbmRpY2F0b3JTdHJpbmcoKTtcbiAgICBhd2FpdCB0aGlzLnRhaWxMb2dzVW50aWwoYm9vdGVkSW5kaWNhdG9yLCBzdGFydHVwVGltZW91dCk7XG5cbiAgICAvLyBzbyBzb3JyeSwgYnV0IHdlIHNob3VsZCB3YWl0IGFub3RoZXIgdHdvIHNlY29uZHMsIGp1c3QgdG8gbWFrZSBzdXJlIHdlJ3ZlIHJlYWxseSBzdGFydGVkXG4gICAgLy8gd2UgY2FuJ3QgbG9vayBmb3IgYW5vdGhlciBtYWdpYyBsb2cgbGluZSwgYmVjYXVzZSB0aGV5IHNlZW0gdG8gYmUgYXBwLWRlcGVuZGVudCAobm90IHN5c3RlbSBkZXBlbmRlbnQpXG4gICAgbG9nLmRlYnVnKGBXYWl0aW5nIGFuIGV4dHJhICR7dGhpcy5leHRyYVN0YXJ0dXBUaW1lfW1zIGZvciB0aGUgc2ltdWxhdG9yIHRvIHJlYWxseSBmaW5pc2ggYm9vdGluZ2ApO1xuICAgIGF3YWl0IEIuZGVsYXkodGhpcy5leHRyYVN0YXJ0dXBUaW1lKTtcbiAgICBsb2cuZGVidWcoJ0RvbmUgd2FpdGluZyBleHRyYSB0aW1lIGZvciBzaW11bGF0b3InKTtcblxuICAgIHRoaXMuZW1pdChCT09UX0NPTVBMRVRFRF9FVkVOVCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIG1hZ2ljIHN0cmluZywgd2hpY2gsIGlmIHByZXNlbnQgaW4gbG9ncywgcmVmbGVjdHMgdGhlIGZhY3QgdGhhdCBzaW11bGF0b3IgYm9vdGluZyBoYXMgYmVlbiBjb21wbGV0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG1hZ2ljIGxvZyBzdHJpbmcuXG4gICAqL1xuICBhc3luYyBnZXRCb290ZWRJbmRpY2F0b3JTdHJpbmcgKCkge1xuICAgIGxldCBpbmRpY2F0b3I7XG4gICAgbGV0IHBsYXRmb3JtVmVyc2lvbiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgc3dpdGNoIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICAgIGNhc2UgJzcuMSc6XG4gICAgICBjYXNlICc4LjEnOlxuICAgICAgY2FzZSAnOC4yJzpcbiAgICAgIGNhc2UgJzguMyc6XG4gICAgICBjYXNlICc4LjQnOlxuICAgICAgICBpbmRpY2F0b3IgPSAncHJvZmlsZWQ6IFNlcnZpY2Ugc3RhcnRpbmcuLi4nO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzkuMCc6XG4gICAgICBjYXNlICc5LjEnOlxuICAgICAgY2FzZSAnOS4yJzpcbiAgICAgIGNhc2UgJzkuMyc6XG4gICAgICAgIGluZGljYXRvciA9ICdTeXN0ZW0gYXBwIFwiY29tLmFwcGxlLnNwcmluZ2JvYXJkXCIgZmluaXNoZWQgc3RhcnR1cCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnMTAuMCc6XG4gICAgICAgIGluZGljYXRvciA9ICdTd2l0Y2hpbmcgdG8ga2V5Ym9hcmQnO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGxvZy53YXJuKGBObyBib290IGluZGljYXRvciBjYXNlIGZvciBwbGF0Zm9ybSB2ZXJzaW9uICcke3BsYXRmb3JtVmVyc2lvbn0nYCk7XG4gICAgICAgIGluZGljYXRvciA9ICdubyBib290IGluZGljYXRvciBzdHJpbmcgYXZhaWxhYmxlJztcbiAgICB9XG4gICAgcmV0dXJuIGluZGljYXRvcjtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFNpbXVsYXRvck9wdGlvbnNcbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBzY2FsZUZhY3RvciBbbnVsbF0gLSBEZWZpbmVzIHRoZSB3aW5kb3cgc2NhbGUgdmFsdWUgZm9yIHRoZSBVSSBjbGllbnQgd2luZG93IGZvciB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqICAgRXF1YWxzIHRvIG51bGwgYnkgZGVmYXVsdCwgd2hpY2gga2VlcHMgdGhlIGN1cnJlbnQgc2NhbGUgdW5jaGFuZ2VkLlxuICAgKiAgIEl0IHNob3VsZCBiZSBvbmUgb2YgWycxLjAnLCAnMC43NScsICcwLjUnLCAnMC4zMycsICcwLjI1J10uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzdGFydHVwVGltZW91dCBbNjAwMDBdIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIFNpbXVsYXRvciBib290aW5nXG4gICAqICAgcHJvY2VzcyBpcyBjb21wbGV0ZWQuIFRoZSBkZWZhdWx0IHRpbWVvdXQgd2lsbCBiZSB1c2VkIGlmIG5vdCBzZXQgZXhwbGljaXRseS5cbiAgICovXG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSBTaW11bGF0b3IgVUkgY2xpZW50IHdpdGggdGhlIGdpdmVuIGFyZ3VtZW50c1xuICAgKiBAcGFyYW0ge1NpbXVsYXRvck9wdGlvbnN9IG9wdHMgLSBTaW11bGF0b3Igc3RhcnR1cCBvcHRpb25zXG4gICAqL1xuICBhc3luYyBzdGFydFVJQ2xpZW50IChvcHRzID0ge30pIHtcbiAgICBvcHRzID0gXy5jbG9uZURlZXAob3B0cyk7XG4gICAgXy5kZWZhdWx0c0RlZXAob3B0cywge1xuICAgICAgc2NhbGVGYWN0b3I6IG51bGwsXG4gICAgICBzdGFydHVwVGltZW91dDogdGhpcy5zdGFydHVwVGltZW91dCxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNpbXVsYXRvckFwcCA9IHBhdGgucmVzb2x2ZShhd2FpdCBnZXRYY29kZVBhdGgoKSwgJ0FwcGxpY2F0aW9ucycsIHRoaXMuc2ltdWxhdG9yQXBwKTtcbiAgICBjb25zdCBhcmdzID0gW1xuICAgICAgJy1GbicsIHNpbXVsYXRvckFwcCxcbiAgICAgICctLWFyZ3MnLCAnLUN1cnJlbnREZXZpY2VVRElEJywgdGhpcy51ZGlkLFxuICAgIF07XG5cbiAgICBpZiAob3B0cy5zY2FsZUZhY3Rvcikge1xuICAgICAgY29uc3Qge25hbWV9ID0gYXdhaXQgdGhpcy5zdGF0KCk7XG4gICAgICBjb25zdCBmb3JtYXR0ZWREZXZpY2VOYW1lID0gbmFtZS5yZXBsYWNlKC9cXHMrL2csICctJyk7XG4gICAgICBjb25zdCBhcmd1bWVudE5hbWUgPSBgLVNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZS1jb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1EZXZpY2VUeXBlLiR7Zm9ybWF0dGVkRGV2aWNlTmFtZX1gO1xuICAgICAgYXJncy5wdXNoKGFyZ3VtZW50TmFtZSwgb3B0cy5zY2FsZUZhY3Rvcik7XG4gICAgfVxuXG4gICAgbG9nLmluZm8oYFN0YXJ0aW5nIFNpbXVsYXRvciBVSSB3aXRoIGNvbW1hbmQ6IG9wZW4gJHthcmdzLmpvaW4oJyAnKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygnb3BlbicsIGFyZ3MsIHt0aW1lb3V0OiBvcHRzLnN0YXJ0dXBUaW1lb3V0fSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIShlcnIuc3Rkb3V0IHx8ICcnKS5pbmNsdWRlcygnLTEwODI1JykgJiYgIShlcnIuc3RkZXJyIHx8ICcnKS5pbmNsdWRlcygnLTEwODI1JykpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgbG9nLndhcm4oYEVycm9yIHdoaWxlIG9wZW5pbmcgVUk6ICR7ZXJyLnN0ZG91dCB8fCBlcnIuc3RkZXJyfS4gQ29udGludWluZ2ApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlcyBnaXZlbiBTaW11bGF0b3Igd2l0aCBvcHRpb25zLiBUaGUgU2ltdWxhdG9yIHdpbGwgbm90IGJlIHJlc3RhcnRlZCBpZlxuICAgKiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIC0gT25lIG9yIG1vcmUgb2YgYXZhaWxhYmxlIFNpbXVsYXRvciBvcHRpb25zLlxuICAgKiAgIFNlZSB7I3N0YXJ0VUlDbGllbnQob3B0cyl9IGRvY3VtZW50YXRpb24gZm9yIG1vcmUgZGV0YWlscyBvbiBvdGhlciBzdXBwb3J0ZWQga2V5cy5cbiAgICovXG4gIGFzeW5jIHJ1biAob3B0cyA9IHt9KSB7XG4gICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgc3RhcnR1cFRpbWVvdXQ6IHRoaXMuc3RhcnR1cFRpbWVvdXQsXG4gICAgfSwgb3B0cyk7XG4gICAgY29uc3QgaXNTZXJ2ZXJSdW5uaW5nID0gYXdhaXQgdGhpcy5pc1J1bm5pbmcoKTtcbiAgICBjb25zdCBpc1VJQ2xpZW50UnVubmluZyA9IGF3YWl0IHRoaXMuaXNVSUNsaWVudFJ1bm5pbmcoKTtcbiAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nICYmIGlzVUlDbGllbnRSdW5uaW5nKSB7XG4gICAgICBsb2cuaW5mbyhgQm90aCBTaW11bGF0b3Igd2l0aCBVRElEICR7dGhpcy51ZGlkfSBhbmQgdGhlIFVJIGNsaWVudCBhcmUgY3VycmVudGx5IHJ1bm5pbmdgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaHV0ZG93bigpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYEVycm9yIG9uIFNpbXVsYXRvciBzaHV0ZG93bjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zdGFydFVJQ2xpZW50KG9wdHMpO1xuXG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yQm9vdChvcHRzLnN0YXJ0dXBUaW1lb3V0KTtcbiAgICBsb2cuaW5mbyhgU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH0gYm9vdGVkIGluICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc1NlY29uZHMudG9GaXhlZCgzKX1zYCk7XG4gIH1cblxuICAvLyBUT0RPIGtlZXAga2V5Y2hhaW5zXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgY3VycmVudCBTaW11bGF0b3IgdG8gdGhlIGNsZWFuIHN0YXRlLlxuICAgKi9cbiAgYXN5bmMgY2xlYW4gKCkge1xuICAgIGF3YWl0IHRoaXMuZW5kU2ltdWxhdG9yRGFlbW9uKCk7XG4gICAgbG9nLmluZm8oYENsZWFuaW5nIHNpbXVsYXRvciAke3RoaXMudWRpZH1gKTtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5lcmFzZURldmljZSgxMDAwMCk7XG4gIH1cblxuICAvKipcbiAgICogU2NydWIgKGRlbGV0ZSB0aGUgcHJlZmVyZW5jZXMgYW5kIGNoYW5nZWQgZmlsZXMpIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZpbGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwQnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAqL1xuICBhc3luYyBzY3J1YkN1c3RvbUFwcCAoYXBwRmlsZSwgYXBwQnVuZGxlSWQpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jbGVhbkN1c3RvbUFwcChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgdHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4vc2NydWIgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogQHBhcmFtIHtib29sZWFufSBzY3J1YiAtIElmIGBzY3J1YmAgaXMgZmFsc2UsIHdlIHdhbnQgdG8gY2xlYW4gYnkgZGVsZXRpbmcgdGhlIGFwcCBhbmQgYWxsXG4gICAqICAgZmlsZXMgYXNzb2NpYXRlZCB3aXRoIGl0LiBJZiBgc2NydWJgIGlzIHRydWUsIHdlIGp1c3Qgd2FudCB0byBkZWxldGUgdGhlIHByZWZlcmVuY2VzIGFuZFxuICAgKiAgIGNoYW5nZWQgZmlsZXMuXG4gICAqL1xuICBhc3luYyBjbGVhbkN1c3RvbUFwcCAoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHNjcnViID0gZmFsc2UpIHtcbiAgICBsb2cuZGVidWcoYENsZWFuaW5nIGFwcCBkYXRhIGZpbGVzIGZvciAnJHthcHBGaWxlfScsICcke2FwcEJ1bmRsZUlkfSdgKTtcbiAgICBpZiAoIXNjcnViKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGFwcCBhbHRvZ2V0aGVyYCk7XG4gICAgfVxuXG4gICAgLy8gZ2V0IHRoZSBkaXJlY3RvcmllcyB0byBiZSBkZWxldGVkXG4gICAgbGV0IGFwcERpcnMgPSBhd2FpdCB0aGlzLmdldEFwcERpcnMoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHNjcnViKTtcblxuICAgIGlmIChhcHBEaXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbG9nLmRlYnVnKCdDb3VsZCBub3QgZmluZCBhcHAgZGlyZWN0b3JpZXMgdG8gZGVsZXRlLiBJdCBpcyBwcm9iYWJseSBub3QgaW5zdGFsbGVkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG5cbiAgICBmb3IgKGxldCBkaXIgb2YgYXBwRGlycykge1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBkaXJlY3Rvcnk6ICcke2Rpcn0nYCk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihkaXIpKTtcbiAgICB9XG5cbiAgICBpZiAoYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKSA+PSA4KSB7XG4gICAgICBsZXQgcmVsUm1QYXRoID0gYExpYnJhcnkvUHJlZmVyZW5jZXMvJHthcHBCdW5kbGVJZH0ucGxpc3RgO1xuICAgICAgbGV0IHJtUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldFJvb3REaXIoKSwgcmVsUm1QYXRoKTtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgZmlsZTogJyR7cm1QYXRofSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHJtUGF0aCkpO1xuICAgIH1cblxuICAgIGF3YWl0IEIuYWxsKGRlbGV0ZVByb21pc2VzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBwYXRocyB0byBkaXJzIHdoZXJlIGFwcGxpY2F0aW9uIGRhdGEgaXMgc3RvcmVkLiBpT1MgOCsgc3RvcmVzIGFwcCBkYXRhIGluIHR3byBwbGFjZXMsXG4gICAqIGFuZCBpT1MgNy4xIGhhcyBvbmx5IG9uZSBkaXJlY3RvcnlcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZpbGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwQnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2NydWIgLSBUaGUgYEJ1bmRsZWAgZGlyZWN0b3J5IGhhcyB0aGUgYWN0dWFsIGFwcCBpbiBpdC4gSWYgd2UgYXJlIGp1c3Qgc2NydWJiaW5nLFxuICAgKiAgIHdlIHdhbnQgdGhpcyB0byBzdGF5LiBJZiB3ZSBhcmUgY2xlYW5pbmcgd2UgZGVsZXRlLlxuICAgKiBAcmV0dXJuIHthcnJheTxzdHJpbmc+fSBBcnJheSBvZiBhcHBsaWNhdGlvbiBkYXRhIHBhdGhzLlxuICAgKi9cbiAgYXN5bmMgZ2V0QXBwRGlycyAoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHNjcnViID0gZmFsc2UpIHtcbiAgICBsZXQgZGlycyA9IFtdO1xuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID49IDgpIHtcbiAgICAgIGxldCBkYXRhID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoYXBwQnVuZGxlSWQpO1xuICAgICAgaWYgKCFkYXRhKSByZXR1cm4gZGlyczsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgICBsZXQgYnVuZGxlID0gIXNjcnViID8gYXdhaXQgdGhpcy5nZXRBcHBEaXIoYXBwQnVuZGxlSWQsICdCdW5kbGUnKSA6IHVuZGVmaW5lZDtcblxuICAgICAgZm9yIChsZXQgc3JjIG9mIFtkYXRhLCBidW5kbGVdKSB7XG4gICAgICAgIGlmIChzcmMpIHtcbiAgICAgICAgICBkaXJzLnB1c2goc3JjKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKGFwcEZpbGUpO1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgZGlycy5wdXNoKGRhdGEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGlycztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSBTaW11bGF0b3IgaW4gb3JkZXIgdG8gaGF2ZSB0aGUgaW5pdGlhbCBmaWxlIHN0cnVjdHVyZSBjcmVhdGVkIGFuZCBzaHV0ZG93biBpdCBhZnRlcndhcmRzLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNhZmFyaSAtIFdoZXRoZXIgdG8gZXhlY3V0ZSBtb2JpbGUgU2FmYXJpIGFmdGVyIHN0YXJ0dXAuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydHVwVGltZW91dCAtIEhvdyBsb25nIHRvIHdhaXQgdW50aWwgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkIChpbiBtaWxsaXNlY29uZHMpLlxuICAgKi9cbiAgYXN5bmMgbGF1bmNoQW5kUXVpdCAoc2FmYXJpID0gZmFsc2UsIHN0YXJ0dXBUaW1lb3V0ID0gdGhpcy5zdGFydHVwVGltZW91dCkge1xuICAgIGxvZy5kZWJ1ZygnQXR0ZW1wdGluZyB0byBsYXVuY2ggYW5kIHF1aXQgdGhlIHNpbXVsYXRvciwgdG8gY3JlYXRlIGRpcmVjdG9yeSBzdHJ1Y3R1cmUnKTtcbiAgICBsb2cuZGVidWcoYFdpbGwgbGF1bmNoIHdpdGggU2FmYXJpPyAke3NhZmFyaX1gKTtcblxuICAgIGF3YWl0IHRoaXMucnVuKHtzdGFydHVwVGltZW91dH0pO1xuXG4gICAgaWYgKHNhZmFyaSkge1xuICAgICAgYXdhaXQgdGhpcy5vcGVuVXJsKCdodHRwOi8vd3d3LmFwcGl1bS5pbycpO1xuICAgIH1cblxuICAgIC8vIHdhaXQgZm9yIHRoZSBzeXN0ZW0gdG8gY3JlYXRlIHRoZSBmaWxlcyB3ZSB3aWxsIG1hbmlwdWxhdGVcbiAgICAvLyBuZWVkIHF1aXRlIGEgaGlnaCByZXRyeSBudW1iZXIsIGluIG9yZGVyIHRvIGFjY29tbW9kYXRlIGlPUyA3LjFcbiAgICAvLyBsb2NhbGx5LCA3LjEgYXZlcmFnZXMgOC41IHJldHJpZXMgKGZyb20gNiAtIDEyKVxuICAgIC8vICAgICAgICAgIDggYXZlcmFnZXMgMC42IHJldHJpZXMgKGZyb20gMCAtIDIpXG4gICAgLy8gICAgICAgICAgOSBhdmVyYWdlcyAxNCByZXRyaWVzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNjAsIDI1MCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NpbXVsYXRvciBmaWxlcyBub3QgZnVsbHkgY3JlYXRlZC4gV2FpdGluZyBhIGJpdCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBUaW1lb3V0IHdhaXRpbmcgZm9yIHNpbXVsYXRvciBmaWxlcyB0byBiZSBjcmVhdGVkLiBDb250aW51aW5nYCk7XG4gICAgfVxuXG4gICAgLy8gYW5kIHF1aXRcbiAgICBhd2FpdCB0aGlzLnNodXRkb3duKCk7XG4gIH1cblxuICAvKipcbiAgICogTG9va3MgZm9yIGxhdW5jaGQgZGFlbW9ucyBjb3JyZXNwb25kaW5nIHRvIHRoZSBzaW0gdWRpZCBhbmQgdHJpZXMgdG8gc3RvcCB0aGVtIGNsZWFubHlcbiAgICogVGhpcyBwcmV2ZW50cyB4Y3J1biBzaW1jdGwgZXJhc2UgZnJvbSBoYW5naW5nLlxuICAgKi9cbiAgYXN5bmMgZW5kU2ltdWxhdG9yRGFlbW9uICgpIHtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgYW55IHNpbXVsYXRvciBkYWVtb25zIGZvciAke3RoaXMudWRpZH1gKTtcblxuICAgIGxldCBsYXVuY2hjdGxDbWQgPSBgbGF1bmNoY3RsIGxpc3QgfCBncmVwICR7dGhpcy51ZGlkfSB8IGN1dCAtZiAzIHwgeGFyZ3MgLW4gMSBsYXVuY2hjdGxgO1xuICAgIHRyeSB7XG4gICAgICBsZXQgc3RvcENtZCA9IGAke2xhdW5jaGN0bENtZH0gc3RvcGA7XG4gICAgICBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsIHN0b3BDbWRdKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3Qgc3RvcCBzaW11bGF0b3IgZGFlbW9uczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnQ2Fycnlpbmcgb24gYW55d2F5IScpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgbGV0IHJlbW92ZUNtZCA9IGAke2xhdW5jaGN0bENtZH0gcmVtb3ZlYDtcbiAgICAgIGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJywgcmVtb3ZlQ21kXSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IHJlbW92ZSBzaW11bGF0b3IgZGFlbW9uczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnQ2Fycnlpbmcgb24gYW55d2F5IScpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgLy8gV2FpdHMgMTAgc2VjIGZvciB0aGUgc2ltdWxhdG9yIGxhdW5jaGQgc2VydmljZXMgdG8gc3RvcC5cbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsXG4gICAgICAgICAgYHBzIC1lICB8IGdyZXAgJHt0aGlzLnVkaWR9IHwgZ3JlcCBsYXVuY2hkX3NpbSB8IGdyZXAgLXYgYmFzaCB8IGdyZXAgLXYgZ3JlcCB8IGF3ayB7J3ByaW50JDEnfWBdKTtcbiAgICAgICAgcmV0dXJuIHN0ZG91dC50cmltKCkubGVuZ3RoID09PSAwO1xuICAgICAgfSwge3dhaXRNczogMTAwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCBlbmQgc2ltdWxhdG9yIGRhZW1vbiBmb3IgJHt0aGlzLnVkaWR9OiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFNodXRkb3duT3B0aW9uc1xuICAgKiBAcHJvcGVydHkgez9udW1iZXJ8c3RyaW5nfSB0aW1lb3V0IFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWxcbiAgICogU2ltdWxhdG9yIGlzIHNodXQgZG93biBjb21wbGV0ZWx5LiBObyB3YWl0IGhhcHBlbnMgaWYgdGhlIHRpbWVvdXQgdmFsdWUgaXMgbm90IHNldFxuICAgKi9cblxuICAvKipcbiAgICogU2h1dCBkb3duIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHs/U2h1dGRvd25PcHRpb25zfSBvcHRzXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBTaW11bGF0b3IgZmFpbHMgdG8gdHJhbnNpdGlvbiBpbnRvIFNodXRkb3duIHN0YXRlIGFmdGVyXG4gICAqIHRoZSBnaXZlbiB0aW1lb3V0XG4gICAqL1xuICBhc3luYyBzaHV0ZG93biAob3B0cyA9IHt9KSB7XG4gICAgaWYgKGF3YWl0IHRoaXMuaXNTaHV0ZG93bigpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgcmV0cnlJbnRlcnZhbCg1LCA1MDAsIHRoaXMuc2ltY3RsLnNodXRkb3duRGV2aWNlLmJpbmQodGhpcy5zaW1jdGwpKTtcbiAgICBjb25zdCB3YWl0TXMgPSBwYXJzZUludChvcHRzLnRpbWVvdXQsIDEwKTtcbiAgICBpZiAod2FpdE1zID4gMCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmlzU2h1dGRvd24oKSwge1xuICAgICAgICAgIHdhaXRNcyxcbiAgICAgICAgICBpbnRlcnZhbE1zOiAxMDAsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU2ltdWxhdG9yIGlzIG5vdCBpbiAnU2h1dGRvd24nIHN0YXRlIGFmdGVyICR7d2FpdE1zfW1zYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSB0aGUgcGFydGljdWxhciBTaW11bGF0b3IgZnJvbSBkZXZpY2VzIGxpc3RcbiAgICovXG4gIGFzeW5jIGRlbGV0ZSAoKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuZGVsZXRlRGV2aWNlKCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBwYXJ0aWN1bGFyIHByZWZlcmVuY2UgZmlsZSB3aXRoIHRoZSBnaXZlbiBrZXkvdmFsdWUgcGFpcnMuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwbGlzdCAtIFRoZSBwcmVmZXJlbmNlcyBmaWxlIHRvIHVwZGF0ZS5cbiAgICogQHBhcmFtIHtvYmplY3R9IHVwZGF0ZXMgLSBUaGUga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNldHRpbmdzIChwbGlzdCwgdXBkYXRlcykge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVTZXR0aW5ncyh0aGlzLCBwbGlzdCwgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICogQXV0aG9yaXplL2RlLWF1dGhvcml6ZSBsb2NhdGlvbiBzZXR0aW5ncyBmb3IgYSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgYXBwbGljYXRpb24gSUQgdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGF1dGhvcml6ZWQgLSBXaGV0aGVyIG9yIG5vdCB0byBhdXRob3JpemUuXG4gICAqL1xuICBhc3luYyB1cGRhdGVMb2NhdGlvblNldHRpbmdzIChidW5kbGVJZCwgYXV0aG9yaXplZCkge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVMb2NhdGlvblNldHRpbmdzKHRoaXMsIGJ1bmRsZUlkLCBhdXRob3JpemVkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmFibGUvRGlzYWJsZSByZWR1Y2UgbW90aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHJlZHVjZU1vdGlvbiAtIFdoZXRoZXIgb3Igbm90IHRvIGVuYWJsZSBpdC5cbiAgICovXG4gIGFzeW5jIHNldFJlZHVjZU1vdGlvbiAocmVkdWNlTW90aW9uID0gdHJ1ZSkge1xuICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgYXdhaXQgdGhpcy5sYXVuY2hBbmRRdWl0KGZhbHNlLCBTVEFSVFVQX1RJTUVPVVQpO1xuICAgIH1cblxuICAgIGF3YWl0IHNldHRpbmdzLnNldFJlZHVjZU1vdGlvbih0aGlzLCByZWR1Y2VNb3Rpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgVUkgYXBwZWFyYW5jZSBzdHlsZS5cbiAgICogVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gYSBib290ZWQgc2ltdWxhdG9yLlxuICAgKlxuICAgKiBAc2luY2UgWGNvZGUgU0RLIDExLjRcbiAgICovXG4gIGFzeW5jIHNldEFwcGVhcmFuY2UgKC8qIHZhbHVlICovKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRocm93IG5ldyBFcnJvcihgWGNvZGUgU0RLICcke3RoaXMueGNvZGVWZXJzaW9ufScgaXMgdG9vIG9sZCB0byBzZXQgVUkgYXBwZWFyYW5jZWApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGN1cnJlbnQgVUkgYXBwZWFyYW5jZSBzdHlsZVxuICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiBhIGJvb3RlZCBzaW11bGF0b3IuXG4gICAqXG4gICAqIEBzaW5jZSBYY29kZSBTREsgMTEuNFxuICAgKi9cbiAgYXN5bmMgZ2V0QXBwZWFyYW5jZSAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRocm93IG5ldyBFcnJvcihgWGNvZGUgU0RLICcke3RoaXMueGNvZGVWZXJzaW9ufScgaXMgdG9vIG9sZCB0byBnZXQgVUkgYXBwZWFyYW5jZWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzZXR0aW5ncyBmb3IgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBoYXNoIG9mIGtleS92YWx1ZSBwYWlycyB0byB1cGRhdGUgZm9yIFNhZmFyaS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNhZmFyaVNldHRpbmdzICh1cGRhdGVzKSB7XG4gICAgbGV0IHVwZGF0ZWQgPSBhd2FpdCBzZXR0aW5ncy51cGRhdGVTYWZhcmlVc2VyU2V0dGluZ3ModGhpcywgdXBkYXRlcyk7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNldHRpbmdzKHRoaXMsICdtb2JpbGVTYWZhcmknLCB1cGRhdGVzKSB8fCB1cGRhdGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBnbG9iYWwgc2V0dGluZ3MgZm9yIFNhZmFyaS5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IHVwZGF0ZXMgLSBUaGUgaGFzaCBvZiBrZXkvdmFsdWUgcGFpcnMgdG8gdXBkYXRlIGZvciBTYWZhcmkuXG4gICAqL1xuICBhc3luYyB1cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncyAodXBkYXRlcykge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncyh0aGlzLCB1cGRhdGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGxvY2FsZSBmb3IgdGhlIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gVGhlIGxhbmd1YWdlIGZvciB0aGUgc2ltdWxhdG9yLiBFLmcuLCBgXCJmcl9VU1wiYC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIFRoZSBsb2NhbGUgdG8gc2V0IGZvciB0aGUgc2ltdWxhdG9yLiBFLmcuLCBgXCJlblwiYC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGNhbGVuZGFyRm9ybWF0IC0gVGhlIGZvcm1hdCBvZiB0aGUgY2FsZW5kYXIuXG4gICAqL1xuICBhc3luYyB1cGRhdGVMb2NhbGUgKGxhbmd1YWdlLCBsb2NhbGUsIGNhbGVuZGFyRm9ybWF0KSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZUxvY2FsZSh0aGlzLCBsYW5ndWFnZSwgbG9jYWxlLCBjYWxlbmRhckZvcm1hdCk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcGxldGVseSBkZWxldGUgbW9iaWxlIFNhZmFyaSBhcHBsaWNhdGlvbiBmcm9tIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVNhZmFyaSAoKSB7XG4gICAgbG9nLmRlYnVnKCdEZWxldGluZyBTYWZhcmkgYXBwcyBmcm9tIHNpbXVsYXRvcicpO1xuXG4gICAgbGV0IGRpcnMgPSBbXTtcblxuICAgIC8vIGdldCB0aGUgZGF0YSBkaXJlY3RvcnlcbiAgICBkaXJzLnB1c2goYXdhaXQgdGhpcy5nZXRBcHBEaXIoJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknKSk7XG5cbiAgICBsZXQgcHYgPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIGlmIChwdiA+PSA4KSB7XG4gICAgICAvLyBnZXQgdGhlIGJ1bmRsZSBkaXJlY3RvcnlcbiAgICAgIGRpcnMucHVzaChhd2FpdCB0aGlzLmdldEFwcERpcignY29tLmFwcGxlLm1vYmlsZXNhZmFyaScsICdCdW5kbGUnKSk7XG4gICAgfVxuXG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG4gICAgZm9yIChsZXQgZGlyIG9mIF8uY29tcGFjdChkaXJzKSkge1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBkaXJlY3Rvcnk6ICcke2Rpcn0nYCk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihkaXIpKTtcbiAgICB9XG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIHVwIHRoZSBkaXJlY3RvcmllcyBmb3IgbW9iaWxlIFNhZmFyaS5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBrZWVwUHJlZnMgLSBXaGV0aGVyIHRvIGtlZXAgU2FmYXJpIHByZWZlcmVuY2VzIGZyb20gYmVpbmcgZGVsZXRlZC5cbiAgICovXG4gIGFzeW5jIGNsZWFuU2FmYXJpIChrZWVwUHJlZnMgPSB0cnVlKSB7XG4gICAgbG9nLmRlYnVnKCdDbGVhbmluZyBtb2JpbGUgc2FmYXJpIGRhdGEgZmlsZXMnKTtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgIGxvZy5pbmZvKCdDb3VsZCBub3QgZmluZCBTYWZhcmkgc3VwcG9ydCBkaXJlY3RvcmllcyB0byBjbGVhbiBvdXQgb2xkICcgK1xuICAgICAgICAgICAgICAgJ2RhdGEuIFByb2JhYmx5IHRoZXJlIGlzIG5vdGhpbmcgdG8gY2xlYW4gb3V0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGxpYnJhcnlEaXIgPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0xpYnJhcnknKTtcbiAgICBsZXQgc2FmYXJpUm9vdCA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKCdjb20uYXBwbGUubW9iaWxlc2FmYXJpJyk7XG4gICAgaWYgKCFzYWZhcmlSb290KSB7XG4gICAgICBsb2cuaW5mbygnQ291bGQgbm90IGZpbmQgU2FmYXJpIHN1cHBvcnQgZGlyZWN0b3JpZXMgdG8gY2xlYW4gb3V0IG9sZCAnICtcbiAgICAgICAgICAgICAgICdkYXRhLiBQcm9iYWJseSB0aGVyZSBpcyBub3RoaW5nIHRvIGNsZWFuIG91dCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc2FmYXJpTGlicmFyeURpciA9IHBhdGgucmVzb2x2ZShzYWZhcmlSb290LCAnTGlicmFyeScpO1xuICAgIGxldCBmaWxlc1RvRGVsZXRlID0gW1xuICAgICAgJ0NhY2hlcy9TbmFwc2hvdHMvY29tLmFwcGxlLm1vYmlsZXNhZmFyaScsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5tb2JpbGVzYWZhcmkvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5XZWJBcHBDYWNoZS8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLldlYktpdC5OZXR3b3JraW5nLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuV2ViS2l0LldlYkNvbnRlbnQvKicsXG4gICAgICAnSW1hZ2UgQ2FjaGUvKicsXG4gICAgICAnV2ViS2l0L2NvbS5hcHBsZS5tb2JpbGVzYWZhcmkvKicsXG4gICAgICAnV2ViS2l0L0dlb2xvY2F0aW9uU2l0ZXMucGxpc3QnLFxuICAgICAgJ1dlYktpdC9Mb2NhbFN0b3JhZ2UvKi4qJyxcbiAgICAgICdTYWZhcmkvKicsXG4gICAgICAnQ29va2llcy8qLmJpbmFyeWNvb2tpZXMnLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuVUlTdGF0dXNCYXIvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5rZXlib2FyZHMvaW1hZ2VzLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuU2FmYXJpLlNhZmVCcm93c2luZy8qJyxcbiAgICAgICcuLi90bXAvY29tLmFwcGxlLm1vYmlsZXNhZmFyaS8qJ1xuICAgIF07XG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG5cbiAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzVG9EZWxldGUpIHtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHBhdGgucmVzb2x2ZShsaWJyYXJ5RGlyLCBmaWxlKSkpO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKHNhZmFyaUxpYnJhcnlEaXIsIGZpbGUpKSk7XG4gICAgfVxuXG4gICAgaWYgKCFrZWVwUHJlZnMpIHtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHBhdGgucmVzb2x2ZShzYWZhcmlMaWJyYXJ5RGlyLCAnUHJlZmVyZW5jZXMvKi5wbGlzdCcpKSk7XG4gICAgfVxuXG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuaW5zdGFsbCB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gZnJvbSB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidWluZGxlIElEIG9mIHRoZSBhcHBsaWNhdGlvbiB0byBiZSByZW1vdmVkLlxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlQXBwIChidW5kbGVJZCkge1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnJlbW92ZUFwcChidW5kbGVJZCk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBhIGJ1aWx0LWluIGFwcGxpY2F0aW9uIHRvIGEgbmV3IHBsYWNlIChhY3R1YWxseSwgcmVuYW1lIGl0KS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcE5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgYXBwIHRvIGJlIG1vdmVkLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBjdXJyZW50IHBhdGggdG8gdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3QXBwUGF0aCAtIFRoZSBuZXcgcGF0aCB0byB0aGUgYXBwbGljYXRpb24uXG4gICAqICAgSWYgc29tZSBhcHBsaWNhdGlvbiBhbHJlYWR5IGV4aXN0cyBieSB0aGlzIHBhdGggdGhlbiBpdCdzIGdvaW5nIHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyBtb3ZlQnVpbHRJbkFwcCAoYXBwTmFtZSwgYXBwUGF0aCwgbmV3QXBwUGF0aCkge1xuICAgIGF3YWl0IHNhZmVSaW1SYWYobmV3QXBwUGF0aCk7XG4gICAgYXdhaXQgZnMuY29weUZpbGUoYXBwUGF0aCwgbmV3QXBwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBDb3BpZWQgJyR7YXBwTmFtZX0nIHRvICcke25ld0FwcFBhdGh9J2ApO1xuXG4gICAgYXdhaXQgZnMucmltcmFmKGFwcFBhdGgpO1xuICAgIGxvZy5kZWJ1ZyhgVGVtcG9yYXJpbHkgZGVsZXRlZCBvcmlnaW5hbCBhcHAgYXQgJyR7YXBwUGF0aH0nYCk7XG5cbiAgICByZXR1cm4gW25ld0FwcFBhdGgsIGFwcFBhdGhdO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIGdpdmVuIFVSTCBpbiBtb2JpbGUgU2FmYXJpIGJyb3dzZXIuXG4gICAqIFRoZSBicm93c2VyIHdpbGwgYmUgc3RhcnRlZCBhdXRvbWF0aWNhbGx5IGlmIGl0IGlzIG5vdCBydW5uaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBiZSBvcGVuZWQuXG4gICAqL1xuICBhc3luYyBvcGVuVXJsICh1cmwpIHtcbiAgICBjb25zdCBTQUZBUklfQk9PVEVEX0lORElDQVRPUiA9ICdNb2JpbGVTYWZhcmlbJztcbiAgICBjb25zdCBTQUZBUklfU1RBUlRVUF9USU1FT1VUID0gMTUgKiAxMDAwO1xuICAgIGNvbnN0IEVYVFJBX1NUQVJUVVBfVElNRSA9IDMgKiAxMDAwO1xuXG4gICAgaWYgKGF3YWl0IHRoaXMuaXNSdW5uaW5nKCkpIHtcbiAgICAgIGF3YWl0IHJldHJ5KDUwMDAsIHRoaXMuc2ltY3RsLm9wZW5VcmwuYmluZCh0aGlzLnNpbWN0bCksIHVybCk7XG4gICAgICBhd2FpdCB0aGlzLnRhaWxMb2dzVW50aWwoU0FGQVJJX0JPT1RFRF9JTkRJQ0FUT1IsIFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQpO1xuICAgICAgLy8gU28gc29ycnksIGJ1dCB0aGUgbG9ncyBoYXZlIG5vdGhpbmcgZWxzZSBmb3IgU2FmYXJpIHN0YXJ0aW5nLi4ganVzdCBkZWxheSBhIGxpdHRsZSBiaXRcbiAgICAgIGxvZy5kZWJ1ZyhgU2FmYXJpIHN0YXJ0ZWQsIHdhaXRpbmcgJHtFWFRSQV9TVEFSVFVQX1RJTUV9bXMgZm9yIGl0IHRvIGZ1bGx5IHN0YXJ0YCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KEVYVFJBX1NUQVJUVVBfVElNRSk7XG4gICAgICBsb2cuZGVidWcoJ0RvbmUgd2FpdGluZyBmb3IgU2FmYXJpJyk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVHJpZWQgdG8gb3BlbiBhIHVybCwgYnV0IHRoZSBTaW11bGF0b3IgaXMgbm90IEJvb3RlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIFNpbXVsYXRvciBjYWNoZXMgY2xlYW51cC5cbiAgICpcbiAgICogQHBhcmFtIHsuLi5zdHJpbmd9IGZvbGRlck5hbWVzIC0gVGhlIG5hbWVzIG9mIENhY2hlcyBzdWJmb2xkZXJzIHRvIGJlIGNsZWFuZWQuXG4gICAqICAgTm9uLWFjY2Vzc2libGUvbm9uLWV4aXN0aW5nIHN1YmZvbGRlcnMgd2lsbCBiZSBza2lwcGVkLlxuICAgKiAgIEFsbCBleGlzdGluZyBzdWJmb2xkZXJzIHVuZGVyIENhY2hlcyB3aWxsIGJlIGRlbGV0ZWQgaWYgdGhpcyBwYXJhbWV0ZXIgaXMgb21pdHRlZC5cbiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGNvdW50IG9mIGNsZWFuZWQgY2FjaGUgaXRlbXMuXG4gICAqICAgWmVybyBpcyByZXR1cm5lZCBpZiBubyBpdGVtcyB3ZXJlIG1hdGNoZWQgZm9yIGNsZWFudXAgKGVpdGhlciBub3QgYWNjZXNzaWJsZSBvciBub3QgZGlyZWN0b3JpZXMpLlxuICAgKi9cbiAgYXN5bmMgY2xlYXJDYWNoZXMgKC4uLmZvbGRlck5hbWVzKSB7XG4gICAgY29uc3QgY2FjaGVzUm9vdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScsICdDYWNoZXMnKTtcbiAgICBpZiAoIShhd2FpdCBmcy5oYXNBY2Nlc3MoY2FjaGVzUm9vdCkpKSB7XG4gICAgICBsb2cuZGVidWcoYENhY2hlcyByb290IGF0ICcke2NhY2hlc1Jvb3R9JyBkb2VzIG5vdCBleGlzdCBvciBpcyBub3QgYWNjZXNzaWJsZS4gTm90aGluZyB0byBkbyB0aGVyZWApO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgbGV0IGl0ZW1zVG9SZW1vdmUgPSBmb2xkZXJOYW1lcy5sZW5ndGggPyBmb2xkZXJOYW1lcyA6IChhd2FpdCBmcy5yZWFkZGlyKGNhY2hlc1Jvb3QpKTtcbiAgICBpdGVtc1RvUmVtb3ZlID0gaXRlbXNUb1JlbW92ZS5tYXAoKHgpID0+IHBhdGgucmVzb2x2ZShjYWNoZXNSb290LCB4KSk7XG4gICAgaWYgKGZvbGRlck5hbWVzLmxlbmd0aCkge1xuICAgICAgaXRlbXNUb1JlbW92ZSA9IGF3YWl0IEIuZmlsdGVyKGl0ZW1zVG9SZW1vdmUsICh4KSA9PiBmcy5oYXNBY2Nlc3MoeCkpO1xuICAgIH1cbiAgICBpdGVtc1RvUmVtb3ZlID0gYXdhaXQgQi5maWx0ZXIoaXRlbXNUb1JlbW92ZSwgYXN5bmMgKHgpID0+IChhd2FpdCBmcy5zdGF0KHgpKS5pc0RpcmVjdG9yeSgpKTtcbiAgICBpZiAoIWl0ZW1zVG9SZW1vdmUubGVuZ3RoKSB7XG4gICAgICBsb2cuZGVidWcoYE5vIFNpbXVsYXRvciBjYWNoZSBpdGVtcyBmb3IgY2xlYW51cCB3ZXJlIG1hdGNoZWQgaW4gJyR7Y2FjaGVzUm9vdH0nYCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYE1hdGNoZWQgJHt1dGlsLnBsdXJhbGl6ZSgnc2ltdWxhdG9yIGNhY2hlIGl0ZW0nLCBpdGVtc1RvUmVtb3ZlLmxlbmd0aCwgdHJ1ZSl9IGAgK1xuICAgICAgYGZvciBjbGVhbnVwOiAke2l0ZW1zVG9SZW1vdmV9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IEIuYWxsKGl0ZW1zVG9SZW1vdmUsICh4KSA9PiBmcy5yaW1yYWYoeCkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBHb3QgYW4gZXhjZXB0aW9uIHdoaWxlIGNsZWFuaW5nIFNpbXVsYXRvciBjYWNoZXM6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbXNUb1JlbW92ZS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogQmxvY2tzIHVudGlsIHRoZSBnaXZlbiBpbmRpY2F0ZXIgc3RyaW5nIGFwcGVhcnMgaW4gU2ltdWxhdG9yIGxvZ3MuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBib290ZWRJbmRpY2F0b3IgLSBUaGUgbWFnaWMgc3RyaW5nLCB3aGljaCBhcHBlYXJzIGluIGxvZ3MgYWZ0ZXIgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkLlxuICAgKiBAcGFyYW0ge251bWJlcn0gdGltZW91dE1zIC0gVGhlIG1heGltdW1tIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3IgdGhlIHN0cmluZyBpbmRpY2F0b3IgcHJlc2VuY2UuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBpb3Mgc2ltdWxhdG9yIGxvZ3Mgb3V0cHV0IGEgbGluZSBtYXRjaGluZyBgYm9vdGVkSW5kaWNhdG9yYFxuICAgKiB0aW1lcyBvdXQgYWZ0ZXIgdGltZW91dE1zXG4gICAqL1xuICBhc3luYyB0YWlsTG9nc1VudGlsIChib290ZWRJbmRpY2F0b3IsIHRpbWVvdXRNcykge1xuICAgIGxldCBzaW1Mb2cgPSBwYXRoLnJlc29sdmUodGhpcy5nZXRMb2dEaXIoKSwgJ3N5c3RlbS5sb2cnKTtcblxuICAgIC8vIHdlIG5lZWQgdG8gbWFrZSBzdXJlIGxvZyBmaWxlIGV4aXN0cyBiZWZvcmUgd2UgY2FuIHRhaWwgaXRcbiAgICBhd2FpdCByZXRyeUludGVydmFsKDIwMCwgMjAwLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZXhpc3RzID0gYXdhaXQgZnMuZXhpc3RzKHNpbUxvZyk7XG4gICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBmaW5kIFNpbXVsYXRvciBsb2c6ICcke3NpbUxvZ30nYCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsb2cuaW5mbyhgU2ltdWxhdG9yIGxvZyBhdCAnJHtzaW1Mb2d9J2ApO1xuICAgIGxvZy5pbmZvKGBUYWlsaW5nIHNpbXVsYXRvciBsb2dzIHVudGlsIHdlIGVuY291bnRlciB0aGUgc3RyaW5nIFwiJHtib290ZWRJbmRpY2F0b3J9XCJgKTtcbiAgICBsb2cuaW5mbyhgV2Ugd2lsbCB0aW1lIG91dCBhZnRlciAke3RpbWVvdXRNc31tc2ApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0YWlsVW50aWwoc2ltTG9nLCBib290ZWRJbmRpY2F0b3IsIHRpbWVvdXRNcyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cuZGVidWcoJ1NpbXVsYXRvciBzdGFydHVwIHRpbWVkIG91dC4gQ29udGludWluZyBhbnl3YXkuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZSBDYWxlbmRhciBhY2Nlc3MgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlEIC0gQnVuZGxlIElEIG9mIHRoZSBhcHBsaWNhdGlvbiwgZm9yIHdoaWNoIHRoZSBhY2Nlc3Mgc2hvdWxkIGJlIGdyYW50ZWQuXG4gICAqL1xuICBhc3luYyBlbmFibGVDYWxlbmRhckFjY2VzcyAoYnVuZGxlSUQpIHtcbiAgICBhd2FpdCB0aGlzLmNhbGVuZGFyLmVuYWJsZUNhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNhYmxlIENhbGVuZGFyIGFjY2VzcyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSUQgLSBCdW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uLCBmb3Igd2hpY2ggdGhlIGFjY2VzcyBzaG91bGQgYmUgZGVuaWVkLlxuICAgKi9cbiAgYXN5bmMgZGlzYWJsZUNhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIGF3YWl0IHRoaXMuY2FsZW5kYXIuZGlzYWJsZUNhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBoYXMgYWNjZXNzIHRvIENhbGVuZGFyLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBoYXMgdGhlIGFjY2Vzcy5cbiAgICovXG4gIGFzeW5jIGhhc0NhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNhbGVuZGFyLmhhc0NhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY3RpdmF0ZXMgU2ltdWxhdG9yIHdpbmRvdy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHJldHVybnMgez9zdHJpbmd9IElmIHRoZSBtZXRob2QgcmV0dXJucyBhIHN0cmluZyB0aGVuIGl0IHNob3VsZCBiZSBhIHZhbGlkIEFwcGxlIFNjcmlwdCB3aGljaFxuICAgKiBpcyBhcHBlbmRlZCBiZWZvcmUgZWFjaCBVSSBjbGllbnQgY29tbWFuZCBpcyBleGVjdXRlZC4gT3RoZXJ3aXNlIHRoZSBtZXRob2Qgc2hvdWxkIGFjdGl2YXRlIHRoZSB3aW5kb3dcbiAgICogaXRzZWxmIGFuZCByZXR1cm4gbm90aGluZy5cbiAgICovXG4gIGFzeW5jIF9hY3RpdmF0ZVdpbmRvdyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIGNvbnN0IHBpZCA9IGF3YWl0IHRoaXMuZ2V0VUlDbGllbnRQaWQoKTtcbiAgICBpZiAocGlkKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgYWN0aXZhdGVBcHAocGlkKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmRlYnVnKGUuc3RkZXJyIHx8IGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byBmYWxzZVxuICAgICAgICAgIHNldCBmcm9udG1vc3QgdG8gdHJ1ZVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgZ2l2ZW4gQXBwbGUgU2NyaXB0IGluc2lkZSBhIGNyaXRpY2FsIHNlY3Rpb24sIHNvIG90aGVyXG4gICAqIHNlc3Npb25zIGNhbm5vdCBpbmZsdWVuY2UgdGhlIFVJIGNsaWVudCBhdCB0aGUgc2FtZSB0aW1lLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwbGVTY3JpcHQgLSBUaGUgdmFsaWQgQXBwbGUgU2NyaXB0IHNuaXBwZXQgdG8gYmUgZXhlY3V0ZWQuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0ZG91dCBvdXRwdXQgcHJvZHVjZWQgYnkgdGhlIHNjcmlwdC5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIG9zYXNjcmlwdCB0b29sIHJldHVybnMgbm9uLXplcm8gZXhpdCBjb2RlLlxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IChhcHBsZVNjcmlwdCkge1xuICAgIGNvbnN0IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgPSBhd2FpdCB0aGlzLl9hY3RpdmF0ZVdpbmRvdygpO1xuICAgIGNvbnN0IHJlc3VsdFNjcmlwdCA9IGAke3dpbmRvd0FjdGl2YXRpb25TY3JpcHQgPyB3aW5kb3dBY3RpdmF0aW9uU2NyaXB0ICsgJ1xcbicgOiAnJ30ke2FwcGxlU2NyaXB0fWA7XG4gICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgVUkgQXBwbGUgU2NyaXB0IG9uIFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9OiAke3Jlc3VsdFNjcmlwdH1gKTtcbiAgICByZXR1cm4gYXdhaXQgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRC5hY3F1aXJlKHRoaXMuc2ltdWxhdG9yQXBwLCBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ29zYXNjcmlwdCcsIFsnLWUnLCByZXN1bHRTY3JpcHRdKTtcbiAgICAgICAgcmV0dXJuIHN0ZG91dDtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNvbXBsZXRlIG9wZXJhdGlvbi4gTWFrZSBzdXJlIFNpbXVsYXRvciBVSSBpcyBydW5uaW5nIGFuZCB0aGUgcGFyZW50IEFwcGl1bSBhcHBsaWNhdGlvbiAoZS4gZy4gQXBwaXVtLmFwcCBvciBUZXJtaW5hbC5hcHApIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgaXMgcHJlc2VudCBpbiBTeXN0ZW0gUHJlZmVyZW5jZXMgPiBTZWN1cml0eSAmIFByaXZhY3kgPiBQcml2YWN5ID4gQWNjZXNzaWJpbGl0eSBsaXN0LiBJZiB0aGUgb3BlcmF0aW9uIGlzIHN0aWxsIHVuc3VjY2Vzc2Z1bCB0aGVuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgaXQgaXMgbm90IHN1cHBvcnRlZCBieSB0aGlzIFNpbXVsYXRvci4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgc3RhdGUgb2YgQmlvbWV0cmljIEVucm9sbG1lbnQgZmVhdHVyZS5cbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IEVpdGhlciB0cnVlIG9yIGZhbHNlXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBFbnJvbGxtZW50IHN0YXRlIGNhbm5vdCBiZSBkZXRlcm1pbmVkXG4gICAqL1xuICBhc3luYyBpc0Jpb21ldHJpY0Vucm9sbGVkICgpIHtcbiAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIlRvdWNoIElEIEVucm9sbGVkXCIgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJIYXJkd2FyZVwiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgICBzZXQgaXNDaGVja2VkIHRvICh2YWx1ZSBvZiBhdHRyaWJ1dGUgXCJBWE1lbnVJdGVtTWFya0NoYXJcIiBvZiBkc3RNZW51SXRlbSkgaXMgXCLinJNcIlxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgICBsb2cuZGVidWcoYFRvdWNoIElEIGVucm9sbGVkIHN0YXRlOiAke291dHB1dH1gKTtcbiAgICByZXR1cm4gXy5pc1N0cmluZyhvdXRwdXQpICYmIG91dHB1dC50cmltKCkgPT09ICd0cnVlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnJvbGxzIGJpb21ldHJpYyAoVG91Y2hJZCwgRmFjZUlkKSBmZWF0dXJlIHRlc3RpbmcgaW4gU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBpc0VuYWJsZWQgLSBEZWZpbmVzIHdoZXRoZXIgYmlvbWV0cmljIHN0YXRlIGlzIGVuYWJsZWQvZGlzYWJsZWRcbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBlbnJvbGxlZCBzdGF0ZSBjYW5ub3QgYmUgY2hhbmdlZFxuICAgKi9cbiAgYXN5bmMgZW5yb2xsQmlvbWV0cmljIChpc0VuYWJsZWQgPSB0cnVlKSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlVUlDbGllbnRTY3JpcHQoYFxuICAgICAgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIlxuICAgICAgICB0ZWxsIHByb2Nlc3MgXCJTaW11bGF0b3JcIlxuICAgICAgICAgIHNldCBkc3RNZW51SXRlbSB0byBtZW51IGl0ZW0gXCJUb3VjaCBJRCBFbnJvbGxlZFwiIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiSGFyZHdhcmVcIiBvZiBtZW51IGJhciAxXG4gICAgICAgICAgc2V0IGlzQ2hlY2tlZCB0byAodmFsdWUgb2YgYXR0cmlidXRlIFwiQVhNZW51SXRlbU1hcmtDaGFyXCIgb2YgZHN0TWVudUl0ZW0pIGlzIFwi4pyTXCJcbiAgICAgICAgICBpZiAke2lzRW5hYmxlZCA/ICdub3QgJyA6ICcnfWlzQ2hlY2tlZCB0aGVuXG4gICAgICAgICAgICBjbGljayBkc3RNZW51SXRlbVxuICAgICAgICAgIGVuZCBpZlxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kcyBhIG5vdGlmaWNhdGlvbiB0byBtYXRjaC9ub3QgbWF0Y2ggdGhlIHRvdWNoIGlkLlxuICAgKlxuICAgKiBAcGFyYW0gez9ib29sZWFufSBzaG91bGRNYXRjaCBbdHJ1ZV0gLSBTZXQgaXQgdG8gdHJ1ZSBvciBmYWxzZSBpbiBvcmRlciB0byBlbXVsYXRlXG4gICAqIG1hdGNoaW5nL25vdCBtYXRjaGluZyB0aGUgY29ycmVzcG9uZGluZyBiaW9tZXRyaWNcbiAgICovXG4gIGFzeW5jIHNlbmRCaW9tZXRyaWNNYXRjaCAoc2hvdWxkTWF0Y2ggPSB0cnVlKSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlVUlDbGllbnRTY3JpcHQoYFxuICAgICAgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIlxuICAgICAgICB0ZWxsIHByb2Nlc3MgXCJTaW11bGF0b3JcIlxuICAgICAgICAgIHNldCBkc3RNZW51SXRlbSB0byBtZW51IGl0ZW0gXCIke3Nob3VsZE1hdGNoID8gJ01hdGNoaW5nJyA6ICdOb24tbWF0Y2hpbmcnfVwiIG9mIG1lbnUgMSBvZiBtZW51IGl0ZW0gXCJTaW11bGF0ZSBGaW5nZXIgVG91Y2hcIiBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIkhhcmR3YXJlXCIgb2YgbWVudSBiYXIgMVxuICAgICAgICAgIGNsaWNrIGRzdE1lbnVJdGVtXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBzcGVjaWFsIEFwcGxlIHNjcmlwdCwgd2hpY2ggY2xpY2tzIHRoZSBwYXJ0aWN1bGFyIGJ1dHRvbiBvbiBEYXRhYmFzZSBhbGVydC5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBpbmNyZWFzZSAtIENsaWNrIHRoZSBidXR0b24gd2l0aCAnSW5jcmVhc2UnIHRpdGxlIG9uIHRoZSBhbGVydCBpZiB0aGlzXG4gICAqICAgcGFyYW1ldGVyIGlzIHRydWUuIFRoZSAnQ2FuY2VsJyBidXR0b24gd2lsbCBiZSBjbGlja2VkIG90aGVyd2lzZS5cbiAgICovXG4gIGFzeW5jIGRpc21pc3NEYXRhYmFzZUFsZXJ0IChpbmNyZWFzZSA9IHRydWUpIHtcbiAgICBsZXQgYnV0dG9uID0gaW5jcmVhc2UgPyAnSW5jcmVhc2UnIDogJ0NhbmNlbCc7XG4gICAgbG9nLmRlYnVnKGBBdHRlbXB0aW5nIHRvIGRpc21pc3MgZGF0YWJhc2UgYWxlcnQgd2l0aCAnJHtidXR0b259JyBidXR0b25gKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgY2xpY2sgYnV0dG9uIFwiJHtidXR0b259XCIgb2Ygd2luZG93IDFcbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYCk7XG4gIH1cblxuICAvL3JlZ2lvbiBLZXljaGFpbnMgSW50ZXJhY3Rpb25cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYmFja3VwIG9mIGtleWNoYWlucyBmb2xkZXIuXG4gICAqIFRoZSBwcmV2aW91c2x5IGNyZWF0ZWQgYmFja3VwIHdpbGwgYmUgYXV0b21hdGljYWxseVxuICAgKiBkZWxldGVkIGlmIHRoaXMgbWV0aG9kIHdhcyBjYWxsZWQgdHdpY2UgaW4gYSByb3cgd2l0aG91dFxuICAgKiBgcmVzdG9yZUtleWNoYWluc2AgYmVpbmcgaW52b2tlZC5cbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGJhY2t1cCBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWxsLlxuICAgKi9cbiAgYXN5bmMgYmFja3VwS2V5Y2hhaW5zICgpIHtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyh0aGlzLmtleWNoYWluUGF0aCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBiYWNrdXBQYXRoID0gYXdhaXQgdGVtcERpci5wYXRoKHtcbiAgICAgIHByZWZpeDogYGtleWNoYWluc19iYWNrdXBfJHtNYXRoLmZsb29yKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpfWAsXG4gICAgICBzdWZmaXg6ICcuemlwJyxcbiAgICB9KTtcbiAgICBjb25zdCB6aXBBcmdzID0gW1xuICAgICAgJy1yJywgYmFja3VwUGF0aCxcbiAgICAgIGAke3RoaXMua2V5Y2hhaW5QYXRofSR7cGF0aC5zZXB9YFxuICAgIF07XG4gICAgbG9nLmRlYnVnKGBDcmVhdGluZyBrZXljaGFpbnMgYmFja3VwIHdpdGggJ3ppcCAke3ppcEFyZ3Muam9pbignICcpfScgY29tbWFuZGApO1xuICAgIGF3YWl0IGV4ZWMoJ3ppcCcsIHppcEFyZ3MpO1xuICAgIGlmIChfLmlzU3RyaW5nKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpICYmIGF3YWl0IGZzLmV4aXN0cyh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKSkge1xuICAgICAgYXdhaXQgZnMudW5saW5rKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpO1xuICAgIH1cbiAgICB0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoID0gYmFja3VwUGF0aDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0b3JlIHRoZSBwcmV2aXNvdWx5IGNyZWF0ZWQga2V5Y2hhaW5zIGJhY2t1cC5cbiAgICpcbiAgICogQHBhcmFtIHs/c3RyaW5nfEFycmF5PHN0cmluZz59IGV4Y2x1ZGVQYXR0ZXJucyAtIFRoZSBsaXN0XG4gICAqIG9mIGZpbGUgbmFtZSBwYXR0ZXJucyB0byBiZSBleGNsdWRlZCBmcm9tIHJlc3RvcmUuIFRoZSBmb3JtYXRcbiAgICogb2YgZWFjaCBpdGVtIHNob3VsZCBiZSB0aGUgc2FtZSBhcyAnLXgnIG9wdGlvbiBmb3JtYXQgZm9yXG4gICAqICd1bnppcCcgdXRpbGl0eS4gVGhpcyBjYW4gYWxzbyBiZSBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcsXG4gICAqIHdoaWNoIGlzIGdvaW5nIGJlIHRyYW5zZm9ybWVkIGludG8gYSBsaXN0IGF1dG9tYXRpY2FsbHksXG4gICAqIGZvciBleGFtcGxlOiAnKi5kYiosYmxhYmxhLnNxbGl0ZSdcbiAgICogQHJldHVybnMge2Jvb2xlYW59IElmIHRoZSByZXN0b3JlIG9wcmF0aW9uIHdhcyBzdWNjZXNzZnVsLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgaXMgbm8ga2V5Y2hhaW5zIGJhY2t1cCBhdmFpbGFibGUgZm9yIHJlc3RvcmUuXG4gICAqL1xuICBhc3luYyByZXN0b3JlS2V5Y2hhaW5zIChleGNsdWRlUGF0dGVybnMgPSBbXSkge1xuICAgIGlmICghXy5pc1N0cmluZyh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKSB8fCAhYXdhaXQgZnMuZXhpc3RzKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBrZXljaGFpbnMgYmFja3VwIGFyY2hpdmUgZG9lcyBub3QgZXhpc3QuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBBcmUgeW91IHN1cmUgaXQgd2FzIGNyZWF0ZWQgYmVmb3JlP2ApO1xuICAgIH1cblxuICAgIGlmIChfLmlzU3RyaW5nKGV4Y2x1ZGVQYXR0ZXJucykpIHtcbiAgICAgIGV4Y2x1ZGVQYXR0ZXJucyA9IGV4Y2x1ZGVQYXR0ZXJucy5zcGxpdCgnLCcpLm1hcCgoeCkgPT4geC50cmltKCkpO1xuICAgIH1cbiAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzUnVubmluZygpO1xuICAgIGxldCBwbGlzdFBhdGg7XG4gICAgaWYgKGlzU2VydmVyUnVubmluZykge1xuICAgICAgcGxpc3RQYXRoID0gcGF0aC5yZXNvbHZlKGF3YWl0IHRoaXMuZ2V0TGF1bmNoRGFlbW9uc1Jvb3QoKSwgJ2NvbS5hcHBsZS5zZWN1cml0eWQucGxpc3QnKTtcbiAgICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHBsaXN0UGF0aCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2xlYXIga2V5Y2hhaW5zIGJlY2F1c2UgJyR7cGxpc3RQYXRofScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbJ2xhdW5jaGN0bCcsICd1bmxvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGZzLnJpbXJhZih0aGlzLmtleWNoYWluUGF0aCk7XG4gICAgICBhd2FpdCBta2RpcnAodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgY29uc3QgdW56aXBBcmdzID0gW1xuICAgICAgICAnLW8nLCB0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoLFxuICAgICAgICAuLi4oXy5mbGF0TWFwKGV4Y2x1ZGVQYXR0ZXJucy5tYXAoKHgpID0+IFsnLXgnLCB4XSkpKSxcbiAgICAgICAgJy1kJywgJy8nXG4gICAgICBdO1xuICAgICAgbG9nLmRlYnVnKGBSZXN0b3Jpbmcga2V5Y2hhaW5zIHdpdGggJ3VuemlwICR7dW56aXBBcmdzLmpvaW4oJyAnKX0nIGNvbW1hbmRgKTtcbiAgICAgIGF3YWl0IGV4ZWMoJ3VuemlwJywgdW56aXBBcmdzKTtcbiAgICAgIGF3YWl0IGZzLnVubGluayh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKTtcbiAgICAgIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGggPSBudWxsO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nICYmIHBsaXN0UGF0aCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoWydsYXVuY2hjdGwnLCAnbG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgS2V5Y2hhaW5zIGZvciB0aGUgcGFydGljdWxhciBzaW11bGF0b3IgaW4gcnVudGltZSAodGhlcmUgaXMgbm8gbmVlZCB0byBzdG9wIGl0KS5cbiAgICpcbiAgICogQHRocm93cyB7RXJyb3J9IElmIGtleWNoYWluIGNsZWFudXAgaGFzIGZhaWxlZC5cbiAgICovXG4gIGFzeW5jIGNsZWFyS2V5Y2hhaW5zICgpIHtcbiAgICBjb25zdCBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRMYXVuY2hEYWVtb25zUm9vdCgpLCAnY29tLmFwcGxlLnNlY3VyaXR5ZC5wbGlzdCcpO1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHBsaXN0UGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNsZWFyIGtleWNoYWlucyBiZWNhdXNlICcke3BsaXN0UGF0aH0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbJ2xhdW5jaGN0bCcsICd1bmxvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICB0cnkge1xuICAgICAgaWYgKGF3YWl0IGZzLmV4aXN0cyh0aGlzLmtleWNoYWluUGF0aCkpIHtcbiAgICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgICAgYXdhaXQgbWtkaXJwKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIH1cbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ2xvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICB9XG4gIH1cblxuICAvL2VuZHJlZ2lvblxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBQcm9jZXNzSW5mb1xuICAgKiBAcHJvcGVydHkge251bWJlcn0gcGlkIFRoZSBhY3R1YWwgcHJvY2VzcyBpZGVudGlmaWVyLlxuICAgKiBDb3VsZCBiZSB6ZXJvIGlmIHRoZSBwcm9jZXNzIGlzIHRoZSBzeXN0ZW0gb25lLlxuICAgKiBAcHJvcGVydHkgez9zdHJpbmd9IGdyb3VwIFRoZSBwcm9jZXNzIGdyb3VwIGlkZW50aWZpZXIuXG4gICAqIFRoaXMgY291bGQgYmUgYG51bGxgIGlmIHRoZSBwcm9jZXNzIGlzIG5vdCBhIHBhcnQgb2YgdGhlXG4gICAqIHBhcnRpY3VsYXIgZ3JvdXAuIEZvciBgbm9ybWFsYCBhcHBsaWNhdGlvbiBwcm9jZXNzZXMgdGhlIGdyb3VwXG4gICAqIG5hbWUgdXN1YWxseSBlcXVhbHMgdG8gYFVJS2l0QXBwbGljYXRpb25gLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gbmFtZSBUaGUgcHJvY2VzcyBuYW1lLCBmb3IgZXhhbXBsZVxuICAgKiBgY29tLmFwcGxlLlByZWZlcmVuY2VzYFxuICAgKi9cblxuICAvKipcbiAgICogTGlzdHMgcHJvY2Vzc2VzIHRoYXQgYXJlIGN1cnJlbnRseSBydW5uaW5nIG9uIHRoZSBnaXZlbiBTaW11bGF0b3IuXG4gICAqIFRoZSBzaW11bGF0b3IgbXVzdCBiZSBpbiBydW5uaW5nIHN0YXRlIGluIG9yZGVyIGZvciB0aGlzXG4gICAqIG1ldGhvZCB0byB3b3JrIHByb3Blcmx5LlxuICAgKlxuICAgKiBAcmV0dXJuIHtBcnJheTxQcm9jZXNzSW5mbz59IFRoZSBsaXN0IG9mIHJldHJpZXZlZCBwcm9jZXNzXG4gICAqIGluZm9ybWF0aW9uXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiBubyBwcm9jZXNzIGluZm9ybWF0aW9uIGNvdWxkIGJlIHJldHJpZXZlZC5cbiAgICovXG4gIGFzeW5jIHBzICgpIHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnbGF1bmNoY3RsJyxcbiAgICAgICdwcmludCcsXG4gICAgICAnc3lzdGVtJyxcbiAgICBdKTtcblxuICAgIGNvbnN0IHNlcnZpY2VzTWF0Y2ggPSAvXlxccypzZXJ2aWNlc1xccyo9XFxzKnsoW159XSspL20uZXhlYyhzdGRvdXQpO1xuICAgIGlmICghc2VydmljZXNNYXRjaCkge1xuICAgICAgbG9nLmRlYnVnKHN0ZG91dCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBsaXN0IG9mIGFjdGl2ZSBwcm9jZXNzZXMgY2Fubm90IGJlIHJldHJpZXZlZGApO1xuICAgIH1cbiAgICAvKlxuICAgIEV4YW1wbGUgbWF0Y2g6XG4gICAgICAgIDAgICAgIDc4IFx0Y29tLmFwcGxlLnJlc291cmNlZ3JhYmJlcmRcbiAgICA4MjE1OCAgICAgIC0gXHRjb20uYXBwbGUuYXNzaXN0YW50X3NlcnZpY2VcbiAgICA4MjEyMCAgICAgIC0gXHRjb20uYXBwbGUubmFub3JlZ2lzdHJ5ZFxuICAgIDgyMDg3ICAgICAgLSBcdGNvbS5hcHBsZS5ub3RpZnlkXG4gICAgODIyNjQgICAgICAtIFx0VUlLaXRBcHBsaWNhdGlvbjpjb20uYXBwbGUuUHJlZmVyZW5jZXNbNzA0Yl1bcmItbGVnYWN5XVxuICAgICovXG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgY29uc3QgcGF0dGVybiA9IC9eXFxzKihcXGQrKVxccytbXFxkLV0rXFxzKyhbXFx3XFwtLl0rOik/KFtcXHdcXC0uXSspL2dtO1xuICAgIGxldCBtYXRjaDtcbiAgICB3aGlsZSAoKG1hdGNoID0gcGF0dGVybi5leGVjKHNlcnZpY2VzTWF0Y2hbMV0pKSkge1xuICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICBwaWQ6IHBhcnNlSW50KG1hdGNoWzFdLCAxMCksXG4gICAgICAgIGdyb3VwOiBfLnRyaW1FbmQobWF0Y2hbMl0sICc6JykgfHwgbnVsbCxcbiAgICAgICAgbmFtZTogbWF0Y2hbM10sXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwYXJ0aWN1bGFyIHBlcm1pc3Npb24gdG8gdGhlIGFwcGxpY2F0aW9uIGJ1bmRsZS4gU2VlXG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlscyBmb3IgbW9yZSBkZXRhaWxzIG9uXG4gICAqIHRoZSBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEFwcGxpY2F0aW9uIGJ1bmRsZSBpZGVudGlmaWVyLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGVybWlzc2lvbiAtIFNlcnZpY2UgbmFtZSB0byBiZSBzZXQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFRoZSBkZXNpcmVkIHN0YXR1cyBmb3IgdGhlIHNlcnZpY2UuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgY2hhbmdpbmcgcGVybWlzc2lvbi5cbiAgICovXG4gIGFzeW5jIHNldFBlcm1pc3Npb24gKGJ1bmRsZUlkLCBwZXJtaXNzaW9uLCB2YWx1ZSkge1xuICAgIGF3YWl0IHRoaXMuc2V0UGVybWlzc2lvbnMoYnVuZGxlSWQsIHtbcGVybWlzc2lvbl06IHZhbHVlfSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwZXJtaXNzaW9uc01hcHBpbmcgLSBBIG1hcHBpbmcgd2hlcmUga2F5c1xuICAgKiBhcmUgc2VydmljZSBuYW1lcyBhbmQgdmFsdWVzIGFyZSB0aGVpciBjb3JyZXNwb25kaW5nIHN0YXR1cyB2YWx1ZXMuXG4gICAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vd2l4L0FwcGxlU2ltdWxhdG9yVXRpbHNcbiAgICogZm9yIG1vcmUgZGV0YWlscyBvbiBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgY2hhbmdpbmcgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBzZXRQZXJtaXNzaW9ucyAoYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZykge1xuICAgIGxvZy5kZWJ1ZyhgU2V0dGluZyBhY2Nlc3MgZm9yICcke2J1bmRsZUlkfSc6IGAgK1xuICAgICAgSlNPTi5zdHJpbmdpZnkocGVybWlzc2lvbnNNYXBwaW5nLCBudWxsLCAyKSk7XG4gICAgYXdhaXQgdGhpcy5wZXJtaXNzaW9ucy5zZXRBY2Nlc3MoYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGN1cnJlbnQgcGVybWlzc2lvbiBzdGF0dXMgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBidW5kbGUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEFwcGxpY2F0aW9uIGJ1bmRsZSBpZGVudGlmaWVyLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VydmljZU5hbWUgLSBPbmUgb2YgYXZhaWxhYmxlIHNlcnZpY2UgbmFtZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgcmV0cmlldmluZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIGdldFBlcm1pc3Npb24gKGJ1bmRsZUlkLCBzZXJ2aWNlTmFtZSkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucGVybWlzc2lvbnMuZ2V0QWNjZXNzKGJ1bmRsZUlkLCBzZXJ2aWNlTmFtZSk7XG4gICAgbG9nLmRlYnVnKGBHb3QgJHtzZXJ2aWNlTmFtZX0gYWNjZXNzIHN0YXR1cyBmb3IgJyR7YnVuZGxlSWR9JzogJHtyZXN1bHR9YCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHRoZSBnaXZlbiBjZXJ0aWZpY2F0ZSBpbnRvIHRoZSBUcnVzdGVkIFJvb3QgU3RvcmUgb24gdGhlIHNpbXVsYXRvci5cbiAgICogVGhlIHNpbXVsYXRvciBtdXN0IGJlIHNodXQgZG93biBpbiBvcmRlciBmb3IgdGhpcyBtZXRob2QgdG8gd29yayBwcm9wZXJseS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBheWxvYWQgdGhlIGNvbnRlbnQgb2YgdGhlIFBFTSBjZXJ0aWZpY2F0ZVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSBjZXJ0aWZpY2F0ZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgaW5zdGFsbGVkXG4gICAqIG9yIGBmYWxzZWAgaWYgaXQgaGFzIGFscmVhZHkgYmVlbiB0aGVyZVxuICAgKi9cbiAgYXN5bmMgYWRkQ2VydGlmaWNhdGUgKHBheWxvYWQsIC8qIG9wdHMgPSB7fSAqLykge1xuICAgIGlmIChhd2FpdCBoYXNTU0xDZXJ0KHBheWxvYWQsIHRoaXMudWRpZCkpIHtcbiAgICAgIGxvZy5pbmZvKGBTU0wgY2VydGlmaWNhdGUgJyR7Xy50cnVuY2F0ZShwYXlsb2FkLCB7bGVuZ3RoOiAyMH0pfScgYWxyZWFkeSBpbnN0YWxsZWRgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbG9nLmluZm8oYEluc3RhbGxpbmcgU1NMIHJvb3QgY2VydGlmaWNhdGUgJyR7Xy50cnVuY2F0ZShwYXlsb2FkLCB7bGVuZ3RoOiAyMH0pfSdgKTtcbiAgICBhd2FpdCBpbnN0YWxsU1NMQ2VydChwYXlsb2FkLCB0aGlzLnVkaWQpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNpbXVsYXRlcyBwdXNoIG5vdGlmaWNhdGlvbiBkZWxpdmVyeVxuICAgKlxuICAgKiBAc2luY2UgWGNvZGUgU0RLIDExLjRcbiAgICovXG4gIGFzeW5jIHB1c2hOb3RpZmljYXRpb24gKC8qIHBheWxvYWQgKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIHB1c2ggbm90aWZpY2F0aW9uc2ApO1xuICB9XG5cbiAgYXN5bmMgZ2V0TGF1bmNoRGFlbW9uc1Jvb3QgKCkge1xuICAgIGNvbnN0IGRldlJvb3QgPSBhd2FpdCBnZXREZXZlbG9wZXJSb290KCk7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShkZXZSb290LFxuICAgICAgJ1BsYXRmb3Jtcy9pUGhvbmVTaW11bGF0b3IucGxhdGZvcm0vRGV2ZWxvcGVyL1NES3MvaVBob25lU2ltdWxhdG9yLnNkay9TeXN0ZW0vTGlicmFyeS9MYXVuY2hEYWVtb25zJyk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbiAocGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgbGV0IHJlcVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG4gICAgaWYgKCFyZXFWZXJzaW9uKSB7XG4gICAgICByZXFWZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gICAgICBsb2cud2FybihgTm8gcGxhdGZvcm0gdmVyc2lvbiBzZXQuIFVzaW5nIG1heCBTREsgdmVyc2lvbjogJHtyZXFWZXJzaW9ufWApO1xuICAgICAgLy8gdGhpcyB3aWxsIGJlIGEgbnVtYmVyLCBhbmQgcG9zc2libHkgYW4gaW50ZWdlciAoZS5nLiwgaWYgbWF4IGlPUyBTREsgaXMgOSlcbiAgICAgIC8vIHNvIHR1cm4gaXQgaW50byBhIHN0cmluZyBhbmQgYWRkIGEgLjAgaWYgbmVjZXNzYXJ5XG4gICAgICBpZiAoIV8uaXNTdHJpbmcocmVxVmVyc2lvbikpIHtcbiAgICAgICAgcmVxVmVyc2lvbiA9IChyZXFWZXJzaW9uICUgMSkgPyBTdHJpbmcocmVxVmVyc2lvbikgOiBgJHtyZXFWZXJzaW9ufS4wYDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcVZlcnNpb247XG4gIH1cblxuICAvLyBjaGFuZ2UgdGhlIGZvcm1hdCBpbiBzdWJjbGFzc2VzLCBhcyBuZWNlc3NhcnlcbiAgc3RhdGljIGFzeW5jIF9nZXREZXZpY2VTdHJpbmdWZXJzaW9uU3RyaW5nIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICBsZXQgcmVxVmVyc2lvbiA9IGF3YWl0IHRoaXMuX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbihwbGF0Zm9ybVZlcnNpb24pO1xuXG4gICAgcmV0dXJuIGAoJHtyZXFWZXJzaW9ufSBTaW11bGF0b3IpYDtcbiAgfVxuXG4gIC8vIGNoYW5nZSB0aGUgZm9ybWF0IGluIHN1YmNsYXNzZXMsIGFzIG5lY2Vzc2FyeVxuICBzdGF0aWMgX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCAoKSB7XG4gICAgLy8gc29tZSBkZXZpY2VzIG5lZWQgdG8gYmUgdXBkYXRlZFxuICAgIHJldHVybiB7XG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDcuMSBTaW11bGF0b3IpJzogJ2lQYWQgMiAoNy4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjAgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4xIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMiBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4yIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjMgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMyBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC40IFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjQgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoNy4xIFNpbXVsYXRvciknOiAnaVBob25lIDVzICg3LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC40IFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguNCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjMgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4zIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMiBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjIgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4xIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjAgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4wIFNpbXVsYXRvciknXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUYWtlcyBhIHNldCBvZiBvcHRpb25zIGFuZCBmaW5kcyB0aGUgY29ycmVjdCBkZXZpY2Ugc3RyaW5nIGluIG9yZGVyIGZvciBJbnN0cnVtZW50cyB0b1xuICAgKiBpZGVudGlmeSB0aGUgY29ycmVjdCBzaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIC0gVGhlIG9wdGlvbnMgYXZhaWxhYmxlIGFyZTpcbiAgICogICAtIGBkZXZpY2VOYW1lYCAtIGEgbmFtZSBmb3IgdGhlIGRldmljZS4gSWYgdGhlIGdpdmVuIGRldmljZSBuYW1lIHN0YXJ0cyB3aXRoIGA9YCwgdGhlIG5hbWUsIGxlc3MgdGhlIGVxdWFscyBzaWduLCBpcyByZXR1cm5lZC5cbiAgICogICAtIGBwbGF0Zm9ybVZlcnNpb25gIC0gdGhlIHZlcnNpb24gb2YgaU9TIHRvIHVzZS4gRGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgWGNvZGUncyBtYXhpbXVtIFNESyB2ZXJzaW9uLlxuICAgKiAgIC0gYGZvcmNlSXBob25lYCAtIGZvcmNlIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBkZXZpY2Ugc3RyaW5nIHRvIGlQaG9uZS4gRGVmYXVsdHMgdG8gYGZhbHNlYC5cbiAgICogICAtIGBmb3JjZUlwYWRgIC0gZm9yY2UgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIGRldmljZSBzdHJpbmcgdG8gaVBhZC4gRGVmYXVsdHMgdG8gYGZhbHNlYC5cbiAgICogICBJZiBib3RoIGBmb3JjZUlwaG9uZWAgYW5kIGBmb3JjZUlwYWRgIGFyZSB0cnVlLCB0aGUgZGV2aWNlIHdpbGwgYmUgZm9yY2VkIHRvIGlQaG9uZS5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgZm91bmQgZGV2aWNlIHN0cmluZy5cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXREZXZpY2VTdHJpbmcgKG9wdHMpIHtcbiAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwge1xuICAgICAgZGV2aWNlTmFtZTogbnVsbCxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogbnVsbCxcbiAgICAgIGZvcmNlSXBob25lOiBmYWxzZSxcbiAgICAgIGZvcmNlSXBhZDogZmFsc2VcbiAgICB9LCBvcHRzKTtcbiAgICBsZXQgbG9nT3B0cyA9IHtcbiAgICAgIGRldmljZU5hbWU6IG9wdHMuZGV2aWNlTmFtZSxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogb3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICBmb3JjZUlwaG9uZTogb3B0cy5mb3JjZUlwaG9uZSxcbiAgICAgIGZvcmNlSXBhZDogb3B0cy5mb3JjZUlwYWRcbiAgICB9O1xuICAgIGxvZy5kZWJ1ZyhgR2V0dGluZyBkZXZpY2Ugc3RyaW5nIGZyb20gb3B0aW9uczogJHtKU09OLnN0cmluZ2lmeShsb2dPcHRzKX1gKTtcblxuICAgIC8vIHNob3J0IGNpcmN1aXQgaWYgd2UgYWxyZWFkeSBoYXZlIGEgZGV2aWNlIG5hbWVcbiAgICBpZiAoKG9wdHMuZGV2aWNlTmFtZSB8fCAnJylbMF0gPT09ICc9Jykge1xuICAgICAgcmV0dXJuIG9wdHMuZGV2aWNlTmFtZS5zdWJzdHJpbmcoMSk7XG4gICAgfVxuXG4gICAgbGV0IGlzaVBob25lID0gISFvcHRzLmZvcmNlSXBob25lIHx8ICFvcHRzLmZvcmNlSXBhZDtcblxuICAgIGlmIChvcHRzLmRldmljZU5hbWUpIHtcbiAgICAgIGxldCBkZXZpY2UgPSBvcHRzLmRldmljZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChkZXZpY2UuaW5kZXhPZignaXBob25lJykgIT09IC0xKSB7XG4gICAgICAgIGlzaVBob25lID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoZGV2aWNlLmluZGV4T2YoJ2lwYWQnKSAhPT0gLTEpIHtcbiAgICAgICAgaXNpUGhvbmUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgaW9zRGV2aWNlU3RyaW5nID0gb3B0cy5kZXZpY2VOYW1lIHx8IChpc2lQaG9uZSA/ICdpUGhvbmUgU2ltdWxhdG9yJyA6ICdpUGFkIFNpbXVsYXRvcicpO1xuXG4gICAgLy8gaWYgc29tZW9uZSBwYXNzZXMgaW4ganVzdCBcImlQaG9uZVwiLCBtYWtlIHRoYXQgXCJpUGhvbmUgU2ltdWxhdG9yXCIgdG9cbiAgICAvLyBjb25mb3JtIHRvIGFsbCB0aGUgbG9naWMgYmVsb3dcbiAgICBpZiAoL14oaVBob25lfGlQYWQpJC8udGVzdChpb3NEZXZpY2VTdHJpbmcpKSB7XG4gICAgICBpb3NEZXZpY2VTdHJpbmcgKz0gJyBTaW11bGF0b3InO1xuICAgIH1cblxuICAgIC8vIHdlIHN1cHBvcnQgZGV2aWNlTmFtZTogXCJpUGhvbmUgU2ltdWxhdG9yXCIsIGFuZCBhbHNvIHdhbnQgdG8gc3VwcG9ydFxuICAgIC8vIFwiaVBob25lIFhZWiBTaW11bGF0b3JcIiwgYnV0IHRoZXNlIHN0cmluZ3MgYXJlbid0IGluIHRoZSBkZXZpY2UgbGlzdC5cbiAgICAvLyBTbywgaWYgc29tZW9uZSBzZW50IGluIFwiaVBob25lIFhZWiBTaW11bGF0b3JcIiwgc3RyaXAgb2ZmIFwiIFNpbXVsYXRvclwiXG4gICAgLy8gaW4gb3JkZXIgdG8gYWxsb3cgdGhlIGRlZmF1bHQgXCJpUGhvbmUgWFlaXCIgbWF0Y2hcbiAgICBpZiAoL1teKGlQaG9uZXxpUGFkKV0gU2ltdWxhdG9yLy50ZXN0KGlvc0RldmljZVN0cmluZykpIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyA9IGlvc0RldmljZVN0cmluZy5yZXBsYWNlKCcgU2ltdWxhdG9yJywgJycpO1xuICAgIH1cbiAgICBpb3NEZXZpY2VTdHJpbmcgKz0gYCAke2F3YWl0IHRoaXMuX2dldERldmljZVN0cmluZ1ZlcnNpb25TdHJpbmcob3B0cy5wbGF0Zm9ybVZlcnNpb24pfWA7XG5cbiAgICBsZXQgQ09ORklHX0ZJWCA9IHRoaXMuX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCgpO1xuXG4gICAgbGV0IGNvbmZpZ0ZpeCA9IENPTkZJR19GSVg7XG4gICAgaWYgKGNvbmZpZ0ZpeFtpb3NEZXZpY2VTdHJpbmddKSB7XG4gICAgICBpb3NEZXZpY2VTdHJpbmcgPSBjb25maWdGaXhbaW9zRGV2aWNlU3RyaW5nXTtcbiAgICAgIGxvZy5kZWJ1ZyhgRml4aW5nIGRldmljZS4gQ2hhbmdlZCBmcm9tICcke29wdHMuZGV2aWNlTmFtZX0nIGAgK1xuICAgICAgICAgICAgICAgIGB0byAnJHtpb3NEZXZpY2VTdHJpbmd9J2ApO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgRmluYWwgZGV2aWNlIHN0cmluZyBpcyAnJHtpb3NEZXZpY2VTdHJpbmd9J2ApO1xuICAgIHJldHVybiBpb3NEZXZpY2VTdHJpbmc7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byB0aGUgc2ltdWxhdG9yJ3MgV2ViSW5zcGVjdG9yIFVuaXggRG9tYWluIFNvY2tldFxuICAgKiAgIG9yIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzb2NrZXQuXG4gICAqL1xuICBhc3luYyBnZXRXZWJJbnNwZWN0b3JTb2NrZXQgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICAvLyB0aGVyZSBpcyBubyBXZWJJbnNwZWN0b3Igc29ja2V0IGZvciB0aGlzIHZlcnNpb24gb2YgWGNvZGVcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5mb3IgKGxldCBbY21kLCBmbl0gb2YgXy50b1BhaXJzKGV4dGVuc2lvbnMpKSB7XG4gIFNpbXVsYXRvclhjb2RlNi5wcm90b3R5cGVbY21kXSA9IGZuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBTaW11bGF0b3JYY29kZTY7XG5leHBvcnQgeyBTaW11bGF0b3JYY29kZTYsIEJPT1RfQ09NUExFVEVEX0VWRU5ULCBTUFJJTkdCT0FSRF9CVU5ETEVfSUQgfTtcbiJdLCJmaWxlIjoibGliL3NpbXVsYXRvci14Y29kZS02LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
