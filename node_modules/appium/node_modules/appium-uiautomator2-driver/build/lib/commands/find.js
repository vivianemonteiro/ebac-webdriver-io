"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = void 0;

require("source-map-support/register");

var _cssConverter = _interopRequireDefault(require("../css-converter"));

let helpers = {},
    extensions = {};
exports.helpers = helpers;
const MAGIC_FIRST_VIS_CHILD_SEL = /\/\*\[@firstVisible ?= ?('|")true\1\]/;
const MAGIC_SCROLLABLE_SEL = /\/\/\*\[@scrollable ?= ?('|")true\1\]/;
const MAGIC_SCROLLABLE_BY = 'new UiSelector().scrollable(true)';

helpers.doFindElementOrEls = async function (params) {
  if (params.strategy === 'xpath' && MAGIC_FIRST_VIS_CHILD_SEL.test(params.selector)) {
    let elementId = params.context;
    return await this.uiautomator2.jwproxy.command(`/appium/element/${elementId}/first_visible`, 'GET', {});
  }

  if (params.strategy === 'xpath' && MAGIC_SCROLLABLE_SEL.test(params.selector)) {
    params.strategy = '-android uiautomator';
    params.selector = MAGIC_SCROLLABLE_BY;
  }

  if (params.strategy === 'css selector') {
    params.strategy = '-android uiautomator';
    params.selector = _cssConverter.default.toUiAutomatorSelector(params.selector);
  }

  if (params.multiple) {
    return await this.uiautomator2.jwproxy.command(`/elements`, 'POST', params);
  } else {
    return await this.uiautomator2.jwproxy.command(`/element`, 'POST', params);
  }
};

Object.assign(extensions, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9maW5kLmpzIl0sIm5hbWVzIjpbImhlbHBlcnMiLCJleHRlbnNpb25zIiwiTUFHSUNfRklSU1RfVklTX0NISUxEX1NFTCIsIk1BR0lDX1NDUk9MTEFCTEVfU0VMIiwiTUFHSUNfU0NST0xMQUJMRV9CWSIsImRvRmluZEVsZW1lbnRPckVscyIsInBhcmFtcyIsInN0cmF0ZWd5IiwidGVzdCIsInNlbGVjdG9yIiwiZWxlbWVudElkIiwiY29udGV4dCIsInVpYXV0b21hdG9yMiIsImp3cHJveHkiLCJjb21tYW5kIiwiQ3NzQ29udmVydGVyIiwidG9VaUF1dG9tYXRvclNlbGVjdG9yIiwibXVsdGlwbGUiLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUEsSUFBSUEsT0FBTyxHQUFHLEVBQWQ7QUFBQSxJQUFrQkMsVUFBVSxHQUFHLEVBQS9COztBQUlBLE1BQU1DLHlCQUF5QixHQUFHLHVDQUFsQztBQUVBLE1BQU1DLG9CQUFvQixHQUFHLHVDQUE3QjtBQUNBLE1BQU1DLG1CQUFtQixHQUFHLG1DQUE1Qjs7QUFNQUosT0FBTyxDQUFDSyxrQkFBUixHQUE2QixnQkFBZ0JDLE1BQWhCLEVBQXdCO0FBQ25ELE1BQUlBLE1BQU0sQ0FBQ0MsUUFBUCxLQUFvQixPQUFwQixJQUErQkwseUJBQXlCLENBQUNNLElBQTFCLENBQStCRixNQUFNLENBQUNHLFFBQXRDLENBQW5DLEVBQW9GO0FBQ2xGLFFBQUlDLFNBQVMsR0FBR0osTUFBTSxDQUFDSyxPQUF2QjtBQUNBLFdBQU8sTUFBTSxLQUFLQyxZQUFMLENBQWtCQyxPQUFsQixDQUEwQkMsT0FBMUIsQ0FBbUMsbUJBQWtCSixTQUFVLGdCQUEvRCxFQUFnRixLQUFoRixFQUF1RixFQUF2RixDQUFiO0FBQ0Q7O0FBQ0QsTUFBSUosTUFBTSxDQUFDQyxRQUFQLEtBQW9CLE9BQXBCLElBQStCSixvQkFBb0IsQ0FBQ0ssSUFBckIsQ0FBMEJGLE1BQU0sQ0FBQ0csUUFBakMsQ0FBbkMsRUFBK0U7QUFDN0VILElBQUFBLE1BQU0sQ0FBQ0MsUUFBUCxHQUFrQixzQkFBbEI7QUFDQUQsSUFBQUEsTUFBTSxDQUFDRyxRQUFQLEdBQWtCTCxtQkFBbEI7QUFDRDs7QUFDRCxNQUFJRSxNQUFNLENBQUNDLFFBQVAsS0FBb0IsY0FBeEIsRUFBd0M7QUFDdENELElBQUFBLE1BQU0sQ0FBQ0MsUUFBUCxHQUFrQixzQkFBbEI7QUFDQUQsSUFBQUEsTUFBTSxDQUFDRyxRQUFQLEdBQWtCTSxzQkFBYUMscUJBQWIsQ0FBbUNWLE1BQU0sQ0FBQ0csUUFBMUMsQ0FBbEI7QUFDRDs7QUFDRCxNQUFJSCxNQUFNLENBQUNXLFFBQVgsRUFBcUI7QUFDbkIsV0FBTyxNQUFNLEtBQUtMLFlBQUwsQ0FBa0JDLE9BQWxCLENBQTBCQyxPQUExQixDQUFtQyxXQUFuQyxFQUErQyxNQUEvQyxFQUF1RFIsTUFBdkQsQ0FBYjtBQUNELEdBRkQsTUFFTztBQUNMLFdBQU8sTUFBTSxLQUFLTSxZQUFMLENBQWtCQyxPQUFsQixDQUEwQkMsT0FBMUIsQ0FBbUMsVUFBbkMsRUFBOEMsTUFBOUMsRUFBc0RSLE1BQXRELENBQWI7QUFDRDtBQUNGLENBbEJEOztBQW9CQVksTUFBTSxDQUFDQyxNQUFQLENBQWNsQixVQUFkLEVBQTBCRCxPQUExQjtlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENzc0NvbnZlcnRlciBmcm9tICcuLi9jc3MtY29udmVydGVyJztcblxubGV0IGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG4vLyB3ZSBvdmVycmlkZSB0aGUgeHBhdGggc2VhcmNoIGZvciB0aGlzIGZpcnN0LXZpc2libGUtY2hpbGQgc2VsZWN0b3IsIHdoaWNoXG4vLyBsb29rcyBsaWtlIC8qW0BmaXJzdFZpc2libGU9XCJ0cnVlXCJdXG5jb25zdCBNQUdJQ19GSVJTVF9WSVNfQ0hJTERfU0VMID0gL1xcL1xcKlxcW0BmaXJzdFZpc2libGUgPz0gPygnfFwiKXRydWVcXDFcXF0vO1xuXG5jb25zdCBNQUdJQ19TQ1JPTExBQkxFX1NFTCA9IC9cXC9cXC9cXCpcXFtAc2Nyb2xsYWJsZSA/PSA/KCd8XCIpdHJ1ZVxcMVxcXS87XG5jb25zdCBNQUdJQ19TQ1JPTExBQkxFX0JZID0gJ25ldyBVaVNlbGVjdG9yKCkuc2Nyb2xsYWJsZSh0cnVlKSc7XG5cbi8qKlxuICogT3ZlcnJpZGluZyBoZWxwZXJzLmRvRmluZEVsZW1lbnRPckVscyBmdW5jdGlvbmFsaXR5IG9mIGFwcGl1bS1hbmRyb2lkLWRyaXZlcixcbiAqIHRoaXMuZWxlbWVudCBpbml0aWFsaXplZCBpbiBmaW5kLmpzIG9mIGFwcGl1bS1hbmRyb2lkLWRyaXZlLlxuICovXG5oZWxwZXJzLmRvRmluZEVsZW1lbnRPckVscyA9IGFzeW5jIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgaWYgKHBhcmFtcy5zdHJhdGVneSA9PT0gJ3hwYXRoJyAmJiBNQUdJQ19GSVJTVF9WSVNfQ0hJTERfU0VMLnRlc3QocGFyYW1zLnNlbGVjdG9yKSkge1xuICAgIGxldCBlbGVtZW50SWQgPSBwYXJhbXMuY29udGV4dDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvYXBwaXVtL2VsZW1lbnQvJHtlbGVtZW50SWR9L2ZpcnN0X3Zpc2libGVgLCAnR0VUJywge30pO1xuICB9XG4gIGlmIChwYXJhbXMuc3RyYXRlZ3kgPT09ICd4cGF0aCcgJiYgTUFHSUNfU0NST0xMQUJMRV9TRUwudGVzdChwYXJhbXMuc2VsZWN0b3IpKSB7XG4gICAgcGFyYW1zLnN0cmF0ZWd5ID0gJy1hbmRyb2lkIHVpYXV0b21hdG9yJztcbiAgICBwYXJhbXMuc2VsZWN0b3IgPSBNQUdJQ19TQ1JPTExBQkxFX0JZO1xuICB9XG4gIGlmIChwYXJhbXMuc3RyYXRlZ3kgPT09ICdjc3Mgc2VsZWN0b3InKSB7XG4gICAgcGFyYW1zLnN0cmF0ZWd5ID0gJy1hbmRyb2lkIHVpYXV0b21hdG9yJztcbiAgICBwYXJhbXMuc2VsZWN0b3IgPSBDc3NDb252ZXJ0ZXIudG9VaUF1dG9tYXRvclNlbGVjdG9yKHBhcmFtcy5zZWxlY3Rvcik7XG4gIH1cbiAgaWYgKHBhcmFtcy5tdWx0aXBsZSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50c2AsICdQT1NUJywgcGFyYW1zKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudGAsICdQT1NUJywgcGFyYW1zKTtcbiAgfVxufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9maW5kLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
