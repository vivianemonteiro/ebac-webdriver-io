"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WebInspectorEncoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _appiumSupport = require("appium-support");

const WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE = 8096;

class WebInspectorEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    let payloadBuffer = _appiumSupport.plist.createPlist(data, true);

    for (let i = 0; i < payloadBuffer.length; i += this._encode(payloadBuffer, i)) {}

    onData();
  }

  _encode(data, pos) {
    const messageLength = Math.min(data.length - pos, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE);

    if (messageLength < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {
      this.push({
        WIRFinalMessageKey: data.slice(pos, messageLength + pos)
      });
    } else {
      this.push({
        WIRPartialMessageKey: data.slice(pos, messageLength + pos)
      });
    }

    return messageLength;
  }

}

exports.WebInspectorEncoder = WebInspectorEncoder;
var _default = WebInspectorEncoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi93ZWJpbnNwZWN0b3IvdHJhbnNmb3JtZXIvd2ViaW5zcGVjdG9yLWVuY29kZXIuanMiXSwibmFtZXMiOlsiV0VCSU5TUEVDVE9SX1BBUlRJQUxfUEFDS0VUX0NIVU5LX1NJWkUiLCJXZWJJbnNwZWN0b3JFbmNvZGVyIiwiU3RyZWFtIiwiVHJhbnNmb3JtIiwiY29uc3RydWN0b3IiLCJvYmplY3RNb2RlIiwiX3RyYW5zZm9ybSIsImRhdGEiLCJlbmNvZGluZyIsIm9uRGF0YSIsInBheWxvYWRCdWZmZXIiLCJwbGlzdCIsImNyZWF0ZVBsaXN0IiwiaSIsImxlbmd0aCIsIl9lbmNvZGUiLCJwb3MiLCJtZXNzYWdlTGVuZ3RoIiwiTWF0aCIsIm1pbiIsInB1c2giLCJXSVJGaW5hbE1lc3NhZ2VLZXkiLCJzbGljZSIsIldJUlBhcnRpYWxNZXNzYWdlS2V5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUVBLE1BQU1BLHNDQUFzQyxHQUFHLElBQS9DOztBQUVBLE1BQU1DLG1CQUFOLFNBQWtDQyxnQkFBT0MsU0FBekMsQ0FBbUQ7QUFFakRDLEVBQUFBLFdBQVcsR0FBSTtBQUNiLFVBQU07QUFBRUMsTUFBQUEsVUFBVSxFQUFFO0FBQWQsS0FBTjtBQUNEOztBQUVEQyxFQUFBQSxVQUFVLENBQUVDLElBQUYsRUFBUUMsUUFBUixFQUFrQkMsTUFBbEIsRUFBMEI7QUFDbEMsUUFBSUMsYUFBYSxHQUFHQyxxQkFBTUMsV0FBTixDQUFrQkwsSUFBbEIsRUFBd0IsSUFBeEIsQ0FBcEI7O0FBQ0EsU0FBSyxJQUFJTSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHSCxhQUFhLENBQUNJLE1BQWxDLEVBQTBDRCxDQUFDLElBQUksS0FBS0UsT0FBTCxDQUFhTCxhQUFiLEVBQTRCRyxDQUE1QixDQUEvQyxFQUErRSxDQUFFOztBQUNqRkosSUFBQUEsTUFBTTtBQUNQOztBQUVETSxFQUFBQSxPQUFPLENBQUVSLElBQUYsRUFBUVMsR0FBUixFQUFhO0FBQ2xCLFVBQU1DLGFBQWEsR0FBR0MsSUFBSSxDQUFDQyxHQUFMLENBQVNaLElBQUksQ0FBQ08sTUFBTCxHQUFjRSxHQUF2QixFQUE0QmhCLHNDQUE1QixDQUF0Qjs7QUFDQSxRQUFJaUIsYUFBYSxHQUFHakIsc0NBQXBCLEVBQTREO0FBQzFELFdBQUtvQixJQUFMLENBQVU7QUFBQ0MsUUFBQUEsa0JBQWtCLEVBQUVkLElBQUksQ0FBQ2UsS0FBTCxDQUFXTixHQUFYLEVBQWdCQyxhQUFhLEdBQUdELEdBQWhDO0FBQXJCLE9BQVY7QUFDRCxLQUZELE1BRU87QUFDTCxXQUFLSSxJQUFMLENBQVU7QUFBQ0csUUFBQUEsb0JBQW9CLEVBQUVoQixJQUFJLENBQUNlLEtBQUwsQ0FBV04sR0FBWCxFQUFnQkMsYUFBYSxHQUFHRCxHQUFoQztBQUF2QixPQUFWO0FBQ0Q7O0FBQ0QsV0FBT0MsYUFBUDtBQUNEOztBQXBCZ0Q7OztlQXlCcENoQixtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdHJlYW0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7IHBsaXN0IH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuXG5jb25zdCBXRUJJTlNQRUNUT1JfUEFSVElBTF9QQUNLRVRfQ0hVTktfU0laRSA9IDgwOTY7XG5cbmNsYXNzIFdlYkluc3BlY3RvckVuY29kZXIgZXh0ZW5kcyBTdHJlYW0uVHJhbnNmb3JtIHtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoeyBvYmplY3RNb2RlOiB0cnVlIH0pO1xuICB9XG5cbiAgX3RyYW5zZm9ybSAoZGF0YSwgZW5jb2RpbmcsIG9uRGF0YSkge1xuICAgIGxldCBwYXlsb2FkQnVmZmVyID0gcGxpc3QuY3JlYXRlUGxpc3QoZGF0YSwgdHJ1ZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXlsb2FkQnVmZmVyLmxlbmd0aDsgaSArPSB0aGlzLl9lbmNvZGUocGF5bG9hZEJ1ZmZlciwgaSkpIHt9XG4gICAgb25EYXRhKCk7XG4gIH1cblxuICBfZW5jb2RlIChkYXRhLCBwb3MpIHtcbiAgICBjb25zdCBtZXNzYWdlTGVuZ3RoID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSBwb3MsIFdFQklOU1BFQ1RPUl9QQVJUSUFMX1BBQ0tFVF9DSFVOS19TSVpFKTtcbiAgICBpZiAobWVzc2FnZUxlbmd0aCA8IFdFQklOU1BFQ1RPUl9QQVJUSUFMX1BBQ0tFVF9DSFVOS19TSVpFKSB7XG4gICAgICB0aGlzLnB1c2goe1dJUkZpbmFsTWVzc2FnZUtleTogZGF0YS5zbGljZShwb3MsIG1lc3NhZ2VMZW5ndGggKyBwb3MpfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHVzaCh7V0lSUGFydGlhbE1lc3NhZ2VLZXk6IGRhdGEuc2xpY2UocG9zLCBtZXNzYWdlTGVuZ3RoICsgcG9zKX0pO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZUxlbmd0aDtcbiAgfVxuXG59XG5cbmV4cG9ydCB7IFdlYkluc3BlY3RvckVuY29kZXIgfTtcbmV4cG9ydCBkZWZhdWx0IFdlYkluc3BlY3RvckVuY29kZXI7XG4iXSwiZmlsZSI6ImxpYi93ZWJpbnNwZWN0b3IvdHJhbnNmb3JtZXIvd2ViaW5zcGVjdG9yLWVuY29kZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
