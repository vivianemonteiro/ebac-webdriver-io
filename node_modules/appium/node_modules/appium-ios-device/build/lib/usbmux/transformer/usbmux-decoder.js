"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.UsbmuxDecoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _appiumSupport = require("appium-support");

const HEADER_LENGTH = 16;

class UsbmuxDecoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this._decode(data);

    onData();
  }

  _decode(data) {
    const header = {
      length: data.readUInt32LE(0),
      version: data.readUInt32LE(4),
      type: data.readUInt32LE(8),
      tag: data.readUInt32LE(12)
    };
    let payload = data.slice(HEADER_LENGTH, data.length);
    this.push({
      header,
      payload: _appiumSupport.plist.parsePlist(payload)
    });
  }

}

exports.UsbmuxDecoder = UsbmuxDecoder;
var _default = UsbmuxDecoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91c2JtdXgvdHJhbnNmb3JtZXIvdXNibXV4LWRlY29kZXIuanMiXSwibmFtZXMiOlsiSEVBREVSX0xFTkdUSCIsIlVzYm11eERlY29kZXIiLCJTdHJlYW0iLCJUcmFuc2Zvcm0iLCJjb25zdHJ1Y3RvciIsIm9iamVjdE1vZGUiLCJfdHJhbnNmb3JtIiwiZGF0YSIsImVuY29kaW5nIiwib25EYXRhIiwiX2RlY29kZSIsImhlYWRlciIsImxlbmd0aCIsInJlYWRVSW50MzJMRSIsInZlcnNpb24iLCJ0eXBlIiwidGFnIiwicGF5bG9hZCIsInNsaWNlIiwicHVzaCIsInBsaXN0IiwicGFyc2VQbGlzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQSxNQUFNQSxhQUFhLEdBQUcsRUFBdEI7O0FBRUEsTUFBTUMsYUFBTixTQUE0QkMsZ0JBQU9DLFNBQW5DLENBQTZDO0FBRTNDQyxFQUFBQSxXQUFXLEdBQUk7QUFDYixVQUFNO0FBQUVDLE1BQUFBLFVBQVUsRUFBRTtBQUFkLEtBQU47QUFDRDs7QUFFREMsRUFBQUEsVUFBVSxDQUFFQyxJQUFGLEVBQVFDLFFBQVIsRUFBa0JDLE1BQWxCLEVBQTBCO0FBQ2xDLFNBQUtDLE9BQUwsQ0FBYUgsSUFBYjs7QUFDQUUsSUFBQUEsTUFBTTtBQUNQOztBQUVEQyxFQUFBQSxPQUFPLENBQUVILElBQUYsRUFBUTtBQUNiLFVBQU1JLE1BQU0sR0FBRztBQUNiQyxNQUFBQSxNQUFNLEVBQUVMLElBQUksQ0FBQ00sWUFBTCxDQUFrQixDQUFsQixDQURLO0FBRWJDLE1BQUFBLE9BQU8sRUFBRVAsSUFBSSxDQUFDTSxZQUFMLENBQWtCLENBQWxCLENBRkk7QUFHYkUsTUFBQUEsSUFBSSxFQUFFUixJQUFJLENBQUNNLFlBQUwsQ0FBa0IsQ0FBbEIsQ0FITztBQUliRyxNQUFBQSxHQUFHLEVBQUVULElBQUksQ0FBQ00sWUFBTCxDQUFrQixFQUFsQjtBQUpRLEtBQWY7QUFPQSxRQUFJSSxPQUFPLEdBQUdWLElBQUksQ0FBQ1csS0FBTCxDQUFXbEIsYUFBWCxFQUEwQk8sSUFBSSxDQUFDSyxNQUEvQixDQUFkO0FBQ0EsU0FBS08sSUFBTCxDQUFVO0FBQUVSLE1BQUFBLE1BQUY7QUFBVU0sTUFBQUEsT0FBTyxFQUFFRyxxQkFBTUMsVUFBTixDQUFpQkosT0FBakI7QUFBbkIsS0FBVjtBQUNEOztBQXJCMEM7OztlQTBCOUJoQixhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN0cmVhbSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IHsgcGxpc3QgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cbmNvbnN0IEhFQURFUl9MRU5HVEggPSAxNjtcblxuY2xhc3MgVXNibXV4RGVjb2RlciBleHRlbmRzIFN0cmVhbS5UcmFuc2Zvcm0ge1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7IG9iamVjdE1vZGU6IHRydWUgfSk7XG4gIH1cblxuICBfdHJhbnNmb3JtIChkYXRhLCBlbmNvZGluZywgb25EYXRhKSB7XG4gICAgdGhpcy5fZGVjb2RlKGRhdGEpO1xuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2RlY29kZSAoZGF0YSkge1xuICAgIGNvbnN0IGhlYWRlciA9IHtcbiAgICAgIGxlbmd0aDogZGF0YS5yZWFkVUludDMyTEUoMCksXG4gICAgICB2ZXJzaW9uOiBkYXRhLnJlYWRVSW50MzJMRSg0KSxcbiAgICAgIHR5cGU6IGRhdGEucmVhZFVJbnQzMkxFKDgpLFxuICAgICAgdGFnOiBkYXRhLnJlYWRVSW50MzJMRSgxMilcbiAgICB9O1xuXG4gICAgbGV0IHBheWxvYWQgPSBkYXRhLnNsaWNlKEhFQURFUl9MRU5HVEgsIGRhdGEubGVuZ3RoKTtcbiAgICB0aGlzLnB1c2goeyBoZWFkZXIsIHBheWxvYWQ6IHBsaXN0LnBhcnNlUGxpc3QocGF5bG9hZCkgfSk7XG4gIH1cblxufVxuXG5leHBvcnQgeyBVc2JtdXhEZWNvZGVyIH07XG5leHBvcnQgZGVmYXVsdCBVc2JtdXhEZWNvZGVyO1xuIl0sImZpbGUiOiJsaWIvdXNibXV4L3RyYW5zZm9ybWVyL3VzYm11eC1kZWNvZGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uIn0=
