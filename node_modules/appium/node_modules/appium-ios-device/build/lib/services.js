"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.startSyslogService = startSyslogService;
exports.startWebInspectorService = startWebInspectorService;
exports.startInstallationProxyService = startInstallationProxyService;
exports.startSimulateLocationService = startSimulateLocationService;
exports.startAfcService = startAfcService;
exports.startNotificationProxyService = startNotificationProxyService;
exports.startHouseArrestService = startHouseArrestService;

require("source-map-support/register");

var _utilities = require("./utilities");

var _syslog = require("./syslog");

var _simulatelocation = require("./simulatelocation");

var _webinspector = require("./webinspector");

var _installationProxy = require("./installation-proxy");

var _afc = require("./afc");

var _notificationProxy = require("./notification-proxy");

var _houseArrest = require("./house-arrest");

var _plistService = _interopRequireDefault(require("./plist-service"));

var _semver = _interopRequireDefault(require("semver"));

async function startSyslogService(udid, opts = {}) {
  const socket = await startService(udid, _syslog.SYSLOG_SERVICE_NAME, opts.socket);
  return new _syslog.SyslogService(socket);
}

async function startSimulateLocationService(udid, opts = {}) {
  const socket = await startService(udid, _simulatelocation.SIMULATE_LOCATION_SERVICE_NAME, opts.socket);
  return new _simulatelocation.SimulateLocationService(socket);
}

async function startWebInspectorService(udid, opts = {}) {
  const osVersion = opts.osVersion || (await (0, _utilities.getOSVersion)(udid, opts.socket));
  const isSimulator = !!opts.isSimulator;
  const verbose = !!opts.verbose;
  const verboseHexDump = !!opts.verboseHexDump;
  const socketChunkSize = opts.socketChunkSize;
  const maxFrameLength = opts.maxFrameLength;

  const semverVersion = _semver.default.coerce(osVersion);

  if (!semverVersion) {
    throw new Error(`Could not create a semver version out of '${osVersion}'`);
  }

  if (opts.socket) {
    return new _webinspector.WebInspectorService({
      majorOsVersion: semverVersion.major,
      isSimulator,
      socketChunkSize,
      verbose,
      verboseHexDump,
      socketClient: opts.socket,
      maxFrameLength
    });
  }

  const socket = await startService(udid, _webinspector.WEB_INSPECTOR_SERVICE_NAME, undefined);
  return new _webinspector.WebInspectorService({
    majorOsVersion: semverVersion.major,
    isSimulator,
    socketChunkSize,
    verbose,
    verboseHexDump,
    socketClient: socket,
    maxFrameLength
  });
}

async function startInstallationProxyService(udid, opts = {}) {
  const socket = await startService(udid, _installationProxy.INSTALLATION_PROXY_SERVICE_NAME, opts.socket);
  return new _installationProxy.InstallationProxyService(new _plistService.default(socket));
}

async function startAfcService(udid, opts = {}) {
  const socket = await startService(udid, _afc.AFC_SERVICE_NAME, opts.socket);
  return new _afc.AfcService(socket);
}

async function startNotificationProxyService(udid, opts = {}) {
  const socket = await startService(udid, _notificationProxy.NOTIFICATION_PROXY_SERVICE_NAME, opts.socket);
  return new _notificationProxy.NotificationProxyService(socket);
}

async function startHouseArrestService(udid, opts = {}) {
  const socket = await startService(udid, _houseArrest.HOUSE_ARREST_SERVICE_NAME, opts.socket);
  return new _houseArrest.HouseArrestService(socket);
}

async function startService(udid, serviceName, socket) {
  const lockdown = await (0, _utilities.startLockdownSession)(udid, socket);

  try {
    const service = await lockdown.startService(serviceName);

    if (service.EnableServiceSSL) {
      return await (0, _utilities.connectPortSSL)(udid, service.Port, socket);
    } else {
      return await (0, _utilities.connectPort)(udid, service.Port, socket);
    }
  } finally {
    lockdown.close();
  }
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6WyJzdGFydFN5c2xvZ1NlcnZpY2UiLCJ1ZGlkIiwib3B0cyIsInNvY2tldCIsInN0YXJ0U2VydmljZSIsIlNZU0xPR19TRVJWSUNFX05BTUUiLCJTeXNsb2dTZXJ2aWNlIiwic3RhcnRTaW11bGF0ZUxvY2F0aW9uU2VydmljZSIsIlNJTVVMQVRFX0xPQ0FUSU9OX1NFUlZJQ0VfTkFNRSIsIlNpbXVsYXRlTG9jYXRpb25TZXJ2aWNlIiwic3RhcnRXZWJJbnNwZWN0b3JTZXJ2aWNlIiwib3NWZXJzaW9uIiwiaXNTaW11bGF0b3IiLCJ2ZXJib3NlIiwidmVyYm9zZUhleER1bXAiLCJzb2NrZXRDaHVua1NpemUiLCJtYXhGcmFtZUxlbmd0aCIsInNlbXZlclZlcnNpb24iLCJzZW12ZXIiLCJjb2VyY2UiLCJFcnJvciIsIldlYkluc3BlY3RvclNlcnZpY2UiLCJtYWpvck9zVmVyc2lvbiIsIm1ham9yIiwic29ja2V0Q2xpZW50IiwiV0VCX0lOU1BFQ1RPUl9TRVJWSUNFX05BTUUiLCJ1bmRlZmluZWQiLCJzdGFydEluc3RhbGxhdGlvblByb3h5U2VydmljZSIsIklOU1RBTExBVElPTl9QUk9YWV9TRVJWSUNFX05BTUUiLCJJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UiLCJQbGlzdFNlcnZpY2UiLCJzdGFydEFmY1NlcnZpY2UiLCJBRkNfU0VSVklDRV9OQU1FIiwiQWZjU2VydmljZSIsInN0YXJ0Tm90aWZpY2F0aW9uUHJveHlTZXJ2aWNlIiwiTk9USUZJQ0FUSU9OX1BST1hZX1NFUlZJQ0VfTkFNRSIsIk5vdGlmaWNhdGlvblByb3h5U2VydmljZSIsInN0YXJ0SG91c2VBcnJlc3RTZXJ2aWNlIiwiSE9VU0VfQVJSRVNUX1NFUlZJQ0VfTkFNRSIsIkhvdXNlQXJyZXN0U2VydmljZSIsInNlcnZpY2VOYW1lIiwibG9ja2Rvd24iLCJzZXJ2aWNlIiwiRW5hYmxlU2VydmljZVNTTCIsIlBvcnQiLCJjbG9zZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxlQUFlQSxrQkFBZixDQUFtQ0MsSUFBbkMsRUFBeUNDLElBQUksR0FBRyxFQUFoRCxFQUFvRDtBQUNsRCxRQUFNQyxNQUFNLEdBQUcsTUFBTUMsWUFBWSxDQUFDSCxJQUFELEVBQU9JLDJCQUFQLEVBQTRCSCxJQUFJLENBQUNDLE1BQWpDLENBQWpDO0FBQ0EsU0FBTyxJQUFJRyxxQkFBSixDQUFrQkgsTUFBbEIsQ0FBUDtBQUNEOztBQUVELGVBQWVJLDRCQUFmLENBQTZDTixJQUE3QyxFQUFtREMsSUFBSSxHQUFHLEVBQTFELEVBQThEO0FBQzVELFFBQU1DLE1BQU0sR0FBRyxNQUFNQyxZQUFZLENBQUNILElBQUQsRUFBT08sZ0RBQVAsRUFBdUNOLElBQUksQ0FBQ0MsTUFBNUMsQ0FBakM7QUFDQSxTQUFPLElBQUlNLHlDQUFKLENBQTRCTixNQUE1QixDQUFQO0FBQ0Q7O0FBRUQsZUFBZU8sd0JBQWYsQ0FBeUNULElBQXpDLEVBQStDQyxJQUFJLEdBQUcsRUFBdEQsRUFBMEQ7QUFDeEQsUUFBTVMsU0FBUyxHQUFHVCxJQUFJLENBQUNTLFNBQUwsS0FBa0IsTUFBTSw2QkFBYVYsSUFBYixFQUFtQkMsSUFBSSxDQUFDQyxNQUF4QixDQUF4QixDQUFsQjtBQUNBLFFBQU1TLFdBQVcsR0FBRyxDQUFDLENBQUNWLElBQUksQ0FBQ1UsV0FBM0I7QUFDQSxRQUFNQyxPQUFPLEdBQUcsQ0FBQyxDQUFDWCxJQUFJLENBQUNXLE9BQXZCO0FBQ0EsUUFBTUMsY0FBYyxHQUFHLENBQUMsQ0FBQ1osSUFBSSxDQUFDWSxjQUE5QjtBQUNBLFFBQU1DLGVBQWUsR0FBR2IsSUFBSSxDQUFDYSxlQUE3QjtBQUNBLFFBQU1DLGNBQWMsR0FBR2QsSUFBSSxDQUFDYyxjQUE1Qjs7QUFDQSxRQUFNQyxhQUFhLEdBQUdDLGdCQUFPQyxNQUFQLENBQWNSLFNBQWQsQ0FBdEI7O0FBQ0EsTUFBSSxDQUFDTSxhQUFMLEVBQW9CO0FBQ2xCLFVBQU0sSUFBSUcsS0FBSixDQUFXLDZDQUE0Q1QsU0FBVSxHQUFqRSxDQUFOO0FBQ0Q7O0FBQ0QsTUFBSVQsSUFBSSxDQUFDQyxNQUFULEVBQWlCO0FBQ2YsV0FBTyxJQUFJa0IsaUNBQUosQ0FBd0I7QUFDN0JDLE1BQUFBLGNBQWMsRUFBRUwsYUFBYSxDQUFDTSxLQUREO0FBRTdCWCxNQUFBQSxXQUY2QjtBQUc3QkcsTUFBQUEsZUFINkI7QUFJN0JGLE1BQUFBLE9BSjZCO0FBSzdCQyxNQUFBQSxjQUw2QjtBQU03QlUsTUFBQUEsWUFBWSxFQUFFdEIsSUFBSSxDQUFDQyxNQU5VO0FBTzdCYSxNQUFBQTtBQVA2QixLQUF4QixDQUFQO0FBU0Q7O0FBQ0QsUUFBTWIsTUFBTSxHQUFHLE1BQU1DLFlBQVksQ0FBQ0gsSUFBRCxFQUFPd0Isd0NBQVAsRUFBbUNDLFNBQW5DLENBQWpDO0FBQ0EsU0FBTyxJQUFJTCxpQ0FBSixDQUF3QjtBQUM3QkMsSUFBQUEsY0FBYyxFQUFFTCxhQUFhLENBQUNNLEtBREQ7QUFFN0JYLElBQUFBLFdBRjZCO0FBRzdCRyxJQUFBQSxlQUg2QjtBQUk3QkYsSUFBQUEsT0FKNkI7QUFLN0JDLElBQUFBLGNBTDZCO0FBTTdCVSxJQUFBQSxZQUFZLEVBQUVyQixNQU5lO0FBTzdCYSxJQUFBQTtBQVA2QixHQUF4QixDQUFQO0FBU0Q7O0FBRUQsZUFBZVcsNkJBQWYsQ0FBOEMxQixJQUE5QyxFQUFvREMsSUFBSSxHQUFHLEVBQTNELEVBQStEO0FBQzdELFFBQU1DLE1BQU0sR0FBRyxNQUFNQyxZQUFZLENBQUNILElBQUQsRUFBTzJCLGtEQUFQLEVBQXdDMUIsSUFBSSxDQUFDQyxNQUE3QyxDQUFqQztBQUNBLFNBQU8sSUFBSTBCLDJDQUFKLENBQTZCLElBQUlDLHFCQUFKLENBQWlCM0IsTUFBakIsQ0FBN0IsQ0FBUDtBQUNEOztBQUVELGVBQWU0QixlQUFmLENBQWdDOUIsSUFBaEMsRUFBc0NDLElBQUksR0FBRyxFQUE3QyxFQUFpRDtBQUMvQyxRQUFNQyxNQUFNLEdBQUcsTUFBTUMsWUFBWSxDQUFDSCxJQUFELEVBQU8rQixxQkFBUCxFQUF5QjlCLElBQUksQ0FBQ0MsTUFBOUIsQ0FBakM7QUFDQSxTQUFPLElBQUk4QixlQUFKLENBQWU5QixNQUFmLENBQVA7QUFDRDs7QUFFRCxlQUFlK0IsNkJBQWYsQ0FBOENqQyxJQUE5QyxFQUFvREMsSUFBSSxHQUFHLEVBQTNELEVBQStEO0FBQzdELFFBQU1DLE1BQU0sR0FBRyxNQUFNQyxZQUFZLENBQUNILElBQUQsRUFBT2tDLGtEQUFQLEVBQXdDakMsSUFBSSxDQUFDQyxNQUE3QyxDQUFqQztBQUNBLFNBQU8sSUFBSWlDLDJDQUFKLENBQTZCakMsTUFBN0IsQ0FBUDtBQUNEOztBQUVELGVBQWVrQyx1QkFBZixDQUF3Q3BDLElBQXhDLEVBQThDQyxJQUFJLEdBQUcsRUFBckQsRUFBeUQ7QUFDdkQsUUFBTUMsTUFBTSxHQUFHLE1BQU1DLFlBQVksQ0FBQ0gsSUFBRCxFQUFPcUMsc0NBQVAsRUFBa0NwQyxJQUFJLENBQUNDLE1BQXZDLENBQWpDO0FBQ0EsU0FBTyxJQUFJb0MsK0JBQUosQ0FBdUJwQyxNQUF2QixDQUFQO0FBQ0Q7O0FBRUQsZUFBZUMsWUFBZixDQUE2QkgsSUFBN0IsRUFBbUN1QyxXQUFuQyxFQUFnRHJDLE1BQWhELEVBQXdEO0FBQ3RELFFBQU1zQyxRQUFRLEdBQUcsTUFBTSxxQ0FBcUJ4QyxJQUFyQixFQUEyQkUsTUFBM0IsQ0FBdkI7O0FBQ0EsTUFBSTtBQUNGLFVBQU11QyxPQUFPLEdBQUcsTUFBTUQsUUFBUSxDQUFDckMsWUFBVCxDQUFzQm9DLFdBQXRCLENBQXRCOztBQUNBLFFBQUlFLE9BQU8sQ0FBQ0MsZ0JBQVosRUFBOEI7QUFDNUIsYUFBTyxNQUFNLCtCQUFlMUMsSUFBZixFQUFxQnlDLE9BQU8sQ0FBQ0UsSUFBN0IsRUFBbUN6QyxNQUFuQyxDQUFiO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsYUFBTyxNQUFNLDRCQUFZRixJQUFaLEVBQWtCeUMsT0FBTyxDQUFDRSxJQUExQixFQUFnQ3pDLE1BQWhDLENBQWI7QUFDRDtBQUNGLEdBUEQsU0FPVTtBQUNSc0MsSUFBQUEsUUFBUSxDQUFDSSxLQUFUO0FBQ0Q7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbm5lY3RQb3J0LCBjb25uZWN0UG9ydFNTTCwgc3RhcnRMb2NrZG93blNlc3Npb24sIGdldE9TVmVyc2lvbiB9IGZyb20gJy4vdXRpbGl0aWVzJztcbmltcG9ydCB7IFN5c2xvZ1NlcnZpY2UsIFNZU0xPR19TRVJWSUNFX05BTUUgfSBmcm9tICcuL3N5c2xvZyc7XG5pbXBvcnQgeyBTaW11bGF0ZUxvY2F0aW9uU2VydmljZSwgU0lNVUxBVEVfTE9DQVRJT05fU0VSVklDRV9OQU1FIH0gZnJvbSAnLi9zaW11bGF0ZWxvY2F0aW9uJztcbmltcG9ydCB7IFdlYkluc3BlY3RvclNlcnZpY2UsIFdFQl9JTlNQRUNUT1JfU0VSVklDRV9OQU1FIH0gZnJvbSAnLi93ZWJpbnNwZWN0b3InO1xuaW1wb3J0IHsgSW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlLCBJTlNUQUxMQVRJT05fUFJPWFlfU0VSVklDRV9OQU1FIH0gZnJvbSAnLi9pbnN0YWxsYXRpb24tcHJveHknO1xuaW1wb3J0IHsgQWZjU2VydmljZSwgQUZDX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vYWZjJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblByb3h5U2VydmljZSwgTk9USUZJQ0FUSU9OX1BST1hZX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vbm90aWZpY2F0aW9uLXByb3h5JztcbmltcG9ydCB7IEhvdXNlQXJyZXN0U2VydmljZSwgSE9VU0VfQVJSRVNUX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vaG91c2UtYXJyZXN0JztcbmltcG9ydCBQbGlzdFNlcnZpY2UgZnJvbSAnLi9wbGlzdC1zZXJ2aWNlJztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcblxuXG5hc3luYyBmdW5jdGlvbiBzdGFydFN5c2xvZ1NlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgU1lTTE9HX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQpO1xuICByZXR1cm4gbmV3IFN5c2xvZ1NlcnZpY2Uoc29ja2V0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRTaW11bGF0ZUxvY2F0aW9uU2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBTSU1VTEFURV9MT0NBVElPTl9TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBTaW11bGF0ZUxvY2F0aW9uU2VydmljZShzb2NrZXQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydFdlYkluc3BlY3RvclNlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBvc1ZlcnNpb24gPSBvcHRzLm9zVmVyc2lvbiB8fCBhd2FpdCBnZXRPU1ZlcnNpb24odWRpZCwgb3B0cy5zb2NrZXQpO1xuICBjb25zdCBpc1NpbXVsYXRvciA9ICEhb3B0cy5pc1NpbXVsYXRvcjtcbiAgY29uc3QgdmVyYm9zZSA9ICEhb3B0cy52ZXJib3NlO1xuICBjb25zdCB2ZXJib3NlSGV4RHVtcCA9ICEhb3B0cy52ZXJib3NlSGV4RHVtcDtcbiAgY29uc3Qgc29ja2V0Q2h1bmtTaXplID0gb3B0cy5zb2NrZXRDaHVua1NpemU7XG4gIGNvbnN0IG1heEZyYW1lTGVuZ3RoID0gb3B0cy5tYXhGcmFtZUxlbmd0aDtcbiAgY29uc3Qgc2VtdmVyVmVyc2lvbiA9IHNlbXZlci5jb2VyY2Uob3NWZXJzaW9uKTtcbiAgaWYgKCFzZW12ZXJWZXJzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgY3JlYXRlIGEgc2VtdmVyIHZlcnNpb24gb3V0IG9mICcke29zVmVyc2lvbn0nYCk7XG4gIH1cbiAgaWYgKG9wdHMuc29ja2V0KSB7XG4gICAgcmV0dXJuIG5ldyBXZWJJbnNwZWN0b3JTZXJ2aWNlKHtcbiAgICAgIG1ham9yT3NWZXJzaW9uOiBzZW12ZXJWZXJzaW9uLm1ham9yLFxuICAgICAgaXNTaW11bGF0b3IsXG4gICAgICBzb2NrZXRDaHVua1NpemUsXG4gICAgICB2ZXJib3NlLFxuICAgICAgdmVyYm9zZUhleER1bXAsXG4gICAgICBzb2NrZXRDbGllbnQ6IG9wdHMuc29ja2V0LFxuICAgICAgbWF4RnJhbWVMZW5ndGgsXG4gICAgfSk7XG4gIH1cbiAgY29uc3Qgc29ja2V0ID0gYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIFdFQl9JTlNQRUNUT1JfU0VSVklDRV9OQU1FLCB1bmRlZmluZWQpO1xuICByZXR1cm4gbmV3IFdlYkluc3BlY3RvclNlcnZpY2Uoe1xuICAgIG1ham9yT3NWZXJzaW9uOiBzZW12ZXJWZXJzaW9uLm1ham9yLFxuICAgIGlzU2ltdWxhdG9yLFxuICAgIHNvY2tldENodW5rU2l6ZSxcbiAgICB2ZXJib3NlLFxuICAgIHZlcmJvc2VIZXhEdW1wLFxuICAgIHNvY2tldENsaWVudDogc29ja2V0LFxuICAgIG1heEZyYW1lTGVuZ3RoLFxuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgSU5TVEFMTEFUSU9OX1BST1hZX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQpO1xuICByZXR1cm4gbmV3IEluc3RhbGxhdGlvblByb3h5U2VydmljZShuZXcgUGxpc3RTZXJ2aWNlKHNvY2tldCkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydEFmY1NlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgQUZDX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQpO1xuICByZXR1cm4gbmV3IEFmY1NlcnZpY2Uoc29ja2V0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnROb3RpZmljYXRpb25Qcm94eVNlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgTk9USUZJQ0FUSU9OX1BST1hZX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQpO1xuICByZXR1cm4gbmV3IE5vdGlmaWNhdGlvblByb3h5U2VydmljZShzb2NrZXQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydEhvdXNlQXJyZXN0U2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBIT1VTRV9BUlJFU1RfU0VSVklDRV9OQU1FLCBvcHRzLnNvY2tldCk7XG4gIHJldHVybiBuZXcgSG91c2VBcnJlc3RTZXJ2aWNlKHNvY2tldCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0U2VydmljZSAodWRpZCwgc2VydmljZU5hbWUsIHNvY2tldCkge1xuICBjb25zdCBsb2NrZG93biA9IGF3YWl0IHN0YXJ0TG9ja2Rvd25TZXNzaW9uKHVkaWQsIHNvY2tldCk7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2VydmljZSA9IGF3YWl0IGxvY2tkb3duLnN0YXJ0U2VydmljZShzZXJ2aWNlTmFtZSk7XG4gICAgaWYgKHNlcnZpY2UuRW5hYmxlU2VydmljZVNTTCkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvbm5lY3RQb3J0U1NMKHVkaWQsIHNlcnZpY2UuUG9ydCwgc29ja2V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvbm5lY3RQb3J0KHVkaWQsIHNlcnZpY2UuUG9ydCwgc29ja2V0KTtcbiAgICB9XG4gIH0gZmluYWxseSB7XG4gICAgbG9ja2Rvd24uY2xvc2UoKTtcbiAgfVxufVxuXG5leHBvcnQge1xuICBzdGFydFN5c2xvZ1NlcnZpY2UsIHN0YXJ0V2ViSW5zcGVjdG9yU2VydmljZSxcbiAgc3RhcnRJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UsIHN0YXJ0U2ltdWxhdGVMb2NhdGlvblNlcnZpY2UsXG4gIHN0YXJ0QWZjU2VydmljZSwgc3RhcnROb3RpZmljYXRpb25Qcm94eVNlcnZpY2UsXG4gIHN0YXJ0SG91c2VBcnJlc3RTZXJ2aWNlXG59O1xuIl0sImZpbGUiOiJsaWIvc2VydmljZXMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
