"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.PlistServiceDecoder = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _stream = _interopRequireDefault(require("stream"));

var _appiumSupport = require("appium-support");

const HEADER_LENGTH = 4;

class PlistServiceDecoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this._decode(data);

    onData();
  }

  _decode(data) {
    const payload = data.slice(HEADER_LENGTH, data.length);

    if (_lodash.default.isEmpty(payload)) {
      return;
    }

    const object = _appiumSupport.plist.parsePlist(payload);

    if (!object) {
      return;
    }

    this.push(object);
  }

}

exports.PlistServiceDecoder = PlistServiceDecoder;
var _default = PlistServiceDecoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9wbGlzdC1zZXJ2aWNlL3RyYW5zZm9ybWVyL3BsaXN0LXNlcnZpY2UtZGVjb2Rlci5qcyJdLCJuYW1lcyI6WyJIRUFERVJfTEVOR1RIIiwiUGxpc3RTZXJ2aWNlRGVjb2RlciIsIlN0cmVhbSIsIlRyYW5zZm9ybSIsImNvbnN0cnVjdG9yIiwib2JqZWN0TW9kZSIsIl90cmFuc2Zvcm0iLCJkYXRhIiwiZW5jb2RpbmciLCJvbkRhdGEiLCJfZGVjb2RlIiwicGF5bG9hZCIsInNsaWNlIiwibGVuZ3RoIiwiXyIsImlzRW1wdHkiLCJvYmplY3QiLCJwbGlzdCIsInBhcnNlUGxpc3QiLCJwdXNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLGFBQWEsR0FBRyxDQUF0Qjs7QUFFQSxNQUFNQyxtQkFBTixTQUFrQ0MsZ0JBQU9DLFNBQXpDLENBQW1EO0FBRWpEQyxFQUFBQSxXQUFXLEdBQUk7QUFDYixVQUFNO0FBQUVDLE1BQUFBLFVBQVUsRUFBRTtBQUFkLEtBQU47QUFDRDs7QUFFREMsRUFBQUEsVUFBVSxDQUFFQyxJQUFGLEVBQVFDLFFBQVIsRUFBa0JDLE1BQWxCLEVBQTBCO0FBQ2xDLFNBQUtDLE9BQUwsQ0FBYUgsSUFBYjs7QUFDQUUsSUFBQUEsTUFBTTtBQUNQOztBQUVEQyxFQUFBQSxPQUFPLENBQUVILElBQUYsRUFBUTtBQUNiLFVBQU1JLE9BQU8sR0FBR0osSUFBSSxDQUFDSyxLQUFMLENBQVdaLGFBQVgsRUFBMEJPLElBQUksQ0FBQ00sTUFBL0IsQ0FBaEI7O0FBQ0EsUUFBSUMsZ0JBQUVDLE9BQUYsQ0FBVUosT0FBVixDQUFKLEVBQXdCO0FBQ3RCO0FBQ0Q7O0FBQ0QsVUFBTUssTUFBTSxHQUFHQyxxQkFBTUMsVUFBTixDQUFpQlAsT0FBakIsQ0FBZjs7QUFDQSxRQUFJLENBQUNLLE1BQUwsRUFBYTtBQUNYO0FBQ0Q7O0FBQ0QsU0FBS0csSUFBTCxDQUFVSCxNQUFWO0FBQ0Q7O0FBckJnRDs7O2VBeUJwQ2YsbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IFN0cmVhbSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IHsgcGxpc3QgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cbmNvbnN0IEhFQURFUl9MRU5HVEggPSA0O1xuXG5jbGFzcyBQbGlzdFNlcnZpY2VEZWNvZGVyIGV4dGVuZHMgU3RyZWFtLlRyYW5zZm9ybSB7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKHsgb2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIF90cmFuc2Zvcm0gKGRhdGEsIGVuY29kaW5nLCBvbkRhdGEpIHtcbiAgICB0aGlzLl9kZWNvZGUoZGF0YSk7XG4gICAgb25EYXRhKCk7XG4gIH1cblxuICBfZGVjb2RlIChkYXRhKSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IGRhdGEuc2xpY2UoSEVBREVSX0xFTkdUSCwgZGF0YS5sZW5ndGgpO1xuICAgIGlmIChfLmlzRW1wdHkocGF5bG9hZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgb2JqZWN0ID0gcGxpc3QucGFyc2VQbGlzdChwYXlsb2FkKTtcbiAgICBpZiAoIW9iamVjdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnB1c2gob2JqZWN0KTtcbiAgfVxufVxuXG5leHBvcnQgeyBQbGlzdFNlcnZpY2VEZWNvZGVyIH07XG5leHBvcnQgZGVmYXVsdCBQbGlzdFNlcnZpY2VEZWNvZGVyO1xuIl0sImZpbGUiOiJsaWIvcGxpc3Qtc2VydmljZS90cmFuc2Zvcm1lci9wbGlzdC1zZXJ2aWNlLWRlY29kZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
