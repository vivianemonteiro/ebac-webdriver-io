"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _utils = require("../utils");

var _appiumSupport = require("appium-support");

let commands = {};

commands.getAttribute = async function (attribute, el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'getAttribute',
    args: [`${el}`, `${attribute}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from getAttribute');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
    throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_INVALID_SELECTOR) {
    throw new _appiumBaseDriver.errors.InvalidSelectorError(result.value);
  }

  return result.value;
};

commands.setValue = async function (value, el) {
  el = (0, _utils.unwrapEl)(el);

  if (value instanceof Array) {
    value = value.join('');
  }

  if (typeof value !== 'string') {
    value = `${value}`;
  }

  value = _appiumSupport.util.escapeSpecialChars(value, "'");
  value = value.replace(/\\\\n/g, '\\n');
  let commandObject = {
    name: 'sendkeys',
    args: [`${el}`, `${value}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from setValue');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
    throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
  }

  return result.value;
};

commands.getText = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'getText',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from getText');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
    throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
  }

  return result.value;
};

commands.elementEnabled = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementEnabled',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementEnabled');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.elementSelected = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementSelected',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementSelected');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_ELEMENT_IS_NOT_SELECTABLE) {
    throw new _appiumBaseDriver.errors.ElementIsNotSelectableError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.elementDisplayed = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementDisplayed',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementDisplayed');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.clear = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'clear',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from clear');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  }

  return result.value;
};

commands.getLocation = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementLocation',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementLocation');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.getLocationInView = async function (elementId) {
  return await this.getLocation(elementId);
};

commands.getSize = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementSize',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from getSize');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.getElementScreenshot = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'GetElementScreenShot',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    return new Buffer.from(data).toString('base64');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_ELEMENT_IS_NOT_VISIBLE) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  } else if (data) {
    return new Buffer.from(data).toString('base64');
  } else {
    throw new Error('Bad response from GetElementScreenShot');
  }
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiZ2V0QXR0cmlidXRlIiwiYXR0cmlidXRlIiwiZWwiLCJjb21tYW5kT2JqZWN0IiwibmFtZSIsImFyZ3MiLCJjb21tYW5kSlNPTiIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwiZXhlY3V0ZVNvY2tldENvbW1hbmQiLCJyZXN1bHQiLCJwYXJzZSIsImUiLCJFcnJvciIsInN0YXR1cyIsInlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMiLCJXRUJEUklWRVJfU1RBTEVfRUxFTUVOVCIsImVycm9ycyIsIlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yIiwidmFsdWUiLCJXRUJEUklWRVJfSU5WQUxJRF9TRUxFQ1RPUiIsIkludmFsaWRTZWxlY3RvckVycm9yIiwic2V0VmFsdWUiLCJBcnJheSIsImpvaW4iLCJ1dGlsIiwiZXNjYXBlU3BlY2lhbENoYXJzIiwicmVwbGFjZSIsImdldFRleHQiLCJlbGVtZW50RW5hYmxlZCIsIldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQiLCJVbmtub3duQ29tbWFuZEVycm9yIiwiV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCIsIk5vU3VjaEVsZW1lbnRFcnJvciIsImVsZW1lbnRTZWxlY3RlZCIsIldFQkRSSVZFUl9FTEVNRU5UX0lTX05PVF9TRUxFQ1RBQkxFIiwiRWxlbWVudElzTm90U2VsZWN0YWJsZUVycm9yIiwiZWxlbWVudERpc3BsYXllZCIsImNsZWFyIiwiZ2V0TG9jYXRpb24iLCJnZXRMb2NhdGlvbkluVmlldyIsImVsZW1lbnRJZCIsImdldFNpemUiLCJnZXRFbGVtZW50U2NyZWVuc2hvdCIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsIldFQkRSSVZFUl9FTEVNRU5UX0lTX05PVF9WSVNJQkxFIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjs7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LFdBQVcsR0FBR0MsSUFBSSxDQUFDQyxTQUFMLENBQWVMLGFBQWYsQ0FBbEI7QUFFQSxNQUFJTSxJQUFJLEdBQUcsTUFBTSxLQUFLQyxvQkFBTCxDQUEwQkosV0FBMUIsQ0FBakI7QUFFQSxNQUFJSyxNQUFKOztBQUNBLE1BQUk7QUFDRkEsSUFBQUEsTUFBTSxHQUFHSixJQUFJLENBQUNLLEtBQUwsQ0FBV0gsSUFBWCxDQUFUO0FBQ0QsR0FGRCxDQUVFLE9BQU9JLENBQVAsRUFBVTtBQUVWLFdBQU8sSUFBSWdDLE1BQU0sQ0FBQ0MsSUFBWCxDQUFnQnJDLElBQWhCLEVBQXNCc0MsUUFBdEIsQ0FBK0IsUUFBL0IsQ0FBUDtBQUNEOztBQUdELE1BQUlwQyxNQUFNLENBQUNJLE1BQVAsS0FBa0JDLG9DQUE2QmdDLGdDQUFuRCxFQUFxRjtBQUNuRixVQUFNLElBQUk5Qix5QkFBT2MsbUJBQVgsQ0FBK0JyQixNQUFNLENBQUNTLEtBQXRDLENBQU47QUFDRCxHQUZELE1BRU8sSUFBSVQsTUFBTSxDQUFDSSxNQUFQLEtBQWtCQyxvQ0FBNkJpQix5QkFBbkQsRUFBOEU7QUFDbkYsVUFBTSxJQUFJZix5QkFBT2dCLGtCQUFYLENBQThCdkIsTUFBTSxDQUFDUyxLQUFyQyxDQUFOO0FBQ0QsR0FGTSxNQUVBLElBQUlYLElBQUosRUFBVTtBQUNmLFdBQU8sSUFBSW9DLE1BQU0sQ0FBQ0MsSUFBWCxDQUFnQnJDLElBQWhCLEVBQXNCc0MsUUFBdEIsQ0FBK0IsUUFBL0IsQ0FBUDtBQUNELEdBRk0sTUFFQTtBQUNMLFVBQU0sSUFBSWpDLEtBQUosQ0FBVSx3Q0FBVixDQUFOO0FBQ0Q7QUFFRixDQTlCRDs7ZUFnQ2VmLFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgdW53cmFwRWwsIHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuXG5sZXQgY29tbWFuZHMgPSB7fTtcblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2dldEF0dHJpYnV0ZScsXG4gICAgYXJnczogW2Ake2VsfWAsIGAke2F0dHJpYnV0ZX1gXVxuICB9O1xuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQmFkIHJlc3BvbnNlIGZyb20gZ2V0QXR0cmlidXRlJyk7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9TVEFMRV9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5TdGFsZUVsZW1lbnRSZWZlcmVuY2VFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX0lOVkFMSURfU0VMRUNUT1IpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRTZWxlY3RvckVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWUgPSBhc3luYyBmdW5jdGlvbiAodmFsdWUsIGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5qb2luKCcnKTtcbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgIHZhbHVlID0gYCR7dmFsdWV9YDtcbiAgfVxuICB2YWx1ZSA9IHV0aWwuZXNjYXBlU3BlY2lhbENoYXJzKHZhbHVlLCBcIidcIik7XG4gIC8vIGRlLWVzY2FwZSBcXG4gc28gaXQgY2FuIGJlIHVzZWQgc3BlY2lhbGx5XG4gIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxcXFxcXFxuL2csICdcXFxcbicpO1xuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdzZW5ka2V5cycsXG4gICAgYXJnczogW2Ake2VsfWAsIGAke3ZhbHVlfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBzZXRWYWx1ZScpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG5cbn07XG5cbmNvbW1hbmRzLmdldFRleHQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2dldFRleHQnLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQmFkIHJlc3BvbnNlIGZyb20gZ2V0VGV4dCcpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG5cbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRFbmFibGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdlbGVtZW50RW5hYmxlZCcsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBlbGVtZW50RW5hYmxlZCcpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZCBhbmQgaGFuZGxlIGVycm9ycyByZXR1cm5lZCBmcm9tIHNlcnZlclxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfTk9fU1VDSF9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50U2VsZWN0ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2VsZW1lbnRTZWxlY3RlZCcsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBlbGVtZW50U2VsZWN0ZWQnKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWQgYW5kIGhhbmRsZSBlcnJvcnMgcmV0dXJuZWQgZnJvbSBzZXJ2ZXJcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX0VMRU1FTlRfSVNfTk9UX1NFTEVDVEFCTEUpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkVsZW1lbnRJc05vdFNlbGVjdGFibGVFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuZWxlbWVudERpc3BsYXllZCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuXG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdlbGVtZW50RGlzcGxheWVkJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCByZXNwb25zZSBmcm9tIGVsZW1lbnREaXNwbGF5ZWQnKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWQgYW5kIGhhbmRsZSBlcnJvcnMgcmV0dXJuZWQgZnJvbSBzZXJ2ZXJcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2NsZWFyJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcblxuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQmFkIHJlc3BvbnNlIGZyb20gY2xlYXInKTtcbiAgfVxuXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdlbGVtZW50TG9jYXRpb24nLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQmFkIHJlc3BvbnNlIGZyb20gZWxlbWVudExvY2F0aW9uJyk7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkIGFuZCBoYW5kbGUgZXJyb3JzIHJldHVybmVkIGZyb20gc2VydmVyXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uSW5WaWV3ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihlbGVtZW50SWQpO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudFNpemUnLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQmFkIHJlc3BvbnNlIGZyb20gZ2V0U2l6ZScpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZCBhbmQgaGFuZGxlIGVycm9ycyByZXR1cm5lZCBmcm9tIHNlcnZlclxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfTk9fU1VDSF9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy5nZXRFbGVtZW50U2NyZWVuc2hvdCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnR2V0RWxlbWVudFNjcmVlblNob3QnLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vVXNlZCB0byBjYXRjaCB1bmtub3duIGNoYXJhY3RlcnMgb24gVGl6ZW5cbiAgICByZXR1cm4gbmV3IEJ1ZmZlci5mcm9tKGRhdGEpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWQgYW5kIGhhbmRsZSBlcnJvcnMgcmV0dXJuZWQgZnJvbSBzZXJ2ZXIsIGVsc2UgY3JlYXRlIHRoZSBiYXNlNjQgaW1hZ2VcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX0VMRU1FTlRfSVNfTk9UX1ZJU0lCTEUpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKGRhdGEpIHtcbiAgICByZXR1cm4gbmV3IEJ1ZmZlci5mcm9tKGRhdGEpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCByZXNwb25zZSBmcm9tIEdldEVsZW1lbnRTY3JlZW5TaG90Jyk7XG4gIH1cblxufTtcblxuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
