"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.YouiEngineDriver = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _desiredCaps = _interopRequireDefault(require("./desired-caps"));

var _logger = _interopRequireDefault(require("./logger"));

var _commands = _interopRequireDefault(require("./commands"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncbox = require("asyncbox");

var _appiumUiautomator2Driver = _interopRequireDefault(require("appium-uiautomator2-driver"));

var _appiumXcuitestDriver = _interopRequireDefault(require("appium-xcuitest-driver"));

var _appiumMacDriver = _interopRequireDefault(require("appium-mac-driver"));

var _bluesky = _interopRequireDefault(require("./bluesky"));

var _tvos = _interopRequireDefault(require("./tvos"));

var _tvossimulator = _interopRequireDefault(require("./tvossimulator"));

var _yimac = _interopRequireDefault(require("./yimac"));

var _yilinux = _interopRequireDefault(require("./yilinux"));

const TO_PROXY_COMMON = ['background', 'closeApp', 'getLog', 'getLogTypes', 'getOrientation', 'getStrings', 'installApp', 'launchApp', 'lock', 'removeApp', 'setOrientation', 'getDeviceTime', 'queryAppState', 'getPerformanceData', 'getSupportedPerformanceDataTypes'];
const TO_PROXY_IOS_ONLY = ['mobileShake'];
const TO_PROXY_ANDROID_ONLY = ['getNetworkConnection', 'isAppInstalled', 'isLocked', 'longPressKeyCode', 'pressKeyCode', 'setNetworkConnection', 'toggleLocationServices', 'unlock'];
const TO_PROXY_IOS = TO_PROXY_IOS_ONLY.concat(TO_PROXY_COMMON);
const TO_PROXY_ANDROID = TO_PROXY_ANDROID_ONLY.concat(TO_PROXY_COMMON);
const TO_PROXY_MAC = TO_PROXY_COMMON;
const DEFAULT_MAX_RETRY_COUNT = 3;
const SOCKET_TIMEOUT = 120000;

class YouiEngineDriver extends _appiumBaseDriver.BaseDriver {
  resetYouiEngine() {
    this.ready = false;
    this.socket = null;
    this.locatorStrategies = ['id', 'name', 'class name', 'accessibility id'];
    this.proxydriver = null;
    this.proxyAllowList = '';
    this.proxyAll = false;
    this.device = null;
  }

  constructor(opts, shouldValidateCaps) {
    super(opts, shouldValidateCaps);
    this.desiredCapConstraints = _desiredCaps.default;
    this.settings = new _appiumBaseDriver.DeviceSettings({
      'TimeDilation': 1,
      'SourceTreeFilter': ''
    }, this.onSettingsUpdate.bind(this));
    this.resetYouiEngine();
  }

  validateLocatorStrategy(strategy) {
    super.validateLocatorStrategy(strategy, false);
  }

  async createSession(caps) {
    try {
      let [sessionId] = await super.createSession(caps);
      this.maxRetryCount = caps.maxRetryCount || DEFAULT_MAX_RETRY_COUNT;

      if (caps.platformName !== null) {
        let appPlatform = caps.platformName.toLowerCase();

        switch (appPlatform) {
          case 'ios':
          case 'tvos':
            await this.startXCUITestSession(caps);
            break;

          case 'android':
            await this.startAndroidSession(caps);
            break;

          case 'mac':
            await this.startMacSession(caps);
            break;

          case 'yimac':
            this.device = new _yimac.default();
            await this.device.startSession(caps);
            break;

          case 'yilinux':
            this.device = new _yilinux.default();
            await this.device.startSession(caps);
            break;

          case 'bluesky':
            this.device = new _bluesky.default();
            await this.device.startSession(caps);
            break;

          case 'yitvos':
            {
              let shell = require('shelljs');

              if (shell.exec(`instruments -s devices | grep '${caps.udid}'`).includes('(Simulator)')) {
                this.device = new _tvossimulator.default();
              } else {
                this.device = new _tvos.default();
              }

              await this.device.startSession(caps, this);
              break;
            }

          case 'noproxy':
          case 'connecttoapp':
            break;

          default:
            _logger.default.errorAndThrow(`Unsupported platformName: ${caps.platformName}`);

        }
      }

      await this.connectSocket();

      if (caps.fullSourceTree === true) {} else {
        _logger.default.debug('Setting SourceTreeFilter to displayed elements only');

        await this.updateSettings({
          SourceTreeFilter: "[@isDisplayed='true']"
        });
      }

      return [sessionId, this.opts];
    } catch (e) {
      await this.deleteSession();
      throw e;
    }
  }

  async onSettingsUpdate(key, value) {
    if (key === 'TimeDilation') {
      await this.setTimeDilation(value);
    } else if (key === 'SourceTreeFilter') {
      await this.setSourceTreeFilter(value);
    }
  }

  async stop() {
    this.ready = false;
  }

  async deleteSession() {
    var _this$caps, _this$socket, _this$socket2;

    _logger.default.debug('Deleting YouiEngine session');

    if ((_this$caps = this.caps) !== null && _this$caps !== void 0 && _this$caps.platformName) {
      let appPlatform = this.caps.platformName.toLowerCase();

      if (['yimac', 'yitvos', 'bluesky', 'yilinux'].includes(appPlatform)) {
        if (this.device) {
          this.device.endSession();
        }
      }
    }

    if (this.proxydriver !== null) {
      await this.proxydriver.deleteSession();
    }

    (_this$socket = this.socket) === null || _this$socket === void 0 ? void 0 : _this$socket.end();
    (_this$socket2 = this.socket) === null || _this$socket2 === void 0 ? void 0 : _this$socket2.destroy();
    await super.deleteSession();
    await this.stop();
  }

  driverShouldDoProxyCmd(command) {
    if (!this.proxydriver) {
      return false;
    }

    if (this.proxyAll) {
      return true;
    }

    for (let allowedCommand of this.proxyAllowList) {
      if (allowedCommand === command) {
        return true;
      }
    }

    return false;
  }

  async executeCommand(cmd, ...args) {
    if (cmd === 'receiveAsyncResponse') {
      _logger.default.debug(`Executing YouiEngineDriver response '${cmd}'`);

      return await this.receiveAsyncResponse(...args);
    }

    if (this.ready) {
      if (this.driverShouldDoProxyCmd(cmd)) {
        _logger.default.debug(`Executing proxied WebDriver command '${cmd}'`);

        if (cmd === 'setContext' && args[0] === 'YOUI_APP') {
          this.proxyAll = false;
          return await this.executeCommand(cmd, ...args);
        }

        this.clearNewCommandTimeout();
        let result = this.proxydriver.executeCommand(cmd, ...args);
        this.startNewCommandTimeout(cmd);
        return result;
      } else {
        _logger.default.debug(`Executing YouiEngine WebDriver command '${cmd}'`);

        return await super.executeCommand(cmd, ...args);
      }
    } else {
      _logger.default.debug(`Command Error '${cmd}'`);

      throw new _appiumBaseDriver.errors.NoSuchDriverError(`Driver is not ready, cannot execute ${cmd}.`);
    }
  }

  validateDesiredCaps(caps) {
    let res = super.validateDesiredCaps(caps);

    if (!res) {
      return res;
    }

    const platformName = caps.platformName.toLowerCase();

    if (!caps.youiEngineAppAddress && platformName !== 'noproxy') {
      let msg = 'The desired capabilities must include youiEngineAppAddress';

      _logger.default.errorAndThrow(msg);
    }

    if (platformName !== 'connecttoapp' && platformName !== 'noproxy') {
      if (!caps.app) {
        let msg = 'The desired capabilities must include app';

        _logger.default.errorAndThrow(msg);
      }

      const fs = require('fs');

      const path = require('path');

      if (!fs.existsSync(caps.app)) {
        let absolutepath = path.resolve(caps.app);
        let msg = 'The app could not be found in following location: ' + absolutepath;

        _logger.default.errorAndThrow(msg);
      }

      if (caps.deviceName.toLowerCase() === 'android') {
        if (!caps.avd) {
          let msg = 'The desired capabilities must include avd';

          _logger.default.errorAndThrow(msg);
        }
      }
    }

    return true;
  }

  async setupNewXCUITestDriver(caps) {
    let args = {
      javascriptEnabled: true
    };
    args = Object.assign(this.opts, args);
    let driver = new _appiumXcuitestDriver.default(args);

    let capsCopy = _lodash.default.cloneDeep(caps);

    capsCopy.newCommandTimeout = 0;
    await driver.createSession(capsCopy);
    return driver;
  }

  async startXCUITestSession(caps) {
    _logger.default.info('Starting an IOS proxy session');

    this.proxyAllowList = TO_PROXY_IOS;
    this.proxydriver = await this.setupNewXCUITestDriver(caps);
  }

  async setupNewAndroidDriver(caps) {
    let androidArgs = { ...this.opts,
      javascriptEnabled: true
    };
    let androiddriver = new _appiumUiautomator2Driver.default(androidArgs);
    this.setSecurityOptions(androiddriver);

    let capsCopy = _lodash.default.cloneDeep(caps);

    capsCopy.newCommandTimeout = 0;
    await androiddriver.createSession(capsCopy);
    return androiddriver;
  }

  async startAndroidSession(caps) {
    _logger.default.info('Starting an Android proxy session');

    this.proxyAllowList = TO_PROXY_ANDROID;
    this.proxydriver = await this.setupNewAndroidDriver(caps);
  }

  async setupNewMacDriver(caps) {
    let macArgs = {
      javascriptEnabled: true
    };
    let macdriver = new _appiumMacDriver.default(macArgs);

    let capsCopy = _lodash.default.cloneDeep(caps);

    capsCopy.newCommandTimeout = 0;
    await macdriver.createSession(capsCopy);
    return macdriver;
  }

  async startMacSession(caps) {
    _logger.default.info('Starting a Mac proxy session');

    this.proxyAllowList = TO_PROXY_MAC;
    this.proxydriver = await this.setupNewMacDriver(caps);
  }

  setSecurityOptions(driver) {
    if (this.relaxedSecurityEnabled) {
      driver.relaxedSecurityEnabled = this.relaxedSecurityEnabled;
    }

    if (this.denyInsecure) {
      driver.denyInsecure = this.denyInsecure;
    }

    if (this.allowInsecure) {
      driver.allowInsecure = this.allowInsecure;
    }
  }

  async connectSocket() {
    let retryCount = 0;
    let connected = false;
    let errno = 'EOK';

    while (retryCount < this.maxRetryCount && !connected) {
      _logger.default.info('Attempt #' + (retryCount + 1));

      let connectedPromise = new _bluebird.default(resolve => {
        let net = require('net');

        let HOST = this.opts.youiEngineAppAddress;
        let PORT;

        if (this.caps.youiEngineAppPort) {
          PORT = this.caps.youiEngineAppPort;
        } else if (this.caps.platformName.toLowerCase() === 'yips4') {
          PORT = 40123;
        } else {
          PORT = 12345;
        }

        if (this.caps.platformName.toLowerCase() === 'android' && this.caps.youiEngineAppAddress.toLowerCase() === 'localhost') {
          let shell = require('shelljs');

          _logger.default.info(' Forwarding the port for Android Emulators ');

          shell.exec(`adb -s '${this.caps.deviceName}' forward tcp:'${PORT}' tcp:'${PORT}'`);

          _logger.default.info(' Forwarding the traffic for Android Emulator ');
        }

        {
          _logger.default.info('Connecting to WebDriver: ' + HOST + ':' + PORT);
        }
        this.socket = new net.Socket();
        this.socket.setTimeout(SOCKET_TIMEOUT);
        this.socket.setKeepAlive(true, 1000);
        let socketClient = this.socket;

        let removeListenerHandler = function () {
          socketClient.removeListener('timeout', timeoutHandler);
          socketClient.removeListener('close', closeHandler);
          socketClient.removeListener('end', endHandler);
          socketClient.removeListener('error', errorHandler);
        };

        let errorHandler = function (ex) {
          _logger.default.error(ex);

          _logger.default.error('Check that WebDriver is enabled in application, if a device ensure the proper IP address is used.');

          removeListenerHandler();
          socketClient.destroy();
          errno = ex.errno;
          resolve(false);
        };

        this.socket.on('error', errorHandler);

        let closeHandler = function () {
          _logger.default.info('Connection closed');

          removeListenerHandler();
          socketClient.destroy();
          resolve(false);
        };

        this.socket.on('close', closeHandler);

        let timeoutHandler = function () {
          _logger.default.error('Connection timed out');

          removeListenerHandler();
          socketClient.destroy();
          resolve(false);
        };

        this.socket.on('timeout', timeoutHandler);
        this.socket.connect(PORT, HOST, function () {
          _logger.default.error('Connection established');

          removeListenerHandler();
          resolve(true);
        });

        let endHandler = function () {
          _logger.default.info('Connection ended');

          removeListenerHandler();
          socketClient.destroy();
          resolve(false);
        };

        this.socket.on('end', endHandler);
      });
      retryCount++;
      connected = await connectedPromise;

      if (!connected && (errno === 'ECONNREFUSED' || errno === -61)) {
        _logger.default.debug('Connection refused, sleeping...');

        await (0, _asyncbox.sleep)(4000);
        errno = 'EOK';
      }

      if (!connected && retryCount === this.maxRetryCount) {
        _logger.default.errorAndThrow('Failed to connect ' + this.maxRetryCount + ' times. Aborting.');
      }
    }

    retryCount = 0;
    this.ready = connected;
  }

  async executeSocketCommand(cmd) {
    if (!this.socket.writable) {
      _logger.default.info('Socket is not writable. Trying to reconnect.');

      await this.connectSocket();
    }

    let retryCount = 0;

    while (retryCount < this.maxRetryCount) {
      this.socket.setTimeout(SOCKET_TIMEOUT);
      let cmdPromise = new _bluebird.default(resolve => {
        _logger.default.debug('COMMAND: ' + cmd);

        let totaldata = [];
        let endMarker = new Buffer.from('youiend');
        let socketClient = this.socket;

        let removeListenerHandler = function () {
          socketClient.removeListener('data', dataHandler);
          socketClient.removeListener('timeout', timeoutHandler);
          socketClient.removeListener('error', errorHandler);
        };

        let timeoutHandler = function () {
          _logger.default.info('Timeout in execute command.');

          removeListenerHandler();
          resolve(false);
        };

        let errorHandler = function () {
          _logger.default.info('On error');

          removeListenerHandler();
          resolve(false);
        };

        let dataHandler = function (data) {
          if (data.length >= endMarker.length) {
            let dataend = new Buffer.alloc(endMarker.length);
            let startIndex = data.length - endMarker.length;
            data.copy(dataend, 0, startIndex, startIndex + endMarker.length);

            if (dataend.equals(endMarker)) {
              let lastData = data.slice(0, startIndex);
              totaldata.push(lastData);
              removeListenerHandler();
              resolve(Buffer.concat(totaldata));
            } else {
              totaldata.push(data);
            }
          }
        };

        socketClient.write(cmd + '\n', 'UTF8', () => {
          socketClient.on('data', dataHandler);
          socketClient.on('timeout', timeoutHandler);
          socketClient.on('error', errorHandler);
        });
      });
      let res = await cmdPromise;

      if (res === false) {
        retryCount++;

        _logger.default.info('Socket failed. Retrying: ' + retryCount);

        continue;
      } else {
        return res;
      }
    }

    throw new Error('ExecuteSocketCommand failed.');
  }

}

exports.YouiEngineDriver = YouiEngineDriver;

for (let [cmd, fn] of _lodash.default.toPairs(_commands.default)) {
  YouiEngineDriver.prototype[cmd] = fn;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kcml2ZXIuanMiXSwibmFtZXMiOlsiVE9fUFJPWFlfQ09NTU9OIiwiVE9fUFJPWFlfSU9TX09OTFkiLCJUT19QUk9YWV9BTkRST0lEX09OTFkiLCJUT19QUk9YWV9JT1MiLCJjb25jYXQiLCJUT19QUk9YWV9BTkRST0lEIiwiVE9fUFJPWFlfTUFDIiwiREVGQVVMVF9NQVhfUkVUUllfQ09VTlQiLCJTT0NLRVRfVElNRU9VVCIsIllvdWlFbmdpbmVEcml2ZXIiLCJCYXNlRHJpdmVyIiwicmVzZXRZb3VpRW5naW5lIiwicmVhZHkiLCJzb2NrZXQiLCJsb2NhdG9yU3RyYXRlZ2llcyIsInByb3h5ZHJpdmVyIiwicHJveHlBbGxvd0xpc3QiLCJwcm94eUFsbCIsImRldmljZSIsImNvbnN0cnVjdG9yIiwib3B0cyIsInNob3VsZFZhbGlkYXRlQ2FwcyIsImRlc2lyZWRDYXBDb25zdHJhaW50cyIsInNldHRpbmdzIiwiRGV2aWNlU2V0dGluZ3MiLCJvblNldHRpbmdzVXBkYXRlIiwiYmluZCIsInZhbGlkYXRlTG9jYXRvclN0cmF0ZWd5Iiwic3RyYXRlZ3kiLCJjcmVhdGVTZXNzaW9uIiwiY2FwcyIsInNlc3Npb25JZCIsIm1heFJldHJ5Q291bnQiLCJwbGF0Zm9ybU5hbWUiLCJhcHBQbGF0Zm9ybSIsInRvTG93ZXJDYXNlIiwic3RhcnRYQ1VJVGVzdFNlc3Npb24iLCJzdGFydEFuZHJvaWRTZXNzaW9uIiwic3RhcnRNYWNTZXNzaW9uIiwiWWlNYWMiLCJzdGFydFNlc3Npb24iLCJZaUxpbnV4IiwiQmx1ZVNreSIsInNoZWxsIiwicmVxdWlyZSIsImV4ZWMiLCJ1ZGlkIiwiaW5jbHVkZXMiLCJUdk9zU2ltdWxhdG9yIiwiVHZPcyIsImxvZ2dlciIsImVycm9yQW5kVGhyb3ciLCJjb25uZWN0U29ja2V0IiwiZnVsbFNvdXJjZVRyZWUiLCJkZWJ1ZyIsInVwZGF0ZVNldHRpbmdzIiwiU291cmNlVHJlZUZpbHRlciIsImUiLCJkZWxldGVTZXNzaW9uIiwia2V5IiwidmFsdWUiLCJzZXRUaW1lRGlsYXRpb24iLCJzZXRTb3VyY2VUcmVlRmlsdGVyIiwic3RvcCIsImVuZFNlc3Npb24iLCJlbmQiLCJkZXN0cm95IiwiZHJpdmVyU2hvdWxkRG9Qcm94eUNtZCIsImNvbW1hbmQiLCJhbGxvd2VkQ29tbWFuZCIsImV4ZWN1dGVDb21tYW5kIiwiY21kIiwiYXJncyIsInJlY2VpdmVBc3luY1Jlc3BvbnNlIiwiY2xlYXJOZXdDb21tYW5kVGltZW91dCIsInJlc3VsdCIsInN0YXJ0TmV3Q29tbWFuZFRpbWVvdXQiLCJlcnJvcnMiLCJOb1N1Y2hEcml2ZXJFcnJvciIsInZhbGlkYXRlRGVzaXJlZENhcHMiLCJyZXMiLCJ5b3VpRW5naW5lQXBwQWRkcmVzcyIsIm1zZyIsImFwcCIsImZzIiwicGF0aCIsImV4aXN0c1N5bmMiLCJhYnNvbHV0ZXBhdGgiLCJyZXNvbHZlIiwiZGV2aWNlTmFtZSIsImF2ZCIsInNldHVwTmV3WENVSVRlc3REcml2ZXIiLCJqYXZhc2NyaXB0RW5hYmxlZCIsIk9iamVjdCIsImFzc2lnbiIsImRyaXZlciIsIlhDVUlUZXN0RHJpdmVyIiwiY2Fwc0NvcHkiLCJfIiwiY2xvbmVEZWVwIiwibmV3Q29tbWFuZFRpbWVvdXQiLCJpbmZvIiwic2V0dXBOZXdBbmRyb2lkRHJpdmVyIiwiYW5kcm9pZEFyZ3MiLCJhbmRyb2lkZHJpdmVyIiwiQW5kcm9pZERyaXZlciIsInNldFNlY3VyaXR5T3B0aW9ucyIsInNldHVwTmV3TWFjRHJpdmVyIiwibWFjQXJncyIsIm1hY2RyaXZlciIsIk1hY0RyaXZlciIsInJlbGF4ZWRTZWN1cml0eUVuYWJsZWQiLCJkZW55SW5zZWN1cmUiLCJhbGxvd0luc2VjdXJlIiwicmV0cnlDb3VudCIsImNvbm5lY3RlZCIsImVycm5vIiwiY29ubmVjdGVkUHJvbWlzZSIsIkIiLCJuZXQiLCJIT1NUIiwiUE9SVCIsInlvdWlFbmdpbmVBcHBQb3J0IiwiU29ja2V0Iiwic2V0VGltZW91dCIsInNldEtlZXBBbGl2ZSIsInNvY2tldENsaWVudCIsInJlbW92ZUxpc3RlbmVySGFuZGxlciIsInJlbW92ZUxpc3RlbmVyIiwidGltZW91dEhhbmRsZXIiLCJjbG9zZUhhbmRsZXIiLCJlbmRIYW5kbGVyIiwiZXJyb3JIYW5kbGVyIiwiZXgiLCJlcnJvciIsIm9uIiwiY29ubmVjdCIsImV4ZWN1dGVTb2NrZXRDb21tYW5kIiwid3JpdGFibGUiLCJjbWRQcm9taXNlIiwidG90YWxkYXRhIiwiZW5kTWFya2VyIiwiQnVmZmVyIiwiZnJvbSIsImRhdGFIYW5kbGVyIiwiZGF0YSIsImxlbmd0aCIsImRhdGFlbmQiLCJhbGxvYyIsInN0YXJ0SW5kZXgiLCJjb3B5IiwiZXF1YWxzIiwibGFzdERhdGEiLCJzbGljZSIsInB1c2giLCJ3cml0ZSIsIkVycm9yIiwiZm4iLCJ0b1BhaXJzIiwiY29tbWFuZHMiLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBS0EsTUFBTUEsZUFBZSxHQUFHLENBQ3RCLFlBRHNCLEVBRXRCLFVBRnNCLEVBR3RCLFFBSHNCLEVBSXRCLGFBSnNCLEVBS3RCLGdCQUxzQixFQU10QixZQU5zQixFQU90QixZQVBzQixFQVF0QixXQVJzQixFQVN0QixNQVRzQixFQVV0QixXQVZzQixFQVd0QixnQkFYc0IsRUFZdEIsZUFac0IsRUFhdEIsZUFic0IsRUFjdEIsb0JBZHNCLEVBZXRCLGtDQWZzQixDQUF4QjtBQWtCQSxNQUFNQyxpQkFBaUIsR0FBRyxDQUN4QixhQUR3QixDQUExQjtBQUlBLE1BQU1DLHFCQUFxQixHQUFHLENBQzVCLHNCQUQ0QixFQUU1QixnQkFGNEIsRUFHNUIsVUFINEIsRUFJNUIsa0JBSjRCLEVBSzVCLGNBTDRCLEVBTTVCLHNCQU40QixFQU81Qix3QkFQNEIsRUFRNUIsUUFSNEIsQ0FBOUI7QUFXQSxNQUFNQyxZQUFZLEdBQUdGLGlCQUFp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QUFkLENBQUQsQ0FBUDtBQUNELGFBVEQsTUFTTztBQUNMQSxjQUFBQSxTQUFTLENBQUNjLElBQVYsQ0FBZVQsSUFBZjtBQUNEO0FBQ0Y7QUFDRixTQXBCRDs7QUFzQkFuQixRQUFBQSxZQUFZLENBQUM2QixLQUFiLENBQW1CcEYsR0FBRyxHQUFHLElBQXpCLEVBQStCLE1BQS9CLEVBQXVDLE1BQU07QUFDM0N1RCxVQUFBQSxZQUFZLENBQUNTLEVBQWIsQ0FBZ0IsTUFBaEIsRUFBd0JTLFdBQXhCO0FBQ0FsQixVQUFBQSxZQUFZLENBQUNTLEVBQWIsQ0FBZ0IsU0FBaEIsRUFBMkJOLGNBQTNCO0FBQ0FILFVBQUFBLFlBQVksQ0FBQ1MsRUFBYixDQUFnQixPQUFoQixFQUF5QkgsWUFBekI7QUFDRCxTQUpEO0FBS0QsT0FwRGdCLENBQWpCO0FBcURBLFVBQUlwRCxHQUFHLEdBQUcsTUFBTTJELFVBQWhCOztBQUNBLFVBQUkzRCxHQUFHLEtBQUssS0FBWixFQUFtQjtBQUNqQmtDLFFBQUFBLFVBQVU7O0FBQ1ZoRSx3QkFBT21ELElBQVAsQ0FBWSw4QkFBOEJhLFVBQTFDOztBQUNBO0FBQ0QsT0FKRCxNQUlPO0FBQ0wsZUFBT2xDLEdBQVA7QUFDRDtBQUNGOztBQUNELFVBQU0sSUFBSTRFLEtBQUosQ0FBVSw4QkFBVixDQUFOO0FBQ0Q7O0FBemV1Qzs7OztBQTRlMUMsS0FBSyxJQUFJLENBQUNyRixHQUFELEVBQU1zRixFQUFOLENBQVQsSUFBc0IzRCxnQkFBRTRELE9BQUYsQ0FBVUMsaUJBQVYsQ0FBdEIsRUFBMkM7QUFDekN0SixFQUFBQSxnQkFBZ0IsQ0FBQ3VKLFNBQWpCLENBQTJCekYsR0FBM0IsSUFBa0NzRixFQUFsQztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZURyaXZlciwgRGV2aWNlU2V0dGluZ3MsIGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgZGVzaXJlZENhcENvbnN0cmFpbnRzIGZyb20gJy4vZGVzaXJlZC1jYXBzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IGNvbW1hbmRzIGZyb20gJy4vY29tbWFuZHMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHNsZWVwIH0gZnJvbSAnYXN5bmNib3gnO1xuXG4vLyBmb3IgcHJveGllc1xuaW1wb3J0IEFuZHJvaWREcml2ZXIgZnJvbSAnYXBwaXVtLXVpYXV0b21hdG9yMi1kcml2ZXInO1xuaW1wb3J0IFhDVUlUZXN0RHJpdmVyIGZyb20gJ2FwcGl1bS14Y3VpdGVzdC1kcml2ZXInO1xuaW1wb3J0IE1hY0RyaXZlciBmcm9tICdhcHBpdW0tbWFjLWRyaXZlcic7XG5pbXBvcnQgQmx1ZVNreSBmcm9tICcuL2JsdWVza3knO1xuaW1wb3J0IFR2T3MgZnJvbSAnLi90dm9zJztcbmltcG9ydCBUdk9zU2ltdWxhdG9yIGZyb20gJy4vdHZvc3NpbXVsYXRvcic7XG5pbXBvcnQgWWlNYWMgZnJvbSAnLi95aW1hYyc7XG5pbXBvcnQgWWlMaW51eCBmcm9tICcuL3lpbGludXgnO1xuXG4vLyBBZGQgY29tbWFuZHMgZnJvbSB0aGUgZm9sbG93aW5nIGxvY2F0aW9uIHRoYXQgc2hvdWxkIGJlIG1hcHBlZCB0byBleGlzdGluZyBkcml2ZXJzOlxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0tYmFzZS1kcml2ZXIvYmxvYi9tYXN0ZXIvbGliL21qc29ud3Avcm91dGVzLmpzXG5cbmNvbnN0IFRPX1BST1hZX0NPTU1PTiA9IFtcbiAgJ2JhY2tncm91bmQnLFxuICAnY2xvc2VBcHAnLFxuICAnZ2V0TG9nJyxcbiAgJ2dldExvZ1R5cGVzJyxcbiAgJ2dldE9yaWVudGF0aW9uJyxcbiAgJ2dldFN0cmluZ3MnLFxuICAnaW5zdGFsbEFwcCcsXG4gICdsYXVuY2hBcHAnLFxuICAnbG9jaycsXG4gICdyZW1vdmVBcHAnLFxuICAnc2V0T3JpZW50YXRpb24nLFxuICAnZ2V0RGV2aWNlVGltZScsXG4gICdxdWVyeUFwcFN0YXRlJyxcbiAgJ2dldFBlcmZvcm1hbmNlRGF0YScsXG4gICdnZXRTdXBwb3J0ZWRQZXJmb3JtYW5jZURhdGFUeXBlcydcbl07XG5cbmNvbnN0IFRPX1BST1hZX0lPU19PTkxZID0gW1xuICAnbW9iaWxlU2hha2UnLFxuXTtcblxuY29uc3QgVE9fUFJPWFlfQU5EUk9JRF9PTkxZID0gW1xuICAnZ2V0TmV0d29ya0Nvbm5lY3Rpb24nLFxuICAnaXNBcHBJbnN0YWxsZWQnLFxuICAnaXNMb2NrZWQnLFxuICAnbG9uZ1ByZXNzS2V5Q29kZScsXG4gICdwcmVzc0tleUNvZGUnLFxuICAnc2V0TmV0d29ya0Nvbm5lY3Rpb24nLFxuICAndG9nZ2xlTG9jYXRpb25TZXJ2aWNlcycsXG4gICd1bmxvY2snLFxuXTtcblxuY29uc3QgVE9fUFJPWFlfSU9TID0gVE9fUFJPWFlfSU9TX09OTFkuY29uY2F0KFRPX1BST1hZX0NPTU1PTik7XG5jb25zdCBUT19QUk9YWV9BTkRST0lEID0gVE9fUFJPWFlfQU5EUk9JRF9PTkxZLmNvbmNhdChUT19QUk9YWV9DT01NT04pO1xuY29uc3QgVE9fUFJPWFlfTUFDID0gVE9fUFJPWFlfQ09NTU9OO1xuXG5jb25zdCBERUZBVUxUX01BWF9SRVRSWV9DT1VOVCA9IDM7XG5jb25zdCBTT0NLRVRfVElNRU9VVCA9IDEyMDAwMDtcblxuY2xhc3MgWW91aUVuZ2luZURyaXZlciBleHRlbmRzIEJhc2VEcml2ZXIge1xuICByZXNldFlvdWlFbmdpbmUgKCkge1xuXG4gICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuICAgIHRoaXMuc29ja2V0ID0gbnVsbDtcbiAgICB0aGlzLmxvY2F0b3JTdHJhdGVnaWVzID0gWydpZCcsICduYW1lJywgJ2NsYXNzIG5hbWUnLCAnYWNjZXNzaWJpbGl0eSBpZCddO1xuICAgIHRoaXMucHJveHlkcml2ZXIgPSBudWxsO1xuICAgIHRoaXMucHJveHlBbGxvd0xpc3QgPSAnJztcbiAgICB0aGlzLnByb3h5QWxsID0gZmFsc2U7XG4gICAgdGhpcy5kZXZpY2UgPSBudWxsO1xuICB9XG5cbiAgY29uc3RydWN0b3IgKG9wdHMsIHNob3VsZFZhbGlkYXRlQ2Fwcykge1xuICAgIHN1cGVyKG9wdHMsIHNob3VsZFZhbGlkYXRlQ2Fwcyk7XG5cbiAgICB0aGlzLmRlc2lyZWRDYXBDb25zdHJhaW50cyA9IGRlc2lyZWRDYXBDb25zdHJhaW50cztcbiAgICB0aGlzLnNldHRpbmdzID0gbmV3IERldmljZVNldHRpbmdzKHsnVGltZURpbGF0aW9uJzogMSwgJ1NvdXJjZVRyZWVGaWx0ZXInOiAnJ30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25TZXR0aW5nc1VwZGF0ZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnJlc2V0WW91aUVuZ2luZSgpO1xuXG4gIH1cblxuICB2YWxpZGF0ZUxvY2F0b3JTdHJhdGVneSAoc3RyYXRlZ3kpIHtcbiAgICBzdXBlci52YWxpZGF0ZUxvY2F0b3JTdHJhdGVneShzdHJhdGVneSwgZmFsc2UpO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlU2Vzc2lvbiAoY2Fwcykge1xuICAgIHRyeSB7XG4gICAgICBsZXQgW3Nlc3Npb25JZF0gPSBhd2FpdCBzdXBlci5jcmVhdGVTZXNzaW9uKGNhcHMpO1xuXG4gICAgICB0aGlzLm1heFJldHJ5Q291bnQgPSBjYXBzLm1heFJldHJ5Q291bnQgfHwgREVGQVVMVF9NQVhfUkVUUllfQ09VTlQ7XG5cbiAgICAgIC8vIHNldHVwIHByb3hpZXMgLSBpZiBwbGF0Zm9ybU5hbWUgaXMgbm90IGVtcHR5LCBtYWtlIGl0IGxlc3MgY2FzZSBzZW5zaXRpdmVcbiAgICAgIGlmIChjYXBzLnBsYXRmb3JtTmFtZSAhPT0gbnVsbCkge1xuICAgICAgICBsZXQgYXBwUGxhdGZvcm0gPSBjYXBzLnBsYXRmb3JtTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBzd2l0Y2ggKGFwcFBsYXRmb3JtKSB7XG4gICAgICAgICAgY2FzZSAnaW9zJzpcbiAgICAgICAgICBjYXNlICd0dm9zJzpcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RhcnRYQ1VJVGVzdFNlc3Npb24oY2Fwcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdhbmRyb2lkJzpcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RhcnRBbmRyb2lkU2Vzc2lvbihjYXBzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ21hYyc6XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0TWFjU2Vzc2lvbihjYXBzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3lpbWFjJzpcbiAgICAgICAgICAgIHRoaXMuZGV2aWNlID0gbmV3IFlpTWFjKCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmRldmljZS5zdGFydFNlc3Npb24oY2Fwcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICd5aWxpbnV4JzpcbiAgICAgICAgICAgIHRoaXMuZGV2aWNlID0gbmV3IFlpTGludXgoKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZGV2aWNlLnN0YXJ0U2Vzc2lvbihjYXBzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2JsdWVza3knOlxuICAgICAgICAgICAgdGhpcy5kZXZpY2UgPSBuZXcgQmx1ZVNreSgpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5kZXZpY2Uuc3RhcnRTZXNzaW9uKGNhcHMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAneWl0dm9zJzoge1xuICAgICAgICAgICAgbGV0IHNoZWxsID0gcmVxdWlyZSgnc2hlbGxqcycpO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBzaGVsbFxuICAgICAgICAgICAgICAgIC5leGVjKGBpbnN0cnVtZW50cyAtcyBkZXZpY2VzIHwgZ3JlcCAnJHtjYXBzLnVkaWR9J2ApXG4gICAgICAgICAgICAgICAgLmluY2x1ZGVzKCcoU2ltdWxhdG9yKScpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5kZXZpY2UgPSBuZXcgVHZPc1NpbXVsYXRvcigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5kZXZpY2UgPSBuZXcgVHZPcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5kZXZpY2Uuc3RhcnRTZXNzaW9uKGNhcHMsIHRoaXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgJ25vcHJveHknOlxuICAgICAgICAgIGNhc2UgJ2Nvbm5lY3R0b2FwcCc6XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coXG4gICAgICAgICAgICAgIGBVbnN1cHBvcnRlZCBwbGF0Zm9ybU5hbWU6ICR7Y2Fwcy5wbGF0Zm9ybU5hbWV9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5jb25uZWN0U29ja2V0KCk7XG5cbiAgICAgIGlmIChjYXBzLmZ1bGxTb3VyY2VUcmVlID09PSB0cnVlKSB7XG4gICAgICAgIC8vRG8gbm90IHNldCBmaWx0ZXJcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnU2V0dGluZyBTb3VyY2VUcmVlRmlsdGVyIHRvIGRpc3BsYXllZCBlbGVtZW50cyBvbmx5Jyk7XG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlU2V0dGluZ3Moe1xuICAgICAgICAgIFNvdXJjZVRyZWVGaWx0ZXI6IFwiW0Bpc0Rpc3BsYXllZD0ndHJ1ZSddXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gW3Nlc3Npb25JZCwgdGhpcy5vcHRzXTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBhd2FpdCB0aGlzLmRlbGV0ZVNlc3Npb24oKTtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb25TZXR0aW5nc1VwZGF0ZSAoa2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgPT09ICdUaW1lRGlsYXRpb24nKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldFRpbWVEaWxhdGlvbih2YWx1ZSk7XG4gICAgfSBlbHNlIGlmIChrZXkgPT09ICdTb3VyY2VUcmVlRmlsdGVyJykge1xuICAgICAgYXdhaXQgdGhpcy5zZXRTb3VyY2VUcmVlRmlsdGVyKHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzdG9wICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlU2Vzc2lvbiAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdEZWxldGluZyBZb3VpRW5naW5lIHNlc3Npb24nKTtcblxuICAgIGlmICh0aGlzLmNhcHM/LnBsYXRmb3JtTmFtZSkge1xuICAgICAgbGV0IGFwcFBsYXRmb3JtID0gdGhpcy5jYXBzLnBsYXRmb3JtTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICBpZiAoWyd5aW1hYycsICd5aXR2b3MnLCAnYmx1ZXNreScsICd5aWxpbnV4J10uaW5jbHVkZXMoYXBwUGxhdGZvcm0pKSB7XG4gICAgICAgIGlmICh0aGlzLmRldmljZSkge1xuICAgICAgICAgIHRoaXMuZGV2aWNlLmVuZFNlc3Npb24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnByb3h5ZHJpdmVyICE9PSBudWxsKSB7XG4gICAgICBhd2FpdCB0aGlzLnByb3h5ZHJpdmVyLmRlbGV0ZVNlc3Npb24oKTtcbiAgICB9XG4gICAgdGhpcy5zb2NrZXQ/LmVuZCgpO1xuICAgIHRoaXMuc29ja2V0Py5kZXN0cm95KCk7XG4gICAgYXdhaXQgc3VwZXIuZGVsZXRlU2Vzc2lvbigpO1xuICAgIGF3YWl0IHRoaXMuc3RvcCgpO1xuICB9XG5cbiAgZHJpdmVyU2hvdWxkRG9Qcm94eUNtZCAoY29tbWFuZCkge1xuICAgIGlmICghdGhpcy5wcm94eWRyaXZlcikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnByb3h5QWxsKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBvbmx5IGFsbG93IHdoaXRlIGxpc3RlZCBjb21tYW5kc1xuICAgIGZvciAobGV0IGFsbG93ZWRDb21tYW5kIG9mIHRoaXMucHJveHlBbGxvd0xpc3QpIHtcbiAgICAgIGlmIChhbGxvd2VkQ29tbWFuZCA9PT0gY29tbWFuZCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZUNvbW1hbmQgKGNtZCwgLi4uYXJncykge1xuICAgIGlmIChjbWQgPT09ICdyZWNlaXZlQXN5bmNSZXNwb25zZScpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgRXhlY3V0aW5nIFlvdWlFbmdpbmVEcml2ZXIgcmVzcG9uc2UgJyR7Y21kfSdgKTtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlY2VpdmVBc3luY1Jlc3BvbnNlKC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlYWR5KSB7XG5cbiAgICAgIGlmICh0aGlzLmRyaXZlclNob3VsZERvUHJveHlDbWQoY21kKSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoYEV4ZWN1dGluZyBwcm94aWVkIFdlYkRyaXZlciBjb21tYW5kICcke2NtZH0nYCk7XG5cbiAgICAgICAgLy8gTWFudWFsbHkgaGFuZGxlIG91ciBvd24gWU9VSV9BUFAgY29udGV4dFxuICAgICAgICBpZiAoY21kID09PSAnc2V0Q29udGV4dCcgJiYgYXJnc1swXSA9PT0gJ1lPVUlfQVBQJykge1xuICAgICAgICAgIHRoaXMucHJveHlBbGwgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhlcmUgYXJlIDIgQ29tbWFuZFRpbWVvdXQgKFlvdWlFbmdpbmVEcml2ZXIgYW5kIHByb3h5KVxuICAgICAgICAvLyBPbmx5IFlvdWlFbmdpbmVEcml2ZXIgQ29tbWFuZFRpbWVvdXQgaXMgdXNlZDsgUHJveHkgaXMgZGlzYWJsZWRcbiAgICAgICAgLy8gQWxsIHByb3h5IGNvbW1hbmRzIG5lZWRzIHRvIHJlc2V0IHRoZSBZb3VpRW5naW5lRHJpdmVyIENvbW1hbmRUaW1lb3V0XG4gICAgICAgIC8vIEhlcmUgd2UgbWFudWFsbHkgcmVzZXQgdGhlIFlvdWlFbmdpbmVEcml2ZXIgQ29tbWFuZFRpbWVvdXQgZm9yIGNvbW1hbmRzIHRoYXQgZ29lIHRvIHByb3h5LlxuICAgICAgICB0aGlzLmNsZWFyTmV3Q29tbWFuZFRpbWVvdXQoKTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHRoaXMucHJveHlkcml2ZXIuZXhlY3V0ZUNvbW1hbmQoY21kLCAuLi5hcmdzKTtcbiAgICAgICAgdGhpcy5zdGFydE5ld0NvbW1hbmRUaW1lb3V0KGNtZCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZGVidWcoYEV4ZWN1dGluZyBZb3VpRW5naW5lIFdlYkRyaXZlciBjb21tYW5kICcke2NtZH0nYCk7XG4gICAgICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoYENvbW1hbmQgRXJyb3IgJyR7Y21kfSdgKTtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRHJpdmVyRXJyb3IoXG4gICAgICAgIGBEcml2ZXIgaXMgbm90IHJlYWR5LCBjYW5ub3QgZXhlY3V0ZSAke2NtZH0uYFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICB2YWxpZGF0ZURlc2lyZWRDYXBzIChjYXBzKSB7XG4gICAgLy8gY2hlY2sgd2l0aCB0aGUgYmFzZSBjbGFzcywgYW5kIHJldHVybiBpZiBpdCBmYWlsc1xuICAgIGxldCByZXMgPSBzdXBlci52YWxpZGF0ZURlc2lyZWRDYXBzKGNhcHMpO1xuICAgIGlmICghcmVzKSB7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH1cblxuICAgIGNvbnN0IHBsYXRmb3JtTmFtZSA9IGNhcHMucGxhdGZvcm1OYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgY2FwYWJpbGl0aWVzIGhhcyB5b3VpRW5naW5lQXBwQWRkcmVzc1xuICAgIGlmICghY2Fwcy55b3VpRW5naW5lQXBwQWRkcmVzcyAmJiBwbGF0Zm9ybU5hbWUgIT09ICdub3Byb3h5Jykge1xuICAgICAgbGV0IG1zZyA9ICdUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgbXVzdCBpbmNsdWRlIHlvdWlFbmdpbmVBcHBBZGRyZXNzJztcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgfVxuXG4gICAgLy8gQXBwIGlzIGJlaW5nIGxhdW5jaGVkXG4gICAgaWYgKHBsYXRmb3JtTmFtZSAhPT0gJ2Nvbm5lY3R0b2FwcCcgJiYgcGxhdGZvcm1OYW1lICE9PSAnbm9wcm94eScpIHtcbiAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYXBhYmlsaXRpZXMgaGFzIGFwcFxuICAgICAgaWYgKCFjYXBzLmFwcCkge1xuICAgICAgICBsZXQgbXNnID0gJ1RoZSBkZXNpcmVkIGNhcGFiaWxpdGllcyBtdXN0IGluY2x1ZGUgYXBwJztcbiAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbiAgICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoY2Fwcy5hcHApKSB7XG4gICAgICAgIGxldCBhYnNvbHV0ZXBhdGggPSBwYXRoLnJlc29sdmUoY2Fwcy5hcHApO1xuICAgICAgICBsZXQgbXNnID1cbiAgICAgICAgICAnVGhlIGFwcCBjb3VsZCBub3QgYmUgZm91bmQgaW4gZm9sbG93aW5nIGxvY2F0aW9uOiAnICsgYWJzb2x1dGVwYXRoO1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgICAgfVxuXG4gICAgICAvL0FuZHJvaWQgZW11bGF0b3Igd2l0aCBwcm94eVxuICAgICAgaWYgKGNhcHMuZGV2aWNlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYW5kcm9pZCcpIHtcbiAgICAgICAgaWYgKCFjYXBzLmF2ZCkge1xuICAgICAgICAgIGxldCBtc2cgPSAnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBhdmQnO1xuICAgICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBmaW5hbGx5LCByZXR1cm4gdHJ1ZSBzaW5jZSB0aGUgc3VwZXJjbGFzcyBjaGVjayBwYXNzZWQsIGFzIGRpZCB0aGlzXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBhc3luYyBzZXR1cE5ld1hDVUlUZXN0RHJpdmVyIChjYXBzKSB7XG4gICAgbGV0IGFyZ3MgPSB7XG4gICAgICBqYXZhc2NyaXB0RW5hYmxlZDogdHJ1ZSxcbiAgICB9O1xuICAgIGFyZ3MgPSBPYmplY3QuYXNzaWduKHRoaXMub3B0cywgYXJncyk7XG5cbiAgICBsZXQgZHJpdmVyID0gbmV3IFhDVUlUZXN0RHJpdmVyKGFyZ3MpO1xuXG4gICAgbGV0IGNhcHNDb3B5ID0gXy5jbG9uZURlZXAoY2Fwcyk7XG4gICAgLy8gRGlzYWJsaW5nIHRoZSBwcm94eSBDb21tYW5kVGltZW91dCBpbiB0aGUgaU9TIGRyaXZlciBzaW5jZSB3ZSBhcmUgbm93IGhhbmRsaW5nIGl0IGluIHRoZSBZb3VpRW5naW5lIERyaXZlclxuICAgIGNhcHNDb3B5Lm5ld0NvbW1hbmRUaW1lb3V0ID0gMDtcbiAgICBhd2FpdCBkcml2ZXIuY3JlYXRlU2Vzc2lvbihjYXBzQ29weSk7XG5cbiAgICByZXR1cm4gZHJpdmVyO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRYQ1VJVGVzdFNlc3Npb24gKGNhcHMpIHtcbiAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgYW4gSU9TIHByb3h5IHNlc3Npb24nKTtcbiAgICB0aGlzLnByb3h5QWxsb3dMaXN0ID0gVE9fUFJPWFlfSU9TO1xuXG4gICAgdGhpcy5wcm94eWRyaXZlciA9IGF3YWl0IHRoaXMuc2V0dXBOZXdYQ1VJVGVzdERyaXZlcihjYXBzKTtcbiAgfVxuXG4gIGFzeW5jIHNldHVwTmV3QW5kcm9pZERyaXZlciAoY2Fwcykge1xuICAgIGxldCBhbmRyb2lkQXJncyA9IHtcbiAgICAgIC4uLnRoaXMub3B0cyxcbiAgICAgIGphdmFzY3JpcHRFbmFibGVkOiB0cnVlLFxuICAgIH07XG4gICAgbGV0IGFuZHJvaWRkcml2ZXIgPSBuZXcgQW5kcm9pZERyaXZlcihhbmRyb2lkQXJncyk7XG4gICAgdGhpcy5zZXRTZWN1cml0eU9wdGlvbnMoYW5kcm9pZGRyaXZlcik7XG5cbiAgICBsZXQgY2Fwc0NvcHkgPSBfLmNsb25lRGVlcChjYXBzKTtcbiAgICAvLyBEaXNhYmxpbmcgdGhlIHByb3h5IENvbW1hbmRUaW1lb3V0IGluIHRoZSBBbmRyb2lkIGRyaXZlciBzaW5jZSB3ZSBhcmUgbm93IGhhbmRsaW5nIGl0IGluIHRoZSBZb3VpRW5naW5lIERyaXZlclxuICAgIGNhcHNDb3B5Lm5ld0NvbW1hbmRUaW1lb3V0ID0gMDtcblxuICAgIGF3YWl0IGFuZHJvaWRkcml2ZXIuY3JlYXRlU2Vzc2lvbihjYXBzQ29weSk7XG5cbiAgICByZXR1cm4gYW5kcm9pZGRyaXZlcjtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0QW5kcm9pZFNlc3Npb24gKGNhcHMpIHtcbiAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgYW4gQW5kcm9pZCBwcm94eSBzZXNzaW9uJyk7XG4gICAgdGhpcy5wcm94eUFsbG93TGlzdCA9IFRPX1BST1hZX0FORFJPSUQ7XG5cbiAgICB0aGlzLnByb3h5ZHJpdmVyID0gYXdhaXQgdGhpcy5zZXR1cE5ld0FuZHJvaWREcml2ZXIoY2Fwcyk7XG4gIH1cblxuICBhc3luYyBzZXR1cE5ld01hY0RyaXZlciAoY2Fwcykge1xuICAgIGxldCBtYWNBcmdzID0ge1xuICAgICAgamF2YXNjcmlwdEVuYWJsZWQ6IHRydWUsXG4gICAgfTtcbiAgICBsZXQgbWFjZHJpdmVyID0gbmV3IE1hY0RyaXZlcihtYWNBcmdzKTtcbiAgICBsZXQgY2Fwc0NvcHkgPSBfLmNsb25lRGVlcChjYXBzKTtcbiAgICAvLyBEaXNhYmxpbmcgdGhlIHByb3h5IENvbW1hbmRUaW1lb3V0IGluIHRoZSBwcm94aWVkIGRyaXZlciBzaW5jZSB3ZSBhcmUgbm93IGhhbmRsaW5nIGl0IGluIHRoZSBZb3VpRW5naW5lIERyaXZlclxuICAgIGNhcHNDb3B5Lm5ld0NvbW1hbmRUaW1lb3V0ID0gMDtcblxuICAgIGF3YWl0IG1hY2RyaXZlci5jcmVhdGVTZXNzaW9uKGNhcHNDb3B5KTtcblxuICAgIHJldHVybiBtYWNkcml2ZXI7XG4gIH1cblxuICBhc3luYyBzdGFydE1hY1Nlc3Npb24gKGNhcHMpIHtcbiAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgYSBNYWMgcHJveHkgc2Vzc2lvbicpO1xuICAgIHRoaXMucHJveHlBbGxvd0xpc3QgPSBUT19QUk9YWV9NQUM7XG5cbiAgICB0aGlzLnByb3h5ZHJpdmVyID0gYXdhaXQgdGhpcy5zZXR1cE5ld01hY0RyaXZlcihjYXBzKTtcbiAgfVxuXG4gIHNldFNlY3VyaXR5T3B0aW9ucyAoZHJpdmVyKSB7XG4gICAgaWYgKHRoaXMucmVsYXhlZFNlY3VyaXR5RW5hYmxlZCkge1xuICAgICAgZHJpdmVyLnJlbGF4ZWRTZWN1cml0eUVuYWJsZWQgPSB0aGlzLnJlbGF4ZWRTZWN1cml0eUVuYWJsZWQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGVueUluc2VjdXJlKSB7XG4gICAgICBkcml2ZXIuZGVueUluc2VjdXJlID0gdGhpcy5kZW55SW5zZWN1cmU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYWxsb3dJbnNlY3VyZSkge1xuICAgICAgZHJpdmVyLmFsbG93SW5zZWN1cmUgPSB0aGlzLmFsbG93SW5zZWN1cmU7XG4gICAgfVxuICB9XG5cbiAgLy8gU09DS0VUU1xuICBhc3luYyBjb25uZWN0U29ja2V0ICgpIHtcbiAgICBsZXQgcmV0cnlDb3VudCA9IDA7XG4gICAgbGV0IGNvbm5lY3RlZCA9IGZhbHNlO1xuICAgIGxldCBlcnJubyA9ICdFT0snO1xuICAgIHdoaWxlIChyZXRyeUNvdW50IDwgdGhpcy5tYXhSZXRyeUNvdW50ICYmICFjb25uZWN0ZWQpIHtcbiAgICAgIGxvZ2dlci5pbmZvKCdBdHRlbXB0ICMnICsgKHJldHJ5Q291bnQgKyAxKSk7XG5cbiAgICAgIGxldCBjb25uZWN0ZWRQcm9taXNlID0gbmV3IEIoKHJlc29sdmUpID0+IHtcbiAgICAgICAgbGV0IG5ldCA9IHJlcXVpcmUoJ25ldCcpO1xuXG4gICAgICAgIGxldCBIT1NUID0gdGhpcy5vcHRzLnlvdWlFbmdpbmVBcHBBZGRyZXNzO1xuICAgICAgICBsZXQgUE9SVDtcblxuICAgICAgICBpZiAodGhpcy5jYXBzLnlvdWlFbmdpbmVBcHBQb3J0KSB7XG4gICAgICAgICAgUE9SVCA9IHRoaXMuY2Fwcy55b3VpRW5naW5lQXBwUG9ydDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNhcHMucGxhdGZvcm1OYW1lLnRvTG93ZXJDYXNlKCkgPT09ICd5aXBzNCcpIHtcbiAgICAgICAgICBQT1JUID0gNDAxMjM7IC8vZGVmYXVsdCBwb3J0IGZvciBQUzRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBQT1JUID0gMTIzNDU7IC8vZGVmYXVsdCBwb3J0XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2Fwcy5wbGF0Zm9ybU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2FuZHJvaWQnICYmIHRoaXMuY2Fwcy55b3VpRW5naW5lQXBwQWRkcmVzcy50b0xvd2VyQ2FzZSgpID09PSAnbG9jYWxob3N0Jykge1xuICAgICAgICAgIGxldCBzaGVsbCA9IHJlcXVpcmUoJ3NoZWxsanMnKTtcbiAgICAgICAgICBsb2dnZXIuaW5mbygnIEZvcndhcmRpbmcgdGhlIHBvcnQgZm9yIEFuZHJvaWQgRW11bGF0b3JzICcpO1xuICAgICAgICAgIHNoZWxsLmV4ZWMoYGFkYiAtcyAnJHt0aGlzLmNhcHMuZGV2aWNlTmFtZX0nIGZvcndhcmQgdGNwOicke1BPUlR9JyB0Y3A6JyR7UE9SVH0nYCk7XG4gICAgICAgICAgbG9nZ2VyLmluZm8oJyBGb3J3YXJkaW5nIHRoZSB0cmFmZmljIGZvciBBbmRyb2lkIEVtdWxhdG9yICcpO1xuICAgICAgICB9XG4gICAgICAgIHtcbiAgICAgICAgICBsb2dnZXIuaW5mbygnQ29ubmVjdGluZyB0byBXZWJEcml2ZXI6ICcgKyBIT1NUICsgJzonICsgUE9SVCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNvY2tldCA9IG5ldyBuZXQuU29ja2V0KCk7XG4gICAgICAgIHRoaXMuc29ja2V0LnNldFRpbWVvdXQoU09DS0VUX1RJTUVPVVQpO1xuICAgICAgICB0aGlzLnNvY2tldC5zZXRLZWVwQWxpdmUodHJ1ZSwgMTAwMCk7XG5cbiAgICAgICAgbGV0IHNvY2tldENsaWVudCA9IHRoaXMuc29ja2V0O1xuXG4gICAgICAgIGxldCByZW1vdmVMaXN0ZW5lckhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc29ja2V0Q2xpZW50LnJlbW92ZUxpc3RlbmVyKCd0aW1lb3V0JywgdGltZW91dEhhbmRsZXIpO1xuICAgICAgICAgIHNvY2tldENsaWVudC5yZW1vdmVMaXN0ZW5lcignY2xvc2UnLCBjbG9zZUhhbmRsZXIpO1xuICAgICAgICAgIHNvY2tldENsaWVudC5yZW1vdmVMaXN0ZW5lcignZW5kJywgZW5kSGFuZGxlcik7XG4gICAgICAgICAgc29ja2V0Q2xpZW50LnJlbW92ZUxpc3RlbmVyKCdlcnJvcicsIGVycm9ySGFuZGxlcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIGFuICdlcnJvcicgZXZlbnQgaGFuZGxlciBmb3IgdGhlIGNsaWVudCBzb2NrZXRcbiAgICAgICAgbGV0IGVycm9ySGFuZGxlciA9IGZ1bmN0aW9uIChleCkge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcihleCk7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgJ0NoZWNrIHRoYXQgV2ViRHJpdmVyIGlzIGVuYWJsZWQgaW4gYXBwbGljYXRpb24sIGlmIGEgZGV2aWNlIGVuc3VyZSB0aGUgcHJvcGVyIElQIGFkZHJlc3MgaXMgdXNlZC4nXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZW1vdmVMaXN0ZW5lckhhbmRsZXIoKTtcbiAgICAgICAgICBzb2NrZXRDbGllbnQuZGVzdHJveSgpO1xuICAgICAgICAgIGVycm5vID0gZXguZXJybm87XG4gICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc29ja2V0Lm9uKCdlcnJvcicsIGVycm9ySGFuZGxlcik7XG4gICAgICAgIC8vIEFkZCBhICdjbG9zZScgZXZlbnQgaGFuZGxlciBmb3IgdGhlIGNsaWVudCBzb2NrZXRcbiAgICAgICAgbGV0IGNsb3NlSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBsb2dnZXIuaW5mbygnQ29ubmVjdGlvbiBjbG9zZWQnKTtcbiAgICAgICAgICByZW1vdmVMaXN0ZW5lckhhbmRsZXIoKTtcbiAgICAgICAgICBzb2NrZXRDbGllbnQuZGVzdHJveSgpO1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNvY2tldC5vbignY2xvc2UnLCBjbG9zZUhhbmRsZXIpO1xuICAgICAgICAvLyBBZGQgYSAndGltZW91dCcgZXZlbnQgaGFuZGxlciBmb3IgdGhlIGNsaWVudCBzb2NrZXRcbiAgICAgICAgbGV0IHRpbWVvdXRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcignQ29ubmVjdGlvbiB0aW1lZCBvdXQnKTtcbiAgICAgICAgICByZW1vdmVMaXN0ZW5lckhhbmRsZXIoKTtcbiAgICAgICAgICBzb2NrZXRDbGllbnQuZGVzdHJveSgpO1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNvY2tldC5vbigndGltZW91dCcsIHRpbWVvdXRIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5zb2NrZXQuY29ubmVjdChQT1JULCBIT1NULCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKCdDb25uZWN0aW9uIGVzdGFibGlzaGVkJyk7XG4gICAgICAgICAgcmVtb3ZlTGlzdGVuZXJIYW5kbGVyKCk7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCBlbmRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxvZ2dlci5pbmZvKCdDb25uZWN0aW9uIGVuZGVkJyk7XG4gICAgICAgICAgcmVtb3ZlTGlzdGVuZXJIYW5kbGVyKCk7XG4gICAgICAgICAgc29ja2V0Q2xpZW50LmRlc3Ryb3koKTtcbiAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zb2NrZXQub24oJ2VuZCcsIGVuZEhhbmRsZXIpO1xuICAgICAgfSk7XG4gICAgICByZXRyeUNvdW50Kys7XG4gICAgICBjb25uZWN0ZWQgPSBhd2FpdCBjb25uZWN0ZWRQcm9taXNlO1xuXG4gICAgICBpZiAoIWNvbm5lY3RlZCAmJiAoZXJybm8gPT09ICdFQ09OTlJFRlVTRUQnIHx8IGVycm5vID09PSAtNjEpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQ29ubmVjdGlvbiByZWZ1c2VkLCBzbGVlcGluZy4uLicpO1xuICAgICAgICBhd2FpdCBzbGVlcCg0MDAwKTtcbiAgICAgICAgZXJybm8gPSAnRU9LJztcbiAgICAgIH1cblxuICAgICAgaWYgKCFjb25uZWN0ZWQgJiYgcmV0cnlDb3VudCA9PT0gdGhpcy5tYXhSZXRyeUNvdW50KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdGYWlsZWQgdG8gY29ubmVjdCAnICsgdGhpcy5tYXhSZXRyeUNvdW50ICsgJyB0aW1lcy4gQWJvcnRpbmcuJyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHJ5Q291bnQgPSAwO1xuICAgIHRoaXMucmVhZHkgPSBjb25uZWN0ZWQ7XG4gIH1cblxuICBhc3luYyBleGVjdXRlU29ja2V0Q29tbWFuZCAoY21kKSB7XG4gICAgaWYgKCF0aGlzLnNvY2tldC53cml0YWJsZSkge1xuICAgICAgbG9nZ2VyLmluZm8oJ1NvY2tldCBpcyBub3Qgd3JpdGFibGUuIFRyeWluZyB0byByZWNvbm5lY3QuJyk7XG4gICAgICBhd2FpdCB0aGlzLmNvbm5lY3RTb2NrZXQoKTtcbiAgICB9XG5cbiAgICBsZXQgcmV0cnlDb3VudCA9IDA7XG4gICAgd2hpbGUgKHJldHJ5Q291bnQgPCB0aGlzLm1heFJldHJ5Q291bnQpIHtcbiAgICAgIHRoaXMuc29ja2V0LnNldFRpbWVvdXQoU09DS0VUX1RJTUVPVVQpO1xuXG4gICAgICBsZXQgY21kUHJvbWlzZSA9IG5ldyBCKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQ09NTUFORDogJyArIGNtZCk7XG5cbiAgICAgICAgbGV0IHRvdGFsZGF0YSA9IFtdO1xuICAgICAgICBsZXQgZW5kTWFya2VyID0gbmV3IEJ1ZmZlci5mcm9tKCd5b3VpZW5kJyk7XG4gICAgICAgIGxldCBzb2NrZXRDbGllbnQgPSB0aGlzLnNvY2tldDtcblxuICAgICAgICBsZXQgcmVtb3ZlTGlzdGVuZXJIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNvY2tldENsaWVudC5yZW1vdmVMaXN0ZW5lcignZGF0YScsIGRhdGFIYW5kbGVyKTtcbiAgICAgICAgICBzb2NrZXRDbGllbnQucmVtb3ZlTGlzdGVuZXIoJ3RpbWVvdXQnLCB0aW1lb3V0SGFuZGxlcik7XG4gICAgICAgICAgc29ja2V0Q2xpZW50LnJlbW92ZUxpc3RlbmVyKCdlcnJvcicsIGVycm9ySGFuZGxlcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IHRpbWVvdXRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxvZ2dlci5pbmZvKCdUaW1lb3V0IGluIGV4ZWN1dGUgY29tbWFuZC4nKTtcbiAgICAgICAgICByZW1vdmVMaXN0ZW5lckhhbmRsZXIoKTtcbiAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgZXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxvZ2dlci5pbmZvKCdPbiBlcnJvcicpO1xuICAgICAgICAgIHJlbW92ZUxpc3RlbmVySGFuZGxlcigpO1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGxldCBkYXRhSGFuZGxlciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHRoaXMgaW5jbHVkZXMgYW4gZW5kIG1hcmtlclxuICAgICAgICAgIC8vIGdldCBsYXN0IGZldyB2YWx1ZXMgb2YgYnVmZmVyXG4gICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID49IGVuZE1hcmtlci5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBkYXRhZW5kID0gbmV3IEJ1ZmZlci5hbGxvYyhlbmRNYXJrZXIubGVuZ3RoKTtcbiAgICAgICAgICAgIGxldCBzdGFydEluZGV4ID0gZGF0YS5sZW5ndGggLSBlbmRNYXJrZXIubGVuZ3RoO1xuICAgICAgICAgICAgZGF0YS5jb3B5KGRhdGFlbmQsIDAsIHN0YXJ0SW5kZXgsIHN0YXJ0SW5kZXggKyBlbmRNYXJrZXIubGVuZ3RoKTtcbiAgICAgICAgICAgIGlmIChkYXRhZW5kLmVxdWFscyhlbmRNYXJrZXIpKSB7XG4gICAgICAgICAgICAgIC8vIHJlbW92ZSBkYXRhIGVuZFxuICAgICAgICAgICAgICBsZXQgbGFzdERhdGEgPSBkYXRhLnNsaWNlKDAsIHN0YXJ0SW5kZXgpO1xuICAgICAgICAgICAgICB0b3RhbGRhdGEucHVzaChsYXN0RGF0YSk7XG5cbiAgICAgICAgICAgICAgcmVtb3ZlTGlzdGVuZXJIYW5kbGVyKCk7XG5cbiAgICAgICAgICAgICAgLy8gcmVzb2x2ZVxuICAgICAgICAgICAgICByZXNvbHZlKEJ1ZmZlci5jb25jYXQodG90YWxkYXRhKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0b3RhbGRhdGEucHVzaChkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgc29ja2V0Q2xpZW50LndyaXRlKGNtZCArICdcXG4nLCAnVVRGOCcsICgpID0+IHtcbiAgICAgICAgICBzb2NrZXRDbGllbnQub24oJ2RhdGEnLCBkYXRhSGFuZGxlcik7XG4gICAgICAgICAgc29ja2V0Q2xpZW50Lm9uKCd0aW1lb3V0JywgdGltZW91dEhhbmRsZXIpO1xuICAgICAgICAgIHNvY2tldENsaWVudC5vbignZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGNtZFByb21pc2U7XG4gICAgICBpZiAocmVzID09PSBmYWxzZSkge1xuICAgICAgICByZXRyeUNvdW50Kys7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdTb2NrZXQgZmFpbGVkLiBSZXRyeWluZzogJyArIHJldHJ5Q291bnQpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignRXhlY3V0ZVNvY2tldENvbW1hbmQgZmFpbGVkLicpO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoY29tbWFuZHMpKSB7XG4gIFlvdWlFbmdpbmVEcml2ZXIucHJvdG90eXBlW2NtZF0gPSBmbjtcbn1cbmV4cG9ydCB7IFlvdWlFbmdpbmVEcml2ZXIgfTtcbiJdLCJmaWxlIjoibGliL2RyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
