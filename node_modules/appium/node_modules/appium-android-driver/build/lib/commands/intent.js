"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumBaseDriver = require("appium-base-driver");

const NO_VALUE_ARG_TYPE = 'sn';
const SUPPORTED_EXTRA_TYPES = ['s', NO_VALUE_ARG_TYPE, 'z', 'i', 'l', 'f', 'u', 'cn', 'ia', 'ial', 'la', 'lal', 'fa', 'fal', 'sa', 'sal'];
const API_LEVEL_ANDROID_8 = 26;
const commands = {};
exports.commands = commands;

function parseIntentSpec(opts = {}) {
  const {
    intent,
    action,
    uri,
    mimeType,
    identifier,
    categories,
    component,
    extras,
    flags
  } = opts;
  const resultArgs = [];

  if (intent) {
    resultArgs.push(intent);
  }

  if (action) {
    resultArgs.push('-a', action);
  }

  if (uri) {
    resultArgs.push('-d', uri);
  }

  if (mimeType) {
    resultArgs.push('-t', mimeType);
  }

  if (!_lodash.default.isNil(identifier)) {
    resultArgs.push('-i', identifier);
  }

  if (categories) {
    if (_lodash.default.isArray(categories)) {
      resultArgs.push(..._lodash.default.flatMap(categories.map(cName => ['-c', cName])));
    } else {
      resultArgs.push('-c', categories);
    }
  }

  if (component) {
    resultArgs.push('-n', component);
  }

  if (opts.package) {
    resultArgs.push('-p', opts.package);
  }

  if (extras) {
    if (!_lodash.default.isArray(extras)) {
      throw new _appiumBaseDriver.errors.InvalidArgumentError(`'extras' must be an array`);
    }

    for (const item of extras) {
      if (!_lodash.default.isArray(item)) {
        throw new _appiumBaseDriver.errors.InvalidArgumentError(`Extra argument '${item}' must be an array`);
      }

      const [type, key, value] = item;

      if (!_lodash.default.includes(SUPPORTED_EXTRA_TYPES, type)) {
        throw new _appiumBaseDriver.errors.InvalidArgumentError(`Extra argument type '${type}' is not known. ` + `Supported intent argument types are: ${SUPPORTED_EXTRA_TYPES}`);
      }

      if (_lodash.default.isEmpty(key) || _lodash.default.isString(key) && _lodash.default.trim(key) === '') {
        throw new _appiumBaseDriver.errors.InvalidArgumentError(`Extra argument's key in '${JSON.stringify(item)}' must be a valid string identifier`);
      }

      if (type === NO_VALUE_ARG_TYPE) {
        resultArgs.push(`--e${type}`, key);
      } else if (_lodash.default.isUndefined(value)) {
        throw new _appiumBaseDriver.errors.InvalidArgumentError(`Intent argument type '${type}' in '${JSON.stringify(item)}' requires a ` + `valid value to be provided`);
      } else {
        resultArgs.push(`--e${type}`, key, value);
      }
    }
  }

  if (flags) {
    resultArgs.push('-f', flags);
  }

  return resultArgs;
}

commands.mobileStartActivity = async function mobileStartActivity(opts = {}) {
  const {
    user,
    wait,
    stop,
    windowingMode,
    activityType,
    display
  } = opts;
  const cmd = ['am', (await this.adb.getApiLevel()) < API_LEVEL_ANDROID_8 ? 'start' : 'start-activity'];

  if (!_lodash.default.isNil(user)) {
    cmd.push('--user', user);
  }

  if (wait) {
    cmd.push('-W');
  }

  if (stop) {
    cmd.push('-S');
  }

  if (!_lodash.default.isNil(windowingMode)) {
    cmd.push('--windowingMode', windowingMode);
  }

  if (!_lodash.default.isNil(activityType)) {
    cmd.push('--activityType', activityType);
  }

  if (!_lodash.default.isNil(display)) {
    cmd.push('--display', display);
  }

  cmd.push(...parseIntentSpec(opts));
  return await this.adb.shell(cmd);
};

commands.mobileBroadcast = async function mobileBroadcast(opts = {}) {
  const {
    user,
    receiverPermission,
    allowBackgroundActivityStarts
  } = opts;
  const cmd = ['am', 'broadcast'];

  if (!_lodash.default.isNil(user)) {
    cmd.push('--user', user);
  }

  if (receiverPermission) {
    cmd.push('--receiver-permission', receiverPermission);
  }

  if (allowBackgroundActivityStarts) {
    cmd.push('--allow-background-activity-starts');
  }

  cmd.push(...parseIntentSpec(opts));
  return await this.adb.shell(cmd);
};

commands.mobileStartService = async function mobileStartService(opts = {}) {
  const {
    user,
    foreground
  } = opts;
  const cmd = ['am'];

  if ((await this.adb.getApiLevel()) < API_LEVEL_ANDROID_8) {
    cmd.push('startservice');
  } else {
    cmd.push(foreground ? 'start-foreground-service' : 'start-service');
  }

  if (!_lodash.default.isNil(user)) {
    cmd.push('--user', user);
  }

  cmd.push(...parseIntentSpec(opts));
  return await this.adb.shell(cmd);
};

commands.mobileStopService = async function mobileStopService(opts = {}) {
  const {
    user
  } = opts;
  const cmd = ['am', (await this.adb.getApiLevel()) < API_LEVEL_ANDROID_8 ? 'stopservice' : 'stop-service'];

  if (!_lodash.default.isNil(user)) {
    cmd.push('--user', user);
  }

  cmd.push(...parseIntentSpec(opts));
  return await this.adb.shell(cmd);
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9pbnRlbnQuanMiXSwibmFtZXMiOlsiTk9fVkFMVUVfQVJHX1RZUEUiLCJTVVBQT1JURURfRVhUUkFfVFlQRVMiLCJBUElfTEVWRUxfQU5EUk9JRF84IiwiY29tbWFuZHMiLCJwYXJzZUludGVudFNwZWMiLCJvcHRzIiwiaW50ZW50IiwiYWN0aW9uIiwidXJpIiwibWltZVR5cGUiLCJpZGVudGlmaWVyIiwiY2F0ZWdvcmllcyIsImNvbXBvbmVudCIsImV4dHJhcyIsImZsYWdzIiwicmVzdWx0QXJncyIsInB1c2giLCJfIiwiaXNOaWwiLCJpc0FycmF5IiwiZmxhdE1hcCIsIm1hcCIsImNOYW1lIiwicGFja2FnZSIsImVycm9ycyIsIkludmFsaWRBcmd1bWVudEVycm9yIiwiaXRlbSIsInR5cGUiLCJrZXkiLCJ2YWx1ZSIsImluY2x1ZGVzIiwiaXNFbXB0eSIsImlzU3RyaW5nIiwidHJpbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJpc1VuZGVmaW5lZCIsIm1vYmlsZVN0YXJ0QWN0aXZpdHkiLCJ1c2VyIiwid2FpdCIsInN0b3AiLCJ3aW5kb3dpbmdNb2RlIiwiYWN0aXZpdHlUeXBlIiwiZGlzcGxheSIsImNtZCIsImFkYiIsImdldEFwaUxldmVsIiwic2hlbGwiLCJtb2JpbGVCcm9hZGNhc3QiLCJyZWNlaXZlclBlcm1pc3Npb24iLCJhbGxvd0JhY2tncm91bmRBY3Rpdml0eVN0YXJ0cyIsIm1vYmlsZVN0YXJ0U2VydmljZSIsImZvcmVncm91bmQiLCJtb2JpbGVTdG9wU2VydmljZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQSxNQUFNQSxpQkFBaUIsR0FBRyxJQUExQjtBQUNBLE1BQU1DLHFCQUFxQixHQUFHLENBQzVCLEdBRDRCLEVBQ3ZCRCxpQkFEdUIsRUFDSixHQURJLEVBQ0MsR0FERCxFQUNNLEdBRE4sRUFDVyxHQURYLEVBQ2dCLEdBRGhCLEVBQ3FCLElBRHJCLEVBRTVCLElBRjRCLEVBRXRCLEtB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UyxRQUFULEVBQW1Cc0IsSUFBbkI7QUFDRDs7QUFDRE0sRUFBQUEsR0FBRyxDQUFDNUIsSUFBSixDQUFTLEdBQUlaLGVBQWUsQ0FBQ0MsSUFBRCxDQUE1QjtBQUNBLFNBQU8sTUFBTSxLQUFLd0MsR0FBTCxDQUFTRSxLQUFULENBQWVILEdBQWYsQ0FBYjtBQUNELENBaEJEOztBQTRDQXpDLFFBQVEsQ0FBQ2tELGlCQUFULEdBQTZCLGVBQWVBLGlCQUFmLENBQWtDaEQsSUFBSSxHQUFHLEVBQXpDLEVBQTZDO0FBQ3hFLFFBQU07QUFDSmlDLElBQUFBO0FBREksTUFFRmpDLElBRko7QUFHQSxRQUFNdUMsR0FBRyxHQUFHLENBQ1YsSUFEVSxFQUVULE9BQU0sS0FBS0MsR0FBTCxDQUFTQyxXQUFULEVBQU4sSUFBK0I1QyxtQkFBaEMsR0FBdUQsYUFBdkQsR0FBdUUsY0FGN0QsQ0FBWjs7QUFJQSxNQUFJLENBQUNlLGdCQUFFQyxLQUFGLENBQVFvQixJQUFSLENBQUwsRUFBb0I7QUFDbEJNLElBQUFBLEdBQUcsQ0FBQzVCLElBQUosQ0FBUyxRQUFULEVBQW1Cc0IsSUFBbkI7QUFDRDs7QUFDRE0sRUFBQUEsR0FBRyxDQUFDNUIsSUFBSixDQUFTLEdBQUlaLGVBQWUsQ0FBQ0MsSUFBRCxDQUE1QjtBQUNBLFNBQU8sTUFBTSxLQUFLd0MsR0FBTCxDQUFTRSxLQUFULENBQWVILEdBQWYsQ0FBYjtBQUNELENBYkQ7O2VBaUJlekMsUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuXG5jb25zdCBOT19WQUxVRV9BUkdfVFlQRSA9ICdzbic7XG5jb25zdCBTVVBQT1JURURfRVhUUkFfVFlQRVMgPSBbXG4gICdzJywgTk9fVkFMVUVfQVJHX1RZUEUsICd6JywgJ2knLCAnbCcsICdmJywgJ3UnLCAnY24nLFxuICAnaWEnLCAnaWFsJywgJ2xhJywgJ2xhbCcsICdmYScsICdmYWwnLCAnc2EnLCAnc2FsJyxcbl07XG5jb25zdCBBUElfTEVWRUxfQU5EUk9JRF84ID0gMjY7XG5cbmNvbnN0IGNvbW1hbmRzID0ge307XG5cbmZ1bmN0aW9uIHBhcnNlSW50ZW50U3BlYyAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBpbnRlbnQsXG4gICAgYWN0aW9uLFxuICAgIHVyaSxcbiAgICBtaW1lVHlwZSxcbiAgICBpZGVudGlmaWVyLFxuICAgIGNhdGVnb3JpZXMsXG4gICAgY29tcG9uZW50LFxuICAgIGV4dHJhcyxcbiAgICBmbGFncyxcbiAgfSA9IG9wdHM7XG4gIGNvbnN0IHJlc3VsdEFyZ3MgPSBbXTtcbiAgaWYgKGludGVudCkge1xuICAgIHJlc3VsdEFyZ3MucHVzaChpbnRlbnQpO1xuICB9XG4gIGlmIChhY3Rpb24pIHtcbiAgICByZXN1bHRBcmdzLnB1c2goJy1hJywgYWN0aW9uKTtcbiAgfVxuICBpZiAodXJpKSB7XG4gICAgcmVzdWx0QXJncy5wdXNoKCctZCcsIHVyaSk7XG4gIH1cbiAgaWYgKG1pbWVUeXBlKSB7XG4gICAgcmVzdWx0QXJncy5wdXNoKCctdCcsIG1pbWVUeXBlKTtcbiAgfVxuICBpZiAoIV8uaXNOaWwoaWRlbnRpZmllcikpIHtcbiAgICByZXN1bHRBcmdzLnB1c2goJy1pJywgaWRlbnRpZmllcik7XG4gIH1cbiAgaWYgKGNhdGVnb3JpZXMpIHtcbiAgICBpZiAoXy5pc0FycmF5KGNhdGVnb3JpZXMpKSB7XG4gICAgICByZXN1bHRBcmdzLnB1c2goLi4uKF8uZmxhdE1hcChjYXRlZ29yaWVzLm1hcCgoY05hbWUpID0+IFsnLWMnLCBjTmFtZV0pKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHRBcmdzLnB1c2goJy1jJywgY2F0ZWdvcmllcyk7XG4gICAgfVxuICB9XG4gIGlmIChjb21wb25lbnQpIHtcbiAgICByZXN1bHRBcmdzLnB1c2goJy1uJywgY29tcG9uZW50KTtcbiAgfVxuICBpZiAob3B0cy5wYWNrYWdlKSB7XG4gICAgcmVzdWx0QXJncy5wdXNoKCctcCcsIG9wdHMucGFja2FnZSk7XG4gIH1cbiAgaWYgKGV4dHJhcykge1xuICAgIGlmICghXy5pc0FycmF5KGV4dHJhcykpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoYCdleHRyYXMnIG11c3QgYmUgYW4gYXJyYXlgKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGV4dHJhcykge1xuICAgICAgaWYgKCFfLmlzQXJyYXkoaXRlbSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihgRXh0cmEgYXJndW1lbnQgJyR7aXRlbX0nIG11c3QgYmUgYW4gYXJyYXlgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IFt0eXBlLCBrZXksIHZhbHVlXSA9IGl0ZW07XG4gICAgICBpZiAoIV8uaW5jbHVkZXMoU1VQUE9SVEVEX0VYVFJBX1RZUEVTLCB0eXBlKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgICAgIGBFeHRyYSBhcmd1bWVudCB0eXBlICcke3R5cGV9JyBpcyBub3Qga25vd24uIGAgK1xuICAgICAgICAgIGBTdXBwb3J0ZWQgaW50ZW50IGFyZ3VtZW50IHR5cGVzIGFyZTogJHtTVVBQT1JURURfRVhUUkFfVFlQRVN9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKF8uaXNFbXB0eShrZXkpIHx8IChfLmlzU3RyaW5nKGtleSkgJiYgXy50cmltKGtleSkgPT09ICcnKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgICAgIGBFeHRyYSBhcmd1bWVudCdzIGtleSBpbiAnJHtKU09OLnN0cmluZ2lmeShpdGVtKX0nIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgaWRlbnRpZmllcmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09PSBOT19WQUxVRV9BUkdfVFlQRSkge1xuICAgICAgICByZXN1bHRBcmdzLnB1c2goYC0tZSR7dHlwZX1gLCBrZXkpO1xuICAgICAgfSBlbHNlIGlmIChfLmlzVW5kZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgICAgIGBJbnRlbnQgYXJndW1lbnQgdHlwZSAnJHt0eXBlfScgaW4gJyR7SlNPTi5zdHJpbmdpZnkoaXRlbSl9JyByZXF1aXJlcyBhIGAgK1xuICAgICAgICAgIGB2YWxpZCB2YWx1ZSB0byBiZSBwcm92aWRlZGBcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdEFyZ3MucHVzaChgLS1lJHt0eXBlfWAsIGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoZmxhZ3MpIHtcbiAgICByZXN1bHRBcmdzLnB1c2goJy1mJywgZmxhZ3MpO1xuICB9XG4gIHJldHVybiByZXN1bHRBcmdzO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0QWN0aXZpdHlPcHRpb25zXG4gKiBAcHJvcGVydHkgez9zdHJpbmd8bnVtYmVyfSB1c2VyIFsnY3VycmVudCddIC0gVGhlIHVzZXIgSUQgZm9yIHdoaWNoIHRoZSBzZXJ2aWNlIGlzIHN0YXJ0ZWQuXG4gKiBUaGUgYGN1cnJlbnRgIHVzZXIgaWQgaXMgdXNlZCBieSBkZWZhdWx0XG4gKiBAcHJvcGVydHkgez9ib29sZWFufSB3YWl0IFtmYWxzZV0gLSBTZXQgaXQgdG8gYHRydWVgIGlmIHlvdSB3YW50IHRvIGJsb2NrIHRoZSBtZXRob2QgY2FsbFxuICogdW50aWwgdGhlIGFjdGl2aXR5IG1hbmFnZXIncyBwcm9jZXNzIHJldHVybnMgdGhlIGNvbnRyb2wgdG8gdGhlIHN5c3RlbS5cbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHN0b3AgW2ZhbHNlXSAtIFNldCBpdCB0byBgdHJ1ZWAgdG8gZm9yY2Ugc3RvcCB0aGUgdGFyZ2V0XG4gKiBhcHAgYmVmb3JlIHN0YXJ0aW5nIHRoZSBhY3Rpdml0eVxuICogQHByb3BlcnR5IHs/bnVtYmVyfHN0cmluZ30gd2luZG93aW5nTW9kZSAtIFRoZSB3aW5kb3dpbmcgbW9kZSB0byBsYXVuY2ggdGhlIGFjdGl2aXR5IGludG8uXG4gKiBDaGVjayBodHRwczovL2FuZHJvaWQuZ29vZ2xlc291cmNlLmNvbS9wbGF0Zm9ybS9mcmFtZXdvcmtzL2Jhc2UvKy9tYXN0ZXIvY29yZS9qYXZhL2FuZHJvaWQvYXBwL1dpbmRvd0NvbmZpZ3VyYXRpb24uamF2YVxuICogZm9yIG1vcmUgZGV0YWlscyBvbiBwb3NzaWJsZSB3aW5kb3dpbmcgbW9kZXMgKGNvbnN0YW50cyBzdGFydGluZyB3aXRoIGBXSU5ET1dJTkdfTU9ERV9gKS5cbiAqIEBwcm9wZXJ0eSB7P251bWJlcnxzdHJpbmd9IGFjdGl2aXR5VHlwZSAtIFRoZSBhY3Rpdml0eSB0eXBlIHRvIGxhdW5jaCB0aGUgYWN0aXZpdHkgYXMuXG4gKiBDaGVjayBodHRwczovL2FuZHJvaWQuZ29vZ2xlc291cmNlLmNvbS9wbGF0Zm9ybS9mcmFtZXdvcmtzL2Jhc2UvKy9tYXN0ZXIvY29yZS9qYXZhL2FuZHJvaWQvYXBwL1dpbmRvd0NvbmZpZ3VyYXRpb24uamF2YVxuICogZm9yIG1vcmUgZGV0YWlscyBvbiBwb3NzaWJsZSBhY3Rpdml0eSB0eXBlcyAoY29uc3RhbnRzIHN0YXJ0aW5nIHdpdGggYEFDVElWSVRZX1RZUEVfYCkuXG4gKiBAcHJvcGVydHkgez9udW1iZXJ8c3RyaW5nfSBkaXNwbGF5IC0gVGhlIGRpc3BsYXkgaWRlbnRpZmllciB0byBsYXVuY2ggdGhlIGFjdGl2aXR5IGludG8uXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGludGVudCAtIFRoZSBuYW1lIG9mIHRoZSBhY3Rpdml0eSBpbnRlbnQgdG8gc3RhcnQsIGZvciBleGFtcGxlXG4gKiBgY29tLnNvbWUucGFja2FnZS5uYW1lLy5Zb3VyU2VydmljZVN1YkNsYXNzTmFtZWBcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYWN0aW9uIC0gQWN0aW9uIG5hbWVcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gcGFja2FnZSAtIFBhY2thZ2UgbmFtZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB1cmkgLSBVbmlmaWVkIHJlc291cmNlIGlkZW50aWZpZXJcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gbWltZVR5cGUgLSBNaW1lIHR5cGVcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gaWRlbnRpZmllciAtIE9wdGlvbmFsIGlkZW50aWZpZXJcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ3xBcnJheTxzdHJpbmc+fSBjYXRlZ29yaWVzIC0gT25lIG9yIG1vcmUgY2F0ZWdvcnkgbmFtZXNcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gY29tcG9uZW50IC0gQ29tcG9uZW50IG5hbWVcbiAqIEBwcm9wZXJ0eSB7QXJyYXk8c3RyaW5nfEFycmF5PHN0cmluZz4+fSBleHRyYXMgLSBPcHRpb25hbCBpbnRlbnQgYXJndW1lbnRzLiBNdXN0IGJlIHJlcHJlc2VudGVkXG4gKiBhcyBhcnJheSBvZiBhcnJheXMsIHdoZXJlIGVhY2ggc3ViYXJyYXkgaXRlbSBjb250YWlucyB0d28gb3IgdGhyZWUgc3RyaW5nIGl0ZW1zOlxuICogdmFsdWUgdHlwZSwga2V5IG5hbWUgYW5kIHRoZSB2YWx1ZSBpdHNlbGYuXG4gKiBTdXBwb3J0ZWQgdmFsdWUgdHlwZXMgYXJlOlxuICogLSBzOiBzdHJpbmcuIFZhbHVlIG11c3QgYmUgYSB2YWxpZCBzdHJpbmdcbiAqIC0gc246IG51bGwuIFZhbHVlIGlzIGlnbm9yZWQgZm9yIHRoaXMgdHlwZVxuICogLSB6OiBib29sZWFuLiBWYWx1ZSBtdXN0IGJlIGVpdGhlciBgdHJ1ZWAgb3IgYGZhbHNlYFxuICogLSBpOiBpbnRlZ2VyLiBWYWx1ZSBtdXN0IGJlIGEgdmFsaWQgNC1ieXRlIGludGVnZXIgbnVtYmVyXG4gKiAtIGw6IGxvbmcuIFZhbHVlIG11c3QgYmUgYSB2YWxpZCA4LWJ5dGUgbG9uZyBudW1iZXJcbiAqIC0gZjogZmxvYXQ6IFZhbHVlIG11c3QgYmUgYSB2YWxpZCBmbG9hdCBudW1iZXJcbiAqIC0gdTogdXJpLiBWYWx1ZSBtdXN0IGJlIGEgdmFsaWQgdW5pZm9ybSByZXNvdXJjZSBpZGVudGlmaWVyIHN0cmluZ1xuICogLSBjbjogY29tcG9uZW50IG5hbWUuIFZhbHVlIG11c3QgYmUgYSB2YWxpZCBjb21wb25lbnQgbmFtZSBzdHJpbmdcbiAqIC0gaWE6IEludGVnZXJbXS4gVmFsdWUgbXVzdCBiZSBhIHN0cmluZyBvZiBjb21tYS1zZXBhcmF0ZWQgaW50ZWdlcnNcbiAqIC0gaWFsOiBMaXN0PEludGVnZXI+LiBWYWx1ZSBtdXN0IGJlIGEgc3RyaW5nIG9mIGNvbW1hLXNlcGFyYXRlZCBpbnRlZ2Vyc1xuICogLSBsYTogTG9uZ1tdLiBWYWx1ZSBtdXN0IGJlIGEgc3RyaW5nIG9mIGNvbW1hLXNlcGFyYXRlZCBsb25nIG51bWJlcnNcbiAqIC0gbGFsOiBMaXN0PExvbmc+LiBWYWx1ZSBtdXN0IGJlIGEgc3RyaW5nIG9mIGNvbW1hLXNlcGFyYXRlZCBsb25nIG51bWJlcnNcbiAqIC0gZmE6IEZsb2F0W10uIFZhbHVlIG11c3QgYmUgYSBzdHJpbmcgb2YgY29tbWEtc2VwYXJhdGVkIGZsb2F0IG51bWJlcnNcbiAqIC0gZmFsOiBMaXN0PEZsb2F0Pi4gVmFsdWUgbXVzdCBiZSBhIHN0cmluZyBvZiBjb21tYS1zZXBhcmF0ZWQgZmxvYXQgbnVtYmVyc1xuICogLSBzYTogU3RyaW5nW10uIFZhbHVlIG11c3QgYmUgY29tbWEtc2VwYXJhdGVkIHN0cmluZ3MuIFRvIGVtYmVkIGEgY29tbWEgaW50byBhIHN0cmluZyxcbiAqIGVzY2FwZSBpdCB1c2luZyBcIlxcLFwiXG4gKiAtIHNhbDogTGlzdDxTdHJpbmc+LiBWYWx1ZSBtdXN0IGJlIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmdzLiBUbyBlbWJlZCBhIGNvbW1hIGludG8gYSBzdHJpbmcsXG4gKiBlc2NhcGUgaXQgdXNpbmcgXCJcXCxcIlxuICogRm9yIGV4YW1wbGU6IFtbJ3MnLCAndmFyTmFtZTEnLCAnTXkgU3RyaW5nMSddLCBbJ3MnLCAndmFyTmFtZTInLCAnTXkgU3RyaW5nMiddLCBbJ2lhJywgJ2Fyck5hbWUnLCAnMSwyLDMsNCddXVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBmbGFncyAtIEludGVudCBzdGFydHVwLXNwZWNpZmljIGZsYWdzIGFzIGEgaGV4YWRlY2ltYWwgc3RyaW5nLlxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9hbmRyb2lkL2NvbnRlbnQvSW50ZW50Lmh0bWxcbiAqIGZvciB0aGUgbGlzdCBvZiBhdmFpbGFibGUgZmxhZyB2YWx1ZXMgKGNvbnN0YW50cyBzdGFydGluZyB3aXRoIEZMQUdfQUNUSVZJVFlfKS5cbiAqIEZsYWcgdmFsdWVzIGNvdWxkIGJlIG1lcmdlZCB1c2luZyB0aGUgbG9naWNhbCAnb3InIG9wZXJhdGlvbi5cbiAqIEZvciBleGFtcGxlLCAweDEwMjAwMDAwIGlzIHRoZSBjb21iaW5hdGlvbiBvZiB0d28gZmxhZ3M6XG4gKiAweDEwMDAwMDAwIGBGTEFHX0FDVElWSVRZX05FV19UQVNLYCB8IDB4MDAyMDAwMDAgYEZMQUdfQUNUSVZJVFlfUkVTRVRfVEFTS19JRl9ORUVERURgXG4gKi9cblxuLyoqXG4gKiBTdGFydHMgdGhlIGdpdmVuIGFjdGl2aXR5IGludGVudC5cbiAqXG4gKiBAcGFyYW0ge1N0YXJ0QWN0aXZpdHlPcHRpb25zfSBvcHRzXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY29tbWFuZCBvdXRwdXRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIHN0YXJ0aW5nIHRoZSBhY3Rpdml0eVxuICogb3IgcmVxdWlyZWQgb3B0aW9ucyBhcmUgbWlzc2luZ1xuICovXG5jb21tYW5kcy5tb2JpbGVTdGFydEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU3RhcnRBY3Rpdml0eSAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICB1c2VyLFxuICAgIHdhaXQsXG4gICAgc3RvcCxcbiAgICB3aW5kb3dpbmdNb2RlLFxuICAgIGFjdGl2aXR5VHlwZSxcbiAgICBkaXNwbGF5LFxuICB9ID0gb3B0cztcbiAgY29uc3QgY21kID0gW1xuICAgICdhbScsIChhd2FpdCB0aGlzLmFkYi5nZXRBcGlMZXZlbCgpIDwgQVBJX0xFVkVMX0FORFJPSURfOCkgPyAnc3RhcnQnIDogJ3N0YXJ0LWFjdGl2aXR5JyxcbiAgXTtcbiAgaWYgKCFfLmlzTmlsKHVzZXIpKSB7XG4gICAgY21kLnB1c2goJy0tdXNlcicsIHVzZXIpO1xuICB9XG4gIGlmICh3YWl0KSB7XG4gICAgY21kLnB1c2goJy1XJyk7XG4gIH1cbiAgaWYgKHN0b3ApIHtcbiAgICBjbWQucHVzaCgnLVMnKTtcbiAgfVxuICBpZiAoIV8uaXNOaWwod2luZG93aW5nTW9kZSkpIHtcbiAgICBjbWQucHVzaCgnLS13aW5kb3dpbmdNb2RlJywgd2luZG93aW5nTW9kZSk7XG4gIH1cbiAgaWYgKCFfLmlzTmlsKGFjdGl2aXR5VHlwZSkpIHtcbiAgICBjbWQucHVzaCgnLS1hY3Rpdml0eVR5cGUnLCBhY3Rpdml0eVR5cGUpO1xuICB9XG4gIGlmICghXy5pc05pbChkaXNwbGF5KSkge1xuICAgIGNtZC5wdXNoKCctLWRpc3BsYXknLCBkaXNwbGF5KTtcbiAgfVxuICBjbWQucHVzaCguLi4ocGFyc2VJbnRlbnRTcGVjKG9wdHMpKSk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmFkYi5zaGVsbChjbWQpO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBCcm9hZGNhc3RPcHRpb25zXG4gKiBAcHJvcGVydHkgez9zdHJpbmd8bnVtYmVyfSB1c2VyIFsnYWxsJ10gLSBUaGUgdXNlciBJRCBmb3Igd2hpY2ggdGhlIGJyb2FkY2FzdCBpcyBzZW50LlxuICogVGhlIGBjdXJyZW50YCBhbGlhcyBhc3N1bWVzIHRoZSBjdXJyZW50IHVzZXIgSUQuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHJlY2VpdmVyUGVybWlzc2lvbiAtIFJlcXVpcmUgcmVjZWl2ZXIgdG8gaG9sZCB0aGUgZ2l2ZW4gcGVybWlzc2lvbi5cbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IGFsbG93QmFja2dyb3VuZEFjdGl2aXR5U3RhcnRzIFtmYWxzZV0gLSBXaGV0aGVyIHRoZSByZWNlaXZlciBtYXlcbiAqIHN0YXJ0IGFjdGl2aXRpZXMgZXZlbiBpZiBpbiB0aGUgYmFja2dyb3VuZC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gaW50ZW50IC0gVGhlIG5hbWUgb2YgdGhlIGludGVudCB0byBicm9hZGNhc3QgdG8sIGZvciBleGFtcGxlXG4gKiBgY29tLnNvbWUucGFja2FnZS5uYW1lLy5Zb3VyU2VydmljZVN1YkNsYXNzTmFtZWAuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGFjdGlvbiAtIEFjdGlvbiBuYW1lXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHVyaSAtIFVuaWZpZWQgcmVzb3VyY2UgaWRlbnRpZmllclxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBtaW1lVHlwZSAtIE1pbWUgdHlwZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBpZGVudGlmaWVyIC0gT3B0aW9uYWwgaWRlbnRpZmllclxuICogQHByb3BlcnR5IHs/c3RyaW5nfEFycmF5PHN0cmluZz59IGNhdGVnb3JpZXMgLSBPbmUgb3IgbW9yZSBjYXRlZ29yeSBuYW1lc1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBjb21wb25lbnQgLSBDb21wb25lbnQgbmFtZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBwYWNrYWdlIC0gUGFja2FnZSBuYW1lXG4gKiBAcHJvcGVydHkge0FycmF5PEFycmF5PHN0cmluZz4+fSBleHRyYXMgLSBPcHRpb25hbCBpbnRlbnQgYXJndW1lbnRzLlxuICogU2VlIGFib3ZlIGZvciB0aGUgZGV0YWlsZWQgZGVzY3JpcHRpb24uXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGZsYWdzIC0gSW50ZW50IHN0YXJ0dXAtc3BlY2lmaWMgZmxhZ3MgYXMgYSBoZXhhZGVjaW1hbCBzdHJpbmcuXG4gKiBTZWUgYWJvdmUgZm9yIHRoZSBkZXRhaWxlZCBkZXNjcmlwdGlvbi5cbiAqL1xuXG5cbi8qKlxuICogU2VuZCBhIGJyb2FkY2FzdCBpbnRlbnQuXG4gKlxuICogQHBhcmFtIHtCcm9hZGNhc3RPcHRpb25zfSBvcHRzXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY29tbWFuZCBvdXRwdXRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIHN0YXJ0aW5nIHRoZSBhY3Rpdml0eVxuICogb3IgcmVxdWlyZWQgb3B0aW9ucyBhcmUgbWlzc2luZ1xuICovXG5jb21tYW5kcy5tb2JpbGVCcm9hZGNhc3QgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVCcm9hZGNhc3QgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgdXNlcixcbiAgICByZWNlaXZlclBlcm1pc3Npb24sXG4gICAgYWxsb3dCYWNrZ3JvdW5kQWN0aXZpdHlTdGFydHMsXG4gIH0gPSBvcHRzO1xuICBjb25zdCBjbWQgPSBbJ2FtJywgJ2Jyb2FkY2FzdCddO1xuICBpZiAoIV8uaXNOaWwodXNlcikpIHtcbiAgICBjbWQucHVzaCgnLS11c2VyJywgdXNlcik7XG4gIH1cbiAgaWYgKHJlY2VpdmVyUGVybWlzc2lvbikge1xuICAgIGNtZC5wdXNoKCctLXJlY2VpdmVyLXBlcm1pc3Npb24nLCByZWNlaXZlclBlcm1pc3Npb24pO1xuICB9XG4gIGlmIChhbGxvd0JhY2tncm91bmRBY3Rpdml0eVN0YXJ0cykge1xuICAgIGNtZC5wdXNoKCctLWFsbG93LWJhY2tncm91bmQtYWN0aXZpdHktc3RhcnRzJyk7XG4gIH1cbiAgY21kLnB1c2goLi4uKHBhcnNlSW50ZW50U3BlYyhvcHRzKSkpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuc2hlbGwoY21kKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU3RhcnRTZXJ2aWNlT3B0aW9uc1xuICogQHByb3BlcnR5IHs/c3RyaW5nfG51bWJlcn0gdXNlciBbJ2N1cnJlbnQnXSAtIFRoZSB1c2VyIElEIGZvciB3aGljaCB0aGUgc2VydmljZSBpcyBzdGFydGVkLlxuICogVGhlIGBjdXJyZW50YCB1c2VyIGlkIGlzIHVzZWQgYnkgZGVmYXVsdFxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gZm9yZWdyb3VuZCBbZmFsc2VdIC0gU2V0IGl0IHRvIGB0cnVlYCBpZiB5b3VyIHNlcnZpY2UgbXVzdCBiZVxuICogc3RhcnRlZCBhcyBmb3JlZ3JvdW5kIHNlcnZpY2UuIFRoaXMgb3B0aW9uIGlzIGlnbm9yZWQgaWYgdGhlIEFQSSBsZXZlbCBvZiB0aGVcbiAqIGRldmljZSB1bmRlciB0ZXN0IGlzIGJlbG93IDI2IChBbmRyb2lkIDgpLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBpbnRlbnQgLSBUaGUgbmFtZSBvZiB0aGUgc2VydmljZSBpbnRlbnQgdG8gc3RhcnQsIGZvciBleGFtcGxlXG4gKiBgY29tLnNvbWUucGFja2FnZS5uYW1lLy5Zb3VyU2VydmljZVN1YkNsYXNzTmFtZWAuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGFjdGlvbiAtIEFjdGlvbiBuYW1lXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHVyaSAtIFVuaWZpZWQgcmVzb3VyY2UgaWRlbnRpZmllclxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBtaW1lVHlwZSAtIE1pbWUgdHlwZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBpZGVudGlmaWVyIC0gT3B0aW9uYWwgaWRlbnRpZmllclxuICogQHByb3BlcnR5IHs/c3RyaW5nfEFycmF5PHN0cmluZz59IGNhdGVnb3JpZXMgLSBPbmUgb3IgbW9yZSBjYXRlZ29yeSBuYW1lc1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBjb21wb25lbnQgLSBDb21wb25lbnQgbmFtZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBwYWNrYWdlIC0gUGFja2FnZSBuYW1lXG4gKiBAcHJvcGVydHkge0FycmF5PEFycmF5PHN0cmluZz4+fSBleHRyYXMgLSBPcHRpb25hbCBpbnRlbnQgYXJndW1lbnRzLlxuICogU2VlIGFib3ZlIGZvciB0aGUgZGV0YWlsZWQgZGVzY3JpcHRpb24uXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGZsYWdzIC0gSW50ZW50IHN0YXJ0dXAtc3BlY2lmaWMgZmxhZ3MgYXMgYSBoZXhhZGVjaW1hbCBzdHJpbmcuXG4gKiBTZWUgYWJvdmUgZm9yIHRoZSBkZXRhaWxlZCBkZXNjcmlwdGlvbi5cbiAqL1xuXG4vKipcbiAqIFN0YXJ0cyB0aGUgZ2l2ZW4gc2VydmljZSBpbnRlbnQuXG4gKlxuICogQHBhcmFtIHtTdGFydFNlcnZpY2VPcHRpb25zfSBvcHRzXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY29tbWFuZCBvdXRwdXRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIHN0YXJ0aW5nIHRoZSBzZXJ2aWNlXG4gKiBvciByZXF1aXJlZCBvcHRpb25zIGFyZSBtaXNzaW5nXG4gKi9cbmNvbW1hbmRzLm1vYmlsZVN0YXJ0U2VydmljZSA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVN0YXJ0U2VydmljZSAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICB1c2VyLFxuICAgIGZvcmVncm91bmQsXG4gIH0gPSBvcHRzO1xuICBjb25zdCBjbWQgPSBbJ2FtJ107XG4gIGlmIChhd2FpdCB0aGlzLmFkYi5nZXRBcGlMZXZlbCgpIDwgQVBJX0xFVkVMX0FORFJPSURfOCkge1xuICAgIGNtZC5wdXNoKCdzdGFydHNlcnZpY2UnKTtcbiAgfSBlbHNlIHtcbiAgICBjbWQucHVzaChmb3JlZ3JvdW5kID8gJ3N0YXJ0LWZvcmVncm91bmQtc2VydmljZScgOiAnc3RhcnQtc2VydmljZScpO1xuICB9XG4gIGlmICghXy5pc05pbCh1c2VyKSkge1xuICAgIGNtZC5wdXNoKCctLXVzZXInLCB1c2VyKTtcbiAgfVxuICBjbWQucHVzaCguLi4ocGFyc2VJbnRlbnRTcGVjKG9wdHMpKSk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmFkYi5zaGVsbChjbWQpO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTdG9wU2VydmljZU9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfG51bWJlcn0gdXNlciBbJ2N1cnJlbnQnXSAtIFRoZSB1c2VyIElEIGZvciB3aGljaCB0aGUgc2VydmljZSBpcyBydW5uaW5nLlxuICogVGhlIGBjdXJyZW50YCB1c2VyIGlkIGlzIHVzZWQgYnkgZGVmYXVsdFxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBpbnRlbnQgLSBUaGUgbmFtZSBvZiB0aGUgc2VydmljZSBpbnRlbnQgdG8gc3RvcCwgZm9yIGV4YW1wbGVcbiAqIGBjb20uc29tZS5wYWNrYWdlLm5hbWUvLllvdXJTZXJ2aWNlU3ViQ2xhc3NOYW1lYC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYWN0aW9uIC0gQWN0aW9uIG5hbWVcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdXJpIC0gVW5pZmllZCByZXNvdXJjZSBpZGVudGlmaWVyXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IG1pbWVUeXBlIC0gTWltZSB0eXBlXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGlkZW50aWZpZXIgLSBPcHRpb25hbCBpZGVudGlmaWVyXG4gKiBAcHJvcGVydHkgez9zdHJpbmd8QXJyYXk8c3RyaW5nPn0gY2F0ZWdvcmllcyAtIE9uZSBvciBtb3JlIGNhdGVnb3J5IG5hbWVzXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGNvbXBvbmVudCAtIENvbXBvbmVudCBuYW1lXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHBhY2thZ2UgLSBQYWNrYWdlIG5hbWVcbiAqIEBwcm9wZXJ0eSB7QXJyYXk8QXJyYXk8c3RyaW5nPj59IGV4dHJhcyAtIE9wdGlvbmFsIGludGVudCBhcmd1bWVudHMuXG4gKiBTZWUgYWJvdmUgZm9yIHRoZSBkZXRhaWxlZCBkZXNjcmlwdGlvbi5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gZmxhZ3MgLSBTZWUgYWJvdmUgZm9yIHRoZSBkZXRhaWxlZCBkZXNjcmlwdGlvbi5cbiAqL1xuXG4vKipcbiAqIFN0b3BzIHRoZSBnaXZlbiBzZXJ2aWNlIGludGVudC5cbiAqXG4gKiBAcGFyYW0ge1N0b3BTZXJ2aWNlT3B0aW9uc30gb3B0c1xuICogQHJldHVybnMge3N0cmluZ30gVGhlIGNvbW1hbmQgb3V0cHV0XG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGEgZmFpbHVyZSB3aGlsZSBzdG9wcGluZyB0aGUgc2VydmljZVxuICogb3IgcmVxdWlyZWQgb3B0aW9ucyBhcmUgbWlzc2luZ1xuICovXG5jb21tYW5kcy5tb2JpbGVTdG9wU2VydmljZSA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVN0b3BTZXJ2aWNlIChvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHVzZXIsXG4gIH0gPSBvcHRzO1xuICBjb25zdCBjbWQgPSBbXG4gICAgJ2FtJyxcbiAgICAoYXdhaXQgdGhpcy5hZGIuZ2V0QXBpTGV2ZWwoKSA8IEFQSV9MRVZFTF9BTkRST0lEXzgpID8gJ3N0b3BzZXJ2aWNlJyA6ICdzdG9wLXNlcnZpY2UnXG4gIF07XG4gIGlmICghXy5pc05pbCh1c2VyKSkge1xuICAgIGNtZC5wdXNoKCctLXVzZXInLCB1c2VyKTtcbiAgfVxuICBjbWQucHVzaCguLi4ocGFyc2VJbnRlbnRTcGVjKG9wdHMpKSk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmFkYi5zaGVsbChjbWQpO1xufTtcblxuXG5leHBvcnQgeyBjb21tYW5kcyB9O1xuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9pbnRlbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
