"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger.js"));

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

let systemCallMethods = {};
const DEFAULT_SDB_EXEC_TIMEOUT = 20000;

systemCallMethods.getConnectedDevices = async function () {
  _logger.default.debug('Getting connected devices...');

  try {
    let {
      stdout
    } = await (0, _teen_process.exec)(this.executable.path, ['devices']);
    let startingIndex = stdout.indexOf('List of devices attached');
    stdout = stdout.slice(startingIndex);

    if (stdout.length < 1) {
      throw new Error('Could not find device.');
    } else {
      let devices = [];

      for (let line of stdout.split('\n')) {
        if (line.trim() !== '' && line.indexOf('List of devices') === -1) {
          let lineInfo = line.split('\t');
          devices.push({
            udid: lineInfo[0].trim(),
            state: lineInfo[1].trim(),
            platform: lineInfo[2].trim()
          });
        }
      }

      _logger.default.debug(`${devices.length} device(s) connected`);

      return devices;
    }
  } catch (e) {
    _logger.default.errorAndThrow('Error while getting connected devices.');
  }
};

systemCallMethods.getDeviceStatus = async function () {
  let {
    stdout
  } = await (0, _teen_process.exec)(this.executable.path, ['get-state']);
  let result;

  if (stdout.indexOf('device' > -1)) {
    result = 'device';
  } else if (stdout.indexOf('offline' > -1)) {
    result = 'offline';
  } else if (stdout.indexOf('locked' > -1)) {
    result = 'locked';
  } else {
    result = 'unknown';
  }

  return result;
};

systemCallMethods.ConnectDevice = async function (device) {
  _logger.default.debug('Connect device...');

  try {
    let {
      stdout
    } = await (0, _teen_process.exec)(this.executable.path, ['connect', device]);

    if (stdout.indexOf(`connected to ${device}`) > -1 || stdout.indexOf('is already connected') > -1) {
      _logger.default.debug(`${device} device(s) connected`);

      return true;
    } else {
      _logger.default.error(`Could not find device.`);

      return false;
    }
  } catch (e) {
    _logger.default.errorAndThrow('Error while connect devices.');
  }
};

systemCallMethods.getDevicesWithRetry = async function (timeoutMs = DEFAULT_SDB_EXEC_TIMEOUT) {
  let start = Date.now();
  let times = 0;

  _logger.default.debug('Trying to find a connected tizen device');

  let getDevices = async () => {
    if (Date.now() - start > timeoutMs || times > 10) {
      throw new Error('Could not find a connected tizen device.');
    }

    try {
      let devices = await this.getConnectedDevices();

      if (devices.length < 1) {
        times++;

        _logger.default.debug('Could not find devices, restarting sdb server...');

        await this.restartSdb();
        return await getDevices();
      }

      return devices;
    } catch (e) {
      times++;

      _logger.default.debug('Could not find devices, restarting sdb server...');

      await this.restartSdb();
      return await getDevices();
    }
  };

  return await getDevices();
};

systemCallMethods.restartSdb = async function () {
  if (this.suppressKillServer) {
    _logger.default.debug(`Not restarting sdb since 'suppressKillServer' is on`);

    return;
  }

  _logger.default.debug('Restarting sdb');

  try {
    await (0, _teen_process.exec)(this.executable.path, ['kill-server']);
    let {
      stdout
    } = await (0, _teen_process.exec)(this.executable.path, ['start-server']);
    return stdout.indexOf('Server has started successfully') > -1 ? true : false;
  } catch (e) {
    _logger.default.error("Error killing SDB server, going to see if it's online anyway");
  }
};

systemCallMethods.sdbExec = async function (cmd, opts = {}) {
  if (!cmd) {
    throw new Error('You need to pass in a command to sdbExec()');
  }

  opts.timeout = opts.timeout || DEFAULT_SDB_EXEC_TIMEOUT;

  let execFunc = async () => {
    try {
      if (!(cmd instanceof Array)) {
        cmd = [cmd];
      }

      let args = this.executable.defaultArgs.concat(cmd);

      _logger.default.debug(`Running '${this.executable.path}' with args: ` + `${JSON.stringify(args)}`);

      let {
        stdout
      } = await (0, _teen_process.exec)(this.executable.path, args, opts);
      return stdout.trim();
    } catch (e) {
      if (e.stdout) {
        let stdout = e.stdout;
        return stdout;
      }

      throw new Error(`Error executing sdbExec. Original error: '${e.message}'; ` + `Stderr: '${(e.stderr || '').trim()}'; Code: '${e.code}'`);
    }
  };

  return await (0, _asyncbox.retry)(2, execFunc);
};

systemCallMethods.shell = async function (cmd, opts = {}) {
  if (!(await this.isDeviceConnected())) {
    throw new Error(`No device connected, cannot run sdb shell command '${cmd.join(' ')}'`);
  }

  let execCmd = ['shell'];

  if (cmd instanceof Array) {
    execCmd = execCmd.concat(cmd);
  } else {
    execCmd.push(cmd);
  }

  return await this.sdbExec(execCmd, opts);
};

systemCallMethods.getPortFromEmulatorString = function (emStr) {
  let portPattern = /emulator-(\d+)/;

  if (portPattern.test(emStr)) {
    return parseInt(portPattern.exec(emStr)[1], 10);
  }

  return false;
};

systemCallMethods.getConnectedEmulators = async function () {
  try {
    _logger.default.debug('Getting connected emulators');

    let devices = await this.getConnectedDevices();
    let emulators = [];

    for (let device of devices) {
      let port = this.getPortFromEmulatorString(device.udid);

      if (port) {
        device.port = port;
        emulators.push(device);
      }
    }

    _logger.default.debug(`${emulators.length} emulator(s) connected`);

    return emulators;
  } catch (e) {
    _logger.default.errorAndThrow(`Error getting emulators. Original error: ${e.message}`);
  }
};

systemCallMethods.setDeviceId = function (deviceId) {
  _logger.default.debug(`Setting device id to ${deviceId}`);

  this.curDeviceId = deviceId;
  let argsHasDevice = this.executable.defaultArgs.indexOf('-s');

  if (argsHasDevice !== -1) {
    this.executable.defaultArgs.splice(argsHasDevice, 2);
  }

  this.executable.defaultArgs.push('-s', deviceId);
};

systemCallMethods.setDevice = function (deviceObj) {
  let deviceId = deviceObj.udid;
  let emPort = this.getPortFromEmulatorString(deviceId);
  this.setEmulatorPort(emPort);
  this.setDeviceId(deviceId);
};

systemCallMethods.getSdbVersion = _lodash.default.memoize(async function () {
  try {
    let sdbVersion = (await this.sdbExec('version')).replace(/Smart\sDevelopment\sBridge\sversion\s([\d.]*)[\s\w-]*/, '$1');
    let parts = sdbVersion.split('.');
    return {
      versionString: sdbVersion,
      versionFloat: parseFloat(sdbVersion),
      major: parseInt(parts[0], 10),
      minor: parseInt(parts[1], 10),
      patch: parts[2] ? parseInt(parts[2], 10) : undefined
    };
  } catch (e) {
    _logger.default.errorAndThrow(`Error getting sdb version. Original error: '${e.message}'; ` + `Stderr: '${(e.stderr || '').trim()}'; Code: '${e.code}'`);
  }
});

systemCallMethods.reboot = async function () {
  try {
    let result = await this.shell(['reboot']);

    if (result.indexOf('command not found') > -1) {
      _logger.default.debug('Device requires sdb to be running as root in order to reboot. Restarting daemon');

      await this.root();
      result = await this.shell(['reboot']);
      return true;
    }

    if (result.indexOf('Rebooting') > -1) {
      return true;
    } else {
      return false;
    }
  } catch (err) {
    _logger.default.warn(`Unable to reboot daemon: '${err.message}'.`);

    return false;
  }
};

systemCallMethods.root = async function () {
  try {
    await this.sdbExec(['root', 'on']);
    return true;
  } catch (err) {
    _logger.default.warn(`Unable to root sdb daemon: '${err.message}'. Continuing`);

    return false;
  }
};

systemCallMethods.unroot = async function () {
  try {
    await this.sdbExec(['root', 'off']);
    return true;
  } catch (err) {
    _logger.default.warn(`Unable to unroot sdb daemon: '${err.message}'. Continuing`);

    return false;
  }
};

systemCallMethods.fileExists = async function (remotePath) {
  let files = await this.ls(remotePath);
  return files.length > 0;
};

systemCallMethods.ls = async function (remotePath) {
  try {
    let stdout = await this.shell(['ls', remotePath]);
    let lines = stdout.split('\n');
    return lines.map(l => l.trim()).filter(Boolean).filter(l => l.indexOf('No such file') === -1);
  } catch (err) {
    if (err.message.indexOf('No such file or directory') === -1) {
      throw err;
    }

    return [];
  }
};

systemCallMethods.getSdkBinaryPath = async function (binaryName) {
  let binaryLoc = null;
  let cmd = this.getCommandForOS();

  try {
    let {
      stdout
    } = await (0, _teen_process.exec)(cmd, [binaryName]);

    _logger.default.info(`Using ${binaryName} from ${stdout}`);

    binaryLoc = stdout.trim();
    return binaryLoc;
  } catch (e) {
    _logger.default.errorAndThrow(`Could not find ${binaryName} Please set the TIZEN_HOME ` + `environment variable with the Tizen SDK root directory path.`);
  }
};

systemCallMethods.getCommandForOS = function () {
  let cmd = 'which';

  if (_appiumSupport.system.isWindows()) {
    cmd = 'where';
  }

  return cmd;
};

systemCallMethods.setEmulatorPort = function (emPort) {
  this.emulatorPort = emPort;
};

systemCallMethods.killProcess = async function (process, opts = {}) {
  let result = await this.shell([`killall ${process}`], opts);

  if (result.indexOf('process not found') > -1) {
    _logger.default.error(`${process} process not found`);

    return false;
  } else {
    return true;
  }
};

systemCallMethods.checkProcessStatus = async function (process, opts = {}) {
  let result = await this.shell([`pgrep ${process}`], opts);
  return result.length > 0;
};

systemCallMethods.startExec = async function (exec, opts = {}) {
  let execPath = '/usr/bin/' + exec;
  await this.shell([execPath], opts);
};

systemCallMethods.stopAutoSleep = async function () {
  await this.root();
  await this.shell('devicectl display stop');
};

systemCallMethods.startAutoSleep = async function () {
  await this.root();
  await this.shell('devicectl display start');
};

var _default = systemCallMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9zeXN0ZW0tY2FsbHMuanMiXSwibmFtZXMiOlsic3lzdGVtQ2FsbE1ldGhvZHMiLCJERUZBVUxUX1NEQl9FWEVDX1RJTUVPVVQiLCJnZXRDb25uZWN0ZWREZXZpY2VzIiwibG9nIiwiZGVidWciLCJzdGRvdXQiLCJleGVjdXRhYmxlIiwicGF0aCIsInN0YXJ0aW5nSW5kZXgiLCJpbmRleE9mIiwic2xpY2UiLCJsZW5ndGgiLCJFcnJvciIsImRldmljZXMiLCJsaW5lIiwic3BsaXQiLCJ0cmltIiwibGluZUluZm8iLCJwdXNoIiwidWRpZCIsInN0YXRlIiwicGxhdGZvcm0iLCJlIiwiZXJyb3JBbmRUaHJvdyIsImdldERldmljZVN0YXR1cyIsInJlc3VsdCIsIkNvbm5lY3REZXZpY2UiLCJkZXZpY2UiLCJlcnJvciIsImdldERldmljZXNXaXRoUmV0cnkiLCJ0aW1lb3V0TXMiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJ0aW1lcyIsImdldERldmljZXMiLCJyZXN0YXJ0U2RiIiwic3VwcHJlc3NLaWxsU2VydmVyIiwic2RiRXhlYyIsImNtZCIsIm9wdHMiLCJ0aW1lb3V0IiwiZXhlY0Z1bmMiLCJBcnJheSIsImFyZ3MiLCJkZWZhdWx0QXJncyIsImNvbmNhdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXNzYWdlIiwic3RkZXJyIiwiY29kZSIsInNoZWxsIiwiaXNEZXZpY2VDb25uZWN0ZWQiLCJqb2luIiwiZXhlY0NtZCIsImdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmciLCJlbVN0ciIsInBvcnRQYXR0ZXJuIiwidGVzdCIsInBhcnNlSW50IiwiZXhlYyIsImdldENvbm5lY3RlZEVtdWxhdG9ycyIsImVtdWxhdG9ycyIsInBvcnQiLCJzZXREZXZpY2VJZCIsImRldmljZUlkIiwiY3VyRGV2aWNlSWQiLCJhcmdzSGFzRGV2aWNlIiwic3BsaWNlIiwic2V0RGV2aWNlIiwiZGV2aWNlT2JqIiwiZW1Qb3J0Iiwic2V0RW11bGF0b3JQb3J0IiwiZ2V0U2RiVmVyc2lvbiIsIl8iLCJtZW1vaXplIiwic2RiVmVyc2lvbiIsInJlcGxhY2UiLCJwYXJ0cyIsInZlcnNpb25TdHJpbmciLCJ2ZXJzaW9uRmxvYXQiLCJwYXJzZUZsb2F0IiwibWFqb3IiLCJtaW5vciIsInBhdGNoIiwidW5kZWZpbmVkIiwicmVib290Iiwicm9vdCIsImVyciIsIndhcm4iLCJ1bnJvb3QiLCJmaWxlRXhpc3RzIiwicmVtb3RlUGF0aCIsImZpbGVzIiwibHMiLCJsaW5lcyIsIm1hcCIsImwiLCJmaWx0ZXIiLCJCb29sZWFuIiwiZ2V0U2RrQmluYXJ5UGF0aCIsImJpbmFyeU5hbWUiLCJiaW5hcnlMb2MiLCJnZXRDb21tYW5kRm9yT1MiLCJpbmZvIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwiZW11bGF0b3JQb3J0Iiwia2lsbFByb2Nlc3MiLCJwcm9jZXNzIiwiY2hlY2tQcm9jZXNzU3RhdHVzIiwic3RhcnRFeGVjIiwiZXhlY1BhdGgiLCJzdG9wQXV0b1NsZWVwIiwic3RhcnRBdXRvU2xlZXAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBSUEsaUJBQWlCLEdBQUcsRUFBeEI7QUFFQSxNQUFNQyx3QkFBd0IsR0FBRyxLQUFqQzs7QUFFQUQsaUJBQWlCLENBQUNFLG1CQUFsQixHQUF3QyxrQkFBa0I7QUFDeERDLGtCQUFJQyxLQUFKLENBQVUsOEJBQVY7O0FBQ0EsTUFBSTtBQUNGLFFBQUk7QUFBRUMsTUFBQUE7QUFBRixRQUFhLE1BQU0sd0JBQUssS0FBS0MsVUFBTCxDQUFnQkMsSUFBckIsRUFBMkIsQ0FBQyxTQUFELENBQTNCLENBQXZCO0FBRUEsUUFBSUMsYUFBYSxHQUFHSCxNQUFNLENBQUNJLE9BQVAsQ0FBZSwwQkFBZixDQUFwQjtBQUNBSixJQUFBQSxNQUFNLEdBQUdBLE1BQU0sQ0FBQ0ssS0FBUCxDQUFhRixhQUFiLENBQVQ7O0FBQ0EsUUFBSUgsTUFBTSxDQUFDTSxNQUFQLEdBQWdCLENBQXBCLEVBQXVC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QUFYLENBQU47QUFDRCxDQUhEOztBQUtBcEQsaUJBQWlCLENBQUNtSCxjQUFsQixHQUFtQyxrQkFBa0I7QUFDbkQsUUFBTSxLQUFLM0IsSUFBTCxFQUFOO0FBQ0EsUUFBTSxLQUFLcEMsS0FBTCxDQUFXLHlCQUFYLENBQU47QUFDRCxDQUhEOztlQUtlcEQsaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XHJcbmltcG9ydCB7IHN5c3RlbSB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcclxuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XHJcbmltcG9ydCB7IHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xyXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xyXG5cclxubGV0IHN5c3RlbUNhbGxNZXRob2RzID0ge307XHJcblxyXG5jb25zdCBERUZBVUxUX1NEQl9FWEVDX1RJTUVPVVQgPSAyMDAwMDtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLmdldENvbm5lY3RlZERldmljZXMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgbG9nLmRlYnVnKCdHZXR0aW5nIGNvbm5lY3RlZCBkZXZpY2VzLi4uJyk7XHJcbiAgdHJ5IHtcclxuICAgIGxldCB7IHN0ZG91dCB9ID0gYXdhaXQgZXhlYyh0aGlzLmV4ZWN1dGFibGUucGF0aCwgWydkZXZpY2VzJ10pO1xyXG5cclxuICAgIGxldCBzdGFydGluZ0luZGV4ID0gc3Rkb3V0LmluZGV4T2YoJ0xpc3Qgb2YgZGV2aWNlcyBhdHRhY2hlZCcpO1xyXG4gICAgc3Rkb3V0ID0gc3Rkb3V0LnNsaWNlKHN0YXJ0aW5nSW5kZXgpO1xyXG4gICAgaWYgKHN0ZG91dC5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGZpbmQgZGV2aWNlLicpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IGRldmljZXMgPSBbXTtcclxuICAgICAgZm9yIChsZXQgbGluZSBvZiBzdGRvdXQuc3BsaXQoJ1xcbicpKSB7XHJcbiAgICAgICAgaWYgKGxpbmUudHJpbSgpICE9PSAnJyAmJiBsaW5lLmluZGV4T2YoJ0xpc3Qgb2YgZGV2aWNlcycpID09PSAtMSkge1xyXG4gICAgICAgICAgbGV0IGxpbmVJbmZvID0gbGluZS5zcGxpdCgnXFx0Jyk7XHJcbiAgICAgICAgICBkZXZpY2VzLnB1c2goeyB1ZGlkOiBsaW5lSW5mb1swXS50cmltKCksIHN0YXRlOiBsaW5lSW5mb1sxXS50cmltKCksIHBsYXRmb3JtOiBsaW5lSW5mb1syXS50cmltKCkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGxvZy5kZWJ1ZyhgJHtkZXZpY2VzLmxlbmd0aH0gZGV2aWNlKHMpIGNvbm5lY3RlZGApO1xyXG4gICAgICByZXR1cm4gZGV2aWNlcztcclxuICAgIH1cclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRXJyb3Igd2hpbGUgZ2V0dGluZyBjb25uZWN0ZWQgZGV2aWNlcy4nKTtcclxuICB9XHJcbn07XHJcblxyXG5zeXN0ZW1DYWxsTWV0aG9kcy5nZXREZXZpY2VTdGF0dXMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgbGV0IHsgc3Rkb3V0IH0gPSBhd2FpdCBleGVjKHRoaXMuZXhlY3V0YWJsZS5wYXRoLCBbJ2dldC1zdGF0ZSddKTtcclxuICBsZXQgcmVzdWx0O1xyXG4gIGlmIChzdGRvdXQuaW5kZXhPZignZGV2aWNlJyA+IC0xKSkge1xyXG4gICAgcmVzdWx0ID0gJ2RldmljZSc7XHJcbiAgfSBlbHNlIGlmIChzdGRvdXQuaW5kZXhPZignb2ZmbGluZScgPiAtMSkpIHtcclxuICAgIHJlc3VsdCA9ICdvZmZsaW5lJztcclxuICB9IGVsc2UgaWYgKHN0ZG91dC5pbmRleE9mKCdsb2NrZWQnID4gLTEpKSB7XHJcbiAgICByZXN1bHQgPSAnbG9ja2VkJztcclxuICB9IGVsc2Uge1xyXG4gICAgcmVzdWx0ID0gJ3Vua25vd24nO1xyXG4gIH1cclxuICByZXR1cm4gcmVzdWx0O1xyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMuQ29ubmVjdERldmljZSA9IGFzeW5jIGZ1bmN0aW9uIChkZXZpY2UpIHtcclxuICBsb2cuZGVidWcoJ0Nvbm5lY3QgZGV2aWNlLi4uJyk7XHJcbiAgdHJ5IHtcclxuICAgIGxldCB7IHN0ZG91dCB9ID0gYXdhaXQgZXhlYyh0aGlzLmV4ZWN1dGFibGUucGF0aCwgWydjb25uZWN0JywgZGV2aWNlXSk7XHJcblxyXG4gICAgaWYgKChzdGRvdXQuaW5kZXhPZihgY29ubmVjdGVkIHRvICR7ZGV2aWNlfWApID4gLTEpIHx8IChzdGRvdXQuaW5kZXhPZignaXMgYWxyZWFkeSBjb25uZWN0ZWQnKSA+IC0xKSkge1xyXG4gICAgICBsb2cuZGVidWcoYCR7ZGV2aWNlfSBkZXZpY2UocykgY29ubmVjdGVkYCk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbG9nLmVycm9yKGBDb3VsZCBub3QgZmluZCBkZXZpY2UuYCk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRXJyb3Igd2hpbGUgY29ubmVjdCBkZXZpY2VzLicpO1xyXG4gIH1cclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLmdldERldmljZXNXaXRoUmV0cnkgPSBhc3luYyBmdW5jdGlvbiAodGltZW91dE1zID0gREVGQVVMVF9TREJfRVhFQ19USU1FT1VUKSB7XHJcbiAgbGV0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuICBsZXQgdGltZXMgPSAwO1xyXG4gIGxvZy5kZWJ1ZygnVHJ5aW5nIHRvIGZpbmQgYSBjb25uZWN0ZWQgdGl6ZW4gZGV2aWNlJyk7XHJcbiAgbGV0IGdldERldmljZXMgPSBhc3luYyAoKSA9PiB7XHJcbiAgICBpZiAoKERhdGUubm93KCkgLSBzdGFydCkgPiB0aW1lb3V0TXMgfHwgdGltZXMgPiAxMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIGEgY29ubmVjdGVkIHRpemVuIGRldmljZS4nKTtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgIGxldCBkZXZpY2VzID0gYXdhaXQgdGhpcy5nZXRDb25uZWN0ZWREZXZpY2VzKCk7XHJcbiAgICAgIGlmIChkZXZpY2VzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICB0aW1lcysrO1xyXG4gICAgICAgIGxvZy5kZWJ1ZygnQ291bGQgbm90IGZpbmQgZGV2aWNlcywgcmVzdGFydGluZyBzZGIgc2VydmVyLi4uJyk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5yZXN0YXJ0U2RiKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBhd2FpdCBnZXREZXZpY2VzKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGRldmljZXM7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHRpbWVzKys7XHJcbiAgICAgIGxvZy5kZWJ1ZygnQ291bGQgbm90IGZpbmQgZGV2aWNlcywgcmVzdGFydGluZyBzZGIgc2VydmVyLi4uJyk7XHJcbiAgICAgIGF3YWl0IHRoaXMucmVzdGFydFNkYigpO1xyXG5cclxuICAgICAgcmV0dXJuIGF3YWl0IGdldERldmljZXMoKTtcclxuICAgIH1cclxuICB9O1xyXG4gIHJldHVybiBhd2FpdCBnZXREZXZpY2VzKCk7XHJcbn07XHJcblxyXG5zeXN0ZW1DYWxsTWV0aG9kcy5yZXN0YXJ0U2RiID0gYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIGlmICh0aGlzLnN1cHByZXNzS2lsbFNlcnZlcikge1xyXG4gICAgbG9nLmRlYnVnKGBOb3QgcmVzdGFydGluZyBzZGIgc2luY2UgJ3N1cHByZXNzS2lsbFNlcnZlcicgaXMgb25gKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGxvZy5kZWJ1ZygnUmVzdGFydGluZyBzZGInKTtcclxuICB0cnkge1xyXG4gICAgYXdhaXQgZXhlYyh0aGlzLmV4ZWN1dGFibGUucGF0aCwgWydraWxsLXNlcnZlciddKTtcclxuICAgIGxldCB7IHN0ZG91dCB9ID0gYXdhaXQgZXhlYyh0aGlzLmV4ZWN1dGFibGUucGF0aCwgWydzdGFydC1zZXJ2ZXInXSk7XHJcbiAgICByZXR1cm4gKHN0ZG91dC5pbmRleE9mKCdTZXJ2ZXIgaGFzIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5JykgPiAtMSkgPyB0cnVlIDogZmFsc2U7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgbG9nLmVycm9yKFwiRXJyb3Iga2lsbGluZyBTREIgc2VydmVyLCBnb2luZyB0byBzZWUgaWYgaXQncyBvbmxpbmUgYW55d2F5XCIpO1xyXG4gIH1cclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLnNkYkV4ZWMgPSBhc3luYyBmdW5jdGlvbiAoY21kLCBvcHRzID0ge30pIHtcclxuICBpZiAoIWNtZCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgbmVlZCB0byBwYXNzIGluIGEgY29tbWFuZCB0byBzZGJFeGVjKCknKTtcclxuICB9XHJcblxyXG4gIG9wdHMudGltZW91dCA9IG9wdHMudGltZW91dCB8fCBERUZBVUxUX1NEQl9FWEVDX1RJTUVPVVQ7XHJcbiAgbGV0IGV4ZWNGdW5jID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCEoY21kIGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcbiAgICAgICAgY21kID0gW2NtZF07XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGFyZ3MgPSB0aGlzLmV4ZWN1dGFibGUuZGVmYXVsdEFyZ3MuY29uY2F0KGNtZCk7XHJcbiAgICAgIGxvZy5kZWJ1ZyhgUnVubmluZyAnJHt0aGlzLmV4ZWN1dGFibGUucGF0aH0nIHdpdGggYXJnczogYCArXHJcbiAgICAgICAgYCR7SlNPTi5zdHJpbmdpZnkoYXJncyl9YCk7XHJcbiAgICAgIGxldCB7IHN0ZG91dCB9ID0gYXdhaXQgZXhlYyh0aGlzLmV4ZWN1dGFibGUucGF0aCwgYXJncywgb3B0cyk7XHJcbiAgICAgIHJldHVybiBzdGRvdXQudHJpbSgpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBpZiAoZS5zdGRvdXQpIHtcclxuICAgICAgICBsZXQgc3Rkb3V0ID0gZS5zdGRvdXQ7XHJcbiAgICAgICAgcmV0dXJuIHN0ZG91dDtcclxuICAgICAgfVxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGV4ZWN1dGluZyBzZGJFeGVjLiBPcmlnaW5hbCBlcnJvcjogJyR7ZS5tZXNzYWdlfSc7IGAgK1xyXG4gICAgICAgIGBTdGRlcnI6ICckeyhlLnN0ZGVyciB8fCAnJykudHJpbSgpfSc7IENvZGU6ICcke2UuY29kZX0nYCk7XHJcbiAgICB9XHJcbiAgfTtcclxuICByZXR1cm4gYXdhaXQgcmV0cnkoMiwgZXhlY0Z1bmMpO1xyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMuc2hlbGwgPSBhc3luYyBmdW5jdGlvbiAoY21kLCBvcHRzID0ge30pIHtcclxuICBpZiAoIWF3YWl0IHRoaXMuaXNEZXZpY2VDb25uZWN0ZWQoKSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyBkZXZpY2UgY29ubmVjdGVkLCBjYW5ub3QgcnVuIHNkYiBzaGVsbCBjb21tYW5kICcke2NtZC5qb2luKCcgJyl9J2ApO1xyXG4gIH1cclxuICBsZXQgZXhlY0NtZCA9IFsnc2hlbGwnXTtcclxuICBpZiAoY21kIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgIGV4ZWNDbWQgPSBleGVjQ21kLmNvbmNhdChjbWQpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBleGVjQ21kLnB1c2goY21kKTtcclxuICB9XHJcbiAgcmV0dXJuIGF3YWl0IHRoaXMuc2RiRXhlYyhleGVjQ21kLCBvcHRzKTtcclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcgPSBmdW5jdGlvbiAoZW1TdHIpIHtcclxuICBsZXQgcG9ydFBhdHRlcm4gPSAvZW11bGF0b3ItKFxcZCspLztcclxuICBpZiAocG9ydFBhdHRlcm4udGVzdChlbVN0cikpIHtcclxuICAgIHJldHVybiBwYXJzZUludChwb3J0UGF0dGVybi5leGVjKGVtU3RyKVsxXSwgMTApO1xyXG4gIH1cclxuICByZXR1cm4gZmFsc2U7XHJcbn07XHJcblxyXG5zeXN0ZW1DYWxsTWV0aG9kcy5nZXRDb25uZWN0ZWRFbXVsYXRvcnMgPSBhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxvZy5kZWJ1ZygnR2V0dGluZyBjb25uZWN0ZWQgZW11bGF0b3JzJyk7XHJcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IHRoaXMuZ2V0Q29ubmVjdGVkRGV2aWNlcygpO1xyXG4gICAgbGV0IGVtdWxhdG9ycyA9IFtdO1xyXG4gICAgZm9yIChsZXQgZGV2aWNlIG9mIGRldmljZXMpIHtcclxuICAgICAgbGV0IHBvcnQgPSB0aGlzLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcoZGV2aWNlLnVkaWQpO1xyXG4gICAgICBpZiAocG9ydCkge1xyXG4gICAgICAgIGRldmljZS5wb3J0ID0gcG9ydDtcclxuICAgICAgICBlbXVsYXRvcnMucHVzaChkZXZpY2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBsb2cuZGVidWcoYCR7ZW11bGF0b3JzLmxlbmd0aH0gZW11bGF0b3IocykgY29ubmVjdGVkYCk7XHJcbiAgICByZXR1cm4gZW11bGF0b3JzO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGxvZy5lcnJvckFuZFRocm93KGBFcnJvciBnZXR0aW5nIGVtdWxhdG9ycy4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xyXG4gIH1cclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLnNldERldmljZUlkID0gZnVuY3Rpb24gKGRldmljZUlkKSB7XHJcbiAgbG9nLmRlYnVnKGBTZXR0aW5nIGRldmljZSBpZCB0byAke2RldmljZUlkfWApO1xyXG4gIHRoaXMuY3VyRGV2aWNlSWQgPSBkZXZpY2VJZDtcclxuICBsZXQgYXJnc0hhc0RldmljZSA9IHRoaXMuZXhlY3V0YWJsZS5kZWZhdWx0QXJncy5pbmRleE9mKCctcycpO1xyXG4gIGlmIChhcmdzSGFzRGV2aWNlICE9PSAtMSkge1xyXG4gICAgdGhpcy5leGVjdXRhYmxlLmRlZmF1bHRBcmdzLnNwbGljZShhcmdzSGFzRGV2aWNlLCAyKTtcclxuICB9XHJcbiAgdGhpcy5leGVjdXRhYmxlLmRlZmF1bHRBcmdzLnB1c2goJy1zJywgZGV2aWNlSWQpO1xyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMuc2V0RGV2aWNlID0gZnVuY3Rpb24gKGRldmljZU9iaikge1xyXG4gIGxldCBkZXZpY2VJZCA9IGRldmljZU9iai51ZGlkO1xyXG4gIGxldCBlbVBvcnQgPSB0aGlzLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcoZGV2aWNlSWQpO1xyXG4gIHRoaXMuc2V0RW11bGF0b3JQb3J0KGVtUG9ydCk7XHJcbiAgdGhpcy5zZXREZXZpY2VJZChkZXZpY2VJZCk7XHJcbn07XHJcblxyXG5zeXN0ZW1DYWxsTWV0aG9kcy5nZXRTZGJWZXJzaW9uID0gXy5tZW1vaXplKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHNkYlZlcnNpb24gPSAoYXdhaXQgdGhpcy5zZGJFeGVjKCd2ZXJzaW9uJykpXHJcbiAgICAgIC5yZXBsYWNlKC9TbWFydFxcc0RldmVsb3BtZW50XFxzQnJpZGdlXFxzdmVyc2lvblxccyhbXFxkLl0qKVtcXHNcXHctXSovLCAnJDEnKTtcclxuICAgIGxldCBwYXJ0cyA9IHNkYlZlcnNpb24uc3BsaXQoJy4nKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZlcnNpb25TdHJpbmc6IHNkYlZlcnNpb24sXHJcbiAgICAgIHZlcnNpb25GbG9hdDogcGFyc2VGbG9hdChzZGJWZXJzaW9uKSxcclxuICAgICAgbWFqb3I6IHBhcnNlSW50KHBhcnRzWzBdLCAxMCksXHJcbiAgICAgIG1pbm9yOiBwYXJzZUludChwYXJ0c1sxXSwgMTApLFxyXG4gICAgICBwYXRjaDogcGFydHNbMl0gPyBwYXJzZUludChwYXJ0c1syXSwgMTApIDogdW5kZWZpbmVkLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgRXJyb3IgZ2V0dGluZyBzZGIgdmVyc2lvbi4gT3JpZ2luYWwgZXJyb3I6ICcke2UubWVzc2FnZX0nOyBgICtcclxuICAgICAgYFN0ZGVycjogJyR7KGUuc3RkZXJyIHx8ICcnKS50cmltKCl9JzsgQ29kZTogJyR7ZS5jb2RlfSdgKTtcclxuICB9XHJcbn0pO1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMucmVib290ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ3JlYm9vdCddKTtcclxuICAgIGlmIChyZXN1bHQuaW5kZXhPZignY29tbWFuZCBub3QgZm91bmQnKSA+IC0xKSB7XHJcbiAgICAgIGxvZy5kZWJ1ZygnRGV2aWNlIHJlcXVpcmVzIHNkYiB0byBiZSBydW5uaW5nIGFzIHJvb3QgaW4gb3JkZXIgdG8gcmVib290LiBSZXN0YXJ0aW5nIGRhZW1vbicpO1xyXG4gICAgICBhd2FpdCB0aGlzLnJvb3QoKTtcclxuICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ3JlYm9vdCddKTtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBpZiAocmVzdWx0LmluZGV4T2YoJ1JlYm9vdGluZycpID4gLTEpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBsb2cud2FybihgVW5hYmxlIHRvIHJlYm9vdCBkYWVtb246ICcke2Vyci5tZXNzYWdlfScuYCk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMucm9vdCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICB0cnkge1xyXG4gICAgYXdhaXQgdGhpcy5zZGJFeGVjKFsncm9vdCcsICdvbiddKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgbG9nLndhcm4oYFVuYWJsZSB0byByb290IHNkYiBkYWVtb246ICcke2Vyci5tZXNzYWdlfScuIENvbnRpbnVpbmdgKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn07XHJcblxyXG5zeXN0ZW1DYWxsTWV0aG9kcy51bnJvb3QgPSBhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHRoaXMuc2RiRXhlYyhbJ3Jvb3QnLCAnb2ZmJ10pO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBsb2cud2FybihgVW5hYmxlIHRvIHVucm9vdCBzZGIgZGFlbW9uOiAnJHtlcnIubWVzc2FnZX0nLiBDb250aW51aW5nYCk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMuZmlsZUV4aXN0cyA9IGFzeW5jIGZ1bmN0aW9uIChyZW1vdGVQYXRoKSB7XHJcbiAgbGV0IGZpbGVzID0gYXdhaXQgdGhpcy5scyhyZW1vdGVQYXRoKTtcclxuICByZXR1cm4gZmlsZXMubGVuZ3RoID4gMDtcclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLmxzID0gYXN5bmMgZnVuY3Rpb24gKHJlbW90ZVBhdGgpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHN0ZG91dCA9IGF3YWl0IHRoaXMuc2hlbGwoWydscycsIHJlbW90ZVBhdGhdKTtcclxuICAgIGxldCBsaW5lcyA9IHN0ZG91dC5zcGxpdCgnXFxuJyk7XHJcbiAgICByZXR1cm4gbGluZXMubWFwKChsKSA9PiBsLnRyaW0oKSlcclxuICAgICAgLmZpbHRlcihCb29sZWFuKVxyXG4gICAgICAuZmlsdGVyKChsKSA9PiBsLmluZGV4T2YoJ05vIHN1Y2ggZmlsZScpID09PSAtMSk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBpZiAoZXJyLm1lc3NhZ2UuaW5kZXhPZignTm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeScpID09PSAtMSkge1xyXG4gICAgICB0aHJvdyBlcnI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMuZ2V0U2RrQmluYXJ5UGF0aCA9IGFzeW5jIGZ1bmN0aW9uIChiaW5hcnlOYW1lKSB7XHJcbiAgbGV0IGJpbmFyeUxvYyA9IG51bGw7XHJcbiAgbGV0IGNtZCA9IHRoaXMuZ2V0Q29tbWFuZEZvck9TKCk7XHJcbiAgdHJ5IHtcclxuICAgIGxldCB7IHN0ZG91dCB9ID0gYXdhaXQgZXhlYyhjbWQsIFtiaW5hcnlOYW1lXSk7XHJcbiAgICBsb2cuaW5mbyhgVXNpbmcgJHtiaW5hcnlOYW1lfSBmcm9tICR7c3Rkb3V0fWApO1xyXG5cclxuICAgIGJpbmFyeUxvYyA9IHN0ZG91dC50cmltKCk7XHJcbiAgICByZXR1cm4gYmluYXJ5TG9jO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZmluZCAke2JpbmFyeU5hbWV9IFBsZWFzZSBzZXQgdGhlIFRJWkVOX0hPTUUgYCArXHJcbiAgICAgIGBlbnZpcm9ubWVudCB2YXJpYWJsZSB3aXRoIHRoZSBUaXplbiBTREsgcm9vdCBkaXJlY3RvcnkgcGF0aC5gKTtcclxuICB9XHJcbn07XHJcblxyXG5zeXN0ZW1DYWxsTWV0aG9kcy5nZXRDb21tYW5kRm9yT1MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgbGV0IGNtZCA9ICd3aGljaCc7XHJcbiAgaWYgKHN5c3RlbS5pc1dpbmRvd3MoKSkge1xyXG4gICAgY21kID0gJ3doZXJlJztcclxuICB9XHJcbiAgcmV0dXJuIGNtZDtcclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLnNldEVtdWxhdG9yUG9ydCA9IGZ1bmN0aW9uIChlbVBvcnQpIHtcclxuICB0aGlzLmVtdWxhdG9yUG9ydCA9IGVtUG9ydDtcclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLmtpbGxQcm9jZXNzID0gYXN5bmMgZnVuY3Rpb24gKHByb2Nlc3MsIG9wdHMgPSB7fSkge1xyXG4gIGxldCByZXN1bHQgPSBhd2FpdCB0aGlzLnNoZWxsKFtga2lsbGFsbCAke3Byb2Nlc3N9YF0sIG9wdHMpO1xyXG5cclxuICBpZiAocmVzdWx0LmluZGV4T2YoJ3Byb2Nlc3Mgbm90IGZvdW5kJykgPiAtMSkge1xyXG4gICAgbG9nLmVycm9yKGAke3Byb2Nlc3N9IHByb2Nlc3Mgbm90IGZvdW5kYCk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxufTtcclxuXHJcbnN5c3RlbUNhbGxNZXRob2RzLmNoZWNrUHJvY2Vzc1N0YXR1cyA9IGFzeW5jIGZ1bmN0aW9uIChwcm9jZXNzLCBvcHRzID0ge30pIHtcclxuICBsZXQgcmVzdWx0ID0gYXdhaXQgdGhpcy5zaGVsbChbYHBncmVwICR7cHJvY2Vzc31gXSwgb3B0cyk7XHJcbiAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMuc3RhcnRFeGVjID0gYXN5bmMgZnVuY3Rpb24gKGV4ZWMsIG9wdHMgPSB7fSkge1xyXG4gIGxldCBleGVjUGF0aCA9ICcvdXNyL2Jpbi8nICsgZXhlYztcclxuICBhd2FpdCB0aGlzLnNoZWxsKFtleGVjUGF0aF0sIG9wdHMpO1xyXG59O1xyXG5cclxuc3lzdGVtQ2FsbE1ldGhvZHMuc3RvcEF1dG9TbGVlcCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICBhd2FpdCB0aGlzLnJvb3QoKTtcclxuICBhd2FpdCB0aGlzLnNoZWxsKCdkZXZpY2VjdGwgZGlzcGxheSBzdG9wJyk7XHJcbn07XHJcblxyXG5zeXN0ZW1DYWxsTWV0aG9kcy5zdGFydEF1dG9TbGVlcCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICBhd2FpdCB0aGlzLnJvb3QoKTtcclxuICBhd2FpdCB0aGlzLnNoZWxsKCdkZXZpY2VjdGwgZGlzcGxheSBzdGFydCcpO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgc3lzdGVtQ2FsbE1ldGhvZHM7XHJcbiJdLCJmaWxlIjoibGliL3Rvb2xzL3N5c3RlbS1jYWxscy5qcyIsInNvdXJjZVJvb3QiOiIuLlxcLi5cXC4uIn0=
