"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger.js"));

let methods = {};

methods.getSdbWithCorrectSdbPath = async function () {
  this.executable.path = await this.getSdkBinaryPath('sdb');
  this.binaries.sdb = this.executable.path;
  return this.sdb;
};

methods.isDeviceConnected = async function () {
  let device = await this.getDeviceStatus();
  return device === 'device';
};

methods.mkdir = async function (remotePath) {
  return await this.shell([`mkdir ${remotePath}`]);
};

methods.isValidClass = function (classString) {
  return new RegExp(/^[a-zA-Z0-9./_]+$/).exec(classString);
};

methods.forceStop = async function (pkg) {
  return await this.shell(['app_launcher', '-k', pkg]);
};

methods.getSdbPath = function () {
  return this.executable.path;
};

methods.rimraf = async function (path) {
  await this.shell(['rm', '-rf', path]);
};

methods.push = async function (localPath, remotePath, opts) {
  await this.sdbExec(['push', localPath, remotePath], opts);
};

methods.pull = async function (remotePath, localPath) {
  await this.sdbExec(['pull', remotePath, localPath], {
    timeout: 60000
  });
};

methods.processExists = async function (processName) {
  try {
    if (!this.isValidClass(processName)) {
      throw new Error(`Invalid process name: ${processName}`);
    }

    let stdout = await this.shell('ps -ef');

    for (let line of stdout.split(/\r?\n/)) {
      line = line.trim().split(/\s+/);
      let pkgColumn = line[line.length - 1];

      if (pkgColumn && pkgColumn.indexOf(processName) !== -1) {
        return true;
      }
    }

    return false;
  } catch (e) {
    _logger.default.errorAndThrow(`Error finding if process exists. Original error: ${e.message}`);
  }
};

methods.forwardPort = async function (systemPort, devicePort) {
  _logger.default.debug(`Forwarding system: ${systemPort} to device: ${devicePort}`);

  await this.sdbExec(['forward', `tcp:${systemPort}`, `tcp:${devicePort}`]);
};

methods.removePortForward = async function (systemPort) {
  _logger.default.debug(`Removing forwarded port socket connection: ${systemPort} `);

  await this.sdbExec(['forward', `--remove`, `tcp:${systemPort}`]);
};

methods.ping = async function () {
  let stdout = await this.shell(['echo', 'ping']);

  if (stdout.indexOf('ping') === 0) {
    return true;
  }

  throw new Error(`SDB ping failed, returned ${stdout}`);
};

methods.restart = async function () {
  try {
    return await this.restartSdb();
  } catch (e) {
    _logger.default.errorAndThrow(`Restart failed. Orginial error: ${e.message}`);
  }
};

methods.takeScreenShot = async function () {
  let stdout = await this.shell(['enlightenment_info -dump_screen']);

  if (stdout.indexOf('dump_screen.png') > -1) {
    return true;
  } else {
    return false;
  }
};

var _default = methods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9zZGItY29tbWFuZHMuanMiXSwibmFtZXMiOlsibWV0aG9kcyIsImdldFNkYldpdGhDb3JyZWN0U2RiUGF0aCIsImV4ZWN1dGFibGUiLCJwYXRoIiwiZ2V0U2RrQmluYXJ5UGF0aCIsImJpbmFyaWVzIiwic2RiIiwiaXNEZXZpY2VDb25uZWN0ZWQiLCJkZXZpY2UiLCJnZXREZXZpY2VTdGF0dXMiLCJta2RpciIsInJlbW90ZVBhdGgiLCJzaGVsbCIsImlzVmFsaWRDbGFzcyIsImNsYXNzU3RyaW5nIiwiUmVnRXhwIiwiZXhlYyIsImZvcmNlU3RvcCIsInBrZyIsImdldFNkYlBhdGgiLCJyaW1yYWYiLCJwdXNoIiwibG9jYWxQYXRoIiwib3B0cyIsInNkYkV4ZWMiLCJwdWxsIiwidGltZW91dCIsInByb2Nlc3NFeGlzdHMiLCJwcm9jZXNzTmFtZSIsIkVycm9yIiwic3Rkb3V0IiwibGluZSIsInNwbGl0IiwidHJpbSIsInBrZ0NvbHVtbiIsImxlbmd0aCIsImluZGV4T2YiLCJlIiwibG9nIiwiZXJyb3JBbmRUaHJvdyIsIm1lc3NhZ2UiLCJmb3J3YXJkUG9ydCIsInN5c3RlbVBvcnQiLCJkZXZpY2VQb3J0IiwiZGVidWciLCJyZW1vdmVQb3J0Rm9yd2FyZCIsInBpbmciLCJyZXN0YXJ0IiwicmVzdGFydFNkYiIsInRha2VTY3JlZW5TaG90Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUVBLElBQUlBLE9BQU8sR0FBRyxFQUFkOztBQUVBQSxPQUFPLENBQUNDLHdCQUFSLEdBQW1DLGtCQUFrQjtBQUNuRCxPQUFLQyxVQUFMLENBQWdCQyxJQUFoQixHQUF1QixNQUFNLEtBQUtDLGdCQUFMLENBQXNCLEtBQXRCLENBQTdCO0FBQ0EsT0FBS0MsUUFBTCxDQUFjQyxHQUFkLEdBQW9CLEtBQUtKLFVBQUwsQ0FBZ0JDLElBQXBDO0FBQ0EsU0FBTyxLQUFLRyxHQUFaO0FBQ0QsQ0FKRDs7QUFNQU4sT0FBTyxDQUFDTyxpQkFBUixHQUE0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O0FBQ0QsR0FGRCxNQUVPO0FBQ0wsV0FBTyxLQUFQO0FBQ0Q7QUFDRixDQVBEOztlQVNlcEMsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcclxuXHJcbmxldCBtZXRob2RzID0ge307XHJcblxyXG5tZXRob2RzLmdldFNkYldpdGhDb3JyZWN0U2RiUGF0aCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICB0aGlzLmV4ZWN1dGFibGUucGF0aCA9IGF3YWl0IHRoaXMuZ2V0U2RrQmluYXJ5UGF0aCgnc2RiJyk7XHJcbiAgdGhpcy5iaW5hcmllcy5zZGIgPSB0aGlzLmV4ZWN1dGFibGUucGF0aDtcclxuICByZXR1cm4gdGhpcy5zZGI7XHJcbn07XHJcblxyXG5tZXRob2RzLmlzRGV2aWNlQ29ubmVjdGVkID0gYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIGxldCBkZXZpY2UgPSBhd2FpdCB0aGlzLmdldERldmljZVN0YXR1cygpO1xyXG4gIHJldHVybiAoZGV2aWNlID09PSAnZGV2aWNlJyk7XHJcbn07XHJcblxyXG5tZXRob2RzLm1rZGlyID0gYXN5bmMgZnVuY3Rpb24gKHJlbW90ZVBhdGgpIHtcclxuICByZXR1cm4gYXdhaXQgdGhpcy5zaGVsbChbYG1rZGlyICR7cmVtb3RlUGF0aH1gXSk7XHJcbn07XHJcblxyXG5tZXRob2RzLmlzVmFsaWRDbGFzcyA9IGZ1bmN0aW9uIChjbGFzc1N0cmluZykge1xyXG4gIHJldHVybiBuZXcgUmVnRXhwKC9eW2EtekEtWjAtOS4vX10rJC8pLmV4ZWMoY2xhc3NTdHJpbmcpO1xyXG59O1xyXG5cclxubWV0aG9kcy5mb3JjZVN0b3AgPSBhc3luYyBmdW5jdGlvbiAocGtnKSB7XHJcbiAgcmV0dXJuIGF3YWl0IHRoaXMuc2hlbGwoWydhcHBfbGF1bmNoZXInLCAnLWsnLCBwa2ddKTtcclxufTtcclxuXHJcbm1ldGhvZHMuZ2V0U2RiUGF0aCA9IGZ1bmN0aW9uICgpIHtcclxuICByZXR1cm4gdGhpcy5leGVjdXRhYmxlLnBhdGg7XHJcbn07XHJcblxyXG5tZXRob2RzLnJpbXJhZiA9IGFzeW5jIGZ1bmN0aW9uIChwYXRoKSB7XHJcbiAgYXdhaXQgdGhpcy5zaGVsbChbJ3JtJywgJy1yZicsIHBhdGhdKTtcclxufTtcclxuXHJcbm1ldGhvZHMucHVzaCA9IGFzeW5jIGZ1bmN0aW9uIChsb2NhbFBhdGgsIHJlbW90ZVBhdGgsIG9wdHMpIHtcclxuICBhd2FpdCB0aGlzLnNkYkV4ZWMoWydwdXNoJywgbG9jYWxQYXRoLCByZW1vdGVQYXRoXSwgb3B0cyk7XHJcbn07XHJcblxyXG5tZXRob2RzLnB1bGwgPSBhc3luYyBmdW5jdGlvbiAocmVtb3RlUGF0aCwgbG9jYWxQYXRoKSB7XHJcbiAgYXdhaXQgdGhpcy5zZGJFeGVjKFsncHVsbCcsIHJlbW90ZVBhdGgsIGxvY2FsUGF0aF0sIHt0aW1lb3V0OiA2MDAwMH0pO1xyXG59O1xyXG5cclxubWV0aG9kcy5wcm9jZXNzRXhpc3RzID0gYXN5bmMgZnVuY3Rpb24gKHByb2Nlc3NOYW1lKSB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghdGhpcy5pc1ZhbGlkQ2xhc3MocHJvY2Vzc05hbWUpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBwcm9jZXNzIG5hbWU6ICR7cHJvY2Vzc05hbWV9YCk7XHJcbiAgICB9XHJcbiAgICBsZXQgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbCgncHMgLWVmJyk7XHJcbiAgICBmb3IgKGxldCBsaW5lIG9mIHN0ZG91dC5zcGxpdCgvXFxyP1xcbi8pKSB7XHJcbiAgICAgIGxpbmUgPSBsaW5lLnRyaW0oKS5zcGxpdCgvXFxzKy8pO1xyXG4gICAgICBsZXQgcGtnQ29sdW1uID0gbGluZVtsaW5lLmxlbmd0aCAtIDFdO1xyXG4gICAgICBpZiAocGtnQ29sdW1uICYmIHBrZ0NvbHVtbi5pbmRleE9mKHByb2Nlc3NOYW1lKSAhPT0gLTEpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGxvZy5lcnJvckFuZFRocm93KGBFcnJvciBmaW5kaW5nIGlmIHByb2Nlc3MgZXhpc3RzLiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XHJcbiAgfVxyXG59O1xyXG5cclxubWV0aG9kcy5mb3J3YXJkUG9ydCA9IGFzeW5jIGZ1bmN0aW9uIChzeXN0ZW1Qb3J0LCBkZXZpY2VQb3J0KSB7XHJcbiAgbG9nLmRlYnVnKGBGb3J3YXJkaW5nIHN5c3RlbTogJHtzeXN0ZW1Qb3J0fSB0byBkZXZpY2U6ICR7ZGV2aWNlUG9ydH1gKTtcclxuICBhd2FpdCB0aGlzLnNkYkV4ZWMoWydmb3J3YXJkJywgYHRjcDoke3N5c3RlbVBvcnR9YCwgYHRjcDoke2RldmljZVBvcnR9YF0pO1xyXG59O1xyXG5cclxubWV0aG9kcy5yZW1vdmVQb3J0Rm9yd2FyZCA9IGFzeW5jIGZ1bmN0aW9uIChzeXN0ZW1Qb3J0KSB7XHJcbiAgbG9nLmRlYnVnKGBSZW1vdmluZyBmb3J3YXJkZWQgcG9ydCBzb2NrZXQgY29ubmVjdGlvbjogJHtzeXN0ZW1Qb3J0fSBgKTtcclxuICBhd2FpdCB0aGlzLnNkYkV4ZWMoWydmb3J3YXJkJywgYC0tcmVtb3ZlYCwgYHRjcDoke3N5c3RlbVBvcnR9YF0pO1xyXG59O1xyXG5cclxubWV0aG9kcy5waW5nID0gYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIGxldCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZWNobycsICdwaW5nJ10pO1xyXG4gIGlmIChzdGRvdXQuaW5kZXhPZigncGluZycpID09PSAwKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgdGhyb3cgbmV3IEVycm9yKGBTREIgcGluZyBmYWlsZWQsIHJldHVybmVkICR7c3Rkb3V0fWApO1xyXG59O1xyXG5cclxubWV0aG9kcy5yZXN0YXJ0ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIHRyeSB7XHJcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5yZXN0YXJ0U2RiKCk7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFJlc3RhcnQgZmFpbGVkLiBPcmdpbmlhbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XHJcbiAgfVxyXG59O1xyXG5cclxubWV0aG9kcy50YWtlU2NyZWVuU2hvdCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICBsZXQgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ2VubGlnaHRlbm1lbnRfaW5mbyAtZHVtcF9zY3JlZW4nXSk7XHJcbiAgaWYgKHN0ZG91dC5pbmRleE9mKCdkdW1wX3NjcmVlbi5wbmcnKSA+IC0xKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IG1ldGhvZHM7XHJcbiJdLCJmaWxlIjoibGliL3Rvb2xzL3NkYi1jb21tYW5kcy5qcyIsInNvdXJjZVJvb3QiOiIuLlxcLi5cXC4uIn0=
